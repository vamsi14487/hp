var WSB;(function(n){class t{static init(){t.aadVerificationContainer=_ge("aadVerificationContainer");t.dialogBox=_ge("dialogBox");t.dynamicPane=_ge("dynamic-pane");t.msbDsbRoot=_ge("msb_dsb_root");t.dynamicPaneFullWidth=_ge("dynamic-pane-full");t.flyoutContainer=_ge("flyoutContainer");t.footer=_ge("footer");t.groups=_ge("groups");t.menuContainer=_ge("menuContainer");t.narratorMessageContainer=_ge("narratorMessageContainer");t.overlayContainer=_ge("overlayContainer");t.performanceWidget=_ge("performanceWidget");t.popoverContainer=_ge("popoverContainer");t.qfContainer=_ge("qfContainer");t.qfContainerScroll=_ge("qfContainerScroll");t.qfPreviewPane=_ge("qfPreviewPane");t.qfPreviewScrollArea=_ge("qfPreviewScrollArea");t.root=_ge("root");t.rootContainer=_ge("rootContainer");t.scopesHeader=_ge("scopesHeader");t.shimmerContainer=n.config.showShimmerOnDismiss?_ge("shimmerContainer"):undefined;t.suggestionsList=_ge("suggestionsList");t.topHitHeader=_ge("topHitHeader");t.topResults=_ge("topResults");t.workUpsellBanner=_ge("workUpsellBanner");t.messageBannerBottom=_ge("messageBannerBottom");t.messageBannerTop=_ge("messageBanner");t.notificationBanner=_ge("notificationBanner");t.chatIframe=_ge("qf-chat")}}n.StaticHtmlElements=t})(WSB||(WSB={})),function(n){function u(){if(!n.isMiniSerpEnabled())return 0;let t=7;return n.config.allowAnswersToAutoOpenMiniSerp||(t&=-2),n.config.allowDNavToAutoOpenMiniSerp||(t&=-3),n.config.allowWebToAutoOpenMiniSerp||(t&=-5),t}class t{}t.QuickAccess=n.config.newQuickAccess?"::{F874310E-B6B7-47DC-BC84-B9E6B38F5903}":"::{679F85CB-0220-4080-B29B-5540CC05AAB6}";t.ThisPC="::{20D04FE0-3AEA-1069-A2D8-08002B30309D}";t.ControlPanel="::{26EE0668-A00A-44D7-9371-BEB064C98683}";const r=[t.QuickAccess,t.ThisPC];class i{constructor(){this.refreshSetting();this.refreshEntrypointApp()}refreshEntrypointApp(){SearchAppWrapper.CortanaApp.hostingEnvironment==3?this.EntryPointApp=1:n.config.forceSettingsAppExperience?this.EntryPointApp=3:(this.EntryPointApp=0,this.AlwaysWide=this.isAlwaysWide(),n.config.initSearchHomeAvailable&&(this.SearchHomeAvailable=n.config.searchHomeSupported))}refreshSetting(){i.TextScaleFactor=SearchAppWrapper.CortanaApp.textScaleFactor;const n=SearchAppWrapper.CortanaApp.queryFormulationView.searchHistory;i.DeviceHistoryEnabled=n&&n.isDeviceHistoryEnabled}clearDefaults(){this.QfMode=0;this.PreviewPaneAvailable=!1;this.MiniSERPMode=0;this.AlwaysWide=!1;this.SearchBoxOnTop=!0;this.AllowKeyboardNavCycling=!0;this.AllowKeyboardNavOffCanvas=!1;this.ScopesAvailable=!1;this.FlatListWithoutGroups=!1;this.MaxSuggestionsWhenFlatList=0;this.SearchHomeAvailable=undefined;this.FirstSuggestionSelectedByDefault=!0;this.AllowProtocolSyntheticSuggestions=!0;this.PanelCanResize=!1}isAlwaysWide(){let r=i.TextScaleFactor>1.25,t=!1;try{t=SearchAppWrapper.CortanaApp.isWideSearch}catch(f){}let u=t!==!1;return(u||n.config.alwaysWideBeforeRS5)&&!r}getAlwaysWideAndPrevewPaneAvailable(){let f=i.TextScaleFactor>1.25,t;try{t=SearchAppWrapper.CortanaApp.isWideSearch}catch(o){}let r;r=n.config.useCobaltCSS?t!==!1:t!==!1&&!!n.Host.getFeatureDWORD("WideAtStartupDelta").featureValue;let u=(r||n.config.alwaysWideBeforeRS5)&&!f,e=u||n.PreviewPane&&!r&&t!==!1;return[u,e]}OnAppVisible(){this.clearDefaults();this.refreshSetting();this.refreshEntrypointApp();n.isFileExplorerCurrentPathThisPcOrQuickAccess=!1;switch(this.EntryPointApp){case 1:let i=n.safeExecute(()=>SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentLocation,"fileExplorerSuggestionPage.currentLocation");i&&!i.startsWith("::")?this.QfMode=5:n.config.wsbInControlPanel&&i&&i.startsWith(t.ControlPanel)?this.QfMode=9:n.contains(r,i)?(n.isFileExplorerCurrentPathThisPcOrQuickAccess=!0,this.QfMode=5):this.QfMode=999999;this.AllowKeyboardNavOffCanvas=!0;this.FlatListWithoutGroups=!0;this.MaxSuggestionsWhenFlatList=10;this.FirstSuggestionSelectedByDefault=!1;this.AllowProtocolSyntheticSuggestions=!1;this.PanelCanResize=!0;break;case 3:this.QfMode=7;this.FlatListWithoutGroups=!0;this.MaxSuggestionsWhenFlatList=10;this.AllowProtocolSyntheticSuggestions=!1;break;case 0:default:{const i=n.config.enableFindInStart&&SearchAppWrapper.CortanaApp.entryPoint=="WNSFIS",[t,r]=i?[!0,!1]:this.getAlwaysWideAndPrevewPaneAvailable();this.QfMode=i?11:t?1:r?0:4;this.PreviewPaneAvailable=i?!1:t||r;this.MiniSERPMode=this.PreviewPaneAvailable?u():0;this.AlwaysWide=t;let f;f=n.shouldUseMsbEnterpriseScopes()?t?n.config.scopesOrderBeginAlwaysWideMsbEnterprise.length>0:n.config.scopesOrderBeginMsbEnterprise.length>0:t?n.config.scopesOrderBeginAlwaysWide.length>0:n.config.scopesOrderBegin.length>0;this.ScopesAvailable=f;this.SearchBoxOnTop=!1;this.SearchHomeAvailable=n.config.searchHomeSupported}}}}n.RuntimeConfiguration=i}(WSB||(WSB={})),function(n){var t;(function(n){let t;(function(n){n.User="SRCHHPGUSR"})(t=n.CookieNames||(n.CookieNames={}));let i;(function(n){n.AutoSuggest="AS"})(i=n.CrumbNames||(n.CrumbNames={}));let r;(function(n){n.CursorPosition="cp";n.ConversationId="cvid";n.LogicalId="logicalId";n.SuggestionCount="sc";n.PartialQuery="pq";n.SuggestionPosition="sp";n.SuggestionType="qs";n.PreviewPaneSuggestionType="qsc";n.SkipValue="sk";n.PreviewPaneSkipValue="skc";n.Ghosting="ghc";n.Css="css";n.Count="count";n.DataSet="ds";n.SessionId="sid";n.TimeStamp="qt";n.Query="q";n.ImpressionGuid="ig";n.QFQuery="qry";n.BaseQuery="bq";n.FormCode="form";n.HashedMuid="nclid";n.RequestElToken="elvr";n.ElTokenValue="elv";n.AppId="appid";n.History="history";n.NoHistory="nohs";n.ApiTextDecoration="textdecorations";n.ClientId="clientid";n.Market="mkt";n.Scope="scope";n.CountryCode="cc";n.HomeGeographicRegion="hgr";n.SetLang="setlang";n.ZeroInputSerp="zis";n.Host="host";n.CortanaVersion="version";n.QfMode="qfm";n.SearchHistorySettingOff="seahisoff"})(r=n.QueryParams||(n.QueryParams={}));let u;(function(n){n.ImpressionGuid="X-MSEdge-IG"})(u=n.Headers||(n.Headers={}));let f;(function(n){n.HitHighlighting="h";n.PopularNow="p";n.Local="l";n.Answers="a"})(f=n.Options||(n.Options={}));let e;(function(n){n.Id="id";n.Query="query";n.Url="url";n.Navigation="nav";n.Type="stype";n.Autocomplete="hc";n.InstData="h";n.AriaLabel="aria-label"})(e=n.SuggestionAttributes||(n.SuggestionAttributes={}))})(t=n.Service||(n.Service={}))}(WSB||(WSB={})),function(n){function ii(t,i){if(i){let i=nt.exec(t);return i&&n.TopLevelDomains[i[1].toLowerCase()]==1}return nt.test(t)}function ri(n){return gt.test(n)}function fi(t){let r=t.substr(1).split("%").map(n=>parseInt(n,16));for(var i=0;i<r.length;++i){let t=[r[i],r[i+1]||0,r[i+2]||0,r[i+3]||0];if(t[0]>=240&&++i&&t[3]<128||t[0]>=224&&++i&&t[2]<128||t[0]>=192&&++i&&t[1]<128||t[0]<192&&t[0]>=128||t[0]<32||n.contains(ui,t[0]))return!1}return!0}function ei(n){return n.replace(/%25/g,"%2525").replace(/%([^0-9a-fA-F])/g,"%25$1").replace(/%([^0-9a-fA-F])/g,"%25$1").replace(/%(.[^0-9a-fA-F])/g,"%25$1").replace(/%(.[^0-9a-fA-F])/g,"%25$1").replace(/%(.)?$/g,"%25$1").match(/[^%]+|(?:%..)*/g).map(n=>n.startsWith("%")&&!fi(n)?n.replace(/%/g,"%25"):n).join("")}function h(t){let i=t;return t.includes("%")&&(t=n.safeExecute(()=>ei(t),"sanitizeUrlEncodings",i,i)),n.safeExecute(()=>decodeURI(t),"safeDecodeURI",i,i)}function r(n,t){if(!n)return null;if(n=n.trim(),n.includes("%")&&c(n))if(n.includes("?")){let[,t,i]=/([^?]*)(.*)/.exec(n);t=h(t);n=t+i}else n=h(n);let r=bt.exec(n);if(!r)return null;let u=r[0].length;if(t&&u<n.length)return null;let i={length:u,type:0,protocol:r[1]||"",auth:r[2]||"",hostname:r[3]||"",port:r[4]||"",path:r[5]||"",parameters:r[6]||"",unparsedSegment:n.substr(u)};return i.auth&&!i.auth.includes(":")&&!i.protocol&&!i.port&&!i.path&&!i.parameters?null:i.protocol||i.path&&i.path.endsWith("/")?i:kt.test(i.hostname)||ii(i.hostname,t)||w.test(i.hostname)||k.test(i.hostname)?i:(i.type=i.path&&!ri(i.path)?1:2,i)}function it(n,t){let r=new RegExp("[?&]{1}"+t+"=([^&]+)([\\/\\\\][^?#]*)?([?#].*)?","i"),i=n.match(r);return i?i[1]:null}function ci(n){return si.some(t=>n.startsWith(t))||oi.test(n)||n.toLocaleLowerCase().includes(hi)}function li(n,t,i){let e=0,o=0,s=0;(t.startsWith("read:")||t.startsWith("ftp:"))&&(t=t.replace(f,""));let u=r(t,!0);u&&u.type==0&&(e=vi(i,u),o=rt(i,t,u),s=yi(i,u));n.protocolMatchLength=e;n.domainMatchLength=o;n.pathMatchLength=s}function ai(n,t){let u=0;(n.startsWith("read:")||n.startsWith("ftp:"))&&(n=n.replace(f,""));let i=r(n,!0);return i&&i.type==0&&(u=rt(t,n,i)),u}function vi(n,t){let i=f.exec(n),r=i?i[1]:n.trim();return t.protocol.startsWith(r)?r.length:0}function rt(t,i,r){if(w.test(r.hostname)||k.test(r.hostname))return r.hostname.startsWith(t)||i.startsWith(t)?t.length:0;let u=r.hostname.split("."),f;if(u.length==1)f=HitHighlightingParser.addMarkers(u[0],t);else{u=u.length>2&&n.SecondLevelDomains[u[u.length-2]]?u.splice(0,u.length-2):u.splice(0,u.length-1);let i=u.join(".");f=HitHighlightingParser.addMarkers(i,t)}let e=f.indexOf(HitHighlightingParser.startMarker);if(e==-1)return 0;if(t.includes("."))return t.endsWith("/")&&(t=t.substr(0,t.length-1)),r.hostname.includes(t)?t.length:0;let o=f.indexOf(HitHighlightingParser.endMarker);return o-e-1}function yi(n,t){if(!t.path)return 0;let i=HitHighlightingParser.addMarkers(t.path,n),r=i.indexOf(HitHighlightingParser.startMarker);if(r==-1)return 0;let u=i.indexOf(HitHighlightingParser.endMarker);return u-r-1}function pi(n){return n=ft(n,!1),dt.test(n)}function ut(n){return f.test(n)}function wi(n){return a.test(n)}function c(n){return pt.test(n)}function bi(n){return ut(n)&&!c(n)}function ki(n){let t;return t=typeof n=="string"?n:l(n,!0),t=gi(t),t.trim().replace(/^ht+p(s)?[:;]+[\\\/]*|^\/*/ig,(n,t)=>t?"https://":"http://")}function ft(n,t){return t?n.includes("/")||(n=n.replace(/\\/g,"/")):n.startsWith("//")||n.includes("\\")||(n=n.replace(/\//g,"\\")),n}function di(n){return n=ft(n,!0).replace(/\/+/g,"/"),(n.startsWith("/")?"file:/":"file:///")+n}function gi(n){if(!n||!n.includes("\\"))return n;let i=n.includes("?")?n.indexOf("?"):n.length,r=n.includes("#")?n.indexOf("#"):n.length,t=Math.min(i,r),u=n.substring(0,t),f=n.substr(t);return u.replace(/\\/g,"/")+f}function l(n,t){let i=n.protocol?n.protocol:"";return i+=!t&&n.auth?n.auth:"",i+=n.hostname,i+=n.port?n.port:"",i+=n.path?n.path:"",i+=n.parameters?n.parameters:"",i+(n.unparsedSegment?n.unparsedSegment:"")}function i(n,t){let i=n;if(t&1){let n=et.exec(i);n&&(i=n[1])}if(t&2){let n=ot.exec(i);n&&(i=n[1])}if(t&4){let n=st.exec(i);n&&(i=n[1])}if(t&8){let n=a.exec(i);n&&(i=n[1])}if(t&16){let n=nr.exec(i);n&&(i=n[1])}if(t&32){let n=r(i,!1);if(n){n.protocol=n.protocol.toLocaleLowerCase();n.hostname=n.hostname.toLocaleLowerCase();let t=l(n);i=i.replace(/^(\s*)(?:[^\s]*)(\s*)$/g,"$1"+t+"$2")}}return t&64&&(i=h(i)),i}function tr(n){return a.test(n)}function e(n){return ot.test(n)?1:et.test(n)?2:st.test(n)?3:0}function ir(n,t,r){if(t){if(t=="/")return n;let f=i(t,7);if(f!=t)return n;let u=i(n,r?7:6);if(!u)return n;let o=t.toLowerCase();if("https".startsWith(o)&&!u.startsWith(t))return n;let s=i(f,8);if(s!=f)return u;let e=i(u,8);return e?"www".startsWith(o)&&!e.startsWith(t)?u:e:u}return i(n,r?15:14)||n}function rr(n,t){let i=e(t);switch(e(n)){case 1:return i!=2;case 2:return i!=1;case 3:case 0:return!0}}function ur(t,r,u){if(i(r,127)!=i(u,127))return!1;let f=e(t.originalQuery);return n.contains([1,2],f)&&!rr(r,u)?!1:!0}function ht(n){let t=r(n,!0);if(!t)return null;let i=v(t);return i?t.path.toLocaleLowerCase():null}function v(n){let t=n.hostname.split(".");return n.hostname&&t.length>1?t[t.length-1]=="com"&&fr.some(n=>t[t.length-2]==n):!0}function er(n){let i=!1,t=n.hostname.toLowerCase().split(".");return n.hostname&&t.length>1&&(i=(t[t.length-1]=="com"||t[t.length-1]=="cn")&&t[t.length-2]=="msn"),i}function or(t){if(t=="https://www.bing.com/?form=EDGSTP&pc=MESP"||t=="https://www.bing.com/?form=EDGSTP&pc=MESPB")return!0;let i=ht(t);return!!i&&n.contains(n.WebSearchPaths,i)}function sr(n){let t=n.match(/^https:\/\/www\.bing\.com\/search\?q=([^&]*)&/);return t&&t[1]?t[1].split("+").join(" "):null}function hr(n){let t=r(n.replace(/^ftp:/g,"http:"),!0);return(t?t.hostname:null)||""}function cr(t){let r=t.queryToFetch.toLocaleLowerCase();if(!r)return!1;let u=i(r,15);return!u||n.contains(["/","ht","htt","http","https","ww","www"],r)||u!=r&&"www".startsWith(i(r,7))}function lr(n){if(yt.test(n)||f.test(n))return!0;let t=n.replace(ni,"/");ti.test(t)?t=t.replace(tt,"."):t.includes(".")&&(t=t.replace(tt,""));let i=r(t,!0);return i&&i.type==0}function ar(n){return n.replace(/[;,/?:@&=+$ ]/g,n=>`%${n.charCodeAt(0).toString(16)}`)}function vr(n,t,i){return v(r(n,!0))?lt(ct(n,i),t):n}function ct(n,t){return o(n,"setlang",t)}function lt(n,t){return o(n,"cc",t)}function o(n,t,i){const{params:u,anchor:f}=yr(n);var r=u,e=it(u,t);return e==null?r=n.indexOf("?")>=0?r.concat(`&${t}=${i}`):r.concat(`?${t}=${i}`):(r=r.replace(new RegExp(`${t}=${e}`,"i"),""),r=o(r,t,i)),f.length>0&&(r=r.concat("#",f)),r=r.replace("?&","?"),r.replace("&&","&")}function yr(n){var t=n.split("#");return t.length==2?{params:t[0],anchor:t[1]}:{params:t[0],anchor:""}}const u="\\-\\s\\[\\]\\/\\\\!@#$%^&*()+={}:;~`\"'|<,>.。?",at="(?:[^"+u+"]-*)*[^"+u+"](?:-*[^"+u+"])*",y="(?:[^"+u+"]-*)*[^"+u+"0-9](?:-*[^"+u+"])*",vt="(?:(?:"+at+"[.。])*"+y+")[.。]?",p="(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])",s="(?:(?:"+p+"\\.){3}"+p+")",w=new RegExp("^"+s+"$"),t="(?:[0-9a-fA-F]{1,4})",b="(?::(?:(?::"+t+"){1,7}|:)|(?:"+t+":){1,7}:|(?:"+t+":){7}"+t+"|(?:"+t+":){1,6}(?::"+t+"){1}|(?:"+t+":){1,5}(?::"+t+"){2}|(?:"+t+":){1,4}(?::"+t+"){3}|(?:"+t+":){1,3}(?::"+t+"){4}|(?:"+t+":){1,2}(?::"+t+"){5}|(?:"+t+":){1,1}(?::"+t+"){6}|fe80:(?::"+t+"){0,4}%[0-9]+|::ffff:"+s+"|)",k=new RegExp("^\\["+b+"\\]$","i"),d="ht+ps?[:;]+[\\\\/]*",yt=new RegExp(d,"i"),g=d+"|/+",pt=new RegExp("^("+g+")","i"),wt=vt+"|"+s+"|\\["+b+"\\]",bt=new RegExp("^("+g+")?([^/@#?]*@)?("+wt+")(:(?:6553[0-5]|655[0-2][0-9]|65[0-4][0-9]{2}|6[0-4][0-9]{3}|[1-5][0-9]{1,4}|[1-9][0-9]{0,3}))?([\\/\\\\][^?#]*)?([?#].*)?","i"),kt=/^localhost[.。]?$/,nt=new RegExp("[.。]("+y+")[.。]?$","i"),dt=/((^[\\]{2}).+)|(^[a-z]:\\.*)/i,f=/^([a-z0-9\-]+):/i,gt=/\s/,tt=/\s+/g,ni=/\s+\/(?!\/)/g,ti=/([^\/]|^)\/(?!\/)/;n.WebSearchPaths=["/search","/entityexplore"];const ui=[33,39,40,41,42,91,93];n.tryParseUrl=r;n.getQueryStringParam=it;const oi=/file:\/\/\/[^:\/]+:\/[^\/]+\/[^\/]+\/AppData\//i,si=["ms-appx:","ms-appx-web:","ms-browser-extension:",],hi="microsoft.microsoftedge_8wekyb3d8bbwe";n.isJunkUrl=ci;n.computeUrlMatchLengths=li;n.computeDomainlMatchLength=ai;n.isUncOrLocalPath=pi;n.startsWithProtocol=ut;n.startsWithWww=wi;n.isHttpProtocol=c;n.isNonHttpProtocol=bi;n.cleanAndFixUrlProtocol=ki;n.cleanAndFixUncOrLocalPath=di;n.parsedUrlToString=l;const et=/^ht+ps:\/*(.*)/i,ot=/^ht+p:\/*(.*)/i,st=/^\/{2,}(.*)/,a=/^www\.(.*)/i,nr=/^(.*[^:\/])\/+$/;n.normalizeUrl=i;n.hasWww=tr;n.getProtocol=e;n.prettyPrintUrl=ir;n.isDuplicateUrl=ur;let fr=["bing","staging-bing-int","working-bing-int","bing-int","bing-exp","binginternal"];n.tryGetBingPathLC=ht;n.isBingHost=v;n.isMsnHost=er;n.isBingSearchUrl=or;n.extractQueryFromBingSearchUrl=sr;n.getDomain=hr;n.isEmptyUrlPrefix=cr;n.queryLooksLikeUrl=lr;n.encodeURIComponentForWindowsProtocol=ar;n.setBingUrlLanguageAndRegion=vr;n.setUrlLang=ct;n.setUrlCC=lt;n.setUrlParameter=o}(WSB||(WSB={})),function(n){let i;(function(n){function t(t,i,r,u,f,e){let o={T:n.QFPERFPING_EVENT_NAME,ST:r,CVID:u,OFFSETS:i,STATE:f,V:n.QFPERFPING_VERSION,RFC:e};return{ImpressionGuid:t,EventType:n.CLIENTINST_EVENT_TYPE,Data:o}}n.CLIENTINST_EVENT_TYPE="ClientInst";n.QFPERFPING_EVENT_NAME="QFPerfPing";n.CLICK_EVENT_TYPE="Click";n.QFPERFPING_VERSION="2";n.QFPERFPING_INVALID_MEASURE=-2;n.INVALID_SEQUENCE_NUMBER=-2;n.KVALUE_SUGGESTIONS_START=1e3;n.KVALUE_SUFFIX_START=1;n.KVALUE_NON_SUGGESTIONS_START=100;n.KVALUE_DSB_MSB_CONTENT=2e3;n.KVALUE_MSB_DSB_SWITCH=4e4;n.KVALUE_DSB_CURRENT_DAY_CONTENT=5e4;n.KVALUE_DSB_PAST_DAYS_CONTENT=6e4;n.KVALUE_DSB_IFRAME_CONTENT=7e4;n.KVALUE_DSB_V2_CONTENT=8e4;n.KVALUE_DSB_MERGED_CONTENT=9e4;n.DEFAULT_APP_NAMESPACE="SmartSearch";n.DEFAULT_SERVICE_NAME="AutoSuggest";n.createPerfPingEvent=t})(i=n.InstrumentationCommon||(n.InstrumentationCommon={}));class t{constructor(n,t,i,r){this._kValue=n;this._qsCode=t;this._handOffType=i;this._workflow=r;this._properties={}}static createInstrumentedItem(n,i){return new t(t.generateKValue(n),i)}static createInstrumentedItemHandOffOverride(n,i,r){return new t(t.generateKValue(n),i,r)}static createInstrumentedItemHandOffOverrideAndQS(n,i,r,u){let f=new t(t.generateKValue(n),i,r);return f.setProperty(u,i),f}static createInstrumentedItemKvalueOverride(n,i,r,u){return new t(n,i,r,u)}static createInstrumentedItemForReformulation(n,i){return new t(t.generateKValue(n),i,998)}static createInstrumentedItemNoHandOff(n,i){return new t(t.generateKValue(n),i,999)}static getNonSuggestionInstrumentedItem(n,i,r){if(!i[n])throw new Error(`${n} not found in kvalues map`);return new t(i[n],n,r)}getKValue(){return this._kValue}getAppNS(){return t.AppNS}getLayoutKValue(){return this._kValue+"."+t.Suffix}getHValue(){return"ID="+t.AppNS+","+this.getLayoutKValue()}getHandoffType(){return this._handOffType}getQsCode(){return this._qsCode}getWorkflow(){return this._workflow}setProperty(n,t){this._properties[n]=t}getProperties(){return Object.keys(this._properties).length>0?this._properties:undefined}static resetKValues(n){delete this._keystrokesKValues[n]}static generateKValue(n){let r=n,t=this._keystrokesKValues[r];return t>0||(t=i.KVALUE_SUGGESTIONS_START),this._keystrokesKValues[r]=++t,t}}t.AppNS=i.DEFAULT_APP_NAMESPACE;t.Suffix=i.KVALUE_SUFFIX_START;t._keystrokesKValues={};n.InstrumentedItem=t}(WSB||(WSB={})),function(n){function dt(){return matchMedia("screen and (-ms-high-contrast)").matches}function gt(){return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isOffline)?!1:navigator.onLine}function c(n){return n?n.replace(pt,"$1").replace(wt,"$1 "):n}function ni(n){return n?n.replace(/[-{}]/g,"").toLowerCase():null}function ti(n){return!n||Object.keys(n).length===0}function ii(n){return n.canFail}function l(n,t,i,r){n&&(n=n.slice(0,t)+e+n.slice(t,n.length));let u=i(n);if(u){let n=u.indexOf(e);t=n!=-1?n:t;u=u.replace(e,"")}r(u,t)}function ri(n){if(!n)return SharedLogHelper.LogError("getInputType",null,new Error("event object is missing")),0;switch(n.pointerType){case"mouse":return 2;case"touch":return 3;case"pen":return 4;default:return 1}}function a(n,...t){t.forEach(t=>delete n.enabledDataSources[t])}function ui(n){return n?n.toLowerCase()!="cn"&&n.toLowerCase()!="ru":!1}function v(i,r){if(!i||!r)return!1;var u=!n.config.bingFetchEnabledRegions||n.config.bingFetchEnabledRegions.length==0||t(n.config.bingFetchEnabledRegions,i.toLowerCase()),f=r.split("-")[0],e=!n.config.bingFetchEnabledLang||n.config.bingFetchEnabledLang.length==0||t(n.config.bingFetchEnabledLang,f.toLowerCase());return u&&e}function fi(i,r){if(!i||!r)return!1;var u=!n.config.miniSerpEnabledRegions||n.config.miniSerpEnabledRegions.length==0||t(n.config.miniSerpEnabledRegions,i.toLowerCase()),f=r.split("-")[0],e=!n.config.miniSerpEnabledLang||n.config.miniSerpEnabledLang.length==0||t(n.config.miniSerpEnabledLang,f.toLowerCase());return u&&e}function ei(t,i){const r=`${i}:${t}`;return r===y?ft():(y=r,n.isMarketEligible(t,i,n.config.trendingSearchInSHEligibleLangRegionPairs))}function oi(t,i){if(!t||!i)return!1;const r=`${i}:${t}`;return r===p?h:(p=r,n.isMarketEligible(t,i,n.config.DSBFullWidthMarkets))}function si(t,i){if(!t||!i)return!1;const r=`${i}:${t}`;return r===w?et():(w=r,n.isMarketEligible(t,i,n.config.thumbnailForTSEligibleLangRegionPairs))}function hi(t,i,r){let u=t.queryToFetch&&t.queryToFetch.length<n.config.minQueryLengthForWebProvider||!v(i,r);return u&&a(t,"Web"),u}function b(t){if(t){t=n.normalizeUrl(t,15);for(let n=1;n<t.length-1;++n)if(kt.includes(t[n]))return!0}return!1}function ci(t,i,r){let u,f;return r||(r=0),l(t,i,n=>c(n),(n,t)=>{u=n,f=t}),u&&(n.config&&n.config.doNotRemoveSpaceAfterIn&&u.toLocaleLowerCase().endsWith(" in ")||(u=u.trim()),f=Math.min(f,u.length)),{originalQuery:t,originalCursorPosition:i,queryToFetch:u,cursorPosition:f,enabledDataSources:{},equals:n=>(u?u.toLowerCase():u)==(n.queryToFetch?n.queryToFetch.toLowerCase():n.queryToFetch)&&r==n.topHitRestriction,isMultiWord:b(u),getCacheKey:()=>u,topHitRestriction:r}}function k(i,r){return r&&!r.enabledDataSources[i]?!1:t(n.config.enabledDataSources,i)}function d(i,r,u,f){let e=f.enabledDataSources[i];return e?e.suggestionIsEnabled&&!e.suggestionIsEnabled(r,u)?!1:t(n.config.enabledDataSources,i):!1}function t(n,t){return n.indexOf(t)!=-1}function li(n,t){let i=n.indexOf(t);return i!=-1?(n.splice(i,1),!0):!1}function ai(n,t){let i=n.findIndex(t);return i!=-1?n.splice(i,1)[0]:null}function vi(n,t,i){if(t<100)for(let r=n.length-1;n.length>t&&r>=0;--r)i(n[r])&&n.splice(r,1)}function yi(n,i){return n.filter(n=>!t(i,n))}function pi(n,t){if(n.length!=t.length)return!1;for(let i=0;i<n.length;++i)if(n[i]!=t[i])return!1;return!0}function wi(n,t){if(n===t)return!0;if(!n||!t||Object.keys(n).length!=Object.keys(t).length)return!1;for(let i in n)if(n[i]!=t[i])return!1;return!0}function g(){return n.getCurrentDate().getTime()}function bi(){if(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.dsbMockCurrentSec)return n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.dsbMockCurrentSec;let t=n.getCurrentDate();return t.getHours()*3600+t.getMinutes()*60+t.getSeconds()}function u(n){let t=Math.abs(Math.floor(n));return(t<10?"0":"")+t}function ki(){let t=n.getCurrentDate(),i=-t.getTimezoneOffset(),r=i>=0?"+":"-";return t.getFullYear()+"-"+u(t.getMonth()+1)+"-"+u(t.getDate())+"T"+u(t.getHours())+":"+u(t.getMinutes())+":"+u(t.getSeconds())+"."+u(t.getMilliseconds())+r+u(i/60)+":"+u(i%60)}function di(n,t){return n?n.replace(bt,(n,i)=>t[i]):n}function gi(n){let t=n?n.number:null,i=n?n.name:null;return t==-2147023673||i=="Canceled"}function i(n,t,i,r,u,f){try{return n()}catch(e){return f||SharedLogHelper.LogError(t,r,e),u&&u(e),i}}function o(n,t,r,u,f,e){return sb_st(()=>i(n,r,null,u,f,e),t)}function nr(n,...t){i(()=>sj_evt.fire(n,...t),n)}function tr(n,t){o(t,1,n)}function s(n,t){let i=[],r=!0,u=(...n)=>{r?i.push(n):t.apply(null,n)};n(u);r=!1;i.forEach(n=>t.apply(null,n))}function ir(n,t,i){f=n&&ct()!="ms-appx-web:"&&lt()!="searchapp.bundleassets.example";nt=f&&v(t,i);tt=f&&fi(t,i);it=f&&ei(t,i);h=f&&oi(t,i);rt=f&&si(t,i);ut=f&&ui(t)}function rr(){return(n.Host===null||n.Host===void 0?void 0:n.Host.isFirstPartySearchDisabled())?!1:f}function ur(){return nt}function fr(){return tt}function ft(){return it}function er(){return h}function et(){return rt}function or(){const t=n.AccessTokenManager.getWindowsAccountType();return!!n.config.isCodexEligible&&ut&&!n.isThirdPartySearchAllowed()&&(t==2&&n.Host.getIsCodexUser()||t==3)}function lr(n){return t(sr,n)}function ar(n){return t(ht,n)}function vr(n){return t(hr,n)}function yr(n){return n==37}function pr(n){return t(ot,n)}function wr(n){return t(st,n)}function br(n){return t(cr,n)}function kr(n,t){return n==121&&t||n==93}function dr(n,t){return n==8||n==46||n==88&&t.ctrlKey}function ct(){return _w.location.protocol}function lt(){return _w.location.host}function gr(){return _w.location.pathname}function nu(){let n=_d.activeElement;return!n||n.id.endsWith("sb_form_q")?_d.body:n}function at(t){return t&&+t!=n.WindowsApiDefaultDate&&t.getTime&&!isNaN(t.getTime())&&t.getFullYear()!=1600}function vt(t){if(!at(t))return null;let i=t.getTime(),r=g();return Math.abs(r-i)/n.DayToMs}function tu(n){let t=vt(n);return t!==null&&t>14}function iu(n){return n==="i"?13:n==="v"?14:0}function fu(n){return encodeURIComponent(n).replace(/[!'()*]/g,escape).replace(/%20/g,"+")}const e=String.fromCharCode(57346),pt=new RegExp("^\\s*("+e+")?\\s*"),wt=new RegExp("\\s*("+e+")?\\s+","g"),bt=/{([0-9]+)}/g,kt=" -_/\\";n.DayToMs=864e5;n.HourToMs=36e5;n.MinuteToMs=6e4;n.DebugSourceName="WindowsSearchBox";SharedLogHelper.RegisterErrorFilter(t=>{let i=t?t.number:null,r=t?t.name:null;return i===-2147023673||i===-2147215328||i===-2147215865&&(n.AnaheimDataProvider===null||n.AnaheimDataProvider===void 0?void 0:n.AnaheimDataProvider.getRetryCount())>0||r==="Canceled"});n.isHighContrastEnabled=dt;n.isBrowserOnline=gt;n.cleanQuery=c;n.cleanGuid=ni;n.isEmpty=ti;n.canIconFail=ii;n.mantainCursorPositionIn=l;n.getInputType=ri;n.disableDataSources=a;let y="",p="",w="";n.disableWebDataSourceIfNeeded=hi;n.isMultiWord=b;n.baseParseQuery=ci;n.isDataSourceEnabled=k;n.isSuggestionTypeEnabled=d;n.contains=t;n.tryRemove=li;n.removeFirstWhere=ai;n.trimList=vi;n.except=yi;n.sequenceEqual=pi;n.objEquals=wi;n.log=()=>{};n.getCurrentDate=()=>new Date;n.getCurrentTime=g;n.getCurrentTimeInSeconds=bi;n.getDateWithTimezone=ki;n.fetchWrapper=(n,t,i)=>i();n.formatString=di;n.isCancellation=gi;n.safeExecute=i;n.safeSetTimeout=o;n.safeFireEvent=nr;n.invokeAsynchronously=tr;n.ensureCallbackIsAsync=s;let f=!0,nt=!0,tt=!0,it=!0,h=!0,rt=!0,ut=!0;n.refreshBingEnabledCache=ir;n.isBingEnabled=rr;n.isWebProviderEnabled=ur;n.isMiniSerpEnabled=fr;n.isTrendingSearchEnabled=ft;n.isDSBV2EnabledMarket=er;n.isThumbnailForTSEnabled=et;n.isCodexEligible=or;const sr=[3,16,17,18,19,20,144,145,],ot=[38,203,211,],hr=[39,37],st=[40,204,212,],ht=ot.concat(st),cr=ht.concat(37,39,36,35);n.isFunctionalKey=lr;n.isUpOrDownKey=ar;n.isLeftOrRightKey=vr;n.isLeftKey=yr;n.isUpKey=pr;n.isDownKey=wr;n.isMovingCursorKey=br;n.isContextMenuKey=kr;n.isDeletionKey=dr;n.getWindowProtocol=ct;n.getWindowHost=lt;n.getWindowPath=gr;n.getCurrentActiveElement=nu;n.WindowsApiDefaultDate=-116444736e5;n.isValidDate=at;n.getTimeDiffInDays=vt;n.olderThan2Weeks=tu;n.verticalToHandoffType=iu;class yt{constructor(){this._cancellations={};this._lastId=0}register(n,t,i){let r=++this._lastId;return this._cancellations[r]={action:n,skipOnDismissAndLaunch:t,where:i},r}unregister(n){delete this._cancellations[n]}cancelAll(n){for(let t in this._cancellations){let r=this._cancellations[t];r.skipOnDismissAndLaunch&&n||i(()=>r.action(),r.where)}this._cancellations={}}}n.CancellationManager=yt;class ru{static getItem(n){var t;try{return((t=_w.localStorage)===null||t===void 0?void 0:t.getItem(n))||null}catch(i){return SharedLogHelper.LogError("localStorage",i,new Error("getItem")),null}}static setItem(n,t){var i;try{(i=_w.localStorage)===null||i===void 0?void 0:i.setItem(n,t)}catch(r){SharedLogHelper.LogError("localStorage",r,new Error("setItem"))}}static removeItem(n){var t;try{return(t=_w.localStorage)===null||t===void 0?void 0:t.removeItem(n)}catch(i){SharedLogHelper.LogError("localStorage",i,new Error("removeItem"))}}static removeItemsWithKeyPrefix(n){try{if(!_w.localStorage)return;const t=[];for(let i=0;i<_w.localStorage.length;i++){const r=_w.localStorage.key(i);(r===null||r===void 0?void 0:r.startsWith(n))&&t.push(r)}for(let n=0;n<t.length;n++)_w.localStorage.removeItem(t[n])}catch(t){SharedLogHelper.LogError("localStorage",t,new Error("removeItemsWithKeyPrefix"))}}static clear(){var n;try{return(n=_w.localStorage)===null||n===void 0?void 0:n.clear()}catch(t){SharedLogHelper.LogError("localStorage",t,new Error("clear"))}}static getLength(){var n;try{return((n=_w.localStorage)===null||n===void 0?void 0:n.length)||0}catch(t){return SharedLogHelper.LogError("localStorage",t,new Error("length")),0}}static key(n){var t;try{return((t=_w.localStorage)===null||t===void 0?void 0:t.key(n))||null}catch(i){return SharedLogHelper.LogError("localStorage",i,new Error("key")),null}}}n.LightweightStorage=ru;class r{static resetSequenceNumber(){this._sequenceNumber=0}static getSequenceNumber(){return this._sequenceNumber}static incrementSequenceNumber(){this._sequenceNumber++}}r._sequenceNumber=0;n.SequenceNumberManager=r;class uu{constructor(t,i,r,u,f){this._suggestionsParsers=t;this._rootViewModel=i;this._suggestionsRenderingManager=r;this._webProviders=u;this._otherProviders=f;this._cancellationManager=new yt;n.Host.bindShown(()=>{this._lastQuery=null,this._currentQuery=null,this._isPaneDismissed=!1});n.Host.bindDismissed(()=>{this.clearFetchTimer(),this.finishPreviousQuery(!0),this.finalizeKeystroke(!0),this._isPaneDismissed=!0,n.config&&n.config.dismissForceFlush&&Log2&&Log2.ForceFlush(),this._rootViewModel.onDismiss()});n.Host.bindQueryChangedOrInitialized((t,i)=>this.onQueryChanged(t,n.config.d,i),undefined,n.config.enableCoreQueryChangeFirst);n.Host.bindOnSubmit((n,t,i)=>this.onSubmit(n,t,i));n.Host.initializeEvents();sj_be(_d.body,"dragstart",t=>{if(!n.isSearchDragAndDropEnabled()){t.preventDefault();t.stopPropagation();return}});sj_b.addEventListener("click",n=>{n.shiftKey&&sj_pd(n)})}clearFetchTimer(){this._fetchTimer&&(sb_ct(this._fetchTimer),this._fetchTimer=null)}finishPreviousQuery(n){this.cancelPreviousQuery(n);this._suggestionsRenderingManager.resetTimers()}finalizeKeystroke(t){let i=r.getSequenceNumber();i>0&&n.InstrumentationHelper.finalizeKeystrokeLog(i);t||r.incrementSequenceNumber()}onQueryChanged(t,u,f){if(this._currentQuery=t,!f&&this._lastQuery&&this._lastQuery.equals(this._currentQuery))this._rootViewModel.onQueryChanged(this._currentQuery,r.getSequenceNumber());else this.clearFetchTimer(),this._completedDataSources={},(this._lastQuery||f)&&this.cancelPreviousQuery(!1),n.config.optimizeGetQueryLogic&&n.Host.getQuery(!0),this.logQueryChange(f,!1),u<=0||this._currentQuery.isSearchHomeZI||this._currentQuery.isThirdPartyZI?(this.fetchForQueryChange(f),i(()=>this.logVariantEventSearchHome(),"logVariantEventSearchHome",null,null,null,!0)):this._fetchTimer=o(()=>{this._fetchTimer=null,this.fetchForQueryChange(f)},u,"fetchTimer"),this._lastQuery=this._currentQuery}logQueryChange(t,i){let u=t?this._currentQuery:n.Host.getQuery();if(u.equals(this._currentQuery)){(this._lastQuery||t)&&this.finishPreviousQuery(i);this.finalizeKeystroke(!1);let u=r.getSequenceNumber();n.InstrumentationHelper.instrumentQueryChangedRequest(u,this._currentQuery)}}onSubmit(t,i,u){this._fetchTimer&&(this._currentQuery||(this._currentQuery=n.Host.getQuery(!0)),this.logQueryChange(!1,!0),this.fetchForQueryChange(!1));this._rootViewModel.submit(t,i,r.getSequenceNumber(),u,this._isPaneDismissed)}cancelPreviousQuery(n){this._cancellationManager&&this._cancellationManager.cancelAll(n)}fetchForQueryChange(t){this.clearFetchTimer();let i=t?this._currentQuery:n.Host.getQuery();if(i.equals(this._currentQuery)){let t=r.getSequenceNumber(),u=!n.config.enabledDataSources.some(n=>k(n,this._currentQuery));if(u)this._rootViewModel.onQueryChanged(this._currentQuery,t);let f=!1;if(this._suggestionsRenderingManager.initiateSequenceNumber(t,this._currentQuery,()=>f=!0),!u){let u=()=>!this._isPaneDismissed&&(n.config.d>0?i.equals(this._currentQuery):t==r.getSequenceNumber())&&!f,e=(new Date).getTime(),o=(n,r,f,o,s,h)=>this.onResponseReceived(i,t,n,r,f,u,o,s,e,h),h=r=>{n.InstrumentationHelper.instrumentFetchesBegin(t);n.config.enabledDataSources.forEach(t=>{n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark(t+".Fetch")});n.fetchWrapper(i,u,()=>{if(n.isThirdPartySearchAllowed()&&i.scope==n.Scope.ThirdPartyWeb){this.fetchTPWeb(i,t,r,u);return}this._webProviders.forEach(n=>{this.fetchWeb(i,n,t,r,u)});this._otherProviders.forEach(n=>{this.fetch(i,n,t,r,u)})});n.InstrumentationHelper.instrumentFetchesEnd(t);this._rootViewModel.onQueryChanged(this._currentQuery,t)};s(h,o)}}}fetchTPWeb(t,r,u,f){var e;if(n.isThirdPartySearchAllowed()&&((e=t.thirdPartySearch)===null||e===void 0?void 0:e.applicationUserModelId)){let o=n.Host.initUrlParameters(),e=n.Host.getThirdPartyDataProviderById(t.thirdPartySearch.applicationUserModelId);i(()=>e.fetch(t,u,r,this._cancellationManager,f,o),"fetch "+e.getName())}}fetchWeb(t,r,u,f,e){const s=n.Service.QueryParams;let o=n.Host.getCustomUrlParameters(t);n.Host.shouldRequestEltoken()&&(o[s.RequestElToken]="1");n.RuntimeConfiguration.DeviceHistoryEnabled||(o[s.SearchHistorySettingOff]="1");o[s.CursorPosition]=t.cursorPosition.toString();o[s.ConversationId]=n.Host.getConversationId();o[s.ImpressionGuid]=n.InstrumentationHelper.getImpressionGuid(u);let h=n.Host.getCustomHeaders(t);i(()=>r.fetch(t,f,u,this._cancellationManager,e,o,h),"fetch "+r.getName())}fetch(n,t,r,u,f){i(()=>t.fetch(n,u,r,this._cancellationManager,f),"fetch "+t.getName())}onResponseReceived(t,i,r,u,f,e,o,h,c,l){if(e()){if(this._completedDataSources[r]){n.config.forceUseNifQF&&r=="Web"||SharedLogHelper.LogError("onResponseReceived",r,new Error(`Data source already completed: ${r}`));return}n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark(r+".Fetch");this._completedDataSources[r]=!l;n.InstrumentationHelper.instrumentResponseReceived(i,r,f,o,h,l);let c=(r,u,o)=>{if(n.InstrumentationHelper.instrumentDataSourceParsed(i,r),e()){if(n.isThirdPartySearchAllowed()&&t.scope==n.Scope.ThirdPartyWeb){this.onTPSuggestionsParsed(i,r,u);return}this.onSuggestionsParsed(t,i,r,f,u,o,l)}},a=n=>{let f=this._suggestionsParsers[r];f?f.parse(t,i,r,u,e,n,this._cancellationManager):(SharedLogHelper.LogError("onResponseReceived",r,new Error("No parser for data source")),n(r,[],null))};s(a,c)}}onTPSuggestionsParsed(t,r,u){i(()=>this._rootViewModel.update(!0,u.slice(0,1),!1,t,u.slice(1),[],[r],[{type:n.GroupType.SearchSuggestions}],!0,{}),"rootViewModel.update",0,null,t=>{n&&n.fallbackToPrepopulatedBundle&&n.fallbackToPrepopulatedBundle(t)})}onSuggestionsParsed(t,i,r,u,f,e,o){f=f.filter(n=>d(r,n.type,n.handoffType,t));n.InstrumentationHelper.instrumentDataSource(i,r,f,e);this._rootViewModel.onSuggestionsParsed(t,i,r,u,f,e);this._suggestionsRenderingManager.queueSuggestions(i,r,f,e,o)}logVariantEventSearchHome(){const t=n.AccessTokenManager.getWindowsAccountType();if(this._currentQuery.isSearchHomeZI&&this._currentQuery.scope==n.Scope.All||this._currentQuery.isWorkScopeZI&&_w.bfbWsbTel&&(t===1||t===4)&&n.isMsbEnterprise()&&!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isGccHighTenant())){let t=n.shouldShowDSBLayout(this._currentQuery);bfbWsbTel.logVariantEvent(t)}}}n.Core=uu;n.encodeQueryParameter=fu}(WSB||(WSB={})),function(n){function vt(t){return n.contains(st,t)}function yt(t){return n.contains(ht,t)}function pt(t){return n.contains(p,t)}function wt(t){return n.contains(ct,t)}function bt(t){return n.contains(lt,t)}function w(){return n.isDataSourceEnabled("SSUE",null)}function b(t){var r=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();let i=!n.config.userProfileButtonEnabled||r==t;switch(t){case 2:return i&&n.isSubstrateOutlookAccountConnected;case 1:return i&&n.isSubstrateO365AccountConnected;case 4:return i&&n.isSubstrateO365AccountConnected&&n.isSubstrateOutlookAccountConnected;default:return!1}}function kt(t){let i=SearchAppWrapper.CortanaApp.authenticationManager.getAllSearchWebAccountsAsync;var r=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return i?!0:r==t}function dt(){return{dataSource:"ANA",groupType:t.SearchSuggestions,requirements:[1],conditionalRequirements:t=>n.isAnaheimDataEnabled(!1,t),suggestionIsEnabled:t=>t=="ANAH"||t=="ANAR"||t=="ANAF"||t=="ANAT"||n.config.topHitMuse&&t=="ANATH"}}function r(n,t,i,r){return o(n,undefined,t,i,r)}function o(t,i,r,u,f){return{dataSource:t,groupType:i,requirements:[1],conditionalRequirements:t=>(r==1?n.isCloudSearchEnabledAadCache:n.isCloudSearchEnabledMsaCache)&&(!f||f(t))&&(u||t&&t.queryToFetch&&t.queryToFetch.length>=n.config.minLengthFor3SonL1)&&kt(r)&&b(r)}}function gt(){return n.isDocSourceEnabledInQws("SREE")}function k(){if(n.msbHost!==null&&n.msbHost!==void 0)return n.msbHost.qfUtils.isMsbQfInScriptsEarlyLoadState()}function s(t,r){return{dataSource:"MSBC",requirements:[1,2],conditionalRequirements:u=>{if(!n.msbHost)return!1;const f=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType(),e=r===i.Documents&&n.msbHost.qfUtils.isMsbFileReady(),o=r===i.Web&&!n.msbHost.features.isWorkScopeApplicable(),s=!r||e||o;return n.isCloudSearchEnabledAadCache&&s&&(t||u&&u.queryToFetch&&u.queryToFetch.length>=at)&&(f==1||f==4||n.config.msbMockToken||k())&&(n.msbHost.isTenantMsbEnabled()||k())&&!n.msbHost.isGccHighTenant()}}}function c(){var t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return!n.isCloudSearchEnabledAadCache&&!n.isCloudSearchEnabledMsaCache||t==3||t==0||!w()?!1:!b(t)}function d(){return n.isDocSourceEnabledInQws("SSUE")}function g(){var t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return t==2||t==4}function nt(t){return t.isSearchHomeZI&&(n.isDataSourceEnabled("SSUE",t)||n.isDataSourceEnabled("SREE",t))}function ni(n,t){return t.siteTitle&&n.isSearchHomeZI}function ti(){n.ScopeConfig[i.All].getEmptyZIMessages=()=>u(i.All,"EmptyAllMessage",n.isBingEnabled()?"EmptyAllSubMessage":"EmptyAllSubMessageNoWeb",it(!0));n.RuntimeConfig.SearchHomeAvailable==1?(n.ScopeConfig[i.All].icon=n.getSearchSuggestionIcon(),n.ScopeConfig[i.All].enabledDataSourcesForZeroInput=[{dataSource:"TOPP",groupType:t.TopApps,suggestionGroupToggler:h(t.TopApps),conditionalRequirements:t=>n.shouldShowZIDataSource(t)},{dataSource:"DFLS",groupType:t.CuratedSuggestions,suggestionGroupToggler:h(t.CuratedSuggestions),conditionalRequirements:t=>n.canShowCuratedSuggestions(t)},{dataSource:"CUSE",groupType:t.CuratedSettings,suggestionGroupToggler:h(t.CuratedSettings),conditionalRequirements:t=>n.shouldShowStaticSearchHome(t)&&n.config.undocked&&n.RuntimeConfig.AlwaysWide},{dataSource:"QSCH",groupType:t.QuickSearch,suggestionGroupToggler:h(t.QuickSearch),conditionalRequirements:t=>n.canShowQuickSearch(t)},{dataSource:"MSBC",groupType:t.QuickWorkSearch,conditionalRequirements:()=>n.canShowQuickWorkSearch()},{dataSource:"MRU",groupType:t.MRUHistory,conditionalRequirements:()=>n.enableMRUSearchHome()||n.config.enableMRUDSBV2&&n.shouldShowDSBFullWidth()},{dataSource:"MWS",groupType:t.MRUHistory,conditionalRequirements:t=>n.enableMRUSearchHome()&&n.canShowWorkSearchMru(t)},{dataSource:"MPP",groupType:t.MRUHistory,conditionalRequirements:()=>n.enableMRUSearchHome()},{dataSource:"MST",groupType:t.MRUHistory,conditionalRequirements:()=>n.enableMRUSearchHome()},{dataSource:"MFF",suggestionIsEnabled:()=>!0,groupType:t.MRUHistory,conditionalRequirements:()=>n.enableMRUSearchHome()},{dataSource:"MRS",groupType:t.MRUHistory,requirements:[1,2],conditionalRequirements:()=>n.enableMRUSearchHome()||n.config.enableMRUDSBV2&&n.shouldShowDSBFullWidth()},{dataSource:"ANA",groupType:t.AnaheimDataList,requirements:[1],conditionalRequirements:t=>n.config.enableWin11SSH?n.shouldShowStaticSearchHome(t)&&n.isAnaheimDataEnabled(!0,t):n.isAnaheimDataEnabled(!0,t),suggestionIsEnabled:n=>n=="QSSG"||n=="ANAT"||n=="ANAH"||n=="ANAR"},{dataSource:"TS",groupType:t.TrendingSearchData,conditionalRequirements:t=>n.isTrendingSearchDataEnabled(t)||n.isTrendingSearchDataInWin11LeftPaneEnabled(t),suggestionIsEnabled:n=>n=="TS"},{dataSource:"RWQ",groupType:t.MRUHistory,conditionalRequirements:t=>n.isRecentWorkSearchEnabled(t)},o("SSUE",t.RecommendedDocs,1,!0,()=>d()),o("SREE",t.RecommendedDocs,1,!0,()=>gt()),{dataSource:"Web",groupType:t.SearchSuggestions,conditionalRequirements:()=>n.config.forceUseNifSH&&n.RuntimeConfiguration.DeviceHistoryEnabled},{dataSource:"QWQS",groupType:t.MsbQuickWorkQueriesTopList,conditionalRequirements:t=>(t===null||t===void 0?void 0:t.isSearchHomeZI)&&t.scope===i.All&&n.msbHost&&n.msbHost.features.isQwsEnabled()&&n.msbHost.isEduTenant()}],n.config.enableAnaheimWin11ZITopSites?(n.shouldShowStaticSearchHome(n.Host.getQuery(!0))&&(n.ScopeConfig[i.All].staticGroupOrderForZeroInput=()=>[t.Upsell,t.MRUHistory,t.CuratedSuggestions,t.AnaheimDataTile,t.CuratedSettings,t.TopApps,t.AnaheimDataList,t.QuickWorkSearchTopList,t.MsbQuickWorkQueriesTopList,t.QuickWorkSearch,t.RecommendedDocs,t.MsbOnRampButton,t.TrendingSearchData,t.QuickSearch,t.PromoBanner,]),n.canShowWorkScopeZiPageContent(n.Host.getQuery(),!0)&&(n.ScopeConfig[i.Work].staticGroupOrderForZeroInput=()=>[t.MRUHistory,t.CuratedSuggestions,t.CuratedSettings,t.TopApps,t.QuickWorkSearchTopList,t.MsbQuickWorkQueriesTopList,t.QuickWorkSearch,t.RecommendedDocs,t.MsbOnRampButton,t.TrendingSearchData,t.QuickSearch,])):n.shouldShowStaticSearchHome(n.Host.getQuery(!0))?(n.ScopeConfig[i.All].staticGroupOrderForZeroInput=()=>[t.Upsell,t.MRUHistory,t.CuratedSuggestions,t.CuratedSettings,t.AnaheimDataTile,t.TopApps,t.AnaheimDataList,t.QuickWorkSearchTopList,t.MsbQuickWorkQueriesTopList,t.QuickWorkSearch,t.RecommendedDocs,t.MsbOnRampButton,t.TrendingSearchData,t.QuickSearch,t.PromoBanner,],n.canShowWorkScopeZiPageContent(n.Host.getQuery(),!0)&&(n.ScopeConfig[i.Work].staticGroupOrderForZeroInput=()=>[t.MRUHistory,t.CuratedSuggestions,t.CuratedSettings,t.TopApps,t.QuickWorkSearchTopList,t.MsbQuickWorkQueriesTopList,t.QuickWorkSearch,t.RecommendedDocs,t.MsbOnRampButton,t.TrendingSearchData,t.QuickSearch,])):n.shouldShowDSBLayout(n.Host.getQuery())?(n.ScopeConfig[i.All].staticGroupOrderForZeroInput=()=>[t.Upsell,t.MRUHistory,t.CuratedSuggestions,t.AnaheimDataTile,t.TopApps,t.AnaheimDataList,t.QuickWorkSearchTopList,t.MsbQuickWorkQueriesTopList,t.QuickWorkSearch,t.RecommendedDocs,t.MsbOnRampButton,t.TrendingSearchData,t.QuickSearch,t.PromoBanner,],n.canShowWorkScopeZiPageContent(n.Host.getQuery(),!0)&&(n.ScopeConfig[i.Work].staticGroupOrderForZeroInput=()=>[t.MRUHistory,t.CuratedSuggestions,t.QuickWorkSearchTopList,t.MsbQuickWorkQueriesTopList,t.QuickWorkSearch,t.RecommendedDocs,t.MsbOnRampButton,])):n.ScopeConfig[i.All].staticGroupOrderForZeroInput=n.shouldEnableAnaheimResetDefault()?()=>[t.Upsell,t.PromoBanner,t.AnaheimDataTile,t.TopApps,t.MRUHistory,t.AnaheimDataList,t.QuickWorkSearchTopList,t.MsbQuickWorkQueriesTopList,t.QuickWorkSearch,t.RecommendedDocs,t.MsbOnRampButton,t.TrendingSearchData,t.QuickSearch,t.VisualSearch,]:()=>[t.AnaheimDataTile,t.TopApps,t.MRUHistory,t.AnaheimDataList,t.QuickWorkSearchTopList,t.MsbQuickWorkQueriesTopList,t.QuickWorkSearch,t.RecommendedDocs,t.MsbOnRampButton,t.TrendingSearchData,t.QuickSearch,t.Upsell,t.PromoBanner,t.VisualSearch,]):n.ScopeConfig[i.All].enabledDataSourcesForZeroInput=[]}function tt(){n.ScopeConfig={};n.ScopeConfig[i.All_FileExplorer]={icon:null,prefixesLocString:null,enabledDataSources:[{dataSource:"FEH"},{dataSource:"IFF"},{dataSource:"MDOC",conditionalRequirements:()=>n.config.useL2ProvidersInFileExplorer},{dataSource:"MPHO",conditionalRequirements:()=>n.config.useL2ProvidersInFileExplorer},{dataSource:"MVID",conditionalRequirements:()=>n.config.useL2ProvidersInFileExplorer},{dataSource:"SSUE",requirements:[1,2],conditionalRequirements:()=>n.config.cloudSearchInFileExplorer&&(n.isFileExplorerCurrentPathThisPcOrQuickAccess||!!SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootAccount)},{dataSource:"SSEE",requirements:[1,2],conditionalRequirements:()=>n.config.cloudSearchInFileExplorer&&(n.isFileExplorerCurrentPathThisPcOrQuickAccess||!!SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.currentSyncRootAccount)},],enabledDataSourcesForZeroInput:[{dataSource:"FEH"},],getEmptyZIMessages:null};n.ScopeConfig[i.All_SettingsApp]={icon:null,prefixesLocString:null,enabledDataSources:[{dataSource:"ST"},{dataSource:"MST"},],enabledDataSourcesForZeroInput:[],getEmptyZIMessages:null};n.ScopeConfig[i.All_ControlPanel]={icon:{content:"&#xE713",type:2},prefixesLocString:"ScopeSettings",enabledDataSources:[{dataSource:"Web",suggestionIsEnabled:()=>!1,requirements:[1,2]},{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MST"},{dataSource:"ST"},{dataSource:"QS",requirements:[1,2]}],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MST"},],getEmptyZIMessages:null};n.ScopeConfig[i.All]={icon:{content:"&#xE782",type:n.config.undocked?8:2,needsAccentColor:!0},prefixesLocString:"ScopeAll",enabledDataSources:[{dataSource:"PP"},{dataSource:"ST"},{dataSource:"FL",conditionalRequirements:t=>{var i;return!n.config.providerConditionAggressive||((i=t===null||t===void 0?void 0:t.queryToFetch)===null||i===void 0?void 0:i.length)>n.config.minQueryLengthForAllScopeProviders}},{dataSource:"LM",conditionalRequirements:t=>{var i;return!n.config.providerConditionAggressive||((i=t===null||t===void 0?void 0:t.queryToFetch)===null||i===void 0?void 0:i.length)>n.config.minQueryLengthForAllScopeProviders}},{dataSource:"IFF",conditionalRequirements:t=>{var i;return!n.config.providerConditionAggressive||((i=t===null||t===void 0?void 0:t.queryToFetch)===null||i===void 0?void 0:i.length)>n.config.minQueryLengthForAllScopeProviders+1}},{dataSource:"CG"},{dataSource:"MRU"},{dataSource:"MPP"},{dataSource:"MST"},{dataSource:"MFF",conditionalRequirements:t=>{var i;return!n.config.providerConditionAggressive||((i=t===null||t===void 0?void 0:t.queryToFetch)===null||i===void 0?void 0:i.length)>n.config.minQueryLengthForAllScopeProviders}},{dataSource:"MRS",groupType:t.MRUHistory,requirements:[1,2],conditionalRequirements:()=>n.config.enableMruProviderInQF},{dataSource:"Web",requirements:[1,2],conditionalRequirements:t=>{var i;return((i=t===null||t===void 0?void 0:t.queryToFetch)===null||i===void 0?void 0:i.length)>n.config.minQueryLengthForAllScopeProviders}},{dataSource:"OSTMA",requirements:[1,2],conditionalRequirements:t=>{var i;return((i=t===null||t===void 0?void 0:t.queryToFetch)===null||i===void 0?void 0:i.length)>n.config.minQueryLengthForAllScopeProviders+(n.config.providerConditionAggressive?1:0)}},{dataSource:"QS",requirements:[1,2],conditionalRequirements:t=>{var i;return((i=t===null||t===void 0?void 0:t.queryToFetch)===null||i===void 0?void 0:i.length)>n.config.minQueryLengthForAllScopeProviders+(n.config.providerConditionAggressive?1:0)}},dt(),r("SSUE",1,!1,()=>!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qfUtils.is3sFileDisabled())),s(!1),],enabledDataSourcesForZeroInput:[],webSyntheticEnabled:t=>t.queryToFetch&&n.isBingEnabled(),getEmptyZIMessages:null,showUpsellOnSuggestionsList:n.config.accountVerificationInAllScope||n.config.msbAccountVerificationInSearchHome?()=>c():undefined};n.ScopeConfig[i.Apps]={icon:{content:n.config.useCobaltCSS?"&#xECAA":"&#xEB3B",type:2},prefixesLocString:"ScopeApps",enabledDataSources:[{dataSource:"Web",suggestionIsEnabled:()=>!1,requirements:[1,2]},{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MPP"},{dataSource:"PP",suggestionIsEnabled:n=>n=="PP"},{dataSource:"OSTMA",requirements:[1,2]},{dataSource:"IBA"},],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"TOPP",conditionalRequirements:n=>n.isSearchHomeZI},{dataSource:"MPP"},n.contains(n.config.enabledDataSources,"LRA")?{dataSource:"LRA"}:{dataSource:"PP",suggestionIsEnabled:n=>n=="PP"}],staticGroupOrderForZeroInput:n=>n.isSearchHomeZI?[t.TopApps,t.Apps]:undefined,getEmptyZIMessages:()=>u(i.Apps,"EmptyAppsMessage","EmptyAppsSubMessage","EmptyScopeSearchLocation_PC")};n.ScopeConfig[i.Settings]={icon:{content:"&#xE713",type:2},prefixesLocString:"ScopeSettings",enabledDataSources:[{dataSource:"Web",suggestionIsEnabled:()=>!1,requirements:[1,2]},{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MST"},{dataSource:"ST"},{dataSource:"QS",requirements:[1,2]}],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MST"},],getEmptyZIMessages:()=>e(i.Settings,!1)};n.ScopeConfig[i.Photos]={icon:{content:"&#xEB9F",type:2},prefixesLocString:"ScopePhotos",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MFF",suggestionIsEnabled:n=>n=="LI"},{dataSource:"MPHO",suggestionIsEnabled:n=>n=="LI"},],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MFF",suggestionIsEnabled:n=>n=="LI"},],getEmptyZIMessages:()=>e(i.Photos,!0)};n.ScopeConfig[i.Videos]={icon:{content:"&#xE714",type:1},prefixesLocString:"ScopeVideos",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MFF",suggestionIsEnabled:n=>n=="LV"},{dataSource:"MVID",suggestionIsEnabled:n=>n=="LV"},],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MFF",suggestionIsEnabled:n=>n=="LV"},],getEmptyZIMessages:()=>e(i.Videos,!0)};n.ScopeConfig[i.Music]={icon:{content:n.config.useCobaltCSS?"&#xE90B":"&#xE8D6",type:2},prefixesLocString:"ScopeMusic",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MFF",suggestionIsEnabled:n=>n=="MU"},{dataSource:"MMUS",suggestionIsEnabled:n=>n=="MU"},],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MFF",suggestionIsEnabled:n=>n=="MU"},],getEmptyZIMessages:()=>e(i.Music,!1)};n.ScopeConfig[i.Documents]={icon:{content:n.config.useCobaltCSS?"&#xE8A5":"&#xE7C3",type:2},prefixesLocString:"ScopeDocuments",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MFF",suggestionIsEnabled:n=>n=="FL"},{dataSource:"MDOC",suggestionIsEnabled:n=>n=="FL"},{dataSource:"MPHO",suggestionIsEnabled:n=>n=="FL",conditionalRequirements:n=>!n||!n.taskFrame},{dataSource:"MVID",suggestionIsEnabled:n=>n=="FL",conditionalRequirements:n=>!n||!n.taskFrame},{dataSource:"MPVD",suggestionIsEnabled:n=>n=="FL",conditionalRequirements:t=>n.config.mergeQueries&&(!t||!t.taskFrame)},{dataSource:"PP",suggestionIsEnabled:n=>n=="LDOC"},r("SSUE",1,!0,()=>!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qfUtils.is3sFileDisabled())),r("SSEE",1,!0,()=>!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qfUtils.is3sFileDisabled())),s(!0,i.Documents)],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MFF",suggestionIsEnabled:n=>n=="FL"},{dataSource:"IFF",suggestionIsEnabled:n=>n=="FL",conditionalRequirements:()=>n.config.enableZeroInputSearchHomeDocuments},o("SSUE",t.RecommendedDocs,1,!0,()=>fi()),o("SREE",t.RecommendedDocs,1,!0,()=>!1),],showUpsellOnSuggestionsList:()=>c(),getEmptyZIMessages:()=>e(i.Documents,!1)};n.ScopeConfig[i.Folders]={icon:{content:"&#xE8B7",type:2},prefixesLocString:"ScopeFolders",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MFF",suggestionIsEnabled:n=>n=="FD"},{dataSource:"MFOL",suggestionIsEnabled:n=>n=="FD"},],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:()=>!1},{dataSource:"MFF",suggestionIsEnabled:n=>n=="FD"},],getEmptyZIMessages:()=>e(i.Folders,!1)};n.ScopeConfig[i.Web]={icon:n.config.useCobaltCSS?{content:"&#xF6FA",type:2}:{content:"&#xE774",type:1},prefixesLocString:"ScopeWeb",enabledDataSources:[{dataSource:"MRU",suggestionIsEnabled:(t,i)=>i==1||n.config.enableMruProviderInQF&&i==0},{dataSource:"MRS",suggestionIsEnabled:(n,t)=>t==0,conditionalRequirements:()=>n.config.enableZeroInputSearchHomeWeb||n.config.enableMruProviderInQF},{dataSource:"Web",suggestionIsEnabled:(t,i)=>n.contains([0,13,14,10,5,1],i),requirements:[1,2]},{dataSource:"PP",suggestionIsEnabled:(n,t)=>t==1},{dataSource:"ANA",suggestionIsEnabled:(n,t)=>t==1&&(n=="ANAH"||n=="ANAR"||n=="ANATH"),requirements:[1,2],conditionalRequirements:()=>n.config.topHitMuse},s(!0,i.Web),],enabledDataSourcesForZeroInput:[{dataSource:"MRU",suggestionIsEnabled:(n,t)=>t==1},{dataSource:"MRS",suggestionIsEnabled:(n,t)=>t==0,conditionalRequirements:()=>n.config.enableZeroInputSearchHomeWeb},{dataSource:"Web",requirements:[1,2],conditionalRequirements:()=>g()},],webSyntheticEnabled:t=>t.queryToFetch&&n.isBingEnabled(),getEmptyZIMessages:()=>u(i.Web,"EmptyWebMessage","EmptyWebSubMessage")};n.ScopeConfig[i.PathCompletion]={icon:{content:"&#xE782",type:n.config.undocked?8:2,needsAccentColor:!0},scopeNameLocString:n.config.pathCompletionReplacesAll?"PathCompletionScopeName":null,prefixesLocString:null,enabledDataSources:[{dataSource:"PT"},{dataSource:"CG"},],enabledDataSourcesForZeroInput:[],getEmptyZIMessages:null};n.ScopeConfig[i.Emails]={icon:{content:"&#xE715",type:2},prefixesLocString:"ScopeEmails",enabledDataSources:[r("SSEE",1,!0),r("SSEC",2,!0),],enabledDataSourcesForZeroInput:[],showUpsellOnSuggestionsList:()=>c(),getEmptyZIMessages:()=>e(i.Emails,!1)};n.ScopeConfig[i.People]={icon:{content:"&#xE716",type:2},prefixesLocString:"ScopePeople",enabledDataSources:[r("SSUE",1,!0,()=>!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isTenantMsbEnabled())),r("SSUC",2,!0),s(!0),],enabledDataSourcesForZeroInput:[r("SSUE",1,!0,()=>ei()),r("SSUC",2,!0),],showUpsellOnSuggestionsList:()=>c(),getEmptyZIMessages:()=>e(i.People,!1)};n.ScopeConfig[i.Work]={icon:{content:"&#xE821",type:2},prefixesLocString:"ScopeWork",enabledDataSources:[r("SSUE",1,!0,()=>!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isTenantMsbEnabled())),r("SSUC",2,!0),s(!0),],enabledDataSourcesForZeroInput:[{dataSource:"DFLS",groupType:t.CuratedSuggestions,suggestionGroupToggler:h(t.CuratedSuggestions),conditionalRequirements:t=>n.canShowCuratedSuggestionInEnterpriseScope(t)},{dataSource:"MWS",groupType:t.MRUHistory,suggestionIsEnabled:()=>!0,conditionalRequirements:t=>n.canShowWorkSearchMru(t)},{dataSource:"MRU",groupType:t.MRUHistory,conditionalRequirements:t=>n.enableMRUSearchHome()&&n.canShowMruInWorkScopeZi(t)},{dataSource:"MPP",groupType:t.MRUHistory,conditionalRequirements:t=>n.enableMRUSearchHome()&&n.canShowMruInWorkScopeZi(t)},{dataSource:"MST",groupType:t.MRUHistory,conditionalRequirements:t=>n.enableMRUSearchHome()&&n.canShowMruInWorkScopeZi(t)},{dataSource:"MFF",suggestionIsEnabled:()=>!0,groupType:t.MRUHistory,conditionalRequirements:t=>n.enableMRUSearchHome()&&n.canShowMruInWorkScopeZi(t)},{dataSource:"MRS",groupType:t.MRUHistory,requirements:[1,2],conditionalRequirements:t=>n.enableMRUSearchHome()&&n.canShowMruInWorkScopeZi(t)},{dataSource:"MSBC",groupType:t.QuickWorkSearch,conditionalRequirements:t=>n.canShowQuickWorkSearch()&&n.canShowMsbSearchHomeInWorkScopeZi(t)},o("SSUE",t.RecommendedDocs,1,!0,t=>d()&&n.canShowMsbSearchHomeInWorkScopeZi(t)),],getEmptyZIMessages:()=>u(i.Work,"EmptyWorkMessage","EmptyWorkSubMessage")};n.ScopeConfig[i.EdgeUrls]={icon:{content:"&#xE81F",type:2},prefixesLocString:null,prefixes:["Edge","url","lucky"],enabledDataSources:[{dataSource:"ANA",suggestionIsEnabled:(n,t)=>t==1&&(n=="ANAH"||n=="ANAR"||n=="ANATH"),requirements:[1,2],conditionalRequirements:()=>n.config.topHitMuse}],enabledDataSourcesForZeroInput:[{dataSource:"ANA",suggestionIsEnabled:(n,t)=>t==1&&(n=="ANAH"||n=="ANAR"||n=="ANATH"),requirements:[1,2],conditionalRequirements:()=>n.config.topHitMuse}],getEmptyZIMessages:()=>u(i.EdgeUrls,"EmptyWebMessage","EmptyWebSubMessage")};n.ScopeConfig[i.Chat]={icon:{content:"&#xE901",type:2},prefixesLocString:"ScopeChat",enabledDataSources:[],enabledDataSourcesForZeroInput:[],getEmptyZIMessages:()=>["",""]};n.ScopeConfig[i.ThirdPartyWeb]={icon:{content:"&#xE774",type:1},prefixesLocString:"ScopeThirdPartyWeb",enabledDataSources:[{dataSource:"TPWeb",suggestionIsEnabled:(t,i)=>n.contains([1],i),requirements:[1]},],enabledDataSourcesForZeroInput:[{dataSource:"TPWeb",requirements:[1]},],getEmptyZIMessages:()=>u(i.Web,"EmptyWebMessage","EmptyWebSubMessage")};for(let t in n.ScopeConfig)n.ScopeConfig[t].enabledDataSources=n.ScopeConfig[t].enabledDataSources.filter(t=>n.contains(n.config.enabledDataSources,t.dataSource)),n.ScopeConfig[t].enabledDataSourcesForZeroInput=n.ScopeConfig[t].enabledDataSourcesForZeroInput.filter(t=>n.contains(n.config.enabledDataSources,t.dataSource))}function ii(){f=null}function it(t){let u=n.Host.getConnectedAccountInfo(0),f=n.Host.getConnectedAccountInfo(1),i=!!(u||f),r=t&&n.isBingEnabled();return i&&r?"EmptyScopeSearchLocation_PCCloudAndWeb":i?"EmptyScopeSearchLocation_PCAndCloud":r?"EmptyScopeSearchLocation_PCAndWeb":"EmptyScopeSearchLocation_PC"}function e(n,t){return u(n,`Empty${i[n]}Message`,`Empty${i[n]}SubMessage`,it(t))}function u(t,i,r,u){let f=rt(n.ScopeConfig[t]),e=u?n.Host.getLocString(u):"",o=n.Host.getLocString(i,f,e),s=n.Host.getLocString(r,f,e);return[o,s]}function ri(){const t=n=>HitHighlightingParser.removeDiacritics(n.toLocaleLowerCase().trim());if(f={},n.RuntimeConfig.ScopesAvailable)for(let r in n.ScopeConfig){let e=parseInt(r),u=n.ScopeConfig[e];if(e!=i.All&&a(e,u)){if(e===i.Work&&ui(u),n.isThirdPartySearchAllowed()&&e==i.ThirdPartyWeb){let r=n.Host.getThirdPartySearchApps();r.forEach(n=>{let r=t(n.displayName);f[r]||(f[r]=i.ThirdPartyWeb,u.prefixes=l(t(n.displayName)))});continue}if(!u.prefixes&&u.prefixesLocString){let t=n.Host.getLocString(u.prefixesLocString),i=n.Host.getEnUsLocString(u.prefixesLocString);u.prefixes=l(t,i)}u.prefixes&&u.prefixes.forEach(n=>f[t(n)]=e)}}}function ui(t){(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isEduScopeApplicableFromStoredValue())?(t.prefixesLocString="ScopeSchool",t.icon=n.config.useCobaltCSS?{content:"&#xE82D",type:2}:{content:"&#xE736",type:2},t.getEmptyZIMessages=()=>u(i.Work,"EmptySchoolMessage","EmptyEduSubMessage")):(t.prefixesLocString="ScopeWork",t.icon={content:"&#xE821",type:2},t.getEmptyZIMessages=()=>u(i.Work,"EmptyWorkMessage","EmptyWorkSubMessage"));t.prefixes=null}function rt(t){if(t.scopeNameLocString)return n.Host.getLocString(t.scopeNameLocString);if(t.prefixes)return t.prefixes[0].trim();if(t.prefixesLocString){let i=t.prefixesLocString;(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(40979072))&&i==="ScopeAll"&&(i="ScopeSearch");let r=l(n.Host.getLocString(i));return r[0].trim()}return""}function l(n,t){let i=n;return t&&(i+=","+t),i.search(y)>-1&&(i=i.replace(y,",")),i.split(",")}function fi(){return!!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qfUtils.isDocumentZeroQueryEnabled())}function ei(){return!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isTenantMsbEnabled())||!!n.config.msbEnablePeopleZQ}function a(t,r){if(n.shouldUseMsbEnterpriseScopes()){if(!n.contains(n.config.enabledScopesMsbEnterprise,i[t]))return!1}else if(!n.contains(n.config.enabledScopes,i[t]))return!1;if(n.config.noMailPeopleScopeInMsa&&(t==i.Emails||t==i.People)){let t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();if(t!==3&&t!==0)return t===1}if(t==i.Web&&!n.isBingEnabled()||t==i.Chat&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isEduTenant()))return!1;if(t==i.Chat&&n.isBingEnabled())return!0;if(t===i.Work)return!!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isWorkScopeApplicable());if(t==i.ThirdPartyWeb&&n.isThirdPartySearchAllowed()||r.showUpsellOnSuggestionsList&&r.showUpsellOnSuggestionsList())return!0;if(t==i.ThirdPartyWeb)return n.isThirdPartySearchAllowed();let u=n.config.enabledDataSources.filter(n=>n!="MRU");n.isBingEnabled()&&t!=i.Web&&(u=u.filter(n=>n!="Web"));for(let n of r.enabledDataSources)et(n,null)||(u=u.filter(t=>t!=n.dataSource));return r.enabledDataSources.some(t=>n.contains(u,t.dataSource))?!0:!1}function ut(t){switch(n.RuntimeConfig.QfMode){case 5:return n.ScopeConfig[i.All_FileExplorer];case 7:return n.ScopeConfig[i.All_SettingsApp];case 9:return n.ScopeConfig[i.All_ControlPanel];default:return n.ScopeConfig[v(t)]}}function si(t,r,u,f,e){e||(e={});const{topHitRestriction:h,forceGroupOnTop:c,fromSearchHome:l,fromSuggestionType:a,inorganic:y,serpURLParams:p}=e;let o=n.baseParseQuery(t,r,h);o.fullPartialQuery=o.queryToFetch;o.scope=i.All;o.forceGroupOnTop=c;o.fromSuggestionType=a;o.fromSearchHome=l;o.inorganic=y;o.serpURLParams=p;let s;if(li(o,f))o.taskFrame=f,o.isFormulatedQuery=!0,s=n.ScopeConfig[v(o)];else{if(o.fullPartialQuery&&(hi(o),u&&o.scope!=u.scope&&(o.isFormulatedQuery=!0)),o.isSearchHomeZI=!o.queryToFetch&&o.scope!=i.ThirdPartyWeb&&(n.RuntimeConfig.SearchHomeAvailable==1||n.RuntimeConfig.SearchHomeAvailable==2&&o.scope!=i.All),o.isWorkScopeZI=!o.queryToFetch&&o.scope===i.Work,o.isThirdPartyZI=n.isThirdPartySearchAllowed()&&!o.queryToFetch&&o.scope==i.ThirdPartyWeb&&!!o.thirdPartySearch,o.scope==i.All||o.scope==i.Web){let t=n.tryParseUrl(o.queryToFetch,!0);t&&t.type==0?(o.isProtocol=!0,o.fixedUrl=n.cleanAndFixUrlProtocol(t)):oi.test(o.queryToFetch)&&(o.isProtocol=!0,o.fixedUrl=n.cleanAndFixUrlProtocol(o.queryToFetch))}s=ut(o);let r=o.queryToFetch?s.enabledDataSources:s.enabledDataSourcesForZeroInput;o.availableDataSources={};for(let t of r)n.contains(n.config.enabledDataSources,t.dataSource)&&(o.availableDataSources[t.dataSource]=t);o.enabledDataSources={};for(let n in o.availableDataSources){let t=o.availableDataSources[n];t.suggestionGroupToggler&&t.suggestionGroupToggler.isHidden()||(o.enabledDataSources[n]=t)}let t=o.queryToFetch?s.staticGroupOrder:s.staticGroupOrderForZeroInput;t&&(o.staticGroupOrder=t(o))}return ci(o,s),o.showProgressBar=n.isL2(o)&&n.config.dataSourcesWithProgressBar.some(n=>!!o.enabledDataSources[n]),o.equals=n=>{var t,r;return(o.queryToFetch?o.queryToFetch.toLowerCase():o.queryToFetch)==(n.queryToFetch?n.queryToFetch.toLowerCase():n.queryToFetch)&&n.scope==o.scope&&(n.scope!=i.ThirdPartyWeb||n.scope==i.ThirdPartyWeb&&((t=n.thirdPartySearch)===null||t===void 0?void 0:t.applicationUserModelId)===((r=o.thirdPartySearch)===null||r===void 0?void 0:r.applicationUserModelId))&&(n.taskFrame?n.taskFrame.raw:"")==(o.taskFrame?o.taskFrame.raw:"")&&n.topHitRestriction==o.topHitRestriction},o.getCacheKey=()=>o.cursorPosition+o.queryToFetch.toLocaleLowerCase()+o.scope+n.regionCache,o}function hi(t){if(n.RuntimeConfig.ScopesAvailable){let s=n.isDataSourceEnabled("PT",null),c=s&&ft.test(t.fullPartialQuery);if(c){t.canBePathCompletion=!0;t.scope=i.PathCompletion;return}let u=t.originalQuery;n.config.skippingRemoveDiacriticsIndexerRelated||(u=HitHighlightingParser.removeDiacritics(t.originalQuery));let h=u.match(/^(([^:：]+)[:：]\s*)(.*)/)||n.config.forwardSlashScopes&&u.match(/(\/(\w+)\s*)(.*)/);if(h){let[,l,r,e]=h;r=r.toLocaleLowerCase();let o=r.trim();if(f&&n.contains(Object.keys(f),o)){if(t.scope=f[o],n.config.skippingRemoveDiacriticsIndexerRelated){const n=[i.Documents,i.Folders,i.Music,i.Videos,i.Photos];n.indexOf(t.scope)==-1&&(e=HitHighlightingParser.removeDiacritics(e))}t.queryToFetch=e;t.cursorPosition=Math.max(0,t.originalCursorPosition-l.length);n.mantainCursorPositionIn(t.queryToFetch,t.cursorPosition,n.cleanQuery,(n,i)=>{t.queryToFetch=n,t.cursorPosition=i});t.scope==i.ThirdPartyWeb&&(t.thirdPartySearch=n.Host.getThirdPartySearchAppByName(o));t.scopePrefix=r;t.isMultiWord=n.isMultiWord(t.queryToFetch);t.canBePathCompletion=s&&ft.test(t.queryToFetch)}}}}function et(t,i){for(let i of t.requirements||[])switch(i){case 1:if(n.config.disableOfflineRequest&&!n.isBrowserOnline())return!1;break;case 2:if(!n.isBingEnabled())return!1}return t.conditionalRequirements&&!t.conditionalRequirements(i)?!1:!0}function ci(t,i){let r=n.RuntimeConfig.QfMode==5&&t.fullPartialQuery.search(":")>=0;if(r){t.enabledDataSources={};return}n.disableWebDataSourceIfNeeded(t,n.Host.getRegion(),n.Host.getLanguage());let u=t.queryToFetch?i.enabledDataSources:i.enabledDataSourcesForZeroInput;for(let i of u)et(i,t)||n.disableDataSources(t,i.dataSource);if(!t.queryToFetch){let i=!n.RuntimeConfiguration.DeviceHistoryEnabled;i&&n.disableDataSources(t,"PP","LRA","FL","LM","IFF")}n.TweakSearch&&n.TweakSearch.disableDataSourcesBasedOnTweakSearch(t);n.config.searchServiceDisabled&&n.disableDataSources(t,"IFF","IBA");!nt(t)||n.isMsbEnterprise()&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isQwsEnabled())||n.disableDataSources(t,"QSCH")}function li(t,i){if(i){let r=i.scope,u=n.ScopeConfig[i.scope];if(a(r,n.ScopeConfig[r])){let f=n.ScopeConfig[r].enabledDataSources.filter(n=>bi(n.dataSource,i));if(f.length>0){for(let i of f)n.contains(n.config.enabledDataSources,i.dataSource)&&(t.enabledDataSources[i.dataSource]=i);return u}}}return null}function ai(t){let r=n.safeExecute(()=>JSON.parse(t),"parseTaskFrame");if(r){let n=pi(r);if(n!=i.All)return{raw:t,parsed:r,scope:n}}return null}function pi(n){switch(n.Uri){case vi:let r=n,t=r.FileType;if(t&&t.Value){if(t.Value=="Picture")return i.Photos;if(t.Value=="Video")return i.Videos}return i.Documents;case yi:return i.Emails}return i.All}function v(n){return n?n.taskFrame?n.taskFrame.scope:n.scope:undefined}function wi(n){if(n.taskFrame){let t=n.taskFrame.parsed;if(t)if(n.taskFrame.scope==i.Emails){let n=t,i=n.Subject;if(i&&i.Value)return i.Value;let r=n.Body;if(r&&r.Value)return r.Value;let u=n.From&&n.From.length>0?n.From[0]:null;if(u&&u.Value)return u.Value;let f=n.To&&n.To.length>0?n.To[0]:null;if(f&&f.Value)return f.Value}else{let n=t,r=n.Title;if(r&&r.Value)return r.Value;let u=n.Body;if(u&&u.Value)return u.Value;let i=n.People;if(i&&i[0]&&i[0].Value)return i[0].Value;let f=n.Place;if(f&&f.Value)return f.Value}}return n.queryToFetch}function bi(n,t){if(t.scope==i.Emails)return n=="SSEC"||n=="SSEE";else{let r=t.parsed,i=r.FileSource?r.FileSource.Value:null;switch(n){case"MPVD":case"MDOC":case"MPHO":case"MVID":return i!="onedrive"&&i!="sharepoint";case"SSEE":return i!="thispc"&&i!="onedrive";default:return!1}}}function ki(){}function h(t){let i=""+t;const u=()=>{let t=n.LightweightStorage.getItem(ot)||"";return t.split(",")},r=t=>{let i=t.join(",");n.LightweightStorage.setItem(ot,i)};return{isHidden:()=>!1,toggle:t=>{n.safeExecute(()=>{let n=u();if(t&&n.every(n=>n!=i))n.push(i),r(n);else if(!t){let t=n.findIndex(n=>n==i);t>-1&&(n.splice(t,1),r(n))}},"GroupToggler.toggle")}}}let i;(function(n){n[n.All=0]="All";n[n.Apps=1]="Apps";n[n.Settings=2]="Settings";n[n.Photos=3]="Photos";n[n.Videos=4]="Videos";n[n.Music=5]="Music";n[n.Documents=6]="Documents";n[n.Folders=7]="Folders";n[n.Web=8]="Web";n[n.PathCompletion=9]="PathCompletion";n[n.Emails=10]="Emails";n[n.People=11]="People";n[n.Work=12]="Work";n[n.Chat=13]="Chat";n[n.All_FileExplorer=1e3]="All_FileExplorer";n[n.All_Lockscreen=1001]="All_Lockscreen";n[n.All_SettingsApp=1002]="All_SettingsApp";n[n.All_ControlPanel=1003]="All_ControlPanel";n[n.EdgeUrls=1004]="EdgeUrls";n[n.ThirdPartyWeb=1e4]="ThirdPartyWeb"})(i=n.Scope||(n.Scope={}));let t;(function(n){n[n.Apps=0]="Apps";n[n.Settings=1]="Settings";n[n.Cortana=2]="Cortana";n[n.Command=3]="Command";n[n.Photos=4]="Photos";n[n.Videos=5]="Videos";n[n.Music=6]="Music";n[n.Documents=7]="Documents";n[n.Folders=8]="Folders";n[n.Emails=9]="Emails";n[n.Store=10]="Store";n[n.SearchSuggestions=11]="SearchSuggestions";n[n.PathCompletion=12]="PathCompletion";n[n._PowerBi=13]="_PowerBi";n[n.JumpListTasks=14]="JumpListTasks";n[n.JumpListPinned=15]="JumpListPinned";n[n.JumpListRecent=16]="JumpListRecent";n[n.JumpListFrequent=17]="JumpListFrequent";n[n.JumpListCustom=18]="JumpListCustom";n[n._JumpListActivityFeed=19]="_JumpListActivityFeed";n[n.People=20]="People";n[n._EdgeHistory=21]="_EdgeHistory";n[n.LocalPlaces=22]="LocalPlaces";n[n.Bookmarks=25]="Bookmarks";n[n.Related=26]="Related";n[n.Websites=27]="Websites";n[n.Contact=28]="Contact";n[n.JumpListSynthetic=29]="JumpListSynthetic";n[n.JumpListActions=30]="JumpListActions";n[n._StartMenu=31]="_StartMenu";n[n.LocalSearchHistory=32]="LocalSearchHistory";n[n.JumpListSettingsFaq=33]="JumpListSettingsFaq";n[n.JumpListSettingsRelatedSettings=34]="JumpListSettingsRelatedSettings";n[n.ActivityFeedSuggestions=35]="ActivityFeedSuggestions";n[n.TopApps=36]="TopApps";n[n.QuickSearch=37]="QuickSearch";n[n._LockscreenQuickSearch=38]="_LockscreenQuickSearch";n[n.WelcomeExperience=39]="WelcomeExperience";n[n.Upsell=40]="Upsell";n[n.MRUHistory=43]="MRUHistory";n[n.PromoBanner=44]="PromoBanner";n[n.VisualSearch=45]="VisualSearch";n[n._BingDailyImage=46]="_BingDailyImage";n[n._MeetingPrep=48]="_MeetingPrep";n[n.AnaheimDataList=49]="AnaheimDataList";n[n.RecommendedDocs=50]="RecommendedDocs";n[n.QuickWorkSearch=51]="QuickWorkSearch";n[n.QuickWorkSearchTopList=52]="QuickWorkSearchTopList";n[n.CuratedSuggestions=53]="CuratedSuggestions";n[n._RelatedMsbDocuments=54]="_RelatedMsbDocuments";n[n.AnaheimDataTile=55]="AnaheimDataTile";n[n.AnaheimDataTopHit=56]="AnaheimDataTopHit";n[n.DSBGroup=57]="DSBGroup";n[n.CuratedSettings=58]="CuratedSettings";n[n.ThreeFingerTap=59]="ThreeFingerTap";n[n.WorkSuggestions=60]="WorkSuggestions";n[n.Groups=61]="Groups";n[n.TrendingSearchData=62]="TrendingSearchData";n[n.MsbQuickWorkQueriesTopList=63]="MsbQuickWorkQueriesTopList";n[n.AnaheimDataQF=64]="AnaheimDataQF";n[n.BingChat=65]="BingChat";n[n.ChatWithBing=66]="ChatWithBing";n[n.GroupHeader=104]="GroupHeader";n[n.MsbOnRampButton=105]="MsbOnRampButton"})(t=n.GroupType||(n.GroupType={}));const y=/(\s*,\s*)|([\s]*[،„፡“፣"，]+[\s]*)/g,st=["PP","QP","IBA","TOPL"],ht=["ST","QS","SSTS"],p=["LI","LV","MU"],ct=["FL","LDOC","FD","MFIL"].concat(p),lt=[i.Documents,i.Folders,i.Photos,i.Videos,i.Music],at=1;n.isApp=vt;n.isSetting=yt;n.isMedia=pt;n.isFileOrFolder=wt;n.isFileOrFolderScope=bt;n.substrateProvidersEnabled=w;n.searchHistoryAllowed=g;n.isRecommendedDocsGroupEnabled=nt;n.nicerCloudFilesEnabled=ni;n.setZeroInputDataSourcesForL1=ti;n.populateScopeConfig=tt;tt();let f;n.cleanScopePrefixes=ii;n.initScopePrefixes=ri;n.getScopeDisplayName=rt;n.isScopeEnabled=a;n.getScopeConfig=ut;n.isAADVerificationRequired=!1;const oi=/^ht+ps?[;:]+|^www[.。]|^\/+/,ft=/^[a-z]:\\|^%[^%]+%\\|^\\/i;n.parseQuery=si;n.parseTaskFrame=ai;const vi="action://FindMyStuff/FindDocument",yi="action://FindMyStuff/FindMessage";n.getEffectiveScope=v;n.getEffectiveQuery=wi;const ot="HiddenSuggestionGroups";n.initQueryParser=ki}(WSB||(WSB={})),function(n){function wr(n,t){vt=n;yt=t}function pt(){return vt}function br(){return yt}function kr(n,t){return n.type==t.type&&n.source==t.source}function dr(t){if(n.config.useCobaltCSS)switch(t){case"WNSGPH":return"WSBEDG";case"WMSRPM":return"WMSMAN";case"WMSRPA":return"WMSAUT";case"WSBREW":return"WSREWF";case"WSBBST":return"WSBSTK";case"SBIWSB":return"WSVISS";case"BFBWSL":return"MSBWSL";case"BFBWPP":return"MSBWPP";case"BFBWMS":return"MSBWMS";case"MDSB10":return"MDSB11";case"EDSB10":return"EDSB11";case"WSBWS0":return"WSBWS1";case"WSHBSH":return"WSHBSH";case"WSBWSC":return"WSBWSD";case"BFBQWQ":return"MSBQWQ";case"DSBI10":return"DSBI11";case"DSBC10":return"DSBC11";case"SSHTRD":return"SHTR11";default:return t}return t}function nu(n){switch(n){case"PP":return"Apps";case"ST":return"Settings";case"FL":return"Files";case"LM":return"Media";default:return null}}function tu(n){switch(n){case"FL":case"LM":case"IFF":case"MFF":case"PT":case"CG":case"MPVD":case"MDOC":case"MFOL":case"MPHO":case"MVID":case"MMUS":case"FEH":return!0;case"OSTMA":case"QS":case"PP":case"LRA":case"ST":case"MPP":case"MST":case"IBA":case"THST":case"TOPP":case"QSCH":case"DFLS":case"CUSE":case"QWQS":return!1}throw new Error("New local data source "+n+" needs to be explicity classified as potentially containing PII or not");}function bt(n){let t=e(n);return n.deviceItem&&n.handoffType==2?t+"\t"+n.deviceItem.id:t+"\t"+n.query}function uu(n,t){return n.msbDomain!=null&&n.msbDomain===t.msbDomain&&n.msbId!=null&&n.msbId===t.msbId}function fu(t,i){return t.isSearchHomeZI&&v()&&vr(t)&&!n.config.msbQwsDocsNoRefreshAfterCachedResults&&i.staticGroupType===n.GroupType.RecommendedDocs&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isQwsEnabled())}function gt(t,i){return t.targetPathLC&&n.isApp(t.type)&&n.isApp(i.type)&&t.targetPathLC.includes("\\installer\\")&&t.targetPathLC.endsWith(".ico")&&t.text==i.text}function ni(n,t){return n.handoffType==5&&n.actionUri=="ms-cortana://navigate/Settings"&&t.deviceItem&&t.deviceItem.id=="CortanaSettings"}function ti(n){let t=y(n);return t?t.packageFamilyName:null}function ii(t,i,r){if(i){let i=b(n.FOLDERID_Profile)+"\\onedrive - ",r=t.indexOf(i);if(r>=0){let n=t.indexOf("\\",r+i.length);t=t.substr(n+1)}}else{var u=n.AccessTokenManager.getWindowsIdentity();if(u&&t.startsWith("onedrive for business:\\")&&r){let n=u.indexOf("@");n!=-1&&r.toLocaleLowerCase().indexOf("personal/"+u.substr(0,n))>0&&(t=t.substr(23))}}return t}function ri(t,i,r){var u;let f="";if(r){let t=b(n.FOLDERID_Profile)+"\\"+n.SubstrateTenantName.toLocaleLowerCase()+"\\",r=i.indexOf(t);if(r>=0){let n=r+t.length,u=i.indexOf(" - ",n);f=i.substr(n,u-n).toLocaleLowerCase();i=i.substr(u+3)}}else i.startsWith("sharepoint:\\")&&(i=i.substr(12),f=(u=t.siteTitle)===null||u===void 0?void 0:u.toLocaleLowerCase());return[i,f]}function eu(i,r,u){if((r.type=="TOPL"||r.type=="DFLS")&&i.isSearchHomeZI||fu(i,r))return t.NotDuplicate;if(uu(r,u)||n.contains([5,4],r.handoffType)&&n.contains([5,4],u.handoffType)&&r.actionUri==u.actionUri&&r.query.toLocaleLowerCase()==u.query.toLocaleLowerCase()||r.handoffType==10&&u.handoffType==10&&r.type==u.type&&!r.htmlContent&&!u.htmlContent&&r.query.toLocaleLowerCase()==u.query.toLocaleLowerCase()||r.type!="PWL"&&r.handoffType==1&&u.handoffType==1&&n.isDuplicateUrl(i,r.url,u.url))return t.NoMetadata;let s=y(r),h=y(u),f,e;f=s?s.filePath:r.path;f&&(f=f.toLocaleLowerCase());e=h?h.filePath:u.path;e&&(e=e.toLocaleLowerCase());let c=ti(r),l=ti(u);if(c&&l&&c.toLocaleLowerCase()==l.toLocaleLowerCase())return t.NoMetadata;let a=nt(r),v=nt(u);if(a&&h||v&&s){let i=f||e,n=a||v,r=n.encodedPath;if(i&&r&&i==r.toLocaleLowerCase()){let i=s||h;return!n.launchArguments||(i.launchArguments||"").toLocaleLowerCase()==n.launchArguments.toLocaleLowerCase()||!i.launchArguments&&n.launchArguments&&i.displayName.toLocaleLowerCase().startsWith(n.displayName.toLocaleLowerCase())?t.NoMetadata:t.NotDuplicate}return t.NotDuplicate}if(r.deviceItem&&u.deviceItem){let i=r.deviceItem.id||"",o=u.deviceItem.id||"";if(n.isSetting(r.type)&&n.isSetting(u.type)&&(i=r.deviceItem.displayName,o=u.deviceItem.displayName),i.toLocaleLowerCase()==o.toLocaleLowerCase())return f&&!s&&e&&!h?t.MergeMetadata:t.NoMetadata;if(s){if(n.isSetting(u.type)&&kt[i]==o)return t.NoMetadata}else if(n.isSetting(r.type)&&(h&&kt[o]==i||n.isSetting(u.type)&&(dt[i]==o||dt[o]==i)))return t.NoMetadata}if(gt(r,u)||gt(u,r))return t.NoMetadata;if(f&&e){if(f==e)return t.MergeMetadata;if(!s&&!h)if(r.handoffType==u.handoffType){if(r.handoffType==8&&r.url==u.url)return t.MergeMetadata}else{const i=r.type==="MFIL"||u.type==="MFIL",s=r.handoffType!=8&&!o(r),h=u.handoffType!=8&&!o(u);if(f=ii(f,s,r.url),e=ii(e,h,u.url),f==e)return i?t.NoMetadata:t.MergeMetadata;if(n.SubstrateTenantName){let[n,c]=ri(r,f,s),[o,l]=ri(u,e,h);if(c==l&&(o.endsWith(n)||n.endsWith(o)))return i?t.NoMetadata:t.MergeMetadata}}let i=r.targetPathLC,c=u.targetPathLC;if(s&&u.type=="IBA"&&(f=et(f)),h&&r.type=="IBA"&&(e=et(e)),(i&&c&&i==c||i&&i==e||c&&f==c||f==e)&&(!s||!h||(s.launchArguments||"").toLocaleLowerCase()==(h.launchArguments||"").toLocaleLowerCase()))return t.NoMetadata}return ni(r,u)||ni(u,r)?t.NoMetadata:r.type==="PPL"&&u.type==="PPL"&&r.uniqueName&&u.uniqueName&&r.uniqueName.toLocaleLowerCase()===u.uniqueName.toLocaleLowerCase()?t.NoMetadata:r.type==="OLE"&&u.type==="OLE"&&r.internetMessageId===u.internetMessageId?t.NoMetadata:r.type==="BKS"&&u.type==="BKS"&&r.url&&u.url&&r.url===u.url?t.NoMetadata:t.NotDuplicate}function ou(n){switch(n){case"MFF":case"FL":case"LM":case"IFF":case"MPVD":case"MDOC":case"MPHO":case"MVID":case"MMUS":case"MFOL":return!0;default:return!1}}function su(t,i){if(!n.IndexerQueryGenerator)return!1;if(n.RuntimeConfig.QfMode==5)return!0;switch(t){case"IBA":case"MPVD":case"MDOC":case"MPHO":case"MVID":case"MMUS":case"MFOL":return!0;case"IFF":return oi(i)||!n.config.minLengthForIBAonL1||i.queryToFetch.length>=n.config.minLengthForIBAonL1;default:return!1}}function hu(t,i,r,u){if(r!="Exchange"){let o;const s=decodeURI(t.url),h=i.toLocaleLowerCase(),c=s.toLocaleLowerCase().indexOf(h);if(c!=-1){let n=s.substr(0,c-1);h.endsWith(".one")&&(n=n.substr(0,n.lastIndexOf("/")));o=encodeURI(n)}else o=t.url;let f=s.split("/").slice(3),e;r==null?e="":r=="OneDriveBusiness"?(e="OneDrive for Business:\\",f.length>2&&f[0].toLocaleLowerCase()=="personal"&&f[2].toLocaleLowerCase()=="documents"&&(f=f.slice(3))):e="SharePoint:\\";h.endsWith(".one")&&f.splice(f.length-2,1);t.path=e+f.join("\\");u&&(r=="OneDriveBusiness"?e=n.Host.getLocString("OneDriveTitle",t.siteTitle):(e=t.siteTitle,f.length>1&&f[0].toLocaleLowerCase()=="teams"&&(f=f.slice(2))),t.prettyPrintedPath=e+" > "+f.join(" > "));o&&(t.locationUrl=o)}}function cu(n){return n.kind=="Modern Setting"}function y(t){return n.isApp(t.type)?t.deviceItem:null}function lu(n){return!!n.suggestions}function au(t){return n.config.useCobaltCSS&&(a(t)||f(t))}function vu(n){return n.deviceItem}function nt(n){return n.type=="CG"?n.deviceItem:null}function yu(t){return n.isApp(t.type)||n.isSetting(t.type)||n.isFileOrFolder(t.type)&&!ai(t.type)}function pu(t){const i=e(t);return i==n.GroupType.WorkSuggestions||i==n.GroupType.Bookmarks||i==n.GroupType.People||i==n.GroupType.Documents}function e(t,i){if(typeof t.staticGroupType=="number")return t.staticGroupType;switch(t.type){case"TOPL":return n.GroupType.TopApps}if(n.isApp(t.type))return n.GroupType.Apps;if(tt(t))return t.groupType;if(n.isSetting(t.type))return n.GroupType.Settings;switch(t.type){case"CG":return n.GroupType.Command;case"PT":return n.GroupType.PathCompletion;case"LI":return n.GroupType.Photos;case"LV":return n.GroupType.Videos;case"MU":return n.GroupType.Music;case"JL":case"FL":case"LDOC":case"SDFE":case"MFIL":return n.GroupType.Documents;case"FD":return n.GroupType.Folders;case"OLE":case"OWA":return n.GroupType.Emails;case"PPL":case"MPPL":return n.GroupType.People;case"MGRP":return i===n.Scope.Work?n.GroupType.Groups:n.GroupType.People;case"BKS":case"MBKS":case"MQNA":case"MBLD":case"MACR":return n.GroupType.Bookmarks;case"ELA":return n.GroupType.LocalPlaces;case"ANAF":case"ANAH":case"ANAT":case"ANAR":return n.GroupType.SearchSuggestions;case"ANATH":return n.GroupType.AnaheimDataTopHit;case"FEH":return n.GroupType.LocalSearchHistory;case"SNSC":case"SNSP":case"SNST":return n.GroupType.VisualSearch;case"RSSG":case"QSSG":case"QWQS":case"QWQA":case"QWQC":return n.GroupType.QuickSearch;case"TS":return n.GroupType.TrendingSearchData;default:switch(t.handoffType){case 3:return n.GroupType.Store;case 5:case 4:return n.GroupType.Cortana;case 10:return t.htmlContent?n.GroupType.SearchSuggestions:n.GroupType.Cortana;case 0:return t.staticGroupType===n.GroupType.ChatWithBing?n.GroupType.ChatWithBing:n.GroupType.SearchSuggestions;case 13:case 14:return n.GroupType.SearchSuggestions;case 21:return n.GroupType.WorkSuggestions;case 1:return n.GroupType.Websites}throw new Error("Unexpected handoff type: "+t.handoffType);}}function wu(n){return!n.isAnswer&&(n.handoffType==0||n.handoffType==11||n.handoffType==21)&&n.type!="QSSG"}function ui(t){switch(t){case n.GroupType.JumpListTasks:case n.GroupType.JumpListPinned:case n.GroupType.JumpListRecent:case n.GroupType.JumpListFrequent:case n.GroupType.JumpListCustom:return!0;default:return!1}}function bu(t){let i=t.type;return ui(i)||i==n.GroupType.Related||i==n.GroupType.Contact}function tt(n){return!!n.isChild||!!n.parent}function ku(n){return n.type=="JL"}function du(t){switch(t){case n.GroupType.Apps:case n.GroupType.Store:return n.Scope.Apps;case n.GroupType.Settings:return n.Scope.Settings;case n.GroupType.Documents:return n.Scope.Documents;case n.GroupType.Folders:return n.Scope.Folders;case n.GroupType.Photos:return n.Scope.Photos;case n.GroupType.Videos:return n.Scope.Videos;case n.GroupType.Music:return n.Scope.Music;case n.GroupType.LocalPlaces:case n.GroupType.SearchSuggestions:case n.GroupType.ChatWithBing:case n.GroupType.AnaheimDataQF:case n.GroupType.Websites:case n.GroupType.Bookmarks:return n.Scope.Web;case n.GroupType.Emails:return n.Scope.Emails;case n.GroupType.People:return n.Scope.People;case n.GroupType.AnaheimDataTopHit:if(n.config.topHitMuse)return n.Scope.EdgeUrls;break;case n.GroupType.BingChat:return n.Scope.Chat}return n.Scope.All}function gu(t){switch(t){case 0:case 7:case 8:return 32;case 1:return 16;case 2:return n.IconSize_GridLayout_Scaled;case 3:return 24;case 4:return 64;case 5:return 200}}function nf(n,t,i){if(n&&n.type==0&&hi(t)){let r=t=>{n.ratio=t.height==t.width?1:t.height>t.width?3:2,i()},t=new Image;t.src=n.content;t.onload=()=>r({height:t.height,width:t.width})}else i()}function tf(t){return`${n.config.imageHostName}${t}`}function it(){let t=n.uiLanguageCache.toLocaleLowerCase();return rf[t]||t}function fi(n,t,i,r,u,f,e,o,s,h,c,l,a,v){let y={text:t,getIcon:i,icon:r,type:u,query:f,ciMatchedQuery:null,id:c,click:l,handoffType:o,instItem:e,isAnswer:!1,htmlContent:null,classNames:[],selected:!1,featureStore:undefined,sequenceNumber:s,getMruData:()=>null,template:0,mayContainPII:h,features:[],previewPaneType:undefined,reactKey:v};return y.previewPaneType=bf(n,y,a),y}function uf(n,t,i,r,u,f,e,o,s){n.subItems==null&&(n.subItems=[]);let c=n.id,h={id:t,sequenceNumber:n.sequenceNumber,selected:!1,text:i,itemView:r,props:u,onSelected:o,click:s,disabled:e,instItem:f,suggestionId:c};return n.subItems.push(h),h}function ff(t,i,r,u,f,e,o,s){let h=n.InstrumentationHelper.getInstrumentedSyntheticSuggestion(i,r);if(h)return h;let l=t.scope;h=fi(t,null,null,u,r,null,n.InstrumentedItem.getNonSuggestionInstrumentedItem(r,wt.KValues),f,i,!1,r);h.notAResult=!0;h.primaryMetadata=e;o&&(h.additionalInfoText=" - "+h.primaryMetadata);let c=n=>{var t;h.query=n.queryToFetch;h.text=HitHighlightingParser.addMarkers(n.queryToFetch);h.narratorText=ei(h);h.click=()=>s(h,n);h.reactKey=r+n.queryToFetch+((t=h.primaryMetadata)!==null&&t!==void 0?t:"")};return c(t),h.updateFromQuery=n=>!n.isProtocol&&n.scope==l&&n.queryToFetch?(c(n),!0):!1,h.getMruData=()=>at(h),n.InstrumentationHelper.instrumentSyntheticSuggestion(i,h),h}function ei(n,t){if(n.htmlContent)return null;let i=[n.text],r=n.dateShort;if(r&&i.push(r),t)i.push(t);else{if(n.primaryMetadata){i.push(n.primaryMetadata);let t=n.department;t&&i.push(t)}n.template==1&&n.secondaryMetadata&&i.push(n.secondaryMetadata)}return HitHighlightingParser.removeMarkers(i.join(", "))}function oi(t){return(t===null||t===void 0?void 0:t.scope)!=n.Scope.All||!!(t===null||t===void 0?void 0:t.taskFrame)}function si(t){return typeof t=="string"?t=="LI"||t=="LV":t==n.GroupType.Photos||t==n.GroupType.Videos}function hi(n){return si(n)||li(n)}function ef(t){return!n.config.disableMediaGridLayout&&!n.RuntimeConfig.AlwaysWide&&si(t)}function sf(t,i){if(!t||!n.RuntimeConfig.ScopesAvailable)return null;if(i.scope==n.Scope.All){let r=[];if(t.ISUPN&&t.ISUPG){let n=t.ISUPN.split("\t"),i=t.ISUPG.split("\t");if(n.length==i.length)for(let t=0;t<n.length;t++)r.push(i[t]+"\t"+n[t]);else SharedLogHelper.LogError("parseWebSuppressionSignals",null,new Error("parsedNames.length != parsedGroups.length"))}let i=t.FSUP?t.FSUP.split("\t"):null;if(n.config.disableFSUPForWebSuggGroup&&i){let t=i.indexOf(n.GroupType.SearchSuggestions.toString());t!==-1&&i.splice(t,1)}return{fullySuppressedGroups:i,partiallySuppressedGroups:t.PSUP?t.PSUP.split("\t"):null,suppressedSuggestions:r}}return null}function hf(t){return p||(p=_d.createElement("span")),n.safeExecute(()=>(p.innerHTML=t,p.innerText),t,"decodeHtml")}function cf(n,t){return{matchType:n,matchedText:t}}function i(n){return n.replace(lf,"\\$&")}function af(t,r){if(r){let u=n.config.disableSyntaxHighlight?t.toLocaleLowerCase().includes(r.toLocaleLowerCase()):t.includes(HitHighlightingParser.startMarker),e=u?t:HitHighlightingParser.addMarkers(t,r),f=HitHighlightingParser.split(e).find(n=>n.highlighted);if(f){let o=u?HitHighlightingParser.removeMarkers(t):t,s=n.config.disableSyntaxHighlight?new RegExp("((?:\\\\[^\\\\]+)?\\\\[^\\\\]+)?\\\\("+i(r)+"|"+i(r.toLocaleLowerCase())+").*","i"):new RegExp("((?:\\\\[^\\\\]+)?\\\\[^\\\\]+)?\\\\"+i(f.text)+".*","i"),e=s.exec(o);if(e&&e[0])return{matchType:rt.Location,matchedText:o.startsWith(e[0])?o:String.fromCharCode(8230)+e[0]}}}return null}function vf(t,r){if(r){let u=n.config.disableSyntaxHighlight?t.toLocaleLowerCase().includes(r.toLocaleLowerCase()):t.includes(HitHighlightingParser.startMarker),e=u?t:HitHighlightingParser.addMarkers(t,r),f=HitHighlightingParser.split(e).find(n=>n.highlighted);if(f){let o=u?HitHighlightingParser.removeMarkers(t):t,s,h=n.config.disableSyntaxHighlight?new RegExp("(?:\\S+\\s){0,3}\\b("+i(r)+"|"+i(r.toLocaleLowerCase())+")\\S*(?:\\s\\S+){0,5}","i"):new RegExp("(?:\\S+\\s){0,3}\\b"+i(f.text)+"\\S*(?:\\s\\S+){0,5}","i"),e=h.exec(o);return e&&e[0]&&(s={matchType:rt.Content,matchedText:e[0]}),[o,s]}}return[null,null]}function yf(t,i){return!t||!i?!1:n.config.disableSyntaxHighlight?HitHighlightingParser.addMarkers(t,i).toLocaleLowerCase().includes(i.toLocaleLowerCase()):HitHighlightingParser.addMarkers(t,i).includes(HitHighlightingParser.startMarker)}function pf(t){return t==n.Scope.Emails}function wf(n){if(tt(n))return!1;switch(n.handoffType){case 0:case 13:case 14:case 21:case 5:case 10:case 4:return n.type!="QSSG";case 3:return n.type=="STS";case 2:return n.type=="SDFE";case 8:case 12:return n.type=="OWA";default:return!1}}function bf(t,i,r){const u=undefined;if(!n.RuntimeConfig.PreviewPaneAvailable||t.isSearchHomeZI)return u;const f=()=>{if(i.handoffType==1)return n.RuntimeConfig.AlwaysWide?2:u;return n.isBingEnabled()&&n.contains([0,13,14],i.handoffType)&&!i.htmlContent?1:u};if(r)return f();switch(e(i,t===null||t===void 0?void 0:t.scope)){case n.GroupType.Store:return n.RuntimeConfig.AlwaysWide&&i.type!="STS"?2:u;case n.GroupType.Apps:case n.GroupType.Cortana:case n.GroupType.Command:case n.GroupType.Folders:case n.GroupType.Music:case n.GroupType.PathCompletion:case n.GroupType.Emails:case n.GroupType.Photos:case n.GroupType.Settings:case n.GroupType.Videos:return n.RuntimeConfig.AlwaysWide?2:u;case n.GroupType.Documents:return o(i)?3:n.RuntimeConfig.AlwaysWide?2:u;case n.GroupType.People:return i.handoffType==0?1:i.handoffType==1?u:o(i)?3:n.RuntimeConfig.AlwaysWide?2:u;case n.GroupType.Groups:return 3;case n.GroupType.Bookmarks:return o(i)?3:f();case n.GroupType.Websites:return n.isBingEnabled()&&i.type!="LURL"?1:u;case n.GroupType.AnaheimDataTopHit:return n.config.topHitMuse?2:f();default:return f()}}function kf(t,i,r){let u=r.previewPaneType;if(!u)return!1;let f=i.previewPaneType,e=u==1&&f==1,o=!0;return n.config.msbVerticalWorkScopeEnabled&&r.handoffType===21&&(o=i.msbVerticalHash===r.msbVerticalHash),i.query.toLocaleLowerCase()==r.query.toLocaleLowerCase()&&(!e&&u==f||e&&i.handoffType==r.handoffType)&&o}function df(n){return n==null}function ne(t){return t==n.GroupType.Documents&&n.isSubstrateO365AccountConnected}function te(t){switch(t){case 2:return"OneDrive";case 3:return n.Host.getLocString("OneDriveForBusiness");case 4:return"SharePoint";case 1:return n.Host.getLocString("ThisPC");case 5:return n.Host.getLocString("MsbPeopleGroups");case 6:return n.Host.getLocString("MsbPeopleContacts")}return null}function ie(n){if(pi())switch(n){case 37:return 39;case 39:return 37}return n}function re(){return n.config.enableBlueSearchBPForWebSuggestion||n.config.enableSolidSearchForWebSuggestion?{content:n.Host.getWindowsTheme()==2?n.config.qfWebSuggestionIconUrlDark:n.config.qfWebSuggestionIconUrlLight,type:0,isWebSuggestionIcon:!0}:{content:"&#xE721",type:2}}function ue(t){return n.Host.getLocString(t?(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isEduTenant())?"SeeSchoolAndWebResults":"SeeWorkAndWebResults":di()?"SeeBingChatResults":ci())}function ci(){return n.config.addOpenPrefixToOnlineSuggestion?"OpenWebResults":n.config.enableNewWebSuggestionAnnotation?n.config.webSuggestionAnnotationKey:"SeeWebResults"}function fe(t){return n.msbHost&&n.isDataSourceEnabled("MSBC",t)}function li(n){return n=="PPL"||n=="MPPL"||n=="MGRP"}function ai(n){return n=="MFIL"}function ee(){const t=n.config.msbSuggestionTophitRule;switch(t){case 1:return iu;case 2:default:return ru}}function oe(n){return n=="MPPL"||n=="MGRP"||n=="MBKS"||n=="MQNA"||n=="MFIL"||n=="MBLD"||vi(n)}function vi(n){return n=="MVALL"||yi(n)}function yi(n){return n=="MVPPL"||n=="MVGRP"||n=="MVSIT"||n=="MVFIL"||n=="MVMES"||n=="MVYAM"||n=="MVCON"}function se(n){switch(n){case"MVPPL":return"MPPL";case"MVGRP":return"MGRP";case"MVFIL":return"MFIL";default:return undefined}}function o(n){return n.handoffType===17}function he(n,t){const i="b_hide";n&&(t?n.classList.remove(i):n.classList.add(i))}function ce(n,t){const i="fixedHeightWin11";n&&(t?n.classList.add(i):n.classList.remove(i))}function w(n,t){n instanceof HTMLElement&&(n.style.width=t)}function le(t,i,r){if(t){const{TextScaleFactor:f}=n.RuntimeConfiguration,u=f>1,e=n.config.useCobaltCSS;if(i)if(r)u?t.getAttribute("style")||(w(t.querySelector(".dsb-fwp-left"),"57.1%"),t.querySelector(".dsb-fwp-left").style.marginRight="2.2%",w(t.querySelector(".dsb-fwp-right"),"40.7%")):(t.querySelector(".dsb-fwp-left").removeAttribute("style"),t.querySelector(".dsb-fwp-right").removeAttribute("style"));else if(u){if(!t.getAttribute("style")){const n=e?"59.32%":"53.31%";w(t,n)}}else t.removeAttribute("style")}}function pi(){return ThresholdUtilities.isRightToLeftLanguage(n.uiLanguageCache)}function ae(){ut={}}function b(t){let i=ut[t];if(typeof i=="undefined"){let r=SearchAppWrapper.CortanaApp.queryFormulationView.deviceSearch;r.getFolderPathFromKnownFolderIdGuid?(i=n.safeExecute(()=>r.getFolderPathFromKnownFolderIdGuid(t),"getPathFromFolderID","",t),i=i.toLocaleLowerCase()):i="";ut[t]=i}return i}function ve(){ft={}}function et(n){if(!n.startsWith("{"))return n;let t=ft[n];if(!t){let i=n.match(ye);t=i?b(i[1])+i[2]:n;ft[n]=t}return t}function pe(n){return n.startsWith("file:")&&(n=n.slice(5)),n.replace(/\//g,"\\")}function we(t){return n.config.enforceOriginalOrderForTypes[t.type]||n.config.enforceOriginalOrderForTypes[t.type+"|"+t.handoffType]}function be(t){return t==1?"https://substrate.office.com":n.config.useCobaltCSS?"https://substrate.office.com/M365.Access":"https://substrate.office.com/SubstrateSearch-Internal.ReadWrite"}function ke(n){return n==1?"https://www.bing.com":"service::cortana.bing.com::mbi_ssl"}function de(t){return n.TweakSearch&&n.TweakSearch.isTweakSearchEnabled()?n.config[t]:undefined}function ge(){return n.config.skipSelectedScope&&n.RuntimeConfig.AlwaysWide}function wi(t){return n.RuntimeConfig.PreviewPaneAvailable&&n.RuntimeConfig.QfMode!=0&&n.RuntimeConfig.QfMode!=11&&s(t)&&n.canShowUpsell&&!l(t)&&!(SearchAppWrapper.CortanaApp.height<=550)}function bi(t){return(n.config.supportedQuickAnswersMarkets[t]||n.config.quickAnswerIcon||n.config.quickAnswerWeb)&&ki()}function ki(){return(n.RuntimeConfig.PreviewPaneAvailable||!n.RuntimeConfig.AlwaysWide&&!n.config.useCobaltCSS&&!u())&&n.RuntimeConfig.QfMode!=0&&n.RuntimeConfig.QfMode!=11&&n.isBingEnabled()&&n.isBrowserOnline()}function no(){var t;return n.config.anaheimResetDefaultTop&&!n.config.anaheimResetDefaultDisabledLang[(t=it())===null||t===void 0?void 0:t.substring(0,2)]}function to(){return n.config.enableCodexUpsell&&n.isCodexEligible()}function di(){return n.config.enableQFSuggestionsToChatRouting&&n.config.enableBingChatString&&n.isCodexEligible()}function io(n){return n+"&showconv=1&sendquery=1"}function ro(t,i,r){if(n.config.enableQFSuggestionsToChatRouting&&n.isCodexEligible()&&!!i&&t==0&&r!="ECS"){const t=i.trim().split(" ").filter(n=>n.trim()!="").length;return t>=n.config.thresholdForQFSuggToBingChat}return!1}function gi(){return n.config.enableQFChatIcon?n.Host.getWindowsTheme()===2?"searchChatIconDark2":"searchChatIconLight2":"searchChatIcon"}function uo(n){n&&n.handoffType==0&&(n.icon={type:0,className:gi()})}function fo(t,i){return!!i&&!!n.config.enableSearchHomeSuggToBingChat&&t==0&&n.AccessTokenManager.getWindowsAccountType()==2}function eo(){if(!n.config.enableSnipSearchV2)return!1;const i="CN";if(!n.revIpRegionCache||n.revIpRegionCache==i||n.regionCache==i||!n.isBingEnabled())return!1;let t=n.Host.getQuery();return wi(t)?!1:a(t)||f(t)?!1:n.Host.isBitmapInClipboardSupported()}function oo(t){return nr(t)&&(!r(!0)||n.config.enableQuickSearch&&r(!0))&&!tr(t)}function nr(t){const i=it();return(n.isMiniSerpEnabled()||n.config.quickSearchToMsnMarkets[i])&&d(t)&&!n.isDataSourceEnabled("CUSE",t)}function so(){if(n.msbHost!==null&&n.msbHost!==void 0)return n.msbHost.features.isEnterpriseScopeEnabled()}function ho(){return n.msbHost&&n.msbHost.features.isQwsEnabled()&&v()&&n.isMiniSerpEnabled()&&(n.msbHost.qfUtils.getIsMsbClientQfTokenReady()||n.msbHost.qfUtils.getQuickWorkSearchCache()!=null)}function r(t,i){var r,u;let f=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return t?n.config.enableAnaheimWin11ZI?f!=1:(r=n.config.enableAnaheimDataSH&&!n.config.useCobaltCSS&&d(i)&&f!=1)!==null&&r!==void 0?r:!1:(u=n.config.enableAnaheimDataQF)!==null&&u!==void 0?u:!1}function tr(t){const i=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return n.isTrendingSearchEnabled()&&d(t)&&i!=1&&n.RuntimeConfig.QfMode!=0&&n.RuntimeConfig.QfMode!=11&&n.RuntimeConfig.QfMode!=4&&!n.isTSFallbackToANA}function co(t){const i=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return n.isTSWin11LeftPaneEnabled&&!!n.config.trendingSearchInWin11LeftPane&&f(t)&&i!=1&&n.RuntimeConfig.QfMode!=0&&n.RuntimeConfig.QfMode!=11&&n.RuntimeConfig.QfMode!=4}function lo(t){return n.config.msbDsbRecentQueriesEnabled&&!l(t)&&v()&&u()}function ao(){var t,i;return n.config.enableAnaheimWin11ZITopSites?!1:n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable()?(t=h()&&n.LightweightStorage.getItem("AnaheimDataBHListDismissed")!="1"&&(n.config.enableAnaheimDataHS&&n.AnaheimDataParser.HistorySuggestionCount>0||n.config.enableAnaheimDataRC&&n.AnaheimDataParser.RecentlyClosedSuggestionCount>0))!==null&&t!==void 0?t:!1:n.AnaheimDataProvider?(i=h()&&n.config.enableAnaheimDataHS&&n.LightweightStorage.getItem("AnaheimDataBHListDismissed")!="1"&&n.AnaheimDataParser.HistorySuggestionCount>0)!==null&&i!==void 0?i:!1:!1}function vo(){var t,i;return n.config.enableAnaheimWin11ZITopSites&&(n.AnaheimDataParser.TopSitesSuggestionCount<=3?n.LightweightStorage.setItem("AnaheimDataTSTileDismissed","1"):n.LightweightStorage.setItem("AnaheimDataTSTileDismissed","0")),n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable()?(t=h()&&n.LightweightStorage.getItem("AnaheimDataTSTileDismissed")!="1"&&n.config.enableAnaheimDataTSTile&&n.AnaheimDataParser.TopSitesSuggestionCount>=3)!==null&&t!==void 0?t:!1:n.AnaheimDataProvider?(i=h()&&n.config.enableAnaheimDataTSTile&&n.LightweightStorage.getItem("AnaheimDataTSTileDismissed")!="1"&&n.AnaheimDataParser.TopSitesSuggestionCount>=3)!==null&&i!==void 0?i:!1:!1}function h(){var t,i;return n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable()?(t=r(!0)&&n.config.enableAnaheimDataSHUX)!==null&&t!==void 0?t:!1:n.AnaheimDataProvider?(i=r(!0)&&n.config.enableAnaheimDataSHUX&&n.AnaheimDataProvider.getShouldShowAnaheimDataSH())!==null&&i!==void 0?i:!1:!1}function yo(){var t;return n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable()?(t=ot()&&(n.config.enableAnaheimDataHS&&n.AnaheimDataParser.HistorySuggestionCount>0||n.config.enableAnaheimDataRC&&n.AnaheimDataParser.TopSitesSuggestionCount>0||n.config.enableAnaheimDataFV&&n.AnaheimDataParser.FavoriteSuggestionCount>0||n.config.enableAnaheimDataTSTile&&n.AnaheimDataParser.TopSitesSuggestionCount>0))!==null&&t!==void 0?t:!1:n.AnaheimDataProvider?ot()&&n.AnaheimDataParser.HistorySuggestionCount>0:!1}function ot(){var t,i;return n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.checkAnaheimV2Enable()?(t=r(!1)&&n.config.enableAnaheimDataQFUX)!==null&&t!==void 0?t:!1:n.AnaheimDataProvider?(i=r(!1)&&n.config.enableAnaheimDataQFUX&&n.config.enableAnaheimDataHS&&n.AnaheimDataProvider.getShouldShowAnaheimDataQF())!==null&&i!==void 0?i:!1:!1}function po(){var t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return n.config.skipWinVersionCheck||(t==2||t==3)&&[4,27,].indexOf(n.osSKUCache)==-1&&!n.isSubstrateO365AccountConnected}function wo(){return bi(n.Host.getLanguage().toLowerCase())||(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isQwsEnabled())||n.config.enableAnaheimDataSH||n.config.enableAnaheimDataQF}function ir(n,t,i){if(typeof n!="object"||n==null)return n;if(n instanceof Date){let t=new Date;return t.setTime(n.getTime()),t}let r=Array.isArray(n)?[]:Object.create(Object.getPrototypeOf(n));for(let u in n)(!t||t.indexOf(u)<0)&&(r[u]=i&&i.indexOf(u)>=0?n[u]:ir(n[u],t,i));return r}function st(n,t){var i,u,r;if(n===t||typeof n=="function"&&typeof t=="function")return!0;if(typeof n!="object"||n===null||typeof t!="object"||t===null||(i=Object.keys(n),u=Object.keys(t),i.length!==u.length))return!1;for(r=0;r<i.length;r++)if(!Object.hasOwnProperty.call(t,i[r])||!st(n[i[r]],t[i[r]]))return!1;return!0}function bo(t,i,r){return n.config.pureRender?!st(t.props,i)||!st(t.state,r):!0}function ko(){return n.config.mruSearchHome&&!l()}function go(t,i,r,u){return n.Async.safeChainWithGlobalCaching("getIconUrlSuggestion",()=>ThresholdUtilities.createPromise(f=>{let o=SearchAppWrapper.CortanaApp.createStringMap(),s=SearchAppWrapper.CortanaApp.createStringMap(),e=rr(t,i,r,u);n.Async.safeChain("fetchIconUrl",()=>SearchAppWrapper.CortanaApp.makeHttpRequestAsync(0,e,o,"",s),t=>{if(t.statusCode!==200){f(null);return}n.Async.safeChain("readIconResponse",()=>t.readAsStreamAsync(),f,()=>f(null),null,null,1)},()=>f(null),null,e,1)}),()=>t+"_icon",t=>t?n.toIcon(t,"convertResponseToIcon"):{type:0,content:n.getEdgeFallbackIcon()},null,null,t,1)}function rr(t,i=32,r=32,u=1.5){let f=n.getDomain(t).replace("www.",""),e=n.generateKeyFromDomain(f);return"https://th.bing.com/th?id=ODF."+e+"&pid=Api&w="+i+"&h="+r+"&dpr="+u}function k(){return ur()&&ns()}function ur(){return n.isBingEnabled()&&n.RuntimeConfig.AlwaysWide&&n.config.enableDynamicSearchBox&&n.Host.isDSBEnabledByClient()}function ns(){const t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return t!=1||fr()}function fr(){return n.AccessTokenManager.getWindowsAccountType()==1&&(u()||(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.isOffWorkHour())||(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isSupportConsumerDsbForMsbDisabledTenant())||(n.msbDsbSwitchHost===null||n.msbDsbSwitchHost===void 0?void 0:n.msbDsbSwitchHost.isInDiscoverMode()))}function u(){const t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return t===1&&(n.msbDsbHost===null||n.msbDsbHost===void 0?void 0:n.msbDsbHost.isEnabled())}function ts(){return n.config.useCobaltCSS&&n.config.msbDsbGleamWin11Rotation?SearchAppWrapper.CortanaApp.entryPoint=="WNSTBD":er()}function er(){return!n.config.useCobaltCSS&&SearchAppWrapper.CortanaApp.entryPoint=="WNSDSB"||n.config.useCobaltCSS&&SearchAppWrapper.CortanaApp.entryPoint=="WNSTBD"}function or(){const t=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType();return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.showDSBAlways)||n.config.undocked&&(!n.config.enableWin11SSH||t===1||n.isPofEnabledOnWin11())||SearchAppWrapper.CortanaApp.entryPoint=="WNSTBD"&&n.config.enableWin11SSH||SearchAppWrapper.CortanaApp.entryPoint=="WNSDSB"&&!n.config.undocked||SearchAppWrapper.CortanaApp.entryPoint=="WNSGLY"||SearchAppWrapper.CortanaApp.entryPoint=="WNSPBS"||SearchAppWrapper.CortanaApp.entryPoint=="WNSALS"||SearchAppWrapper.CortanaApp.entryPoint=="WNSSTB"||SearchAppWrapper.CortanaApp.entryPoint=="WNSPTP"||SearchAppWrapper.CortanaApp.entryPoint=="WNSKBS"||n.config.enableDSBSearchBox&&SearchAppWrapper.CortanaApp.entryPoint=="WNSBOX"&&!u()||pr()&&SearchAppWrapper.CortanaApp.entryPoint=="WNSBOX"&&!u()||SearchAppWrapper.CortanaApp.entryPoint=="WBQRPL"}function s(t){return t?t.isSearchHomeZI&&t.scope==n.Scope.All:n.RuntimeConfig.SearchHomeAvailable==1}function ht(n){return c(n)}function ct(n){return c(n)}function sr(t){return(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isEnterpriseScopeEnabled())&&!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isEduScopeApplicable())&&(c(t)||n.config.msbWorkSearchMruInShDsbEnabled&&s(t))}function hr(t){return n.config.msbWorkScopeZiPageMruEnabled&&c(t)}function is(t){return cr(t)&&n.config.curatedSuggestionInWorkScopeEnabled&&(hr(t)||sr(t))}function c(t,i){return(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isWorkScopeZiPageContentEnabled())&&((t===null||t===void 0?void 0:t.isWorkScopeZI)||i)}function rs(t){return n.config.msbWorkScopeFreZiPageContentEnabled&&(ct(t)||ht(t))}function us(t){return n.config.msbDsbGleamToWorkScopeEnabled&&(t||os())}function fs(){return(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isTenantMsbEnabled())&&!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isEduTenant())}function es(t){return(n.config.msbDsbGleamRotation||n.config.msbFixedDocumentGleam||n.config.msbFixedPeopleGleam||n.config.msbDsbPinGleam||n.config.msbDsbSwitchScope=="People"||n.config.msbDsbSwitchScope=="Documents")&&(t||ts())&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isTenantMsbEnabled())&&!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isEduTenant())}function os(){return er()&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isTenantMsbEnabled())&&!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isEduTenant())}function f(t){return(s(t)||ht(t))&&k()&&or()&&(n.dsbManager===null||n.dsbManager===void 0?void 0:n.dsbManager.hasContent())}function cr(t){return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.disableCuratedSuggestion)?!1:(a(t)||f(t))&&!l(t)}function l(t){return lr()&&s(t)&&k()&&(SearchAppWrapper.CortanaApp.entryPoint=="WNSDSB"||SearchAppWrapper.CortanaApp.entryPoint=="WNSHID")&&!u()&&!(n.msbDsbSwitchHost===null||n.msbDsbSwitchHost===void 0?void 0:n.msbDsbSwitchHost.shouldShow())&&(n.dsbManager===null||n.dsbManager===void 0?void 0:n.dsbManager.hasContent(!0))&&n.isBrowserOnline()}function lr(){return n.config.enableDSBFullWidthIter2&&n.isDSBV2EnabledMarket()}function ss(){return k()||n.config.transparentMiniserp}function d(n){return!lt()||a(n)&&!f(n)}function a(n){return(s(n)||ct(n))&&!f(n)&&lt()}function lt(){return n.config.enableTwoPanesZI&&n.RuntimeConfig.AlwaysWide}function ar(n){return{type:n.type,handoffType:n.handoffType,hc:n.hc,highConfidenceMetaSuggestionScore:n.highConfidenceMetaSuggestionScore,prefetchConfidenceScore:n.prefetchConfidenceScore,suggestionKey:bt(n)}}function at(n){return Object.assign(Object.assign({},ar(n)),{query:n.query,textWithoutHH:HitHighlightingParser.removeMarkers(n.text),icon:n.getIcon?null:n.icon})}function hs(n,t){return Object.assign(Object.assign({},at(n)),{title:n.primaryMetadata,url:t})}function cs(t){if(n.msbHost!==null&&n.msbHost!==void 0)return n.msbHost.features.isQwsDocSrcEnabled(t)}function vr(t){return(t===null||t===void 0?void 0:t.scope)==n.Scope.All||(t===null||t===void 0?void 0:t.scope)==n.Scope.Work}function ls(){return pt().getSelectedAccountId()!=null&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isMsbInternalTenant())&&v()}function v(){if(n.msbHost!==null&&n.msbHost!==void 0)return n.msbHost.shouldForceEnterprise()}function as(t){return(t===null||t===void 0?void 0:t.isSearchHomeZI)&&(t===null||t===void 0?void 0:t.scope)==n.Scope.People}function yr(n){return n&&{authority:n.accountProviderAuthority,providerId:n.accountProviderId,state:n.accountState,isDefault:n.isDefaultAccount}}function vs(n){return JSON.stringify(yr(n))}function ys(n){return JSON.stringify(n&&n.map(n=>yr(n)))}function ps(t,i,r,u){n.config.enableBackgroundTaskLogging&&n.safeExecute(()=>{SearchAppWrapper.CortanaApp.logMeasure(t,0,i,JSON.stringify(u?u:{}),"")},r)}function ws(){let t=n.Host.getWindowsTheme();return t==2}function bs(t,i,r,u,f){let s=i.filter(t=>t.type!="SW"&&n.contains(u,e(t))&&!n.contains(f,t.type)),h=r.filter(t=>t.type!="SW"&&n.contains(u,e(t))&&!n.contains(f,t.type)),o=n.config.searchTheWebMaxSuggestionsCount;if(n.config.enableProgressiveSearchTheWebMaxSuggestions&&t)switch(t.queryToFetch.length){case 0:case 1:case 2:case 3:break;case 4:o+=1;break;case 5:o+=2;break;case 6:o+=4;break;case 7:o+=6;break;default:o=25}if(s.length>=o){h.map(n=>n.suppressed=!0);let n=0;s.forEach(t=>t.suppressed=n++>=o)}else{let t=1,n=o-s.length;n>0&&h.filter(()=>t++>=n).map(n=>n.suppressed=!0)}}function ks(n,t,i){if(!n||!t||!i||i.length==0)return!1;const r=i.findIndex(i=>{const r=i.toLowerCase().split(":");if(r.length!==2||!r[0]||!r[1])return!1;const[u,f]=r;return t.toLowerCase().startsWith(u)&&n.toLowerCase()===f});return r!==-1}function ds(n,t,i){const r=document.querySelector(n);r&&(r===document.activeElement?r.removeAttribute(t):r.setAttribute(t,i))}function gs(){return(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(40979072))&&SearchAppWrapper.CortanaApp.regionalPolicies.isThirdPartyWebSearchSupported}function nh(){return(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(40979072))&&SearchAppWrapper.CortanaApp.regionalPolicies.isThirdPartyZeroInputSupported}function th(){return(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(40979072))&&SearchAppWrapper.CortanaApp.regionalPolicies.shouldSearchLaunchToMRUThirdPartyScope}function ih(){return(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(40979072))&&!SearchAppWrapper.CortanaApp.regionalPolicies.areRecentWebSearchesAllowedInFirstPartyZeroInput}function pr(){return(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(40979072))&&!SearchAppWrapper.CortanaApp.regionalPolicies.isFirstPartyTaskbarGleamSupported}function rh(){return n.isSearchPointsOfFlexibilityEnabled()&&(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(47251916))&&SearchAppWrapper.CortanaApp.regionalPolicies.isThirdPartyTaskbarGleamSupported}function uh(){if(n.VelocityKeys!==null&&n.VelocityKeys!==void 0)return n.VelocityKeys.isFeatureEnabled(43283005)}function fh(){return document.querySelector(".selected.removeIcon")!==null}function eh(){if(!n.config.enableCodexScope)return!1;const t=n.AccessTokenManager.getWindowsAccountType();return t!==1||!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isEduTenant())}function sh(){return oh}function hh(){return n.config.useCobaltCSS&&n.config.scopeWithBackground&&n.RuntimeConfig.AlwaysWide}function ch(t){t&&!n.TestHookUrlParameters&&(n.config.useCobaltCSS||t!==g.RunAsAdmin&&t!==g.RunAsAdminPreviewPane||SearchAppWrapper.CortanaApp.dismissApp())}let vt,yt;n.setWSBCommonResources=wr;n.getAccessTokenManager=pt;n.getPage=br;n.sameGroup=kr;n.mapOSFormCode=dr;let wt;(function(t){t.KValues=(()=>{let n={};return n.GPT=108,n.GT=109,n.GW=110,n.SW=114,n.PWL=115,n.STS=116,n.SBI=117,n.SBV=118,n.SDSC=119,n.SDIO=120,n.IMIO=121,n.COFA=122,n.COOA=124,n.SDFE=126,n.OWA=128,n.OMSS=129,n.OMIO=130,n.OMTS=131,n.OMAC=133,n.OMVA=135,n.SSTS=136,n.AFOT=137,n.SNSC=138,n.RWBD=139,n.RWBN=140,n.EUP=142,n.RWBG=145,n.QSCH=146,n.SKU=148,n.SNSP=149,n.SNST=150,n.APPA=152,n.OMZI=153,n.FB=154,n.MSBA=155,n.ANA=156,n.APB=157,n.MMB=158,n.OMB=159,n.CB=161,n.EDUR=162,n.EDBU=164,n.ORB=165,n.QWQS=166,n.VFO=167,n.CCBL=168,n.CCBR=169,n.RSBK=170,n.RSBU=171,n.RSBD=172,n.COD=173,n.WSNR=174,n})();t.HandoffsForNonSuggestions=(()=>{let n={};return n.GPT=2,n.GT=3,n.GW=0,n.SDSC=2,n.SDIO=2,n.IMIO=2,n.COFA=2,n.COOA=2,n.SNSP=19,n.SNST=19,n.APPA=997,n.OMZI=997,n.FB=997,n.MSBA=2,n.APB=997,n.MMB=997,n.OMB=997,n.CB=997,n.CCBL=19,n.CCBR=19,n.RSBK=19,n.RSBU=19,n.RSBD=19,n})();t.HandoffsForDSBScenarios=(()=>{let n={};return n.ExploreMore=0,n.OnThisDay=0,n.QuoteOfTheDay=0,n.WordOfTheDay=0,n.WholePageTabs=0,n.HeroCardOfTheDay=0,n.RelatedLocal=19,n.RelatedLocal_Hero=0,n.RelatedLocal_CTA=0,n.RelatedShopping_Hero=20,n.RelatedShopping_CTA=20,n.Rewards=0,n.TrendingImages=13,n.TrendingSearch=0,n.TrendingVideos=0,n.ShortVideos=0,n.PersonalizedRecipes=20,n.RelatedRecipe=0,n.KC_HeroCard=0,n.PersonalizedSports=20,n.DSBServerSide=0,n})();t.GroupsForNonSuggestions=(()=>{let t={};return t.GPT=n.GroupType.GroupHeader,t.GT=n.GroupType.GroupHeader,t.GW=n.GroupType.GroupHeader,t.SDSC=n.GroupType.Settings,t.SDIO=n.GroupType.Settings,t.IMIO=n.GroupType.Settings,t.COFA=n.GroupType.Settings,t.COOA=n.GroupType.Settings,t.SNSP=n.GroupType.VisualSearch,t.SNST=n.GroupType.VisualSearch,t.MSBA=n.GroupType.Upsell,t})()})(wt=n.SyntheticQSCodesMaps||(n.SyntheticQSCodesMaps={}));let gr;(function(n){n[n.Open=1]="Open";n[n.RunAs=2]="RunAs";n[n.RunAsUser=3]="RunAsUser";n[n.OpenInBrowser=4]="OpenInBrowser";n[n.OpenFileLocation=5]="OpenFileLocation";n[n.OpenContaining=6]="OpenContaining";n[n.TabletMode_OpenNewWindow=7]="TabletMode_OpenNewWindow";n[n.PinToStartScreen=8]="PinToStartScreen";n[n.StartUnpin=9]="StartUnpin";n[n.TaskbarUnpin=10]="TaskbarUnpin";n[n.StartPin=11]="StartPin";n[n.TaskbarPin=12]="TaskbarPin";n[n.Manage=13]="Manage";n[n.ConnectNetworkDrive=14]="ConnectNetworkDrive";n[n.DisconnectNetworkDrive=15]="DisconnectNetworkDrive";n[n.Uninstall=16]="Uninstall";n[n["Tile.Uninstall"]=17]="Tile.Uninstall";n[n.ItemProperties=18]="ItemProperties";n[n.Settings=19]="Settings";n[n.Review=20]="Review";n[n.Share=21]="Share";n[n.S_Open=1e3]="S_Open";n[n.S_Install=1001]="S_Install";n[n.S_CopyFullPath=1002]="S_CopyFullPath";n[n.S_SendEmail=1003]="S_SendEmail";n[n.S_SendInstantMessage=1004]="S_SendInstantMessage";n[n.S_CopyPersonDetails=1005]="S_CopyPersonDetails";n[n.S_OpenFileLocationInBrowser=1006]="S_OpenFileLocationInBrowser";n[n.S_OpenInOutlookWeb=1007]="S_OpenInOutlookWeb";n[n.S_LaunchOutlookNative=1008]="S_LaunchOutlookNative";n[n.S_OpenInBrowser=1009]="S_OpenInBrowser"})(gr=n.JumplistActionItemType||(n.JumplistActionItemType={}));n.providerFailureLogName=nu;n.localDataSourceMayContainPII=tu;n.getSuggestionKey=bt;n.prefixNormalizedSuggTypes=new Set(["NS","NH","NM","NL","NP"]);const kt={"Microsoft.Windows.ControlPanel":"ControlPanel","Microsoft.AutoGenerated.{923DD477-5846-686B-A659-0FCCD73851A8}":"Classic_{E9C71548-B580-43B2-ACDB-1BA924002754}","{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\\dfrgui.exe":"Classic_{7D13A5DB-6081-48BD-8EA3-A9D7FE67A335}","{6D809377-6AF0-444B-8957-A3773F02200E}\\Windows Defender\\MSASCui.exe":"NameSpace_Classic_{D8559EB9-20C0-410E-BEDA-7ED416AECC2A}","{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\\cleanmgr.exe":"Classic_{AACA901F-E74F-4894-B074-F55059532853}","Microsoft.AutoGenerated.{BB044BFD-25B7-2FAA-22A8-6371A93E0456}":"Classic_{45FDB5DF-1457-4A41-A824-7AD9C75767BC}","Microsoft.Windows.PCSettings.DefaultApps":"AAA_SettingsPageAppsDefaults"},dt={"NameSpace_Classic_{F942C606-0914-47AB-BE56-1321B8035096}":"Classic_{232A1851-808C-4B44-A92A-38E862989CE5",AAA_Proxy_Automatic_Config_Group:"AAA_SettingsPageNetworkProxy",AAA_Settings_DeveloperModeGroup:"AAA_SettingsPageRestoreDeveloperOptions",AAA_SystemSettings_Users_PicturePassword:"AAA_SettingsGroupPicturePassword"};let t;(function(n){n[n.NotDuplicate=0]="NotDuplicate";n[n.NoMetadata=1]="NoMetadata";n[n.MergeMetadata=2]="MergeMetadata"})(t||(t={}));const iu=[["PPL","MPPL"],["MFIL"],["MBKS","MACR","MQNA","MGRP","MBLD"],["MVALL"]],ru=[["PPL","MPPL"],["MFIL"],["MBKS"],["MACR"],["MQNA","MGRP","MBLD"],["MVALL"]];n.isDuplicate=eu;n.MRUDatabaseName="mruWithIndex";n.MSBMRUDatabaseName="msbMruWithIndex";n.ANADatabaseName="anaWithIndex";n.DataProviderDBName={MRUDataProvider:n.MRUDatabaseName,AnaheimDataProvider:n.ANADatabaseName,MSBMRUDataProvider:n.MSBMRUDatabaseName};n.isFileOrFolderLocalDataSource=ou;n.supportsShortcuts=su;n.setDocumentLocationProperties=hu;n.isModernSetting=cu;n.getAppItem=y;n.isGroup=lu;n.isWin11DSB=au;n.getItemWithFileMetadata=vu;n.getCommandLineItem=nt;n.isMRUHistoryGroupType=yu;n.isWorkScopeMruGroupType=pu;n.getGroupType=e;n.isWebSuggestion=wu;n.isJumpListGroup=ui;n.isTopHitChildGroup=bu;n.isChildSuggestion=tt;n.isJumpListSuggestion=ku;n.getScope=du;n.IconSize_GridLayout=92;n.IconSize_GridLayout_Medium=68;n.IconSize_GridLayout_Scaled=130;n.getImageSizeValue=gu;n.populateImageRatio=nf;n.getImageUrl=tf;let rf={"zh-hans-cn":"zh-cn","zh-hans-sg":"zh-cn","zh-hant-hk":"zh-hk","zh-hant-tw":"zh-tw",ko:"ko-kr",ja:"ja-jp",nb:"nb-no"};n.getCurrentLanguage=it;n.createSuggestion=fi;n.addSubItemToSuggestion=uf;n.getSyntheticSuggestion=ff;n.getNarratorText=ei;n.isL2=oi;n.iconIsThumbnail=hi;n.displayedInGridLayout=ef;n.parseWebSuppressionSignals=sf;let p;n.decodeHtml=hf;let rt;(function(n){n[n.Author=1]="Author";n[n.LastModifiedBy=2]="LastModifiedBy";n[n.Content=3]="Content";n[n.Tags=4]="Tags";n[n.Album=5]="Album";n[n.Artist=6]="Artist";n[n.Genre=7]="Genre";n[n.Location=8]="Location"})(rt=n.MatchType||(n.MatchType={}));n.createMatch=cf;const lf=/[-[\]{}()*+!<=:?.\/\\^$|#,]/g;n.escapeRegex=i;n.tryGetLocationMatch=af;n.tryGetTextContentMatch=vf;n.matchesOnPropertyHH=yf;n.uses3lineTemplate=pf;n.hasReverseHighlighting=wf;n.isEquivalentForPreviewPanePurposes=kf;n.isNullOrUndefined=df;class gf{constructor(t,i,r){this.verb=t.verb;this.displayName=t.displayName;this.executeSync=t.executeSync?()=>r(()=>t.executeSync()):()=>r(()=>{n.Async.safeChain("verb.executeAsync",()=>t.executeAsync(),()=>n.Host.manuallyDismissApp(),null,null,null)});this.isDefault=t.isDefault;this.icon=i;this.getIcon=t.getIcon}}n.DeviceItemVerbWrapper=gf;n.shouldSetThisPcGroupSource=ne;n.getGroupSourceDisplayName=te;n.EdgeAppIds=["MSEdge","Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge"];n.AnaheimAppIds=["MSEdge"];n.SpartanAppId="Microsoft.MicrosoftEdge_8wekyb3d8bbwe!MicrosoftEdge";n.InternetExplorerId="Microsoft.InternetExplorer.Default";n.DMAConsentAppIds=["shell:RecycleBinFolder"];n.getRtlAdjustedKey=ie;n.getSearchSuggestionIcon=re;n.getWebSuggestionAnnotation=ue;n.getSeeWebResultsAnnotationKey=ci;n.msbEnabledForQuery=fe;n.isOnlineSuggestionPersonType=li;n.isOnlineSuggestionMsbFile=ai;n.getMsbTophitSuggestionTypeOrder=ee;n.isMsbOnlineSuggestionType=oe;n.isMsbVerticalOnlineSuggestionType=vi;n.isMsbSubverticalOnlineSuggestionType=yi;n.getMsbSuggestionTypeFromSubverticalOnlineSuggestionType=se;n.isMsbQFSuggestion=o;n.setVisibility=he;n.setFixHeight=ce;n.setWidth=w;n.setAdaptiveWidth=le;n.isRtl=pi;n.FOLDERID_Profile="{5E6C858F-0E22-4760-9AFE-EA3317B67173}";n.FOLDERID_SkyDrive="{A52BBA46-E9E1-435f-B3D9-28DAA648C0F6}";n.FOLDERID_System="{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}";n.FOLDERID_SystemX86="{D65231B0-B2F1-4857-A4CE-A8E7C6EA7D27}";let ut={};n.clearFolderCaches=ae;n.getKnownFolderPathLC=b;let ft={};n.clearPathExpansionCache=ve;let ye=/^\{([a-z0-9-]{36})\}(.*)/i;n.resolveKnownFolderGUIDsInPath=et;n.indexerFilePathToRegularPath=pe;n.enforceOriginalOrder=we;n.getSubstrateResourceOrScope=be;n.getBingResourceOrScope=ke;n.getTweakedSetting=de;n.shouldSkipSelectedScope=ge;n.canShowSearchHomeUpsell=wi;n.shouldEnableQuickSearches=bi;n.preconditionForEnableQuickSearches=ki;n.shouldEnableAnaheimResetDefault=no;n.shouldEnableCodexUpsell=to;n.shouldEnableBingChatString=di;n.appendBingChatParams=io;n.shouldQFSuggToBingChat=ro;n.searchChatIconClassName=gi;n.setSearchSuggestionChatIcon=uo;n.shouldSHSuggToBingChat=fo;n.shouldEnableSnipSearch=eo;n.canShowQuickSearch=oo;n.canShowQuickSearchWithoutANA=nr;n.shouldUseMsbEnterpriseScopes=so;n.canShowQuickWorkSearch=ho;n.isAnaheimDataEnabled=r;n.isTSFallbackToANA=!1;n.isTrendingSearchDataEnabled=tr;n.isTSWin11LeftPaneEnabled=!0;n.isTrendingSearchDataInWin11LeftPaneEnabled=co;n.isRecentWorkSearchEnabled=lo;n.canShowAnaheimDataSHListE2E=ao;n.canShowAnaheimDataSHTileE2E=vo;n.canShowAnaheimDataSH=h;n.canShowAnaheimDataQFE2E=yo;n.canShowAnaheimDataQF=ot;n.isConsumerWindowsSKU=po;n.shouldShowTwoColumns=wo;n.currentTabStorageKey="currentTab";n.MeetingDismissedEndDateKey="MeetingDismissedStartDate";n.deepCopy=ir;n.shouldComponentUpdateOverload=bo;n.enableMRUSearchHome=ko;n.getFaviconUrlForRawUrl=go;n.getThumbnailServerUrl=rr;n.isDynamicSearchContentPossible=k;n.isDynamicSearchContentBaseEnabled=ur;n.isDsbEnabledForEnterprise=fr;n.isMsbDsbEnabled=u;n.isDSBAllowedInEntryPoint=or;n.isZeroInputAllScope=s;n.canShowMsbDsbInWorkScopeZi=ht;n.canShowMsbSearchHomeInWorkScopeZi=ct;n.canShowWorkSearchMru=sr;n.canShowMruInWorkScopeZi=hr;n.canShowCuratedSuggestionInEnterpriseScope=is;n.canShowWorkScopeZiPageContent=c;n.canShowWorkFreZiPageContent=rs;n.isWorkScopeDsbGleamRedirect=us;n.isWorkScopeDsbGleamRedirectOnHoverAllowed=fs;n.isDsbGleamSwitchToScopeEnabled=es;n.shouldShowDSBLayout=f;n.canShowCuratedSuggestions=cr;n.isCurrentDayMainMomentDismissed=!1;n.shouldShowDSBFullWidth=l;n.isDSBFullWidthFlightEnabled=lr;n.shouldShowTransparentMiniserp=ss;n.shouldShowZIDataSource=d;n.shouldShowStaticSearchHome=a;n.isTwoPanesZIEnabled=lt;n.getMruSuggestionData=ar;n.getMruWebSuggestionData=at;n.getMruUrlSuggestionData=hs;n.isDocSourceEnabledInQws=cs;n.isMsbQwsDocsCacheEnabled=vr;n.isMsbInternalTenant=ls;n.isMsbEnterprise=v;n.isPeopleScopeZI=as;n.stringifyISearchWebAccount=vs;n.stringifyISearchWebAccounts=ys;n.logToMC=ps;n.isDarkModeEnabled=ws;n.limitWebSuggestions=bs;n.isMarketEligible=ks;n.PreviewMetadataContainerId="previewMetadataLocation";n.PreviewMetadataContainer={id:"previewMetadataLocation",selected:!1};n.focusedToolTipHandler=ds;n.isThirdPartySearchAllowed=gs;n.isThirdPartyZeroInputEnabledByRegionalPolicy=nh;n.isThirdPartyMRUEnabledByRegionalPolicy=th;n.isZeroInputRecentsDisabledByRegionalPolicy=ih;n.isBingGleamDisabledByRegionalPolicy=pr;n.isThirdPartyGleamSupported=rh;n.isSearchDragAndDropEnabled=uh;n.isRemoveIconSelected=fh;n.isChatScopeEnabled=eh;const oh=navigator.userAgent;n.getUserAgent=sh;n.isWin11AlwaysWide=hh;let g;(function(n){n.RunAsAdmin="RunAs";n.RunAsAdminPreviewPane="pp_RunAs"})(g||(g={}));n.dismissAppWhenRunAsAdmin=ch}(WSB||(WSB={})),function(n){let t;(function(n){n.checking="checking";n.downloading="downloading";n.error="error";n.noUpdate="noupdate";n.obsolete="obsolete";n.updateReady="updateready"})(t||(t={}));const i=[t.checking,t.downloading,t.error,t.noUpdate,t.obsolete,t.updateReady];class r{constructor(n=Date.now){this.getNowTimestamp=n;this._appCacheEventIndex=1;this._superFreshEnabled=!1;this._appCache=_w.applicationCache;this.subscribeForEvents()}instrumentSuperFreshUpdate(n){this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.SuperFreshUpdateData.T=this.getNowTimestamp();this._appCacheTimeline.SuperFreshUpdateData.S=n;this.sendAppCacheEvents()}registerSuperFresh(){this._superFreshEnabled=!0}subscribeForEvents(){i.forEach((n,t)=>sj_be(this._appCache,n,()=>this.handleAppCacheEvent(n,t)))}handleAppCacheEvent(n,i){n!=t.checking&&this._appCacheTimeline||(this._appCacheTimeline=this.createAppCacheTimelineObject());this._appCacheTimeline.AppCacheEvents[i]=this.getNowTimestamp();switch(n){case t.obsolete:SharedLogHelper.LogWarning("handleAppCacheEvent",null,"AppCache marked as obsolete and will be deleted");this.sendAppCacheEvents();break;case t.error:case t.noUpdate:this.sendAppCacheEvents();break;case t.updateReady:this._superFreshEnabled||this.sendAppCacheEvents()}}sendAppCacheEvents(){let r=_G.ServerIG;if(!r){SharedLogHelper.LogError("sendAppCacheEvents","Could not instrument as server IG not known",new Error("Could not instrument app cache event"));return}let t=this._appCacheTimeline;if(t){let u=t.AppCacheEvents,f=[{I:t.EventIndex,E:u,S:t.SuperFreshUpdateData,ABT:n.InstrumentationHelper.getConversationStartTimestamp()}];u[2]&&(f[0].OL=navigator.onLine);let i=n.InstrumentationCommon.createPerfPingEvent(r,f,"AppCache",n.Host.getConversationId());Log2.LogEvent(i.EventType,i.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,i.ImpressionGuid,null,null);this._appCacheTimeline=this.createAppCacheTimelineObject()}}createAppCacheTimelineObject(){let n={EventIndex:this._appCacheEventIndex,AppCacheEvents:{},SuperFreshUpdateData:{T:undefined,S:undefined}};return this._appCacheEventIndex++,n}}n.AppCacheInstrumentationHelper=r}(WSB||(WSB={})),function(n){const t=["PP","ST","FL","LM"];class i{constructor(){this._isMobile=SearchAppWrapper.CortanaApp.isMobile}logProfilerMarker(t,i,r,u,f){f||(f={});n.safeExecute(()=>{t==1?SearchAppWrapper.CortanaApp.logMeasure("Bing_QF_"+r,i,"QF",JSON.stringify(f),u):SearchAppWrapper.CortanaApp.logVerboseTrace("Bing_QF_"+r,i,"QF",JSON.stringify(f),u)},"logProfilerMarker")}getEnrichedClientInfoForDSB(){var i,r;let t={},u=(i=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())!==null&&i!==void 0?i:0;if(t.windowsAccount=u.toString(),t.snrVersion=n.config.snrVersion,u===1){const i=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.getTenantVariants();i&&(t.msbTenantVariants=i)}if(n.config.wsbWebView2){const n=this.getWebView2Info();t.isWebView2=(n===null||n===void 0?void 0:n.isWebView2)?1:undefined;t.webView2Version=((r=n===null||n===void 0?void 0:n.webView2Version)===null||r===void 0?void 0:r.length)>0?n.webView2Version:undefined}return t}getEnrichedClientInfo(t){var r,u,f,e,o;let p=typeof _G=="object"?_G:{};const h=n.getUserAgent();let i={};if(i.entryPoint=SearchAppWrapper.CortanaApp.entryPoint,i.previousExperience=SearchAppWrapper.CortanaApp.queryFormulationView.previousExperience,i.qfMode=""+n.RuntimeConfig.QfMode,i.isSearchHome=(t===null||t===void 0?void 0:t.isSearchHomeZI)?1:undefined,i.isSVCss=n.config.useCobaltCSS?1:undefined,i.region=n.regionCache||undefined,i.lang=n.uiLanguageCache||undefined,i.DC=p.DA||undefined,i.isMobile=this._isMobile?1:0,i.isXbox=h.toLowerCase().includes("xbox one")?1:0,i.isHololens=h.toLowerCase().includes("hololens")?1:0,i.windowsColor=n.Host.getWindowsTheme(),i.appColor=n.Host.getAppTheme(),n.config.useCobaltCSS)i.WideAtStartupDelta=440;else{let t=n.Host.getFeatureDWORD("WideAtStartupDelta");t.validFeature&&typeof t.featureValue=="number"&&(i.WideAtStartupDelta=t.featureValue)}t&&t.scope!=n.Scope.All&&(i.scope=n.Scope[t.scope]);(t===null||t===void 0?void 0:t.fromSuggestionType)&&(i.fromClick={sType:t.fromSuggestionType,searchHome:t.fromSearchHome?1:undefined});i.deviceHistoryEnabled=n.RuntimeConfiguration.DeviceHistoryEnabled?1:0;let s=(r=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())!==null&&r!==void 0?r:0;i.windowsAccount=s.toString();let w=(u=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getMsaAccountsCount())!==null&&u!==void 0?u:0;i.msaAccountsCount=w;let b=(f=n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getAadAccountsCount())!==null&&f!==void 0?f:0;i.aadAccountsCount=b;n.isAADVerificationRequired&&(i.aadAccountVerificationRequired=1);n.isMsftAccountConnected&&(i.msftAccountConnected=1);n.isSubstrateO365AccountConnected&&(i.o365Connected=1);n.isSubstrateOutlookAccountConnected&&(i.outlookConnected=1);n.Host.hasFallbackHappened()&&(i.fallback=1);n.Host.isClientLocationAvailable()&&(i.clientLocationAvailable=1);n.Host.isInputPanelVisible()&&(i.isInputPaneVisible=1);n.Host.getWindowsTheme()==2&&(i.darkMode=1);SearchAppWrapper.CortanaApp.colorPrevalenceEnabled&&(i.colorPrevalence=1);SearchAppWrapper.CortanaApp.isSearchBoxInTaskbar&&(i.searchBoxInTaskbar=1);SearchAppWrapper.CortanaApp.taskbarOrientation&&(i.taskbarOrientation=SearchAppWrapper.CortanaApp.taskbarOrientation);n.config.enableEdgeMuidsTelemetry&&SearchAppWrapper.CortanaApp.edgeMuids&&(i.edgeMuidCount=n.Host.getEdgeMuidCount(),i.edgeMuidDefault=n.Host.getEdgeMuidDefault(),i.edgeMuids=n.Host.getEdgeMuidsAdditional(2).join(","));n.config.snrVersion&&(i.snrVersion=n.config.snrVersion);n.osSKUCache&&(i.osSKU=n.osSKUCache.toString());i.ciVersion=n.ConstraintIndex.currentCIVersion;i.defaultBrowser=n.Host.getDefaultBrowser().toString();let c=n.config.enableFuzzyRanking||n.config.enableFuzzyRanking1?n.Host.getFRSuggCount():-1;c>-1&&(i.frSC=c.toString());let l=n.config.enableColdStartRanking||n.config.enableColdStartRanking1?n.Host.getCRCount():-1;l>-1&&(i.crC=l.toString());let a=n.config.enableColdStartRanking||n.config.enableColdStartRanking1?n.Host.getNCRCount():-1;a>-1&&(i.ncrC=a.toString());let v=n.config.enableColdStartRanking||n.config.enableColdStartRanking1?n.Host.getFCRCount():-1;if(v>-1&&(i.fcrC=v.toString()),t===null||t===void 0?void 0:t.isSearchHomeZI){const t=n.dsbManager===null||n.dsbManager===void 0?void 0:n.dsbManager.getDynamicSearchBoxContentKeyAtShown();t&&(i.dsbContentKey=t)}if(n.config.enableDynamicSearchBox&&(i.isDSBEnabledByClient=n.Host.isDSBEnabledByClient(),i.isDSBContentPossible=n.isDynamicSearchContentPossible()),n.msbHost&&(i.tenantMsbStatus=n.msbHost.getTenantMsbStatus(),s===1||s===0)){i.msbSyncdocFired=n.msbHost.qfUtils.getClientQfSyncDocEventFired();i.msbClientQfState=n.msbHost.qfUtils.getMsbClientQfState();const r=n.msbHost.qfUtils.getClientQfStatusMessage();r&&(i.msbClientQfStatusMsg=r);const u=n.msbHost.getTenantVariants();u&&(i.msbTenantVariants=u);i.msbClientQfTrieState=n.safeExecute(()=>n.msbHost.qfUtils.getMsbClientQfTrieState(),"getMsbClientQfTrieState");i.workChatEligibility=n.msbHost.getChatEligibility();n.msbDsbSwitchHost&&n.msbHost.features.isMsbDsbSwitchEnabled()&&(t===null||t===void 0?void 0:t.isSearchHomeZI)&&n.config.enableDynamicSearchBox&&(i.msbDBM=n.msbDsbSwitchHost.getBlendMode())}((e=n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.getFeatures())===null||e===void 0?void 0:e.length)>0&&(i.vks=n.VelocityKeys.getFeatures());i.isSmallIcons=SearchAppWrapper.CortanaApp.isTrayInSmallIconsMode;const y=SearchAppWrapper.CortanaApp.isTraySearchBoxVisibleOnAnyMonitor;if(y!=undefined&&(i.isSearchBoxVisible=y?1:0),n.config.wsbWebView2){const n=this.getWebView2Info();i.isWebView2=(n===null||n===void 0?void 0:n.isWebView2)?1:undefined;i.webView2Version=((o=n===null||n===void 0?void 0:n.webView2Version)===null||o===void 0?void 0:o.length)>0?n.webView2Version:undefined}if(SearchAppWrapper.CortanaApp.systemInfo){const t=n.Host.getSearchAppMemoryCommitMB();i.searchAppMemoryCommitMB=t>0?t:undefined}return i}getSuggestionsPageName(){return"Page.SmartSearch.AS.Suggestions"}getApplicationName(){return"SmartSearch"}getRankerModelId(){return n.Ranking.suggestionFastRankModelIdCurrent}createNonSuggestionDataSourceObject(t,i){return{T:"D.Url",K:i.getKValue(),Val:t,Ho:n.SyntheticQSCodesMaps.HandoffsForNonSuggestions[t],Gr:n.SyntheticQSCodesMaps.GroupsForNonSuggestions[t],NR:1,Properties:i.getProperties()}}createDataSourceObject(t,i){const u=t.mayContainPII&&!n.TestHookUrlParameters,f=(i||t.instItem).getKValue(),e=i&&typeof i.getHandoffType()=="number"?i.getHandoffType():t.handoffType,o=i?i.getQsCode():t.type;let r={T:"D.Url",K:f,Q:u?undefined:t.query,MQ:t.ciMatchedQuery?t.ciMatchedQuery:undefined,Val:o,Ho:e,Ans:t.isAnswer?1:undefined,Gr:n.getGroupType(t),HC:t.hc?1:undefined,RAF:t.useRaf?1:undefined,HS:t.fromHistory?1:undefined,F:t.features.length>0?t.features.join(","):undefined,AC:t.autoCompleteType?t.autoCompleteType:undefined,HCMS:t.highConfidenceMetaSuggestionScore,HCS:t.highConfidenceSuggestionScore,LM:t.suggestionLogMeta,Url:t.url,Uri:t.actionUri,Src:t.source,Sg:t.segments,NR:t.notAResult?1:undefined};if(t.deviceItem?r.DeviceSignals=n.safeExecute(()=>this.buildDeviceItemDataSource(u,t),"buildDeviceItemDataSource"):n.isJumpListSuggestion(t)&&(r.DeviceSignals=n.safeExecute(()=>this.buildJumpListItemDataSource(t),"buildJumpListItemDataSource")),n.TestHookUrlParameters){let n=t;n.path&&(r.path=n.path);n.targetPathLC&&(r.targetPath=n.targetPathLC)}return r.RankerSignals=this.buildRankerOutputDataSource(t),r}buildRankerOutputDataSource(n){if(!n.rankingScore&&!n.featureStore)return undefined;return{rankingScore:n.rankingScore,featureStore:n.featureStore,mruSuppressionScore:n.mruSuppressionScore,fbcScore:n.fbcScore,previewPaneScore:n.previewPaneScore}}buildJumpListItemDataSource(t){let r=t.jumpListItem,i={Rank:r.usagePoints||undefined,LAD:n.isValidDate(r.lastAccessed)?r.lastAccessed.toJSON():undefined};if(n.TestHookUrlParameters)i.path=r.path,i.description=t.tooltip;else if(!i.Rank&&!i.LAD)return undefined;return i}getPathCompletionItem(n){return n.type=="PT"?n.deviceItem:null}buildDeviceItemDataSource(t,i){var e;let f=i.deviceItem,r={Rank:f.rankScore};if(((e=f===null||f===void 0?void 0:f.propertyHitsString)===null||e===void 0?void 0:e.length)>0?r.PHits=f.propertyHitsString:f.propertyHits&&f.propertyHits.length>0&&(r.PHits=f.propertyHits.join(",")),t||(r.Id=f.id,r.DName!=i.query&&(r.DName=f.displayName)),n.TestHookUrlParameters&&(r.kind=f.kind),n.isSetting(i.type))return r.MDN=n.isModernSetting(f)?1:0,r;let u=n.getAppItem(i);if(u)return r.LAD=n.isValidDate(u.lastAccessed)?u.lastAccessed.toJSON():undefined,r.AppLnch=u.totalLaunches,r.Args=u.launchArguments?1:0,r.MDN=u.isImmersive?1:0,r.Ext=u.extension,n.TestHookUrlParameters&&(r.CDT=n.isValidDate(u.createdDate)?u.createdDate.toJSON():undefined,r.LMD=n.isValidDate(u.lastModifiedDate)?u.lastModifiedDate.toJSON():undefined,r.launchArguments=u.launchArguments,r.filePath=u.filePath),r;let o=n.getItemWithFileMetadata(i);if(o){r.Ext=o.extension;n.TestHookUrlParameters&&(r.itemTypeDisplayName=o.itemTypeDisplayName);let t=n.getCommandLineItem(i);if(t)return n.TestHookUrlParameters&&(r.launchArguments=t.launchArguments,r.encodedPath=t.encodedPath),r;if(!this.getPathCompletionItem(i)){let t=i.deviceItem;r.CDT=n.isValidDate(t.createdDate)?t.createdDate.toJSON():undefined;r.LMD=n.isValidDate(t.lastModifiedDate)?t.lastModifiedDate.toJSON():undefined;r.Ext=t.extension?t.extension:""}}return r}logMasterPageImpression(t){n.safeExecute(()=>n.config.enableCETOFlightAssignment?ThresholdInst.LogMasterPageImpressions(t,null,t.enrichedClientInfo):ThresholdInst.LogPageImpression(t,null,t.enrichedClientInfo),"logMasterImpressionForClient")}logDataSourceTimeout(i,r){if(SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure)for(let u of t)n.isDataSourceEnabled(u,r)&&!n.contains(i,u)&&n.safeExecute(()=>SearchAppWrapper.CortanaApp.queryFormulationView.logProviderFailure(n.providerFailureLogName(u),"NoReturnForTopHit"),"logProviderFailure")}onItemClick(){SearchAppWrapper.CortanaApp.queryFormulationView.resetConversationIdNextTimeQFIsShown&&SearchAppWrapper.CortanaApp.queryFormulationView.resetConversationIdNextTimeQFIsShown()}getWebView2Info(){var t;if(!this._cachedWV2Info){const i=n.getUserAgent(),r=i.includes("IsWebView2/True"),u=r?(t=i.match(/\(WebView2Version (.*)\)/))===null||t===void 0?void 0:t[1]:"";this._cachedWV2Info={isWebView2:r,webView2Version:u}}return this._cachedWV2Info}}n.WSBInstrumentationProvider=i}(WSB||(WSB={})),function(n){const r="/QF_KEYSTROKE_VIRTUAL_URL?",i="autosuggest";class t{static init(i,r){t._keystrokesInstrumentationData={};t._instrumentationProvider=i;t._clientTelemetry=r;ClientInstConfig.queueDumpInterval=n.config.logQueueDumpInterval;_w.ClTrCo.SharedClickSuppressed=!0;n.Host.bindShown(n=>t._clientShownTimestamp=n);n.Host.bindConversationStart(()=>t.onConversationStart());t._conversationTimeline={RawImpressionGuid:"",ImpressionGuid:"",ConversationId:"",AppVisibleStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AppVisibleFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AppShownStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AppShownFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE}}static bindFinalizeKeystroke(n){t._finalizeKeystrokeHandlers.push(n)}static bindKeystrokeTimelineUpdated(n){t._keystrokeTimelineUpdatedHandlers.push(n)}static fireKeystrokeTimelineUpdatedHandlers(n){t._keystrokeTimelineUpdatedHandlers.forEach(t=>t(n))}static getRawImpressionGuid(i){let r=t._keystrokesInstrumentationData[i];return r&&r.RawImpressionGuid?r.RawImpressionGuid:(SharedLogHelper.LogError("getRawImpressionGuid","sequenceNumber: "+i+" ConversationID: "+n.Host.getConversationId(),new Error("No instrumentation data/no IG found for sequenceNumber")),"")}static getImpressionGuid(n){let i=t._keystrokesInstrumentationData[n];if(i&&i.ImpressionGuid)return i.ImpressionGuid;throw"getImpressionGuid(): No IG for sequence "+n;}static updateSuggestionsList(n,i){t._clientTelemetry&&t._clientTelemetry.updateSuggestionsList(n,i)}static instrumentKeyDown(n){t._keyDownTimeStamp=n}static instrumentFetchProviderBegin(i,r){i>0&&t.safeInstrumentPerf(i,i=>{n.config.perfInstV2&&(i.DataProvidersStarted[r]=t.getOffsettedNow())},"instrumentFetchProviderBegin",null)}static instrumentFetchesBegin(i){t.safeInstrumentPerf(i,i=>{i.DataSourcesFetchBegin=t.getOffsettedNow(),n.config.perfInstV2&&(i.DataProviderFetchStart=t.getOffsettedNow())},"instrumentFetchesBegin",null)}static instrumentFetchesEnd(n){t.safeInstrumentPerf(n,n=>{n.DataSourcesFetchEnd=t.getOffsettedNow()},"instrumentFetchesEnd",null)}static instrumentDataSourceParsed(n,i){t.safeInstrumentPerf(n,n=>{let r=t.getOffsettedNow();typeof n.ResponseParsed[i]!="number"?n.ResponseParsed[i]=r:(n.MultipleResponsesParsed[i]||(n.MultipleResponsesParsed[i]=[n.ResponseParsed[i]]),n.MultipleResponsesParsed[i].push(r))},"instrumentDataSourceParsed",i)}static instrumentItemClickForPreviewPane(n,i,r,u,f,e,o,s,h){if(i.getHandoffType()!=999){let c=t.createBaseCustomGPingPayload(f,e);t.addPreviewPaneDataToGPingPayload(c,o,s,h);t.instrumentItemClickAndGPing(c,n,i,r,u,f)}}static isContextMenuVerbClickEvent(t){switch(t){case"RemoveFromDeviceHistory":case"RemoveFromDeviceHistoryAll":case n.JumplistActionItemType[n.JumplistActionItemType.StartPin]:case n.JumplistActionItemType[n.JumplistActionItemType.StartUnpin]:case n.JumplistActionItemType[n.JumplistActionItemType.TaskbarPin]:case n.JumplistActionItemType[n.JumplistActionItemType.TaskbarUnpin]:case n.JumplistActionItemType[n.JumplistActionItemType.PinToStartScreen]:case n.JumplistActionItemType[n.JumplistActionItemType.S_CopyFullPath]:case n.JumplistActionItemType[n.JumplistActionItemType.S_CopyPersonDetails]:return!1;default:return!0}}static instrumentItemClickForContextMenu(n,i,r,u,f,e,o){if(i.getHandoffType()!=999)if(this.isContextMenuVerbClickEvent(o)){let s=t.createBaseCustomGPingPayload(f,e);t.addContextMenuDataToGPingPayload(s,o);t.instrumentItemClickAndGPing(s,n,i,r,u,f)}else t.instrumentLayoutItemSelect(i,r)}static instrumentItemClick(n,i,r,u,f,e){let o=i.getHandoffType();if(o!=999)if(o==998||o==997)t.instrumentLayoutItemSelect(i,r);else{let o=t.createBaseCustomGPingPayload(f,e);if(i.getProperties()){let n=i.getProperties();t.addExtraPropsToGPingPayload(o,n)}t.instrumentItemClickAndGPing(o,n,i,r,u,f)}}static instrumentItemClickAndGPing(i,r,u,f,e,o){t.sendCustomGPing(i,u.getHValue(),r);let h=t._keystrokesInstrumentationData[f],s=t._keystrokesInstrumentationData[f];s?(h.RenderingStarted||t.updatePageIG(f),_G.IG!=s.ImpressionGuid&&SharedLogHelper.LogError("instrumentItemClick","IG ("+s.ImpressionGuid+") for sequenceNumber "+f+" does not match the page IG ("+_G.IG+")",new Error("IG for sequence number does not match the currently rendered page's IG (_G.IG)")),t._clientTelemetry&&t._clientTelemetry.logItemClickedMeasure(s.ConversationId,s.RawImpressionGuid,u,o)):SharedLogHelper.LogError("instrumentItemClick","sequenceNumber: "+f+" ConversationID: "+n.Host.getConversationId(),new Error("No instrumentation data found for sequenceNumber"));t.finalizeKeystrokeLog(f,1);e&&e();t._instrumentationProvider.onItemClick();n.config.forceLogFlush?Log2.ForceFlush():Log2.FlushMainQueueDontForce();_w.clickFlushedTime=sb_gt()}static instrumentLayoutItemSelect(n,i){let r={AppNS:n.getAppNS(),K:n.getLayoutKValue()};t.logClientInstEvent("Select","ItemClicked",i,r)}static instrumentDSBChevronSelect(i){let r={scenario:i};t.logClientInstEvent("Select","DSBMegaChevronClicked",n.SequenceNumberManager.getSequenceNumber(),r)}static instrumentDSBChevronDirection(i,r){let u={scenario:i,direction:r};t.logClientInstEvent("Select","DSBMegaChevronDirectionClicked",n.SequenceNumberManager.getSequenceNumber(),u)}static instrumentPerfEvent(i,r,u){n.config.logClientPerf&&t.safeInstrumentPerf(i,n=>{t._instrumentationProvider.logProfilerMarker(1,0,r,n.RawImpressionGuid,{d:u})},"instrumentPerfEvent")}static instrumentAggregateFunctionPerf(i,r){n.config.logClientPerf&&t._clientTelemetry.logAggregateFunctionPerf(i,r)}static instrumentDeviceQueryBegin(n){t._instrumentationProvider.logProfilerMarker(1,0,"StartDeviceQuery",n,{})}static createBaseCustomGPingPayload(n,i){let r={};switch(n){case 1:r.i="k";r.mk=t.getModifierKeyCodes(i);break;case 3:r.i="t";break;case 4:r.i="p";break;case 5:r.i="n";break;case 6:r.i="b";break;case 0:r.i="x";r.mk=t.getModifierKeyCodes(i);break;default:r.mk=t.getModifierKeyCodes(i)}return r}static addContextMenuDataToGPingPayload(n,t){n.cm=t}static addExtraPropsToGPingPayload(n,t){Object.keys(t).forEach(i=>{n[i]=t[i]})}static addPreviewPaneDataToGPingPayload(n,t,i,r){t&&(n.pp=t,i&&(n.ppit=i),typeof r=="number"&&(n.rho=r))}static sendCustomGPing(t,i,r){let u=i;n.isEmpty(t)||(u+="&PR="+JSON.stringify(t));n.safeExecute(()=>_w.si_T(u,null,null,0,r),"logCustomGPing")}static getModifierKeyCodes(n){if(n){let t=n.altKey?"A":"";if(t+=n.ctrlKey?"C":"",t+=n.shiftKey?"S":"",t)return t}return undefined}static notifyTopHitPreviewPaneOpenedOrInterrupted(i,r){let u=t._keystrokesPerfPingData[i];u&&u.PreviewPanePendingInfo!=null&&(u.PreviewPanePendingInfo.latency=t.getOffsettedNow(),r?u.PreviewPaneOpened=u.PreviewPanePendingInfo:u.PreviewPaneCanceled=u.PreviewPanePendingInfo,u.PreviewPanePendingInfo=null,t.tryInstrumentRenderStopped(i,u));n.config.perfInstV2&&r&&t.safeInstrumentPerf(i,n=>{n.PreviewPaneFinish=t.getOffsettedNow()},"instrumentFetchesEnd",null)}static previewPaneOpenedOrClosed(n,i,r,u,f,e){let o=n?"Select":"Unselect",s=n?"PreviewPaneOpened":"PreviewPaneClosed";if(t.logClientInstEvent(o,s,i,e),n&&t._keystrokesPerfPingData[i]&&t.notifyTopHitPreviewPaneOpenedOrInterrupted(i,!0),n&&t._clientTelemetry){let n=t._keystrokesInstrumentationData[i];n&&t._clientTelemetry.logPreviewPaneOpenedMeasure(r,u,f)}}static logClientInstEvent(n,i,r,u){let f=null;if(r){let n=t._keystrokesInstrumentationData[r];n&&(f=n.ImpressionGuid)}Log2.LogEvent(n,u,i,null,null,f,null,null)}static safeInstrument(n,i,r,u){let f=t._keystrokesInstrumentationData[n];if(f)i(f);else{var e=u?" DS: "+u:"";SharedLogHelper.LogError(r,(u?u+" ":"")+" sequenceNumber: "+n,new Error("No instrumentation data found for sequenceNumber"+e))}}static safeInstrumentPerf(i,r,u,f){let e=t._keystrokesPerfPingData[i];if(e)n.safeExecute(()=>r(e),u);else{var o=f?" DS: "+f:"";SharedLogHelper.LogError(u,(f?f+" ":"")+" sequenceNumber: "+i+" Current sequenceNumber: "+n.SequenceNumberManager.getSequenceNumber(),new Error("No instrumentation data found for sequenceNumber"+o))}}static instrumentRenderingStarted(n){t.safeInstrument(n,i=>{i.RenderingStarted=!0,t.updatePageIG(n)},"instrumentRenderingStarted")}static instrumentQueryChangedRequest(i,r){delete t._keystrokesInstrumentationData[i-1];n.InstrumentedItem.resetKValues(i);let h=t._keystrokesPerfPingData[i];h&&SharedLogHelper.LogError("instrumentQueryChangedRequest","sequenceNumber: "+i,new Error("Duplicate BeginRequest for sequenceNumber"));let f=n.Host.getConversationId(),u=n.Host.getRawImpressionGuid(),e=n.cleanGuid(u),o=n.getCurrentTime(),c={RawImpressionGuid:u,ImpressionGuid:e,ConversationId:f,Query:r,PendingDataSources:{},DataSources:{},RankerExtraInfo:{},DuplicateDS:{},Layout:[],MasterPageImpressionCreated:!1,RenderingStarted:!1,PendingInstrumentedItems:{},PendingSyntheticSuggestions:{},OriginalTimestamp:o},s={RawImpressionGuid:u,ImpressionGuid:e,ConversationId:f,PrefixLength:r.queryToFetch?r.queryToFetch.length:0,SearchHomeRenderEvent:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,ClientShownEvent:t.getOffsettedNow(t._clientShownTimestamp),RequestBegin:t.getOffsettedNow(o),ResponseReceived:{},MultipleResponsesReceived:{},DataSourcesState:t._searchServiceStatus?{Indexer:t._searchServiceStatus}:undefined,RenderFinished:{},renderGroupFinished:{},AllRenderFinished:0,AllDataSourcesProcessed:!1,PendingIcons:0,PreviewPanePendingInfo:undefined,TopResultRendered:[],ResponseFromCache:{},DataSourcesFetchBegin:0,DataSourcesFetchEnd:0,ResponseParsed:{},PreviewPaneOpened:{},PreviewPaneCanceled:{},PageLoadTime:0,SearchHomeLoadTime:0,FirstRenderTime:0,MultipleResponsesParsed:{},ConversationStart:n.config.perfInstV2?t._conversationStartTimestamp:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,SequenceStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,DataProviderFetchStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,DataProviderFetchFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,DataProvidersStarted:{},DataProvidersFinished:{},RendersCompleted:{},RendersColdRank:{},PreviewPaneStart:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,PreviewPaneFinish:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,AnaheimDataIndexCount:{},MRUDataTelemetry:{},MRUFilesAndFoldersDefinedCount:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE,MRUFilesAndFoldersUndefinedCount:n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE};t._keystrokesInstrumentationData[i]=c;t._keystrokesPerfPingData[i]=s;t._currentRender=0;n.config.perfInstV2&&t._keyDownTimeStamp!=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE&&(t.safeInstrumentPerf(i,n=>{n.SequenceStart=t._keyDownTimeStamp-t._conversationStartTimestamp},"instrumentKeyDown",null),t._keyDownTimeStamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE);t._clientTelemetry&&t._clientTelemetry.logNewKeystrokeMeasure(f,u,r);t.updatePageIG(i);t.fireKeystrokeTimelineUpdatedHandlers(s);(n.config.enableFuzzyRanking||n.config.enableFuzzyRanking1)&&n.Host.setFRSuggCount(-1);(n.config.enableColdStartRanking||n.config.enableColdStartRanking1)&&(n.Host.setCRCount(-1),n.Host.setNCRCount(-1),n.Host.setFCRCount(-1));(n.config.enableMRUFilesAndFoldersTelemetry||n.config.disableMRUFilesAndFoldersWildCards)&&(n.Host.setMRUFilesAndFoldersDefinedCount(0),n.Host.setMRUFilesAndFoldersUndefinedCount(0))}static setSearchServiceStatus(n){t._searchServiceStatus=n}static instrumentResponseReceived(i,r,u,f,e,o){t.safeInstrumentPerf(i,i=>{if(!e){let u=t.getOffsettedNow();typeof i.ResponseReceived[r]!="number"?(i.ResponseReceived[r]=u,n.config.useWhereId&&r=="IFF"):(i.MultipleResponsesReceived[r]||(i.MultipleResponsesReceived[r]=[i.ResponseReceived[r]]),i.MultipleResponsesReceived[r].push(u))}u&&(i.DataSourcesState=i.DataSourcesState||{},i.DataSourcesState[r]=u);f&&(i.ResponseFromCache[r]=f)},"instrumentResponseReceived",r);n.config.perfInstV2&&t.safeInstrumentPerf(i,n=>{o||(n.DataProvidersFinished[r]=t.getOffsettedNow(),n.DataProviderFetchFinish<n.DataProvidersFinished[r]&&(n.DataProviderFetchFinish=n.DataProvidersFinished[r])),u&&(n.DataSourcesState=n.DataSourcesState||{},n.DataSourcesState[r]=u),f&&(n.ResponseFromCache[r]=f)},"instrumentResponseReceived",r)}static instrumentTopResultRendered(i,r,u){t.safeInstrumentPerf(i,f=>{let e=t.getOffsettedNow(),o="T"+r.join(",");if(f.renderGroupFinished[o])u||(f.renderGroupFinished[o].iconsFinished=e);else{if(f.TopResultRendered.push({V:e,T:r.join(",")}),t._clientTelemetry){let n=e-f.RequestBegin;t._clientTelemetry.logTopResultsRenderedMeasure(f.RawImpressionGuid,r,n)}f.renderGroupFinished[o]={iconsFinished:e,suggestionsFinished:e}}t.tryInstrumentRenderStopped(i,f);n.MockUrlParameters&&n.safeFireEvent("TopResultRendered")},"instrumentTopResultRendered")}static instrumentRenderedLocalSuggestion(n,i){let u=t._keystrokesInstrumentationData[n];if(u){let n={},t={};for(var r=0;r<i.length;r++)i[r].type=="FV"?n[r]="TBD":i[r].type=="HU"&&(t[r]="TBD");u.FvSug=n;u.HuSug=t}}static instrumentAggregatorCall(i){t.safeInstrument(i,i=>{let r={fastRankModelId:t._instrumentationProvider.getRankerModelId()};for(let n in i.RankerExtraInfo)r[n]=i.RankerExtraInfo[n];i.RankerExtraInfo={};let u={T:"D.Aggregator",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Aggregator",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:[],rankerModelIds:r};i.DataSources.aggregator=u},"instrumentAggregatorCall")}static instrumentDSB(){t.safeInstrument(n.SequenceNumberManager.getSequenceNumber(),t=>{let r=n.dsbManager.getInstrumentedProps(),u=[],i=null;if(r){for(let t=0;t<r.length;t++){let e=r[t],f=e===null||e===void 0?void 0:e.instrumentedItem,o=e===null||e===void 0?void 0:e.subItemInstrumentedItems;if(o&&o.length>0)for(let t=0;t<o.length;t++){let i=o[t],r={T:"D.url",Val:i===null||i===void 0?void 0:i.getQsCode(),Ho:i===null||i===void 0?void 0:i.getHandoffType(),Gr:n.GroupType.DSBGroup,K:i===null||i===void 0?void 0:i.getKValue()};(i===null||i===void 0?void 0:i.getProperties())&&(r.Properties=i.getProperties());u.push(r)}i===null&&(i=f===null||f===void 0?void 0:f.getWorkflow());let s=f===null||f===void 0?void 0:f.getProperties(),h={T:"D.url",Val:f===null||f===void 0?void 0:f.getQsCode(),Ho:f===null||f===void 0?void 0:f.getHandoffType(),Gr:n.GroupType.DSBGroup,K:f===null||f===void 0?void 0:f.getKValue()};s&&(h.Properties=s);u.push(h)}let f=Object.assign(Object.assign({T:"D.DSB",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"DSB",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE},i?{Workflow:i}:undefined),{DS:u});t.DataSources.dsb=f}},"instrumentDSB")}static addDuplicatesDataSource(t){let i=Object.keys(t.DuplicateDS).map(n=>t.DuplicateDS[n]);i.length>0&&(t.DataSources.duplicates={T:"D.Duplicates",Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"Duplicates",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,DS:i})}static instrumentDuplicate(i,r,u){t.safeInstrument(i,t=>{let i=t.DuplicateDS[r.instItem.getHValue()];i||(i={T:"D.Duplicate",DS:[{T:"D.DSRef",KRef:r.instItem.getKValue()}]},r.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(i.DS[0].AppNS=r.instItem.getAppNS()),t.DuplicateDS[r.instItem.getHValue()]=i);let f={T:"D.DSRef",KRef:u.instItem.getKValue()};u.instItem.getAppNS()!=n.InstrumentationCommon.DEFAULT_APP_NAMESPACE&&(f.AppNS=u.instItem.getAppNS());i.DS.push(f)},"instrumentDuplicate")}static renderingStopped(n){return n.PendingIcons==0&&n.AllDataSourcesProcessed&&n.PreviewPanePendingInfo==null}static notifyAllDataSourcesProcessed(n){t.safeInstrumentPerf(n,i=>{i.AllDataSourcesProcessed=!0,t.tryInstrumentRenderStopped(n,i)},"notifyAllDataSourcesProcessed")}static notifyIconPending(n,i,r){t.safeInstrumentPerf(n,n=>{n.PendingIcons++},"notifyIconPending",(i?"TR":"SUG")+" From "+(r?r:"unknown"))}static notifyIconReadyOrFailed(n,i){t.safeInstrumentPerf(n,n=>{n.PendingIcons--},"notifyIconReadyOrFailed",i?"TR":"SUG")}static notifyPreviewPaneStartRender(i){n.config.perfInstV2&&t.safeInstrumentPerf(i,n=>{n.PreviewPaneStart=t.getOffsettedNow()},"previewPaneStart")}static notifyPreviewPanePending(n,i,r){let u=t._keystrokesPerfPingData[n];u&&(u.PreviewPanePendingInfo={previewPaneType:i,suggestionType:r})}static tryInstrumentRenderStopped(i,r){t.renderingStopped(r)&&(t.finalizeKeystrokeLog(i,2),t.logMemoryUsageInWSBClient(i,"RenderStopped"),n.TestHookUrlParameters&&n.safeFireEvent("RenderStopped"))}static logMemoryUsageInWSBClient(i,r){var u;if(SearchAppWrapper.CortanaApp.systemInfo){let f=SearchAppWrapper.CortanaApp.systemInfo;const s=typeof BingAtWork=="undefined"?"":(u=BingAtWork.context)===null||u===void 0?void 0:u.midgardVersion,e=t._instrumentationProvider.getWebView2Info(),o=f.totalCommitMB;let h="TotalCommitMB:"+o+",TotalWorkingSetMB:"+f.totalWorkingSetMB+",SnrVersion:"+n.config.snrVersion+",MsbVersion:"+s+",IsWebView2:"+(e.isWebView2?1:0)+",WebView2Version:"+e.webView2Version;n.Host.setSearchAppMemoryCommitMB(o);t._instrumentationProvider.logProfilerMarker(1,0,r,t.getRawImpressionGuid(i),h)}}static isLayoutLogged(n){return t._keystrokesInstrumentationData[n].MasterPageImpressionCreated}static finalizeKeystrokeLog(n,i=0){t._finalizeKeystrokeHandlers.forEach(n=>n(i==0));let r=t._keystrokesInstrumentationData[n];if(r&&t.logKeystrokeData(r,n),i!=1){let i=t._keystrokesPerfPingData[n];i&&(t.logPerfPingEvent(t.createKeystrokePerfPingEvent(n,i)),t._clientTelemetry&&t._clientTelemetry.logDataSourcePerformancesMeasure(i),t.fireKeystrokeTimelineUpdatedHandlers(i))}}static instrumentZiRendered(i,r,u){r&&t.logMemoryUsageInWSBClient(i,"ZiRendered");n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("RenderZeroInput");let f=u?u:null;t.safeInstrumentPerf(i,n=>{n.SearchHomeRenderEvent=t.getOffsettedNow()},"instrumentSearchHomeRender",f)}static instrumentRenderFinished(i,r,u,f,e){if(n.config.perfInstV2&&(t===null||t===void 0?void 0:t._currentRender)<0)SharedLogHelper.LogError("instrumentRenderFinished","sequenceNumber: "+i,new Error("Invalid current render for sequence number"));else if(n.config.perfInstV2&&t._keystrokesPerfPingData[i]==undefined)SharedLogHelper.LogError("instrumentRenderFinished","sequenceNumber: "+i+" currentRender: "+t._currentRender,new Error("No keystrokesPerfPingData for sequence number"));else if(e||t._keystrokesPerfPingData[i].FirstRenderTime||(t._keystrokesPerfPingData[i].FirstRenderTime=t.getOffsettedNow()),n.config.perfInstV2){if(t._keystrokesPerfPingData[i].RendersCompleted[t._currentRender]=t.getOffsettedNow(),n.Host.getFCRCount()>-1&&(n.config.enableColdStartRanking||n.config.enableColdStartRanking1)&&(t._keystrokesPerfPingData[i].RendersColdRank[t._currentRender]=n.Host.getFCRCount()),(n.config.disableMRUFilesAndFoldersWildCards||n.config.enableMRUFilesAndFoldersTelemetry)&&(n.Host.getMRUFilesAndFoldersDefinedCount()>-1&&(t._keystrokesPerfPingData[i].MRUFilesAndFoldersDefinedCount=n.Host.getMRUFilesAndFoldersDefinedCount()),n.Host.getMRUFilesAndFoldersUndefinedCount()>-1&&(t._keystrokesPerfPingData[i].MRUFilesAndFoldersUndefinedCount=n.Host.getMRUFilesAndFoldersUndefinedCount())),n.isAnaheimDataEnabled(!0)||n.isAnaheimDataEnabled(!1)){if(n.AnaheimDataProvider&&n.AnaheimDataProvider.InstrumentStringNumber){let r=n.AnaheimDataProvider.InstrumentStringNumber;for(let n in r)t._keystrokesPerfPingData[i].AnaheimDataIndexCount[n]=r[n]}if(n.AnaheimDataProviderV2&&n.AnaheimDataProviderV2.InstrumentStringNumber){let r=n.AnaheimDataProviderV2.InstrumentStringNumber;for(let n in r)t._keystrokesPerfPingData[i].AnaheimDataIndexCount[n]=r[n]}if(n.AnaheimDataParser===null||n.AnaheimDataParser===void 0?void 0:n.AnaheimDataParser.getANANumberMap){let r=n.AnaheimDataParser.getANANumberMap();for(let n in r)t._keystrokesPerfPingData[i].AnaheimDataIndexCount[n]=r[n]}}t._currentRender++}t.safeInstrumentPerf(i,n=>{let e=t.getOffsettedNow(),o="S"+r.join(",");n.renderGroupFinished[o]?f||(n.renderGroupFinished[o].iconsFinished=e):(r.forEach(t=>n.RenderFinished[t]=e),n.renderGroupFinished[o]={iconsFinished:e,suggestionsFinished:e});t.tryInstrumentRenderStopped(i,n);t._clientTelemetry&&t._clientTelemetry.logGroupsRenderedMeasure(u)},"instrumentRenderFinished",r.join(","));let o=t._keystrokesPerfPingData[i];o&&t.fireKeystrokeTimelineUpdatedHandlers(o)}static instrumentSyntheticInstrumentedItem(n,i,r){let u=t._keystrokesInstrumentationData[n];u?u.PendingInstrumentedItems[i]=r:SharedLogHelper.LogError("instrumentSyntheticInstrumentedItem",i,new Error("keystrokesInstrumentationData not found"))}static instrumentSyntheticSuggestion(n,i){let r=t._keystrokesInstrumentationData[n];r?r.PendingSyntheticSuggestions[i.type]=i:SharedLogHelper.LogError("instrumentSyntheticSuggestion",i.type,new Error("Instrumentation synthetic suggestion after flush"))}static getInstrumentedSyntheticSuggestion(n,i){return t._keystrokesInstrumentationData[n].PendingSyntheticSuggestions[i]}static instrumentDataSource(n,i,r,u){t.safeInstrument(n,n=>{if(u&&u.rankerExtraInfo)for(let t in u.rankerExtraInfo)n.RankerExtraInfo[t]=u.rankerExtraInfo[t];let t=r||[],f=n.PendingDataSources[i];n.PendingDataSources[i]=f?f.concat(t):t},"instrumentDataSource",i)}static processPendingDataSources(i){for(let r in i.PendingDataSources){let u=i.PendingDataSources[r];if(u.length>0){let f=[];for(let n of u){f.push(t._instrumentationProvider.createDataSourceObject(n));for(let i of n.subInstItems||[])f.push(t._instrumentationProvider.createDataSourceObject(n,i))}r=="Web"&&(r="WebAS");f.length>0&&(i.DataSources[r]={T:"D."+r,AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:r,SC:f.length,DS:f})}}i.PendingDataSources={}}static instrumentSnRProviderFetchUrl(n,i){t.safeInstrument(n,n=>{n.SnRProviderFetchUrl=i},"instrumentSnRProviderFetchUrl")}static onConversationStart(){if(t._conversationStartTimestamp=n.getCurrentTime(),t._searchServiceStatus=null,t._clientTelemetry){let i=n.Host.getConversationId();t._clientTelemetry.logConversationStartMeasure(i)}t._keystrokesPerfPingData=[];t._currentRender=0}static getConversationStartTimestamp(){return t._conversationStartTimestamp}static logDataSourceTimeout(n,i){t._instrumentationProvider.logDataSourceTimeout(n,i)}static getPpoFromPpi(n){return typeof n.latency=="number"?{L:n.latency,T:n.previewPaneType}:{}}static createKeystrokePerfPingEvent(i,r){let u={I:i,PL:r.PrefixLength,K:r.RequestBegin,F:r.DataSourcesFetchEnd,PPO:t.getPpoFromPpi(r.PreviewPaneOpened),PPC:t.getPpoFromPpi(r.PreviewPaneCanceled),RRT:r.ResponseReceived,RPT:r.ResponseParsed,MRT:r.MultipleResponsesReceived,RFT:r.RenderFinished,TRR:r.TopResultRendered,RS:undefined,PLT:undefined,HLT:undefined,FRT:undefined,IRFT:{},TRIR:[],MPT:r.MultipleResponsesParsed,CS:n.config.perfInstV2?r.ConversationStart:undefined,KS:n.config.perfInstV2?r.SequenceStart:undefined,RB:n.config.perfInstV2?r.RequestBegin:undefined,FS:n.config.perfInstV2?r.DataProviderFetchStart:undefined,FF:n.config.perfInstV2?r.DataProviderFetchFinish:undefined,PST:n.config.perfInstV2?r.DataProvidersStarted:undefined,PFT:n.config.perfInstV2?r.DataProvidersFinished:undefined,RC:n.config.perfInstV2?r.RendersCompleted:undefined,RCR:n.config.perfInstV2&&(n.config.enableColdStartRanking||n.config.enableColdStartRanking1)?r.RendersColdRank:undefined,PS:n.config.perfInstV2?r.PreviewPaneStart:undefined,PF:n.config.perfInstV2?r.PreviewPaneFinish:undefined,ANA:n.config.perfInstV2&&(n.config.enableAnaheimDataSH||n.config.enableAnaheimDataQF)?r.AnaheimDataIndexCount:undefined,MRUFAF:n.config.perfInstV2&&(n.config.enableMRUFilesAndFoldersTelemetry||n.config.disableMRUFilesAndFoldersWildCards)?r.MRUFilesAndFoldersDefinedCount:undefined,MRUFAFU:n.config.perfInstV2&&(n.config.enableMRUFilesAndFoldersTelemetry||n.config.disableMRUFilesAndFoldersWildCards)?r.MRUFilesAndFoldersUndefinedCount:undefined};for(let n in r.renderGroupFinished){let t=r.renderGroupFinished[n];if(t.iconsFinished!=t.suggestionsFinished){let i=n.substr(1);if(n.startsWith("T"))u.TRIR.push({T:i,V:t.iconsFinished});else{let n=i.split(",");for(let i of n)u.IRFT[i]=Math.max(t.iconsFinished,u.IRFT[i]||0)}}}if(t.renderingStopped(r)){let t=0;for(let n in r.renderGroupFinished)t=Math.max(t,r.renderGroupFinished[n].iconsFinished);r.FirstRenderTime&&(u.FRT=r.FirstRenderTime);t&&(r.AllRenderFinished=t,u.RS=t,t=Math.max(t,r.PreviewPaneOpened.latency||r.PreviewPaneCanceled.latency||0),r.PageLoadTime=t,u.PLT=t);r.SearchHomeRenderEvent!=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE&&(u.HLT=Math.max(u.PLT-u.K,r.SearchHomeRenderEvent))}else{let n=t.getOffsettedNow();u.RS=n;u.PLT=n}return n.InstrumentationCommon.createPerfPingEvent(r.ImpressionGuid,[u],"Keystroke",r.ConversationId,r.DataSourcesState,r.ResponseFromCache)}static updatePageIG(n){_G.IG=t.getImpressionGuid(n)}static createMasterPageImpression(r,u,f,e,o){let s={dataSources:o||[],layoutNodes:[],pageName:r,rawQuery:e?e.queryToFetch:"",isQuery:!1,impressionUrl:t.createVirtualImpressionURL(u,f),appName:t._instrumentationProvider.getApplicationName(),enrichedClientInfo:{FDPartnerEntry:i,nclid:_G.nclid,isOffline:n.isBrowserOnline()?0:1,webRequested:f?1:0}},h=n.safeExecute(()=>t._instrumentationProvider.getEnrichedClientInfo(e),"getEnrichedClientInfo");if(h)for(let n in h)s.enrichedClientInfo[n]=h[n];if(n.config.addExtraInstLoad){if(n.config.extraInstLoadSize&&!t.extraInstPayload){let i="";while(i.length<n.config.extraInstLoadSize)i+="xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx";t.extraInstPayload=i}n.config.addExtraInstLoadPercentage&&Date.now()%100<=n.config.addExtraInstLoadPercentage&&(s.enrichedClientInfo.exInst=t.extraInstPayload)}return s}static logKeystrokeData(i){t.processPendingDataSources(i);n.TestHookUrlParameters&&t.addDuplicatesDataSource(i);let f=Object.keys(i.DataSources).map(n=>i.DataSources[n]).concat(t.createNonSuggestionsDataSource(i.PendingInstrumentedItems,i.PendingSyntheticSuggestions));if(i.DataSources={},i.PendingSyntheticSuggestions={},i.PendingInstrumentedItems={},f.length!=0||!i.MasterPageImpressionCreated){let u;if(i.RenderingStarted&&(u=DsLManager.CreateLayoutNode(_d.body,n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,!1,!0,i.MasterPageImpressionCreated,!0)),i.MasterPageImpressionCreated)Log2.LogEvent("ClientInst",null,null,f,u,i.ImpressionGuid,null,null);else{let n=t.createMasterPageImpression(t._instrumentationProvider.getSuggestionsPageName(),r,i.SnRProviderFetchUrl?i.SnRProviderFetchUrl.substring(i.SnRProviderFetchUrl.indexOf("?")+1):"",i.Query,f);u&&(n.layoutNodes=u);i.FvSug&&Object.keys(i.FvSug).length>0&&(n.enrichedClientInfo.FvSug=i.FvSug);i.HuSug&&Object.keys(i.HuSug).length>0&&(n.enrichedClientInfo.HuSug=i.HuSug);n.clientTimestamp=i.OriginalTimestamp;t.logMasterPageImpression(i.ImpressionGuid,n);i.MasterPageImpressionCreated=!0}}}static logPerfPingEvent(t){Log2.LogEvent(t.EventType,t.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,t.ImpressionGuid,null,null);n.ClientTestHooks&&n.ClientTestHooks.DebugLogNoConsole("perfPingEvent",[t])}static logMasterPageImpression(i,r){if(r){if(!i){SharedLogHelper.LogError("logMasterPageImpression",null,new Error("Missing impressionGuid"));return}r.impressionGuid=i;t._instrumentationProvider.logMasterPageImpression(r,n.Host.getConversationId());n.ClientTestHooks&&n.ClientTestHooks.DebugLogNoConsole("masterPageImpression",r,i)}}static instrumentAppVisibleFinish(i){let r=n.getCurrentTime();t._conversationTimeline.AppVisibleStart=i;t._conversationTimeline.AppVisibleFinish=r}static instrumentAppShownFinish(i){let r=n.getCurrentTime();t._conversationTimeline.AppShownStart=i;t._conversationTimeline.AppShownFinish=r}static instrumentConversationTimelineFinish(){let i=_G.ServerIG;if(!i){SharedLogHelper.LogError("instrumentConversationTimelineFinish","Could not instrument as server IG not known",new Error("Could not instrument initilization finish"));return}t._conversationTimeline.RawImpressionGuid=n.Host.getRawImpressionGuid();t._conversationTimeline.ImpressionGuid=n.cleanGuid(t._conversationTimeline.RawImpressionGuid);t._conversationTimeline.ConversationId=n.Host.getConversationId();let r={CID:t._conversationTimeline.ConversationId,ASB:t._conversationTimeline.AppShownStart,ASF:t._conversationTimeline.AppShownFinish,AVB:t._conversationTimeline.AppVisibleStart,AVF:t._conversationTimeline.AppVisibleFinish},u=n.InstrumentationCommon.createPerfPingEvent(i,[r],"ConversationTimeline",t._conversationTimeline.ConversationId);t.logPerfPingEvent(u)}static instrumentPerformance(i,r){try{let e=_G.ServerIG;if(!e){SharedLogHelper.LogError("instrumentPerformance "+i,"Could not instrument as server IG not known",new Error("Could not instrument performance "+i));return}let u=_w.performance,f=new window.Map;if(r){let t=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;if(u&&u.timing&&(t=u.timing.navigationStart),t<=0)return;let i=r.getTime()-t,e=n.getCurrentTime()-t;f.BLT=i;f.ILT=e}this.addNavigationPerformanceInfo(u,f);"LoadError"!==i&&r||this.addResourcePerformanceInfo(u,f);let o=[f],s=n.InstrumentationCommon.createPerfPingEvent(e,o,i);t.logPerfPingEvent(s)}catch(u){typeof SharedLogHelper!="undefined"&&SharedLogHelper.LogError("instrumentPerformanceException",i,u)}}static addNavigationPerformanceInfo(n,t){if(n&&t){let i=n.getEntriesByType("navigation");if(i&&i.length>0){let n=i[0];n&&(t.WST=Math.round(n.workerStart),t.FST=Math.round(n.fetchStart),t.RQST=Math.round(n.requestStart),t.RPST=Math.round(n.responseStart),t.RPET=Math.round(n.responseEnd),t.DCLST=Math.round(n.domContentLoadedEventStart),t.DCLET=Math.round(n.domContentLoadedEventEnd),t.DCT=Math.round(n.domComplete),t.LEST=Math.round(n.loadEventStart),t.LEET=Math.round(n.loadEventEnd),t.ECBS=n.encodedBodySize?Math.round(n.encodedBodySize):"",t.DCBS=n.decodedBodySize?Math.round(n.decodedBodySize):"")}}}static addResourcePerformanceInfo(n,t){if(n&&t){let r=n.getEntriesByType("resource"),i=[];r.forEach(n=>{if(n.duration>0&&n.duration>2e3){let t=n,r=new window.Map;r.NAME=t.name;r.ENTYPE=t.entryType;r.INITYPE=t.initiatorType;r.NHPL=t.nextHopProtocol;r.ST=Math.round(t.startTime);r.RDET=Math.round(t.redirectEnd);r.FST=Math.round(t.fetchStart);r.DLST=Math.round(t.domainLookupStart);r.DLET=Math.round(t.domainLookupEnd);r.CST=Math.round(t.connectStart);r.SCST=Math.round(t.secureConnectionStart);r.CET=Math.round(t.connectEnd);r.RQST=Math.round(t.requestStart);r.RPST=Math.round(t.responseStart);r.RPET=Math.round(t.responseEnd);r.DURN=Math.round(t.duration);r.ECBS=t.encodedBodySize?Math.round(t.encodedBodySize):"";r.DCBS=t.decodedBodySize?Math.round(t.decodedBodySize):"";r.TFS=t.transferSize?Math.round(t.transferSize):"";i.push(r)}});i.length>0&&(t.RS=i)}}static instrumentDSBEvent(r){let f={dataSources:[],layoutNodes:[],pageName:"Page.SmartSearch.AS.DSB",rawQuery:"",isQuery:!1,impressionUrl:"",appName:t._instrumentationProvider.getApplicationName(),enrichedClientInfo:{FDPartnerEntry:i,nclid:_G.nclid,isOffline:n.isBrowserOnline()?0:1},impressionGuid:t.createCleanGuid()},u={};if(u=n.safeExecute(()=>t._instrumentationProvider.getEnrichedClientInfoForDSB(),".instrumentDSBEvent.getEnrichedClientInfoForDSB"),u)for(let n in u)f.enrichedClientInfo[n]=u[n];for(const n in r)f.enrichedClientInfo[n]=r[n];t._instrumentationProvider.logMasterPageImpression(f,null)}static getOffsettedNow(i=n.getCurrentTime()){return i-t._conversationStartTimestamp}static createNonSuggestionsDataSource(i,r){let u=[];for(let n in i)u.push(t._instrumentationProvider.createNonSuggestionDataSourceObject(n,i[n]));for(let i in r)(r[i].staticGroupType!=n.GroupType.MsbOnRampButton||r[i].suppressed!=!0)&&u.push(t._instrumentationProvider.createDataSourceObject(r[i]));if(u.length){let t={T:"D.ContentGroup",AppNS:n.InstrumentationCommon.DEFAULT_APP_NAMESPACE,Service:n.InstrumentationCommon.DEFAULT_SERVICE_NAME,Scenario:"NonSuggestions",SC:u.length,DS:u};return[t]}return[]}static createVirtualImpressionURL(t,i){let r=n.getWindowProtocol()+"//"+n.getWindowHost()+t;return r+=i?i:n.Service.QueryParams.ConversationId+"="+n.encodeQueryParameter(n.Host.getConversationId()),_G.ServerIG&&(r+="&ASInitIG="+n.encodeQueryParameter(_G.ServerIG)),r}static createCleanGuid(n){return n?(n^Math.random()*16>>n/4).toString(16):"10000000100040008000100000000000".replace(/[018]/g,t.createCleanGuid)}static createCodexClickItemProps(n,t){return n.setProperty("FID","Codex"),n.setProperty("Namespace","WindowsSearchBox"),n.setProperty("EventType","ConversationViewEnter"),n.setProperty("source",t),n}static updateMessageBannerClickItemProps(n,t){return n.setProperty("FID","ReclaimSearchbox"),n.setProperty("Namespace","WindowsSearchBox"),n.setProperty("EventType","RecleamSearchBoxEventEnter"),n.setProperty("source",t),n}static logFlightState(n,i){t._clientTelemetry.logFlightState(n,i)}}t._clientShownTimestamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;t._conversationStartTimestamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;t._currentRender=0;t._keyDownTimeStamp=n.InstrumentationCommon.QFPERFPING_INVALID_MEASURE;t._keystrokesPerfPingData={};t._keystrokesInstrumentationData={};t._keystrokeTimelineUpdatedHandlers=[];t._finalizeKeystrokeHandlers=[];n.InstrumentationHelper=t}(WSB||(WSB={})),function(n){const t="&nclid=",i="&ts=",r="&nclidts=",u="&tsms=",f="&elv=",e="&cc=",o="&setlang=",s="&cvid=",h="&qs=",c="&ao=",l="&wsso=";class a{constructor(t=Date.now,i=n.getWindowProtocol()+"//"+n.getWindowHost()){if(this.getNowTimestamp=t,this._baseUrl=i,n.config.overrideHost){let t=n.getWindowHost();t.startsWith("www.")&&(this._baseUrl=n.getWindowProtocol()+"//"+n.config.overrideHost+t.substring(3))}}getSearchUrl(t,i,r,u,e,o,s,h,a,v){if(!u)if(e===21)u=(n.msbHost.features.isEduScopeApplicable()?"/school":"/work")+"/search?q="+n.encodeQueryParameter(i),v&&(u+="&inithash="+v),o=n.mapOSFormCode((v===null||v===void 0?void 0:v.includes("Connectors"))?"WSBWSC":"WSBWS0");else{let t=this.getVerticalFromHandoffType(e);u=(t?"/"+t:"")+"/search?q="+n.encodeQueryParameter(i)}let y=this._baseUrl+u;y+=(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isWindowsTest)?"&form=MONITR&traffictype=wintest":"&form="+n.encodeQueryParameter(o!==null&&o!==void 0?o:n.Host.getFormCode());a&&(y+=c+"1");y=this.enrichUrlWithSuggestionType(y,h?"P":r);y=this.enrichUrlWithCvid(y);n.config.suppressPqParameter||(y+="&pq="+n.encodeQueryParameter(t));let p=n.Host.getMSNRefIg();if(p&&(y+="&refig="+p),y=this.enrichUrlWithMarketInfo(y),y=this.enrichUrlWithDeviceInfo(y),!s){y=this.enrichUrlWithMuidInfo(y);let t=n.Host.getElToken();t&&this._baseUrl.startsWith("https:")&&(y+=f+n.encodeQueryParameter(t));y=this.enrichUrlWithSafeSearchInfo(y)}let w=n.Host.getSafeSearchSetting();return w&&(y+=l+w),e===21&&v&&(y+="#"+v),y}getImageSearchUrl(){let t=this._baseUrl+"/images/detail/upload?FORM="+n.mapOSFormCode("SBIWSB");return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isWindowsTest)&&(t+="&isWindowsTest=1&traffictype=Test"),t}getVerticalFromHandoffType(n){return n===13?"images":n===14?"videos":n===15?"shop":""}enrichUrlWithDeviceInfo(t){n.Host.isEducationEnvironment()&&(t+="&DAF0=1");n.Host.isWindowsS()&&(t+="&DAF1=1");let i=n.Host.getPartnerSearchCode();return i&&(t+="&PC="+i),t}enrichUrlWithMarketInfo(t){let i=n.Host.getRegion(),r=n.Host.getLanguage();return i&&(t+=e+i),r&&(t+=o+r),t}enrichUrlWithSafeSearchInfo(t){return n.Host.getSafeSearchSetting()=="Strict"?t+"&adlt=strict":t}enrichUrlWithMuidInfo(f){if(_G.nclid){f+=t+n.encodeQueryParameter(_G.nclid);let e=this.getNowTimestamp().toString();f+=i+n.encodeQueryParameter(e);let o=e.substring(0,e.length-3);f+=r+n.encodeQueryParameter(o);let s=e.substring(e.length-3);f+=u+n.encodeQueryParameter(s)}return f}enrichUrlWithCvid(t){return t+(s+n.encodeQueryParameter(n.Host.getConversationId()))}enrichUrlWithSuggestionType(t,i){return t+(h+n.encodeQueryParameter(i))}getChatUrl(t){return"https://www.bing.com/search?q="+n.encodeQueryParameter(t)+"&showconv=1&sendquery=1&form=WSBMSC"}}n.NavigationHelper=a}(WSB||(WSB={})),function(n){class t{constructor(t){this._selectableItemsContainer=t;n.Host.bindKeyDown((i,r,u)=>{this.selectedItem=this.getSelectedItem();let f=!1;if(i==9)f=this.selectFirstItemInNextGroup(r&&r.shiftKey);else if((n.isUpOrDownKey(i)||n.isLeftOrRightKey(i))&&this.isMsbDsbSelected(this.selectedItem)){const t=n.isUpKey(i)||n.isLeftKey(i);f=this.selectNextItemInGroup(t)}else n.isUpOrDownKey(i)&&(f=this.selectNextItem(n.isUpKey(i)));t.onAfterKeyDown(i,r,u,f)})}selectFirstItemInNextGroup(t){var s,e,o;const r=this._selectableItemsContainer.getSelectableItemsByGroup();if(r.length==0)return!1;const i=r.findIndex(n=>!!n.find(n=>{var t,i;return n.reactKey?n.reactKey===((t=this.selectedItem)===null||t===void 0?void 0:t.reactKey):n.id===((i=this.selectedItem)===null||i===void 0?void 0:i.id)}));let f;f=i<0?-1:this.isMsbDsbSelected(this.selectedItem)?r[i].findIndex(n=>{var t;return n.id===((t=this.selectedItem)===null||t===void 0?void 0:t.id)}):r[i].findIndex(n=>n==this.selectedItem);this.selectedItem&&(this.selectedItem.selected=!1,(e=(s=this.selectedItem).onUnselected)===null||e===void 0?void 0:e.call(s));let u;return(i<0?u=r[0][0]:t?!this.isMsbDsbSelected(this.selectedItem)&&f>0?u=r[i][0]:i>0&&(u=r[i-1][0],u.hiddenAfterFocus&&i>=2&&(u=r[i-2][0])):i+1<r.length?u=r[i+1][0]:f+1<r[i].length&&((o=this.selectedItem)===null||o===void 0?void 0:o.scope)==n.Scope.Work&&(u=r[i][f+1]),u)?(this._selectableItemsContainer.select(u,!0),u.onSelected&&u.onSelected(),!0):!1}selectNextItem(t){var o,f,s,e;const i=this._selectableItemsContainer.getSelectableItems();if(i.length==0)return!1;const r=this.selectedItem?i.findIndex(n=>{var t,i;return n.reactKey?n.reactKey===((t=this.selectedItem)===null||t===void 0?void 0:t.reactKey):n.id===((i=this.selectedItem)===null||i===void 0?void 0:i.id)}):-1;this.selectedItem&&(this.selectedItem.selected=!1,(f=(o=this.selectedItem).onUnselected)===null||f===void 0?void 0:f.call(o));const h=t?r==0:r==i.length-1;if(h&&n.RuntimeConfig.AllowKeyboardNavOffCanvas)return this._selectableItemsContainer.select(null,!0),!0;if(h&&!n.RuntimeConfig.AllowKeyboardNavCycling)return!1;const u=t?r<=0?i.length-1:r-1:(r+1)%i.length;return this._selectableItemsContainer.select(i[u],!0),i[u]&&i[u].onSelected&&((e=(s=i[u]).onSelected)===null||e===void 0?void 0:e.call(s)),!0}selectNextItemInGroup(t){var h,e,f,o;const i=this._selectableItemsContainer.getSelectableItemsByGroup();if((i===null||i===void 0?void 0:i.length)==0)return!1;const s=i.findIndex(n=>!!n.find(n=>{var t;return n.id===((t=this.selectedItem)===null||t===void 0?void 0:t.id)}));if(s<0)return!1;const r=i[s],u=r.findIndex(n=>n==this.selectedItem);this.selectedItem&&(this.selectedItem.selected=!1,(e=(h=this.selectedItem).onUnselected)===null||e===void 0?void 0:e.call(h));const l=t?u==0:u==r.length-1;if(l&&!n.RuntimeConfig.AllowKeyboardNavCycling)return!1;const c=t?u<=0?r.length-1:u-1:(u+1)%r.length;return this._selectableItemsContainer.select(i[s][c],!0),(o=(f=r[c])===null||f===void 0?void 0:f.onSelected)===null||o===void 0?void 0:o.call(f),!0}getSelectedItem(){let t;return this.selectedItem||!(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.keyNavSetFocus)?(t=this._selectableItemsContainer.getSelectedItem(),this.isMsbDsbSelected(this.selectedItem)&&(t=this._selectableItemsContainer.getSelectableItems().find(n=>n.selected)||t)):(t=this._selectableItemsContainer.getSelectableItems().find(t=>t.id===(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.keyNavSetFocus)),this._selectableItemsContainer.select(t,!0)),t}isMsbDsbSelected(t){return!!n.isMsbEnterprise()&&!!(t===null||t===void 0?void 0:t.dsb)}}n.KeyboardEvtHandler=t}(WSB||(WSB={})),function(n){n.LatencyTimeout=500;n.MsbPeopleLatencyTimeout=1e3;class t{constructor(n,t){this._aggregator=n;this._rootViewModel=t;this._sequenceNumber=-1;this._suggestionsQueue={};this._dataSourcesCompleted={}}initiateSequenceNumber(t,i,r){if(!(n.isThirdPartySearchAllowed===null||n.isThirdPartySearchAllowed===void 0?void 0:n.isThirdPartySearchAllowed())||i.scope!=n.Scope.ThirdPartyWeb){if(this._sequenceNumber>=t){SharedLogHelper.LogError("initiateSequenceNumber",null,new Error("Unexpected sequence number"));return}this.resetStateForNewQuery(t,i);this._highPriorityDataSources=[];this._normalPriorityDataSources=[];this._lowPriorityDataSources=[];for(let t of n.config.enabledDataSources){let r=i.enabledDataSources[t];r&&(n.config.lowPriorityDataSources[t]?this._lowPriorityDataSources.push(t):n.config.highPriorityDataSources[t]?t==="MSBC"&&(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qfUtils.isWaitForBackfillEnabled(i.scope))?this._lowPriorityDataSources.push(t):this._highPriorityDataSources.push(t):this._normalPriorityDataSources.push(t))}if(this._HighPriDoneProcessing=this._highPriorityDataSources.length==0,this._highPriorityDataSources.length==0&&this._normalPriorityDataSources.length==0&&this._lowPriorityDataSources.length==0)this.processSuggestions(!1);else{let t=this.getLatencyTimeout();t>0&&(this._bufferingTimer=n.safeSetTimeout(()=>{this._bufferingTimer=null,this.processSuggestions(!0)},t,"processSuggestionsBuffering"),n.config.dataSourceTimeLimit&&(this._processingTimeoutTimer=n.safeSetTimeout(()=>{this._processingTimeoutTimer=null;let t=[...this._highPriorityDataSources.filter(t=>!n.contains(this._arrivedDataSources,t)),...this._normalPriorityDataSources.filter(t=>!n.contains(this._arrivedDataSources,t)),...this._lowPriorityDataSources.filter(t=>!n.contains(this._arrivedDataSources,t)),];SharedLogHelper.LogError("SuggestionsRenderingManager",t.join(","),new Error("Data provider did not complete before the time limit"));this._processingStopped=!0;this._allDataSourcesArrived=!0;this.processSuggestions(!1);r&&r()},n.config.dataSourceTimeLimit,"processSuggestionsTimeout")))}}}getLatencyTimeout(){var t,i;return this._partialQuery.queryToFetch?this._partialQuery.scope===n.Scope.People&&n.isMsftAccountConnected?(t=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.msbPeopleL2LatencyTimeout)!==null&&t!==void 0?t:n.MsbPeopleLatencyTimeout:(i=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.latencyTimeout)!==null&&i!==void 0?i:n.LatencyTimeout:n.LatencyTimeout}queueSuggestions(t,i,r,u,f){if(t>this._sequenceNumber){SharedLogHelper.LogError("queueSuggestions",null,new Error("Unexpected sequence number"));return}if(!(t<this._sequenceNumber)){if(this._dataSourcesCompleted[i]){SharedLogHelper.LogError("queueSuggestions",i,new Error(`Data source already completed: ${i}`));return}if(!n.contains(this._highPriorityDataSources,i)&&!n.contains(this._normalPriorityDataSources,i)&&!n.contains(this._lowPriorityDataSources,i)){SharedLogHelper.LogError("queueSuggestions",i,new Error("Unexpected data source"));return}this._allDataSourcesArrived||(this._suggestionsQueue[i]&&!this._suggestionsQueue[i].updated?this._suggestionsQueue[i].suggestions.push(...r):this._suggestionsQueue[i]={suggestions:r,updated:!1},this._dataSourcesCompleted[i]=!f,u&&(this._extraSignalsMap[i]=u),f||this._arrivedDataSources.push(i),this._allDataSourcesArrived=this.haveAllDataSourcesArrived(this._highPriorityDataSources.concat(this._normalPriorityDataSources).concat(this._lowPriorityDataSources)),this._processingStopped||n.InstrumentationHelper.isLayoutLogged(this._sequenceNumber)?this._allDataSourcesArrived&&(this.resetTimers(),n.InstrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber)):this.processSuggestions(!1))}}resetTimers(){this._bufferingTimer&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null);this._processingTimeoutTimer&&(sb_ct(this._processingTimeoutTimer),this._processingTimeoutTimer=null)}resetStateForNewQuery(t,i){this._arrivedDataSources=[];this._allProcessedDataSources={};this._sequenceNumber=t;this._partialQuery=i;this._suggestionsQueue={};this._dataSourcesCompleted={};this._extraSignalsMap={};this._renderedThisSequenceNumber=!1;this._waitingForMoreResults=!0;this._processingStopped=!1;this._allDataSourcesArrived=n.isEmpty(i.enabledDataSources);this.resetTimers()}getDependencies(t){return n.Host.dataSourceDependencies(t).filter(t=>n.isDataSourceEnabled(t,this._partialQuery))}haveAllDataSourcesArrived(t){return n.config.mergeQueries&&this._partialQuery.scope==n.Scope.Documents?t.every(n=>{switch(n){case"MPHO":case"MVID":case"MDOC":return!!this._partialQuery.enabledDataSources.MPHO&&!!this._partialQuery.enabledDataSources.MVID&&!!this._partialQuery.enabledDataSources.MDOC&&!!this._partialQuery.enabledDataSources.MPVD;default:return!!this._suggestionsQueue[n]}}):t.every(i=>{var r,u;if(i=="MSBC"){const t=n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.qfUtils.isWaitForBackfillEnabled(this._partialQuery.scope),f=!!this._suggestionsQueue[i]&&(((u=(r=this._suggestionsQueue[i])===null||r===void 0?void 0:r.suggestions)===null||u===void 0?void 0:u.length)>0||this._dataSourcesCompleted[i]);return t?f:!!this._suggestionsQueue[i]}return!!this._suggestionsQueue[i]&&this.haveCacheBackedDataSourcesArrived(t)})}haveCacheBackedDataSourcesArrived(t){if(this._partialQuery.isSearchHomeZI&&n.isMsbQwsDocsCacheEnabled(this._partialQuery)&&!n.config.msbQwsDocsNoRefreshAfterCachedResults){const i="SSUE",r="SREE",s=!!this._partialQuery.enabledDataSources[i]&&n.isDocSourceEnabledInQws(i),h=!!this._partialQuery.enabledDataSources[r]&&n.isDocSourceEnabledInQws(r);let u=!1,f=!1;t.forEach(n=>{n==i?u=!0:(n=r)&&(f=!0)});const e=u&&s,o=f&&h;if(e||o){const n=e&&this._dataSourcesCompleted[i],t=o&&this._dataSourcesCompleted[r];return n||t}return!0}return!0}haveAllDataSourcesCompleted(t){return n.config.mergeQueries&&this._partialQuery.scope==n.Scope.Documents?t.every(n=>{switch(n){case"MPHO":case"MVID":case"MDOC":return!!this._partialQuery.enabledDataSources.MPHO&&!!this._partialQuery.enabledDataSources.MVID&&!!this._partialQuery.enabledDataSources.MDOC&&!!this._partialQuery.enabledDataSources.MPVD;default:return!!this._dataSourcesCompleted[n]}}):t.every(n=>!!this._dataSourcesCompleted[n])}processSuggestions(t){let r=[],e=[],i,a=this.getLatencyTimeout()>0&&this._bufferingTimer==null,o=this.haveAllDataSourcesArrived(this._highPriorityDataSources),s=o||a,v=this.haveAllDataSourcesCompleted(this._normalPriorityDataSources),h=this.haveAllDataSourcesCompleted(this._highPriorityDataSources),c=h&&v;t&&n.InstrumentationHelper.logDataSourceTimeout(Object.keys(this._suggestionsQueue),this._partialQuery);let u=t&&!this._renderedThisSequenceNumber,l=(t,f)=>{if(!t.updated&&this.getDependencies(f).every(t=>n.contains(this._arrivedDataSources,t))){if(e.push(f),this._allProcessedDataSources[f]=!0,t.suggestions.length>0){let e=this.canHaveSuppressions(f)?t.suggestions.filter(n=>!this.isSuppressed(f,n)):t.suggestions;if(e.length>0){i&&i.length!==0||(i=this._renderedThisSequenceNumber?this._rootViewModel.getSuggestions(!0):[]);let[t,o]=this.removeDuplicatesAndAssignIds(e,i,r,f);if(n.config.enableMruProviderInQF&&f=="Web"){if(f=="Web"){let n=[];t.forEach(t=>{r.find(n=>(n===null||n===void 0?void 0:n.query)==(t===null||t===void 0?void 0:t.query))||i.find(n=>(n===null||n===void 0?void 0:n.query)==(t===null||t===void 0?void 0:t.query))||n.push(t)});r=r.concat(n)}}else r=r.concat(t);o&&(u=!0)}}t.updated=!0}};const f=t=>{for(let i in t){let u=t[i],r=this._suggestionsQueue[u];if(n.config.enableSearchHistoryMru&&u==="MRS"&&this._partialQuery.isSearchHomeZI&&(r.updated=!0),n.config.enableSearchHistoryMru&&u==="Web"&&this._partialQuery.isSearchHomeZI){let n=this._suggestionsQueue.MRS;if((n===null||n===void 0?void 0:n.suggestions)&&(r===null||r===void 0?void 0:r.suggestions))n.suggestions=this.dedupeAndFilterMrs(n.suggestions,r.suggestions),n.updated=!1,l(n,"MRS");else continue}else r&&l(r,u)}};s&&f(this._highPriorityDataSources);this._bufferingTimer&&c&&(sb_ct(this._bufferingTimer),this._bufferingTimer=null);let y=s&&!this._HighPriDoneProcessing,p=y||(this.getLatencyTimeout()>0?this._bufferingTimer==null:o);p&&(f(this._normalPriorityDataSources),f(this._lowPriorityDataSources));this._waitingForMoreResults&&c&&(this._waitingForMoreResults=!1,(!this._renderedThisSequenceNumber||this._rootViewModel.mayNeedFlush()||(i||this._rootViewModel.getSuggestions(!0)).length==0)&&(u=!0));this._partialQuery.showProgressBar&&this._allDataSourcesArrived&&(u=!0);(r.length>0||u)&&(i||(i=this._renderedThisSequenceNumber?this._rootViewModel.getSuggestions(!0):[]),this.addSuggestions(i,r,e,u));this._allDataSourcesArrived&&(this.resetTimers(),n.InstrumentationHelper.notifyAllDataSourcesProcessed(this._sequenceNumber),this._rootViewModel.toggleProgressBar(!1));this._HighPriDoneProcessing=h}getAggregatorResult(n,t,i){let r=this.waitingForWebProvider();return this._aggregator.rank(t,i,this._extraSignalsMap,this._partialQuery,n,this._sequenceNumber,r)}waitingForWebProvider(){return n.isBrowserOnline()&&["Web"].concat(this.getDependencies("Web")).some(t=>n.isDataSourceEnabled(t,this._partialQuery)&&!this._allProcessedDataSources[t])}addSuggestions(t,i,r,u){let e=this._renderedThisSequenceNumber?this._rootViewModel.getCurrentTopResults():[],f=n.safeExecute(()=>this.getAggregatorResult(e,t,i),"getAggregatorResults",null);f||(f={topResults:e,suggestionsToAdd:i,suggestionsToRemove:[],groupOrder:[]});n.InstrumentationHelper.instrumentAggregatorCall(this._sequenceNumber);n.shouldShowDSBLayout(this._partialQuery)&&n.InstrumentationHelper.instrumentDSB();i=f.suggestionsToAdd;let o=f.suggestionsToRemove;for(let i of f.topResults)n.contains(t,i)&&!n.contains(e,i)&&o.push(i);if(u||i.length!=0||o.length!=0||!n.sequenceEqual(e,f.topResults)){let s=!this._renderedThisSequenceNumber;if(s&&(this._renderedThisSequenceNumber=!0,n.InstrumentationHelper.instrumentRenderingStarted(this._sequenceNumber)),n.config.useGroupTitleEdgeBS&&this._partialQuery&&!this._partialQuery.isSearchHomeZI&&i)for(let t of i)t&&(t.type=="ANAF"||t.type=="ANAH"||t.type=="ANAR"||t.type=="ANAT")&&(t.staticGroupType=n.GroupType.AnaheimDataQF);let h=n.safeExecute(()=>this._rootViewModel.update(s,f.topResults,this._waitingForMoreResults,this._sequenceNumber,i,o,r,f.groupOrder,this._allDataSourcesArrived,this._extraSignalsMap),"rootViewModel.update",0,null,t=>{n&&n.fallbackToPrepopulatedBundle&&n.fallbackToPrepopulatedBundle(t)});h==0&&(this._processingStopped=!0,this.resetTimers())}}isAnaheimSuggestionDupeWithMRU(t,i){if(i.type=="ANAH"||i.type=="ANAR"){let r=i;if(n.isBingSearchUrl(r.url)){let i=n.extractQueryFromBingSearchUrl(r.url);if(i&&n.contains(t,i))return!0}}return!1}dedupeAndFilterMrs(t,i){let u=t;for(let n of i){let t=-1;t=u.findIndex(t=>t.query===n.query);t!==-1?u[t].lastLaunchTime<n.lastLaunchTime&&(u[t]=n):u.push(n)}let r=n.loadDismissedMruWebSugFromCache(),f=u;if(!n.isNullOrUndefined(r)&&r.length>0&&!n.isNullOrUndefined(r[0]))for(let t of r){let i=-1;if(i=f.findIndex(n=>n.query===t.query),i!=-1)if(f[i].lastLaunchTime<t.lastDismissedTime)f.splice(i,1);else{let i=r.indexOf(t);r.splice(i,1);n.LightweightStorage.setItem(n.config.mruWsDismissCacheKey,JSON.stringify(r))}}let e=this._partialQuery.enabledDataSources.MRS.groupType;if(typeof e=="number")for(let n of f)n.staticGroupType=e;return f}removeDuplicatesAndAssignIds(t,i,r,u){var f;let o=n=>{var t,i;n.id||(n.id=n.path?n.path:n.type+n.text+((t=n.additionalInfoText)!==null&&t!==void 0?t:"")+(n.handoffType===17?(i=n.reactKey)!==null&&i!==void 0?i:"":""))},e=!1;if(n.config.enableSearchHistoryMru&&u=="MRS"&&(t=t.filter(n=>i.indexOf(n)===-1),t=t.filter(n=>r.indexOf(n)===-1)),u=="ANA"&&this._suggestionsQueue.MRS){let n=(f=this._suggestionsQueue.MRS.suggestions)===null||f===void 0?void 0:f.map(n=>n.query);n&&(t=t.filter(t=>!this.isAnaheimSuggestionDupeWithMRU(n,t)))}if(this._aggregator.canHaveDuplicates(u,this._partialQuery)){let f=[];for(let s=0;s<t.length;++s){const c=t[s];let h=i.findIndex(n=>this._aggregator.mergeDuplicates(this._partialQuery,n,c));if(h>=0){let t=i[h];t.needsRefreshAfterDeduping&&(e=!0);n.InstrumentationHelper.instrumentDuplicate(this._sequenceNumber,t,c);continue}if(h=r.findIndex(n=>this._aggregator.mergeDuplicates(this._partialQuery,n,c)),h>=0){let t=r[h],i=null;const u=n.config.msbReplaceDupLocalFiles&&c.type==="MFIL"&&t.type==="FL";u&&(i=this.replaceSuggestionInList(r,h,c),t=r[h]);t.needsRefreshAfterDeduping&&(t.needsRefreshAfterDeduping=!1,t.previewPaneNeedsRefreshAfterDeduping=!1);n.InstrumentationHelper.instrumentDuplicate(this._sequenceNumber,t,i!==null&&i!==void 0?i:c);continue}if(this._aggregator.canHaveDuplicatesWithinDataSource(u,this._partialQuery)&&(h=f.findIndex(n=>this._aggregator.mergeDuplicates(this._partialQuery,n,c)),h>=0)){let t=f[h];t.needsRefreshAfterDeduping&&(t.needsRefreshAfterDeduping=!1,t.previewPaneNeedsRefreshAfterDeduping=!1);n.InstrumentationHelper.instrumentDuplicate(this._sequenceNumber,f[h],c);continue}o(c);f.push(c)}return[f,e]}return t.forEach(n=>o(n)),[t,e]}canHaveSuppressions(t){return n.config.suppressDataSources[t]||n.config.dataSourcesWithSuppressedTypes[t]}isSuppressed(t,i){return n.config.suppressDataSources[t]||n.config.suppressTypes[i.type]}replaceSuggestionInList(n,t,i){const r=n[t];return r?(i.duplicates=r.duplicates,i.needsRefreshAfterDeduping=!0,i.previewPaneNeedsRefreshAfterDeduping=!0,n[t]=i,r):r}}n.SuggestionsRenderingManager=t}(WSB||(WSB={})),function(n){function y(n){return n.handoffType==1?n.query:HitHighlightingParser.removeMarkers(n.text)}function f(n){if(n.length==0)return 0;let t=0;for(let i=0;i<n.length;i++)t=(t<<5)-t+n.charCodeAt(i)|0;return t}function t(n,t){if(!n)return t.length;if(!t)return n.length;let u=[],i;for(i=0;i<=t.length;i++)u[i]=[i];let r;for(r=0;r<=n.length;r++)u[0][r]=r;for(i=1;i<=t.length;i++)for(r=1;r<=n.length;r++)u[i][r]=t.charAt(i-1)==n.charAt(r-1)?u[i-1][r-1]:Math.min(u[i-1][r-1]+1,Math.min(u[i][r-1]+1,u[i-1][r]+1));return u[t.length][n.length]}function p(n,i){return n&&(n=n.toLocaleLowerCase()),i&&(i=i.toLocaleLowerCase()),t(n,i)}function o(n,t,i){let r=0;if(t>0||i>0)if(t>0&&i>0){if(i>t){let n=t;t=i;i=n}r=n/(t-n+i)}else r=Number.MAX_VALUE;return r}function s(n,t){let i=n.length,u=t.length;if(i===0&&u===0)return 1;let s=new Array(i),o=new Array(u),r=0,h=0,c=Math.floor(Math.max(i,u)/2)-1;for(let e=0;e<i;e++){let i=Math.max(0,e-c),h=Math.min(u,e+c+1);for(var f=i;f<=h;f++)if(!o[f]&&n[e]==t[f]){s[e]=!0;o[f]=!0;r++;break}}if(r===0)return 0;let e=0;for(let r=0;r<i;r++)if(s[r]){while(!o[e])e++;n[r]!=t[e]&&h++;e++}return(r/i+r/u+(r-h/2)/r)/3}function w(n,t){let i=s(n,t);if(i<1)return i;let r=h(n,t);return i+r*.1*(1-i)}function h(n,t){let i=0;for(;i<4;i++)if(n[i]!=t[i])return i;return++i}function b(n,t){return!n||!t?0:n.length+1<=t.length&&t[n.length]==" "?1:n.length==t.length?1:0}function k(n){let i=0,t=1;if(n&&n.length>1)for(let r=1;r<n.length;r++)n.charAt(r)==n.charAt(r-1)?t++:t=1,t>i&&(i=t);else if(n)return 1;return i}function d(n){return n&&n.length>0?n.trim().split(" ").length:0}function g(n){let t=new RegExp("^[0-9a-zA-Z ]+$");return n&&t.test(n)?1:0}function nt(n){return n&&n.length>0&&n.charAt(n.length-1)==" "?1:0}function tt(n){return n&&n.length>0&&(n.includes("http://")||n.includes("https://")||n.includes("."))?1:0}function it(t,i,r,u){t.includes("?")&&(r[117]=1,ot(t)&&(r[127]=1));t.replace("///","").replace("//","").includes("/")&&(r[118]=1);t.includes(".")&&(r[119]=1);let o=u.cvid+u.privacyNumber+t;r[120]=f(o);let e=t.toLocaleLowerCase();if((e.startsWith("www.")||e.startsWith("http://www.")||e.startsWith("https://www."))&&(r[122]=1),e.startsWith("www.")||e.startsWith("http://")?r[123]=1:e.startsWith("https://")?r[124]=1:e.startsWith("ftp://")?r[125]=1:r[126]=1,i){let t=n.normalizeUrl(e,15),u=n.normalizeUrl(i,15).toLocaleLowerCase();t.startsWith(u)&&(r[187]=1)}}function rt(n,i,r,u,e){if(e){r[128]=t(e,i);r[129]=e.length;let n=u.cvid+u.privacyNumber+e;r[130]=f(n)}}function ut(n,i,r){let u=n.toLocaleLowerCase();r[140]=n.length;let f=u.split(" ");if(r[144]=f.length,i){r[141]=t(n,i);r[142]=Math.min(100,o(r[141],i.length,n.length));let e=i.toLocaleLowerCase();u.includes(e)&&(r[143]=1);u.startsWith(e)&&(r[188]=1);for(let n of f)if(n==e){r[145]=1;break}}}function ot(n){let t=et.find(t=>n.startsWith(t));return n=t?n.substr(t.length):n,ft.some(t=>n.startsWith(t))}function st(n){let t=0;if(n)for(let i in n){let r=n[i];r&&r.prefixLaunchCount&&(t+=r.prefixLaunchCount)}return t}function ht(t,i,r,u){if(r){let f=r[t];f&&(i[47]=f.prefixLaunchCount,i[49]=f.lastLaunchTime,i[101]=u,u>0&&(i[100]=f.prefixLaunchCount/u),f.previewPaneLaunchCount&&f.lastPreviewPaneLaunchTime&&(i[301]=f.previewPaneLaunchCount,f.lastPreviewPaneLaunchTime==f.lastLaunchTime&&(i[302]=1),i[303]=n.getCurrentTime()-f.lastPreviewPaneLaunchTime))}}function ct(n,t,i){if(i){let r=i[n];r&&(t[281]=r.probability,t[282]=r.weight)}}function lt(n,t,r,u,f,e){if(t){let s=i(u,r),o=t[s];o&&(f?(n[153]=o.ProbSugClickGivenPref,n[152]=o.ClicksOnSugGivenPref):e?(n[161]=o.Loglikelihood,n[162]=o.ProbSugClickGivenBackground,n[163]=o.ClicksOnSugGivenPref,n[164]=o.ProbSugClickGivenPref,n[165]=o.CCR,n[166]=o.EventCount,n[293]=o.ProbSugClickGivenPrefTime,n[168]=o.CCRTime,n[294]=o.ProbSugClickGivenBackgroundTime,n[295]=o.LoglikelihoodTime):(n[6]=o.Loglikelihood,n[3]=o.ProbSugClickGivenBackground,n[151]=o.ClicksOnSugGivenPref,n[0]=o.ProbSugClickGivenPref,n[94]=o.CCR,n[95]=o.EventCount,n[290]=o.ProbSugClickGivenPrefTime,n[155]=o.CCRTime,n[291]=o.ProbSugClickGivenBackgroundTime,n[292]=o.LoglikelihoodTime))}}function at(n,t,i){if(t){let r=t[i];r&&(n[256]=r.PSGPCR,n[257]=r.PSGCCR,n[258]=r.PSGSTR,n[286]=r.PSGSATCCR,n[287]=r.PSGSATPCR)}}function i(n,t){return(n+"\t"+t).toLocaleLowerCase()}function r(t,i,r){i==11..toString()&&i==0..toString();switch(n.config.athenaKeyType){case 0:return t||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group is empty")),t;case 1:return i||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),i;case 2:return r||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key suggestion type is empty")),i||SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key handoff is empty")),r+"_"+i;default:return SharedLogHelper.LogError("getAthenaGroupKey",null,new Error("Athena key group type is not set")),""}}function u(t,i,r){switch(n.config.athenaKeyType){case 0:return i==t;case 1:return r==t;case 2:return r==t;default:return!1}}function vt(t){let i={};return t?(n.config.athenaKeyType==2?wt(t,i):(yt(t,i),pt(t,i)),i):i}function yt(t,f){let a=t.Suggestions?t.Suggestions.split("\t"):[],v=t.ProbSugClickGivenPrefs?t.ProbSugClickGivenPrefs.split("\t"):[],y=t.ClicksOnSugGivenPrefs?t.ClicksOnSugGivenPrefs.split("\t"):[],p=t.ProbSugClickGivenBackground?t.ProbSugClickGivenBackground.split("\t"):[],w=t.Loglikelihoods?t.Loglikelihoods.split("\t"):[],c=t.SuggestionGroups?t.SuggestionGroups.split("\t"):[],b=t.ProbSugClickGivenPrefWeeks?t.ProbSugClickGivenPrefWeeks.split("\t"):[],l=t.ProbSugClickGivenPrefWeekends?t.ProbSugClickGivenPrefWeekends.split("\t"):[],k=t.ProbSugClickGivenBackgroundWeeks?t.ProbSugClickGivenBackgroundWeeks.split("\t"):[],nt=t.ProbSugClickGivenBackgroundWeekends?t.ProbSugClickGivenBackgroundWeekends.split("\t"):[],d=t.LoglikelihoodWeeks?t.LoglikelihoodWeeks.split("\t"):[],g=t.LoglikelihoodWeekends?t.LoglikelihoodWeekends.split("\t"):[],s=n.config.athenaKeyType==0||!t.SuggestionHandOffTypes?[]:t.SuggestionHandOffTypes.split("\t"),o=a.length,h=e();if(u(o,c.length,s.length))for(let t=0;t<o;t++){let e=c&&c.length>t?c[t]:"",tt=s&&s.length>t?s[t]:"",it=r(e,tt,""),u=i(a[t],it);f[u]={SuggestionGroup:+c[t]};p.length==o&&(f[u].ProbSugClickGivenBackground=Number(p[t]));v.length==o&&(f[u].ProbSugClickGivenPref=Number(v[t]));y.length==o&&(f[u].ClicksOnSugGivenPref=Number(y[t]));w.length==o&&(f[u].Loglikelihood=Number(w[t]));n.config.athenaKeyType!=0&&s.length==o&&(f[u].SuggestionHandOffType=Number(s[t]));b.length!=o||h?l.length==o&&h&&(f[u].ProbSugClickGivenPrefTime=Number(l[t])):f[u].ProbSugClickGivenPrefTime=Number(b[t]);k.length!=o||h?l.length==o&&h&&(f[u].ProbSugClickGivenBackgroundTime=Number(nt[t])):f[u].ProbSugClickGivenBackgroundTime=Number(k[t]);d.length!=o||h?g.length==o&&h&&(f[u].LoglikelihoodTime=Number(g[t])):f[u].LoglikelihoodTime=Number(d[t])}else SharedLogHelper.LogError("parseLLSignals",null,new Error("Length doesn't match"))}function pt(t,f){let c=t.CCRSuggestions?t.CCRSuggestions.split("\t"):[],h=t.CCRSuggestionGroups?t.CCRSuggestionGroups.split("\t"):[],l=t.CCRs?t.CCRs.split("\t"):[],a=t.EventCounts?t.EventCounts.split("\t"):[],s=n.config.athenaKeyType==0||!t.CCRSuggestionHandOffTypes?[]:t.CCRSuggestionHandOffTypes.split("\t"),v=t.CCRsWeek?t.CCRsWeek.split("\t"):[],y=t.CCRsWeekend?t.CCRsWeekend.split("\t"):[],o=c.length,p=e();if(u(o,h.length,s.length))for(let t=0;t<o;t++){let e=h&&h.length>t?h[t]:"",w=s&&s.length>t?s[t]:"",b=r(e,w,""),u=i(c[t],b);f[u]||(f[u]={SuggestionGroup:Number(h[t])});l.length==o&&(f[u].CCR=Number(l[t]));a.length==o&&(f[u].EventCount=Number(a[t]));n.config.athenaKeyType!=0&&s.length==o&&(f[u].CCRSuggestionHandOffType=Number(s[t]));v.length!=o||p?y.length==o&&p&&(f[u].CCRTime=Number(y[t])):f[u].CCRTime=Number(v[t])}else SharedLogHelper.LogError("parseCCRSignals",null,new Error("Length doesn't match"))}function wt(n,t){let f=n.SugTypes?n.SugTypes.split("\t"):[],e=n.HandOffTypes?n.HandOffTypes.split("\t"):[],o=n.PSGPCRs?n.PSGPCRs.split("\t"):[],s=n.PSGCCRs?n.PSGCCRs.split("\t"):[],h=n.PSGSTRs?n.PSGSTRs.split("\t"):[],c=n.PSGSATCCRs?n.PSGSATCCRs.split("\t"):[],l=n.PSGSATPCRs?n.PSGSATPCRs.split("\t"):[],i=f.length;if(u(i,0,e.length))for(let n=0;n<i;n++){let a=f[n],v=e[n],u=r("",v,a);t[u]={};o.length==i&&(t[u].PSGPCR=Number(o[n]));s.length==i&&(t[u].PSGCCR=Number(s[n]));h.length==i&&(t[u].PSGSTR=Number(h[n]));c.length==i&&(t[u].PSGSATCCR=Number(c[n]));l.length==i&&(t[u].PSGSATPCR=Number(l[n]))}else SharedLogHelper.LogError("parseGroupEngagementSignals",null,new Error("Length doesn't match"))}function bt(n,t){let i={};if(t){let u=0,f=0,r={};for(let{key:e,value:o}of t){r[e]={lexicalSimilarity:0,groupClickCounts:{},groupWeight:{}};f+=c(r,e,n);let t=a(o);r[e].groupClickCounts=t.groupLaunches;for(let n in r[e].groupClickCounts)i[n]||(i[n]={probability:0,weight:0}),i[n].probability+=t.groupHits[n],u+=t.groupHits[n]}l(i,r,f,u)}return i}function kt(n,t){let i={};if(t){let u=0,f=0,r={};for(let{key:o,value:e}of t){r[o]={lexicalSimilarity:0,groupClickCounts:{},groupWeight:{}};f+=c(r,o,n);for(let n in e)e[n]&&e[n].prefixLaunchCount&&(i[n]||(i[n]={probability:0,weight:0}),r[o].groupClickCounts[n]=e[n].prefixLaunchCount,i[n].probability++,u++)}l(i,r,f,u)}return i}function c(n,t,i){let r=t.length-i.length,u=r/t.length;return n[t].lexicalSimilarity=1-u,n[t].lexicalSimilarity}function l(n,t,i,r){let u=0;for(let n in t){let r=t[n];r.lexicalSimilarity/=i;for(let n in r.groupClickCounts){let t=r.groupClickCounts[n];r.groupWeight[n]=t*r.lexicalSimilarity;u+=r.groupWeight[n]}}for(let t in n)n[t].probability/=r;for(let i in t){let r=t[i];for(let t in r.groupClickCounts)n[t]||(n[t]={probability:0,weight:0}),r.groupWeight[t]/=u,n[t].weight+=r.groupWeight[t]}}function a(n){let i=(n,t,i)=>n[t]=n[t]?n[t]+i:i,t={groupLaunches:{},groupHits:{},otherGroupLaunches:0};for(let r in n){let u=n[r];if(u&&u.prefixLaunchCount){let f=u.groupType;f||f===0?(i(t.groupLaunches,f,u.prefixLaunchCount),i(t.groupHits,f,1)):t.otherGroupLaunches+=u.prefixLaunchCount}}return t}function dt(n,t,i,r){if(r){let f=i(t),u=r[f];u&&(n[266]=u.probability,n[267]=u.weight)}}function e(t){let i=t?t.getDay():n.getCurrentDate().getDay();return i==6||i==0}function gt(n){for(let t in n)n[t]?n[t]=v(Number(n[t])):delete n[t]}function v(n){return Number(n.toFixed(5))}function ni(n,t){n.featureStore||(n.featureStore={});n.featureStore[t]=1}n.getTextForLexicalFeatures=y;n.stringHashCode=f;n.getEditDistance=t;n.getEditDistanceIgnoreCase=p;n.computeEditDistanceRatio=o;n.computeJaroSimilarity=s;n.computeJaroWinklerSimilarity=w;n.computeJaroWinklerPrefixOverLapCount=h;n.isWordBoundary=b;n.countMaxContiguousRepeatedChars=k;n.getNumberOfWords=d;n.containsOnlyDigitsLettersOrSpaces=g;n.endsWithSpace=nt;n.prefixIsLikeUrl=tt;n.computeUrlFeatures=it;n.computeDomainFeatures=rt;n.computeTitleFeatures=ut;const ft=["www.bing.","cn.bing.","www.google.","www.yandex.","www.baidu.","www.yahoo.",],et=["http://","https://",];n.getSumMruLaunches=st;n.setMRUSignal=ht;n.setMRUBackPropSignal=ct;n.setEngagementSignals=lt;n.setSuggestionGroupEngagementSignals=at;n.getEngagementSignalKey=i;n.getAthenaGroupKey=r;n.checkAthenaGroupLength=u;n.parseWebEngagementSignals=vt;n.computeGroupBackpropagatedClicks=bt;n.computeSuggestionBackpropagatedClicks=kt;n.evaluateGroupLaunches=a;n.setMRUGroupBackpropClicks=dt;n.isWeekend=e;n.removeUndefinedAndZeroAndTrimValues=gt;n.trimFeatureStoreValue=v;n.setFlagInFeatureStore=ni}(WSB||(WSB={})),function(n){var t;(function(t){function r(n){return n.isSearchHomeZI}const i=.4;t.suggestionRankingModels={};t.suggestionFastRankModelIdCurrent="STH_00000000-0000-0000-0000-000000000000";class u{rank(t,i,u,f,e,o,s,h,c){if(r(t))return{topResults:[],mruSuppressions:null};if(t.scope==n.Scope.PathCompletion)return this.rankPathCompletion(i);let l=n.isL2(t)?null:{mruGroupRatios:null,maxGroupCCR:null,maxGroupProbSugClickGivenPref:null,mruGroupBackpropWeights:null,mruGroupBackpropRatios:null},a=i.slice();this.orderSuggestions(t,i,u,f,o,s,h,l,e);this.setMRUHintEnabled(t,i);this.setGroupSuppressionSignals(l,i);let v=this.getTopHitCandidates(t,i,c.searchTheWeb,a),y=this.createMulticlassClassifierTopHitSuggestionList(v);return{topResults:y,mruSuppressions:l}}isNotChromeIntent(n,t){let i="google chrome";if(t.length==0)return!1;let r=t.filter(n=>n.query.toLocaleLowerCase()==i&&n.type=="PP");return r.length>0&&!n.queryToFetch.includes("c")&&!n.queryToFetch.includes("h")&&!n.queryToFetch.includes("r")&&!n.queryToFetch.includes("m")?!0:!1}setMRUHintEnabled(t,i){if(n.config.enableMRUHint){let r=t.queryToFetch.toLocaleLowerCase();for(let t=0;t<i.length;t++){let u=i[t].featureStore;u[281]&&u[282]&&(n.config.enableMRUHint!=1&&i[t].text.toLocaleLowerCase().startsWith(r)||(i[t].mruHintEnabled=!0))}}}rankPathCompletion(n){let t=n.find(n=>n.type=="CG")||n[0];return{topResults:t?[t]:[],mruSuppressions:null}}swapHighConfidenceTopHit(t){const f={minimum:0,penalty:.1},e={minimum:.08,penalty:.05},o={minimum:.01,penalty:.05},s={minimum:.45,penalty:.9};let u=n=>{let t=-5;return(n-t)/(8-t)},i=t[0],r=0;if(!(t.length<=1)&&!(i.simpleFeatures.mruScore>0)){for(let h=0;h<t.length;h++){let c=t[h];n.isApp(c.type)?(c.simpleFeatures.topHitScore=u(-.45052*c.simpleFeatures.ciGeoMeanScoreNormalized+.15451*c.simpleFeatures.ciGlobalScore+-.34223*c.simpleFeatures.ciLocalScore+-.18174*c.simpleFeatures.ciMatchScore+3.9928),!n.isApp(i.type)&&c.simpleFeatures.topHitScore>f.minimum&&c.simpleFeatures.topHitScore>i.simpleFeatures.topHitScore+f.penalty&&(i=c,r=h)):n.isSetting(c.type)?(c.simpleFeatures.topHitScore=u(-.42912*c.simpleFeatures.ciGeoMeanScoreNormalized+-.0173*c.simpleFeatures.ciLocalScore+-.1516*c.simpleFeatures.ciMatchScore+.28754),!n.isSetting(i.type)&&c.simpleFeatures.topHitScore>e.minimum&&c.simpleFeatures.topHitScore>i.simpleFeatures.topHitScore+e.penalty&&(i=c,r=h)):n.isFileOrFolder(c.type)?(c.simpleFeatures.topHitScore=u(.99907*c.simpleFeatures.startsWithPrefix+1.1431*c.simpleFeatures.containsPrefix+3.1153*c.simpleFeatures.jaroWinklerScore+-3.9697),i==c&&(c.simpleFeatures.topHitScore=0),!n.isFileOrFolder(i.type)&&c.simpleFeatures.topHitScore>s.minimum&&c.simpleFeatures.topHitScore>i.simpleFeatures.topHitScore+s.penalty&&(i=c,r=h)):n.isWebSuggestion(c)||c.type=="MB"||c.isAnswer?(c.simpleFeatures.topHitScore=u(5.3465*c.simpleFeatures.webConfidence+-5.6972),(!n.isWebSuggestion(i)&&c.simpleFeatures.topHitScore>o.minimum&&c.simpleFeatures.topHitScore>i.simpleFeatures.topHitScore+o.penalty||c.type=="MB"&&n.isWebSuggestion(i))&&(i=c,r=h)):(c.type=="PT"||c.type=="CG")&&(i=c,r=h)}r!=0&&(t.unshift(i),t.splice(r+1,1))}}extractSimpleFeatures(t){let i=t.featureStore,f=64,r=0,u={mruScore:i[282]||r,sugTypeBucket:10,ciGeoMeanScoreNormalized:Math.floor(i[405]/1e3)||f,ciGlobalScore:i[269]/1e3||f,ciLocalScore:i[270]/1e3||f,ciMatchScore:Math.floor(i[158]/1e3)||0,rank:Math.floor(i[16]/1e3)||128,webScore:this.getSuggestionScoreFromSuggestionLogMeta(t.suggestionLogMeta)||r,webConfidence:i[17]||r,prefixEqualsSuggestion:i[133]||r,startsWithPrefix:i[188]||r,containsPrefix:i[143]||r,jaroWinklerScore:i[421]||r,topHitScore:r};return u.sugTypeBucket=n.isApp(t.type)?0:n.isSetting(t.type)?1:n.isFileOrFolder(t.type)?2:t.type=="MB"?3:n.isWebSuggestion(t)?4:5,t.type=="IBA"&&i[269]<1&&(u.ciGeoMeanScoreNormalized=64),u.ciMatchScore==0&&u.startsWithPrefix==0&&u.sugTypeBucket<=1&&(u.ciMatchScore+=1),u}isColdStartConversation(t,i,r){if(i&&i.length>0||r&&r.WebSignalsAvailable||!t.some(t=>n.isApp(t.type)||n.isSetting(t.type)))return n.Host.setFCRCount(0),n.Host.incrementNCRCount(),!1;for(let i=0;i<t.length;i++)if(t[i].featureStore&&t[i].featureStore[269]&&t[i].featureStore[270]&&t[i].featureStore[269]>t[i].featureStore[270])return n.Host.setFCRCount(0),n.Host.incrementNCRCount(),!1;return n.config.enableColdStartRanking1||!n.config.enableColdStartRanking?(n.Host.setFCRCount(1),n.Host.incrementCRCount(),!1):(n.Host.setFCRCount(1),n.Host.incrementCRCount(),!0)}selectFastRankRanker(i){i&&(t.suggestionFastRankModelIdCurrent=i);let r=t.suggestionRankingModels[t.suggestionFastRankModelIdCurrent];if(!r){let i;if(i=n.config.secondRankerId&&(n.isMsftAccountConnected||n.isMsbEnterprise()||n.AccessTokenManager.getWindowsAccountType()==1)?n.config.secondRankerId:n.config.mainRankerId,i){if(r=t.suggestionRankingModels[i],r)return t.suggestionFastRankModelIdCurrent=i,r;i!=n.config.mainRankerId?r=this.selectFastRankRanker(n.config.mainRankerId):(SharedLogHelper.LogError("getRanker",i,new Error("Model not found")),t.suggestionFastRankModelIdCurrent="STH_00000000-0000-0000-0000-000000000002")}else SharedLogHelper.LogError("getRanker",i,new Error("fastRank RankerId not defined")),t.suggestionFastRankModelIdCurrent="STH_00000000-0000-0000-0000-000000000003"}return r}orderSuggestions(t,i,r,u,f,e,o,s,h){if(n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBRanking.orderSuggestions"),!n.config.bypassRankerOnNoNewSuggestions||t.hasNewSuggestions){let c=n.safeExecute(()=>this.createFeatureStore(t,i,r,u,f,e,o,s,h),"createFeatureStore");c=c||i.map(()=>({}));let a=this.selectFastRankRanker();if(n.config.enableSimpleRanker){for(let n=0;n<i.length;n++){let t=c[n];i[n].featureStore=t;i[n].simpleFeatures=this.extractSimpleFeatures(i[n])}n.config.enableMatchQueryDemotions?i.sort((n,t)=>t.simpleFeatures.mruScore-n.simpleFeatures.mruScore||n.simpleFeatures.sugTypeBucket-t.simpleFeatures.sugTypeBucket||Math.floor(n.simpleFeatures.ciMatchScore/10)-Math.floor(t.simpleFeatures.ciMatchScore/10)||n.simpleFeatures.ciGeoMeanScoreNormalized-t.simpleFeatures.ciGeoMeanScoreNormalized||n.simpleFeatures.rank-t.simpleFeatures.rank||t.simpleFeatures.prefixEqualsSuggestion-n.simpleFeatures.prefixEqualsSuggestion||t.simpleFeatures.startsWithPrefix-n.simpleFeatures.startsWithPrefix||t.simpleFeatures.containsPrefix-n.simpleFeatures.containsPrefix||t.simpleFeatures.jaroWinklerScore-n.simpleFeatures.jaroWinklerScore):i.sort((n,t)=>t.simpleFeatures.mruScore-n.simpleFeatures.mruScore||n.simpleFeatures.sugTypeBucket-t.simpleFeatures.sugTypeBucket||n.simpleFeatures.ciGeoMeanScoreNormalized-t.simpleFeatures.ciGeoMeanScoreNormalized||n.simpleFeatures.ciMatchScore-t.simpleFeatures.ciMatchScore||n.simpleFeatures.rank-t.simpleFeatures.rank||t.simpleFeatures.prefixEqualsSuggestion-n.simpleFeatures.prefixEqualsSuggestion||t.simpleFeatures.startsWithPrefix-n.simpleFeatures.startsWithPrefix||t.simpleFeatures.containsPrefix-n.simpleFeatures.containsPrefix||t.simpleFeatures.jaroWinklerScore-n.simpleFeatures.jaroWinklerScore);for(let n=0;n<i.length;n++)i[n].rankingScore=-n;this.swapHighConfidenceTopHit(i)}else if((n.config.enableColdStartRanking||n.config.enableColdStartRanking1)&&this.isColdStartConversation(i,h,r)){for(let n=0;n<i.length;n++){let t=c[n];i[n].featureStore=t;i[n].simpleFeatures=this.extractSimpleFeatures(i[n])}i.sort((n,t)=>t.simpleFeatures.prefixEqualsSuggestion-n.simpleFeatures.prefixEqualsSuggestion||t.simpleFeatures.containsPrefix-n.simpleFeatures.containsPrefix||n.simpleFeatures.ciGlobalScore-t.simpleFeatures.ciGlobalScore);for(let n=0;n<i.length;n++)i[n].rankingScore=-n}else if(a)for(let t=0;t<i.length;t++){let r=c[t];if(!n.config.enableConversationCache&&i[t].handoffType!==21||!i[t].skipRerank){let u=n.safeExecute(()=>a(r),"calculateRankingScore");i[t].rankingScore=n.trimFeatureStoreValue(u);i[t].featureStore=r;(n.config.enableFuzzyRanking||n.config.enableFuzzyRanking1)&&(i[t].simpleFeatures=this.extractSimpleFeatures(i[t]));n.config.enableConversationCache&&(i[t].skipRerank=!0)}}if(n.config.enableAnaheimRelevance){let t=[];n.config.enableAnaheimRelevance==1?t=i.filter(n=>n.anaheimRankingSignals):n.config.enableAnaheimRelevance==2&&(t=i.filter(t=>n.getGroupType(t)==n.GroupType.SearchSuggestions));this.getWebRankingWithAnaheimAdapter(t)}let l=i.filter(n=>n.type=="MB");if(n.config.enableSimpleRanker||i.sort((n,t)=>t.rankingScore-n.rankingScore),i.length>1&&(n.config.enableFuzzyRanking||n.config.enableFuzzyRanking1)){let r=i[0].rankingScore,t=0;for(let u=0;u<i.length;u++)if(n.config.enableFuzzyRanking){if((n.isApp(i[u].type)||n.isSetting(i[u].type))&&i[u].rankingScore<=r-n.config.fuzzyRankingThreshold)break;t+=1}else if(n.config.enableFuzzyRanking1&&i[u].rankingScore+n.config.fuzzyRankingThreshold>=r){if(n.isApp(i[u].type)||n.isSetting(i[u].type))break;t+=1}if(n.Host.setFRSuggCount(t),t>1){let u=i.slice(0,t).sort((n,t)=>t.simpleFeatures.prefixEqualsSuggestion-n.simpleFeatures.prefixEqualsSuggestion||t.simpleFeatures.containsPrefix-n.simpleFeatures.containsPrefix||n.simpleFeatures.ciGlobalScore-t.simpleFeatures.ciGlobalScore);for(let f=0;f<t;f++)i[f]=u[f],i[f].rankingScore=r-n.config.fuzzyRankingThreshold*f/t;i.sort((n,t)=>t.rankingScore-n.rankingScore)}}if(l.length>1){let n=i.map((n,t)=>n.type=="MB"?t:undefined).filter(n=>typeof n=="number");for(let t=0;t<l.length;++t)i[n[t]]=l[t]}n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.orderSuggestions")}}getWebRankingWithAnaheimAdapter(t){const i=10,e=-1;let r=!1,u=new Array(i),f=n=>{if(n==e&&!r)return r=!0,-400;n=Math.floor(n);n>i-1&&(n=i-1);let t=-(n*100+500)-u[n];return u[n]+=1,t},o=n=>{for(let t of n)if(t.suggestionLogMeta){let n=this.getSuggestionScoreFromSuggestionLogMeta(t.suggestionLogMeta);if(n)return n}return 64e3};t.sort((n,t)=>t.rankingScore-n.rankingScore);for(let n=0;n<i;++n)u[n]=0;let s=o(t);for(let u of t){let t=this.getRankingBucketWithAnaheimAdapter(u,s,i);u.rankingScore=t!=null&&t>=0?!r&&u.anaheimRankingSignals&&t<=n.config.anaheimDataTopHitThreshold?f(e):f(t):f(i)}}getRankingBucketWithAnaheimAdapter(t,i,r){let u=Math.pow(2,-(i/8e3)+2);if(t.anaheimRankingSignals){let i=t.anaheimRankingSignals.dateVisited,u=(n.getCurrentTime()-i.getTime())/864e5,f=t.anaheimRankingSignals.visitCount,e=t.anaheimRankingSignals.urlTypedCount,o=.6*Math.exp(-u/14)+.25*(1-Math.exp(-f/6))+.15*(1-Math.exp(-e/2));return Math.floor(r*(1-o))}if(t.suggestionLogMeta){let n=this.getSuggestionScoreFromSuggestionLogMeta(t.suggestionLogMeta);if(n)return Math.floor((n-i)/u)}return null}getSuggestionScoreFromSuggestionLogMeta(n){let t=";2152:";return n&&n.indexOf(t)>=0?parseInt(n.substring(n.indexOf(t)+6).split(";")[0].slice(1,-1)):NaN}getTopWebSuggestion(t){if(t.length==0)return null;n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBRanking.getTopWebSuggestion");let i=t[0],r=64e3;if(t.length>1)for(let n of t)if(n.suggestionLogMeta){let t=this.getSuggestionScoreFromSuggestionLogMeta(n.suggestionLogMeta);!isNaN(t)&&t<r&&(r=t,i=n)}return n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.getTopWebSuggestion"),i}applyQueryOverride(t){return n.config.msbQueryOverrideTenant&&(t===null||t===void 0?void 0:t.queryToFetch)&&n.contains(n.config.msbQueryOverrideTenant,t.queryToFetch.toLowerCase())}bypassFallbackForMSB(t,i,r){return(n.config.bypassFallbackOnMSBTopHit==2||n.config.bypassFallbackOnMSBTopHit==3)&&i.every(t=>n.isWebSuggestion(t)||n.isMsbQFSuggestion(t)||t.isAnswer)?n.isMsftAccountConnected&&this.applyQueryOverride(t)?!1:!0:(n.config.bypassFallbackOnMSBTopHit==1||n.config.bypassFallbackOnMSBTopHit==4)&&!i.some(t=>n.isApp(t.type)||n.isSetting(t.type))&&r.length>0&&n.isMsbOnlineSuggestionType(r[0].type)?!0:n.config.bypassFallbackOnMSBTopHit==4&&!i.some(t=>n.isApp(t.type)||n.isSetting(t.type))&&r.length>1&&(r[0].isAnswer||n.isWebSuggestion(r[0]))&&(n.isMsbOnlineSuggestionType(r[1].type)||r.length>2&&r[0].isAnswer&&r[1].isAnswer&&n.isMsbOnlineSuggestionType(r[2].type))?!0:!1}getTopHitCandidates(t,r,u,f){n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBRanking.getTopHitCandidates");let e=r.filter(n=>this.allowInTopHit(t,n,f));if(this.bypassFallbackForMSB(t,r,e,f)){const s=n.getMsbTophitSuggestionTypeOrder();let o=[],u=[];for(const t of s)if(u=n.config.useWsbRankingForMsbFile&&t.length==1&&t[0]=="MFIL"?r.filter(n=>n.type=="MFIL"&&n.autoOpenPreviewPaneWhenOnTopHit):f.filter(n=>t.indexOf(n.type)>-1&&n.autoOpenPreviewPaneWhenOnTopHit),u.length>0)break;if(u.length>0&&u[0].autoOpenPreviewPaneWhenOnTopHit&&(n.config.bypassFallbackOnMSBTopHit!=3||n.getTextForLexicalFeatures(u[0]).toLowerCase().startsWith(t.queryToFetch.toLowerCase()))&&o.push(u[0]),n.config.bypassFallbackOnMSBTopHit==4&&(e[0].isAnswer||n.isWebSuggestion(e[0]))&&(e[0].isAnswer||this.getFallbackClassifierScore(e[0])>i)&&o.push(e[0]),o.length>0)return n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.getTopHitCandidates"),o}if(this.enableFallbackClassifier(t,e,u)){if(e=this.getFallbackClassifierSuggestions(e,u),n.config.enableGGSupp&&this.isNotChromeIntent(t,e))return n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.getTopHitCandidates"),[];if(n.config.demoteWebForApps){let i=this.getTopAppSuggestion(r),u=i?i.query.toLocaleLowerCase():"";i&&this.allowInTopHit(t,i)&&e.every(t=>n.isWebSuggestion(t))&&(u.startsWith(t.queryToFetch)||u.includes(" "+t.queryToFetch))&&(e=[i])}return n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.getTopHitCandidates"),e}return n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBRanking.getTopHitCandidates"),e}getFallbackClassifierScore(i){let r=n.safeExecute(()=>t.suggestionRankingModels[n.config.fallbackClassifierId],"getFallbackClassifier"),u=r?n.safeExecute(()=>r(i.featureStore),"calculateFallbackClassifierScore"):0;return n.trimFeatureStoreValue(u)}getFallbackClassifierSuggestions(r,u){if(r=r.filter(n=>n.type!="SW"),r.every(n=>n.type=="SW"||n.type=="MACR")||(r=r.filter(n=>n.type!="MACR")),r.length>0){let e=0,f=r[0];if(f.fbcScore=this.getFallbackClassifierScore(f),e=n.config.enableAppsSettingsFbcScoreThreshold?n.isApp(f.type)||n.isSetting(f.type)?n.config.appsSettingsFbcScoreThreshold:n.isWebSuggestion(f)?i:n.config.nonWebFbcScoreThreshold:n.isWebSuggestion(f)?i:n.config.nonWebFbcScoreThreshold,f.fbcScore<e){if(n.config.disableTopHitForFBC&&f.handoffType!=0&&!t.topHitIsMultiEntity(r)&&1!=(n.AccessTokenManager===null||n.AccessTokenManager===void 0?void 0:n.AccessTokenManager.getWindowsAccountType())){let t=-1;if(t=r.findIndex(n=>n.handoffType==0),t>=0){if(n.config.asTopHitPosForFBC==1){let n=r.slice(t,t+1);return n.push(f),n}if(n.config.asTopHitPosForFBC==2){let n=r.slice(0,1);return n.push(r[t]),n}return r.slice(t,t+1)}}this.isSyntheticWebBlockedInTopHit(u,f)&&(e=0)}return f.fbcScore>=e?r.slice(0,t.topHitIsMultiEntity(r)?2:1):[]}return[]}enableFallbackClassifier(t,i,r){if(r&&n.config.fallbackClassifierId&&i.length>0){let t=i[0];return n.getGroupType(t)==n.GroupType.Cortana?!1:t.isAnswer?!1:!0}return!1}getTopAppSuggestion(t){for(let i of t)if(n.isApp(i.type))return i;return null}isRecourse(t){return t.notAResult&&!n.contains(["SW","PWL","SSTS"],t.type)}allowInTopHit(t,i,r){if((t===null||t===void 0?void 0:t.scope)!=n.Scope.Web&&i.type=="SW"&&(r===null||r===void 0?void 0:r.length)>1&&this.isSyntheticWebBlockedInTopHit(i,r[0]))return!1;let u=!r||r.length==1;if(n.config.demoteTopHitOnNoQueryMatch&&(n.isApp(i.type)||n.isSetting(i.type))&&!i.ciMatchedQuery&&!i.query.toLocaleLowerCase().includes(t.queryToFetch.toLocaleLowerCase()))return!1;if(t.topHitRestriction==1&&i.query.toLocaleLowerCase()!=t.queryToFetch.toLocaleLowerCase()&&(n.contains(i.features,"ForcePrefixOnTop")||i.features.push("ForcePrefixOnTop")),this.isRecourse(i))return u;let f=n.getGroupType(i);switch(f){case n.GroupType.Store:return i.hc;case n.GroupType.Command:return i.hc||u;case n.GroupType.LocalPlaces:return!1}if(n.getScope(f)==n.Scope.Emails&&!i.hc)return!1;if(n.enforceOriginalOrder(i)&&r)for(let n of r){if(n==i)break;if(n.type==i.type&&n.handoffType==i.handoffType&&n.sourceForGroup==i.sourceForGroup)return!1}return n.RuntimeConfig.QfMode!=11&&n.RuntimeConfig.AlwaysWide&&!i.previewPaneType?!1:!0}isSyntheticWebBlockedInTopHit(t,i){return n.config.enableBlockSWTopHit&&t.type=="SW"&&i.rankingScore-t.rankingScore>n.config.swTopHitRankScoreThreshold&&!n.prefixNormalizedSuggTypes.has(i.type)?!0:!1}createMulticlassClassifierTopHitSuggestionList(i){let r=0;if(n.config.disableTopHitForFBC)r=i.length;else for(let t=0;t<Math.min(i.length,n.config.maxNumberOfTopResults);t++)i[t].rankingScore!==undefined&&i[t].rankingScore>.5&&(r=t);return r==0&&t.topHitIsMultiEntity(i)&&(r=1),n.config.bypassFallbackOnMSBTopHit==4&&i.length>0&&n.isMsbOnlineSuggestionType(i[0].type)&&(r=1),i.slice(0,r+1)}createFeatureStore(t,i,r,u,f,e,o,s,h){let y=[],a=0,p=0,v=0,w=t.queryToFetch.toLocaleLowerCase(),nt=t=>n.getGroupType(t),b=n.getSumMruLaunches(u),k=0,d={};if(u){let t=n.evaluateGroupLaunches(u);k=t.otherGroupLaunches;d=t.groupLaunches}let g=n.computeGroupBackpropagatedClicks(t.queryToFetch,h),tt=n.computeSuggestionBackpropagatedClicks(t.queryToFetch,h);for(let t of i)if(t.handoffType==2){let i=n.getAppItem(t);i&&(p+=i.totalLaunches,i.totalLaunches>a&&(a=i.totalLaunches));t.deviceItem&&t.deviceItem.rankScore>v&&(v=t.deviceItem.rankScore)}let c={};n.isWeekend()&&(c[440]=1);c[441]=this.getLocalHourBucket(new Date);let l=w.split(" ");for(let n of l){if(n=="install"){c[451]=1;break}if(n=="uninstall"){c[450]=1;break}}if(l&&l.length>0){let n=l[0];c[452]=n.indexOf("c:")>-1||n.indexOf("d:")>-1||n.indexOf("e:")>-1||n.indexOf("f:")>-1?1:0}for(let h of i){let i=this.getSuggestionFeatureStore(w,h,f,r,p,o);i[13]=a;i[7]=v;r&&r.WebSignalsAvailable&&(i[93]=1);n.setMRUSignal(n.getSuggestionKey(h),i,u,b);this.setMRUGroupLaunchRatios(i,h,b,d,k,s);n.setMRUBackPropSignal(n.getSuggestionKey(h),i,tt);g&&n.setMRUGroupBackpropClicks(i,h,nt,g);let l=n.getTextForLexicalFeatures(h);if(l){if(h.handoffType==1){n.computeUrlFeatures(l,t.queryToFetch,i,e);let r=n.getDomain(l);n.computeDomainFeatures(h,t.queryToFetch,i,e,r,f)}if(n.isFileOrFolder(h.type)){let t=e.cvid+e.privacyNumber+l;i[131]=n.stringHashCode(t)}}c&&(i[440]=c[440],i[441]=c[441],i[451]=c[451],i[450]=c[450],i[452]=c[452]);n.removeUndefinedAndZeroAndTrimValues(i);y.push(i)}return y}setGroupSuppressionSignals(t,i){if(t){t.maxGroupCCR={};t.maxGroupProbSugClickGivenPref={};t.mruGroupBackpropRatios={};t.mruGroupBackpropWeights={};for(let r of i)if(r.featureStore){let i=n.getGroupType(r),u=r.featureStore[94]||0,f=r.featureStore[0]||0;t.maxGroupCCR[i]=t.maxGroupCCR[i]?Math.max(t.maxGroupCCR[i],u):u;t.maxGroupProbSugClickGivenPref[i]=t.maxGroupProbSugClickGivenPref[i]?Math.max(t.maxGroupProbSugClickGivenPref[i],f):f;t.mruGroupBackpropRatios[i]=r.featureStore[266];t.mruGroupBackpropWeights[i]=r.featureStore[267];(t.mruGroupBackpropWeights[i]||t.mruGroupBackpropRatios[i])&&(t.backPropDataExists=!0)}}}setMRUGroupLaunchRatios(t,i,r,u,f,e){if(r){e&&(e.mruGroupRatios={});t[186]=f/r;for(let f in u){let o=u[f]/r;n.getGroupType(i)==Number(f)&&(t[271]=o);e&&(e.mruGroupRatios[f]=o);switch(Number(f)){case n.GroupType.Apps:t[169]=o;break;case n.GroupType.Settings:t[170]=o;break;case n.GroupType.Cortana:t[171]=o;break;case n.GroupType.Command:t[172]=o;break;case n.GroupType.Photos:t[173]=o;break;case n.GroupType.Videos:t[174]=o;break;case n.GroupType.Music:t[175]=o;break;case n.GroupType.Documents:t[176]=o;break;case n.GroupType.Folders:t[177]=o;break;case n.GroupType.Emails:t[178]=o;break;case n.GroupType.Store:t[179]=o;break;case n.GroupType.SearchSuggestions:t[262]=o;t[180]=u[n.GroupType.Websites]?(u[n.GroupType.Websites]+u[f])/r:o;break;case n.GroupType.Websites:t[263]=o;t[180]=u[n.GroupType.SearchSuggestions]?(u[n.GroupType.SearchSuggestions]+u[f])/r:o;break;case n.GroupType.PathCompletion:t[181]=o;break;case n.GroupType.People:t[184]=o;break;case n.GroupType.Bookmarks:t[260]=o;break;case n.GroupType.LocalPlaces:t[261]=o}}}}getRank(t){if(t.deviceItem&&typeof t.deviceItem.rankScore!="undefined")return t.deviceItem.rankScore;let i=n.isJumpListSuggestion(t)?t.jumpListItem.usagePoints:undefined;return typeof i!="undefined"?i:undefined}getSuggestionFeatureStore(t,i,r,u,f,e){let o={};this.setTypeSignal(i,o);let l=n.getAppItem(i);l?(o[2]=l.totalLaunches,o[92]=l.launchArguments?1:0,f>0&&(o[103]=l.totalLaunches/f),this.addLastAccessDate(l.lastAccessed,o)):this.addLastAccessDate(n.isJumpListSuggestion(i)?i.jumpListItem.lastAccessed:null,o);o[99]=i.confidence;o[150]=i.source;o[283]=i.pinnedToTaskbar?1:undefined;i.hc&&(o[189]=1);o[17]=i.highConfidenceMetaSuggestionScore;let p=this.getRank(i);typeof p!="undefined"?o[16]=p:o[4]=1;var h=i;h.matchedOnlyOnContent&&(o[259]=1);h.matchedOnlyOnAuthor&&(o[273]=1);h.lastModifiedDate&&(o[268]=n.getTimeDiffInDays(h.lastModifiedDate));n.config.populateLastAccessDateForFiles&&h.lastAccessDate&&(o[9]=n.getTimeDiffInDays(h.lastAccessDate),o[19]=0);h.extensionLC==".lnk"&&(o[272]=1);o[23]=i.prefetchConfidenceScore;o[264]=u&&u.ProbNextKS!==undefined?u.ProbNextKS:1;o[296]=u&&u.ProbNextKSV2!==undefined?u.ProbNextKSV2:1;this.setThresholdRatios(o,u);this.setRatios(o,u);let a=n.getGroupType(i),v=i.query;i.type=="SW"&&(v="SearchTheWeb");let y=n.getAthenaGroupKey(String(a),String(i.handoffType),i.type);n.setEngagementSignals(o,r,y,v,!1,!1);n.setEngagementSignals(o,e,y,v,!1,!0);e&&!r&&n.setEngagementSignals(o,e,y,v,!1,!1);o[10]=t.length;(i.isAnswer||a==n.GroupType.Cortana)&&(o[11]=1);let c=n.getTextForLexicalFeatures(i),s=c?c.toLocaleLowerCase():null;c||(o[132]=1);s==t&&(o[133]=1);i.handoffType==2&&(o[8]=1,n.isSetting(i.type)&&(o[64]=1),n.isApp(i.type)&&(o[83]=1));a==n.GroupType.SearchSuggestions&&(i.type!="SW"&&(o[82]=1),o[25]=1);let w=o[132]==1;if(w?o[137]=t.length:(o[137]=c.length,o[134]=n.getEditDistance(t,s),o[135]=Math.min(100,n.computeEditDistanceRatio(o[134],t.length,c.length)),o[136]=n.isWordBoundary(t,c),o[284]=Math.abs(c.length-t.length)),!w&&s){s.indexOf(t)>-1&&(o[143]=1);s.substring(0,t.length)===t&&(o[188]=1);let i=s.split(" ");for(let n of i)if(n==t){o[145]=1;break}o[420]=n.computeJaroSimilarity(t,s);o[421]=n.computeJaroWinklerSimilarity(t,s)}if(o[1]==1&&i.deviceItem){let t=n.getAppItem(i);t.extension&&(o[400]=t.extension===".exe"?1:0,o[401]=t.extension===".appref-ms"?1:0);s&&(o[402]=s.indexOf("install")>-1?1:0)}if(o[1]||i.type!="FL"&&i.type!="FD"&&i.type!="ST"||(o[403]=1),(i.type=="QP"||i.type=="QS"||i.type=="SC"||i.type=="OS")&&(o[404]=1),o[8]==1&&(o[27]=o[133]),(i.isAnswer||a==n.GroupType.Cortana)&&(o[55]=o[133]),(i.type=="HS"||i.fromHistory)&&(o[121]=1),o[41]=o[83]==1?o[40]:o[64]==1?o[39]:o[11]==1?o[32]:o[89]==1?o[54]:o[85]==1?o[30]:o[86]==1?o[53]:o[87]==1?o[52]:o[61]==1?o[31]:o[88]==1?o[51]:o[63]==1?o[35]:o[82]==1?o[29]:o[90]==1?o[50]:o[59]==1?o[34]:o[37],n.isSetting(i.type)||n.isApp(i.type)){let n=i.ciMetaData;this.computeConstraintIndexFeatures(i.deviceItem,o,n);i.ciMatchedQuery=this.getConstraintIndexMatchedQuery(n);o[269]&&o[270]&&(o[405]=Math.sqrt(o[269]*o[270]))}return i.signals&&(o[230]=i.signals.DistanceToEntity,o[231]=i.signals.DistanceToEntityPrecision,o[232]=i.signals.RankingScore),o}addLastAccessDate(t,i){let r=n.getTimeDiffInDays(t);r!=null?i[9]=r:i[19]=1}setTypeSignal(n,t){switch(n.type){case"LDOC":case"FL":t[61]=1;break;case"LI":t[85]=1;break;case"LV":t[86]=1;break;case"MU":t[87]=1;break;case"FD":t[88]=1;break;case"CG":t[89]=1;break;case"PT":t[90]=1;break;case"PP":case"IBA":t[1]=1;break;case"ML":case"MD":t[21]=1;break;case"SW":t[59]=1}}setRatios(n,t){t&&t.AppsRatio!==undefined&&(n[26]=t.AppsRatio,t.SettingsRatio&&(n[5]=t.SettingsRatio),t.StoreRatio&&(n[57]=t.StoreRatio),t.PrefixProbability&&(n[12]=t.PrefixProbability),t.FilesRatio&&(n[24]=t.FilesRatio),t.WebRatio&&(n[18]=t.WebRatio),t.PhotosVideosMusicRatio&&(n[28]=t.PhotosVideosMusicRatio),t.ContactsRatio&&(n[56]=t.ContactsRatio),t.LocalProtocolRatio&&(n[91]=t.LocalProtocolRatio))}setThresholdRatios(n,t){t&&t.ThApps!==undefined?(n[40]=t.ThApps,t.ThStore&&(n[35]=t.ThStore),t.ThSetting&&(n[39]=t.ThSetting),t.ThCortAns&&(n[32]=t.ThCortAns),t.ThPrefixCount&&(n[38]=t.ThPrefixCount),t.ThWeb&&(n[29]=t.ThWeb),t.ThSearchTheWeb&&(n[34]=t.ThSearchTheWeb),t.ThOther&&(n[37]=t.ThOther),t.ThFile&&(n[31]=t.ThFile),t.ThFolder&&(n[51]=t.ThFolder),t.ThPath&&(n[50]=t.ThPath),t.ThEmail&&(n[33]=t.ThEmail),t.ThCommAns&&(n[54]=t.ThCommAns),t.ThPhotoAns&&(n[30]=t.ThPhotoAns),t.ThVideoAns&&(n[53]=t.ThVideoAns),t.ThMusicAns&&(n[52]=t.ThMusicAns),t.ThDNav&&(n[147]=t.ThDNav)):n[42]=1}computeConstraintIndexFeatures(n,t,i){if(n&&n.rawIndexResponse){if(!i)return;if(t[157]=i.GrammarScore,t[158]=i.MatchScore,i.Parses&&i.Parses.length>0&&i.Parses[0].Entities&&i.Parses[0].Entities.length>0)for(let n of i.Parses[0].Entities)if(t[159]=n.EntityScore,n.Attributes)for(let i of n.Attributes)i.Name=="gscore"?t[269]=Number(i.Value):i.Name=="lscore"&&(t[270]=Number(i.Value))}}getConstraintIndexMatchedQuery(n){return!n||n.MatchScore==0?null:n.Query}getLocalHourBucket(n){let t=n.getHours(),i=1;return t>=0&&t<6?i=1:t>=6&&t<12?i=2:t>=12&&t<18?i=3:t>=18&&t<=23&&(i=4),i}}t.FastRankRanker=u})(t=n.Ranking||(n.Ranking={}))}(WSB||(WSB={})),function(n){class t{constructor(t){this._instrumentationProvider=t;n.Host.bindDismissed(()=>this.flushAggregatedMeasure(!0));this._keystrokeAggregatedFunctionPerf={}}onNewKeystroke(n,t,i){this.flushAggregatedMeasure();this._aggregatedMeasureFlushed=!1;this._currentLeftPaneSuggestions=null;this._currentRawImpressionGuid=t;this._currentRawClientImpressionGuid=SearchAppWrapper.CortanaApp.impressionId;this._keystrokeAggregatedMeasure={CVID:n,WebView2Info:this._instrumentationProvider.getWebView2Info()};this._keystrokeAggregatedFunctionPerf={};this._currentKeystrokeAggregatedMeasureIsForSearchHome=i}flushAggregatedMeasure(t){if((t||this._currentKeystrokeAggregatedMeasureIsForSearchHome)&&!this._aggregatedMeasureFlushed){if(n.config.logClientPerf){let n=Object.keys(this._keystrokeAggregatedFunctionPerf);if(this._keystrokeAggregatedFunctionPerf&&n.length>0){let t="";for(let i of n){let n=this._keystrokeAggregatedFunctionPerf[i];t+=n.functionName+","+n.numCalls+","+n.totalDuration+";"}t=t.substr(0,t.length-1);this._instrumentationProvider.logProfilerMarker(1,0,"KeystrokeAggregatedFuncPerf",this._currentRawClientImpressionGuid,t)}}else this._keystrokeAggregatedMeasure&&Object.keys(this._keystrokeAggregatedMeasure).length>1&&this.logProfilerMarker(1,0,"KeystrokeAggregatedMeasure",this._currentRawImpressionGuid,this._currentRawClientImpressionGuid,this._keystrokeAggregatedMeasure);this._aggregatedMeasureFlushed=!0}}logSingleMeasure(n,t,i){this.logProfilerMarker(1,0,n,t,SearchAppWrapper.CortanaApp.impressionId||t,i)}logProfilerMarker(n,t,i,r,u,f){f&&typeof f!="string"&&u!=r&&(f.ServerIG=r);this._instrumentationProvider.logProfilerMarker(n,t,i,u,f)}logAggregate(n,t){this._keystrokeAggregatedMeasure[n]=t}logAggregateFunctionPerf(n,t){let i=this._keystrokeAggregatedFunctionPerf[n];this._keystrokeAggregatedFunctionPerf[n]=i?{functionName:i.functionName,numCalls:i.numCalls+1,totalDuration:i.totalDuration+t}:{functionName:n,numCalls:1,totalDuration:t}}getItemLayoutFromSuggestionsList(n){if(this._currentLeftPaneSuggestions){const t=this._currentLeftPaneSuggestions.topResults,i=this._currentLeftPaneSuggestions.groups;for(let i=0;i<t.length;++i)if(t[i].instItem==n)return{IsInTopResult:!0,GroupType:undefined,PositionInGroup:i};for(let t of i)for(let i=0;i<t.suggestions.length;++i)if(t.suggestions[i].instItem==n)return{IsInTopResult:undefined,GroupType:t.typeWithSource.type,PositionInGroup:i}}return undefined}updateSuggestionsList(n,t){this._currentLeftPaneSuggestions={topResults:n,groups:t}}logDataSourcePerformancesMeasure(n){let t=n.RequestBegin,i=Object.keys(n.ResponseReceived).map(i=>({Name:i,ResponseReceivedTime:n.ResponseReceived[i]-t,RenderedTime:n.RenderFinished[i]-t,Status:n.DataSourcesState&&n.DataSourcesState[i]})),r=n.TopResultRendered.map(n=>({Type:n.T,Time:n.V-t})),u={DataSources:i,TopResultRendered:r};this.logAggregate("DataSourcePerformancesMeasure",u)}logNewKeystrokeMeasure(t,i,r){this.onNewKeystroke(t,i,r.isSearchHomeZI);let u={ScopeInQuery:r.scopePrefix,Scope:r.scope,IsSearchHome:r.isSearchHomeZI};u.CIVersion=n.ConstraintIndex.currentCIVersion;this.logAggregate("NewKeystrokeMeasure",u)}logTopResultsRenderedMeasure(n,t){const i=this._instrumentationProvider.getWebView2Info();this._instrumentationProvider.logProfilerMarker(1,0,"topResultRendered",n,"IsWebView2:"+(i.isWebView2?1:0)+",WebView2Version:"+i.webView2Version);let r={SuggestionTypes:t};this.logAggregate("TopResultsRenderedMeasure",r)}logGroupsRenderedMeasure(n){let t={GroupTypes:n};this.logAggregate("GroupsRenderedMeasure",t)}logPreviewPaneOpenedMeasure(t,i,r){const u=this._instrumentationProvider.getWebView2Info();this._instrumentationProvider.logProfilerMarker(1,0,"previewPaneOpened",this._currentRawClientImpressionGuid,n.getPreviewPaneTypeAsString(i)+",IsWebView2:"+(u.isWebView2?1:0)+",WebView2Version:"+u.webView2Version);let f={ParentType:t.getQsCode(),PreviewPaneType:i,ParentLayoutInfo:this.getItemLayoutFromSuggestionsList(t),AutoOpened:r||undefined};this.logAggregate("LastPreviewPaneOpened",f)}logConversationStartMeasure(n){const t=this._instrumentationProvider.getWebView2Info();this.logSingleMeasure("ConversationStartMeasure",n,"IsWebView2:"+(t.isWebView2?1:0)+",WebView2Version:"+t.webView2Version)}logItemClickedMeasure(n,t,i,r){let u={CVID:n,ItemType:i.getQsCode(),InputType:r,LayoutInfo:this.getItemLayoutFromSuggestionsList(i)};this.flushAggregatedMeasure(!0);this.logSingleMeasure("ItemClickedMeasure",t,u)}logFlightState(n,t){this.logSingleMeasure("BingExpFlight",this._currentRawClientImpressionGuid,`FX:${t?1:0}${n}`)}}n.WindowsTelemetry=t}(WSB||(WSB={})),function(n){const t=/[+.\\*?\[\]()]/g,i={".":"\\.","+":"\\+","*":"\\*","\\":"\\\\","?":"\\?","[":"\\[","]":"\\]","(":"\\(",")":"\\)"},r=/^(?:https?:\/\/)?(.*)/,u=/^(?:(?:https?:\/\/(?:www\.)?)|(?:www\.))(.*)/,f=/^\s+/;class e{constructor(){n.Host.bindKeyDown(t=>{n.isUpOrDownKey(t)&&this.reset()});n.Host.bindQueryChangedOrInitialized(n=>{this._currentQuery=n,!this._fullAutoCompletedQuery||this._fullAutoCompletedQuery.startsWith(n.originalQuery)||n.originalQuery.startsWith(this._fullAutoCompletedQuery)||this.reset()})}apply(t){if(t.query!=this._autoCompletedQuery){let i=this._currentQuery.originalQuery;if(n.Host.setAutoCompleteQueryText(""),this._currentQuery.originalCursorPosition===i.length){let u=this._currentQuery.scopePrefix?this._currentQuery.scopePrefix.length+1:0,n=i.substr(u).replace(f,"").toLowerCase(),r=t.query.toLowerCase();if(n!==r){let f=1,u=this.fullAutoCompleteOffset(r,n);if(u<0&&t.url&&(u=this.infixAutoCompleteOffset(r,n),f=2),u<0&&(u=this.directNavAutoCompleteOffset(r,n)),u>=0){this.setAutoCompletedQuery(i,t.query,u);t.autoCompleteType=f;return}}}this._autoCompletedQuery&&(this.reset(),n.Host.setAutoCompleteQueryText(i))}}reset(){this._autoCompletedQuery=null;this._fullAutoCompletedQuery=null}fullAutoCompleteOffset(n,t){let i=n.startsWith(t);return i?t.length:-1}infixAutoCompleteOffset(n,u){let f=n.search("[ .:,\\\\/+_&-]"+u.replace(t,n=>i[n]));if(f>0){let t=n.substring(0,f+1).match(r)[1],i=t?t.match(/[ .:,\\/+_&-]+/g).length+1:1;if(i<3)return f+1+u.length}return-1}directNavAutoCompleteOffset(n,t){let i=t.match(u);if(i){let t=i[1];if(t.length>0&&n.startsWith(i[1]))return t.length}return-1}setAutoCompletedQuery(t,i,r){let u=t+i.slice(r);n.Host.setAutoCompleteQueryText(u);this._autoCompletedQuery=i;this._fullAutoCompletedQuery=u}}n.WSBAutoComplete=e}(WSB||(WSB={})),function(n){var t;(function(t){function s(n){return{fullySuppressedGroups:n.fullySuppressedGroups?n.fullySuppressedGroups.slice(0):[],partiallySuppressedGroups:n.partiallySuppressedGroups?n.partiallySuppressedGroups.slice(0):[],suppressedSuggestions:n.suppressedSuggestions?n.suppressedSuggestions.slice(0):[]}}function f(n){return n.type=="SW"||n.type=="PWL"}function i(n,t){return!n.suppressed&&n.handoffType==0&&!n.htmlContent&&n.query.toLocaleLowerCase()==t.queryToFetch.toLocaleLowerCase()}function e(n){return n.length>=2&&n[0].type=="MB"&&n[1].type=="MB"}function o(n,t){return t&&n.length>1&&n[0].type=="MB"?1:2}let r;(function(n){n[n.NotDuplicate=0]="NotDuplicate";n[n.NoMetadata=1]="NoMetadata";n[n.MergeMetadata=2]="MergeMetadata"})(r||(r={}));const u={"{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}\\cmd.exe":{appToPromote:"Microsoft.WindowsTerminal_8wekyb3d8bbwe!App",enabled:n.config.promoteTerminalOverCmd},"Microsoft.Windows.MediaPlayer32":{appToPromote:"Microsoft.ZuneMusic_8wekyb3d8bbwe!Microsoft.ZuneMusic",enabled:n.config.demoteWindowsMediaPlayer}};t.isWebSuggestionForPrefix=i;t.topHitIsMultiEntity=e;t.getTopHitNumbersForMultiEntity=o;class h{constructor(t,i,r,u,f,e,o,s){this._navigationHelper=t;this._previousKeystrokeCache=i;this._conversationCache=r;this._ranker=u;this._renderedTopResults=f;this._previewPane=e;this._imageSearchViewModel=o;this._upsellViewModel=s;n.config.enableConversationCache&&this._conversationCache&&n.Host.bindDismissed(()=>{this._conversationCache.clean()})}launchWebSearch(t,i,r,u,f){let e=t.queryToFetch;n.Host.launchSearchAsync(e,this._navigationHelper.getSearchUrl(t.fullPartialQuery,e,r,null,u,undefined,undefined,undefined,undefined,f),i,r)}getProtocol(t,i){let u="PWL",r=n.InstrumentationHelper.getInstrumentedSyntheticSuggestion(i,u);if(r)return r;r=n.createSuggestion(t,null,n.Host.getEdgeIcon,null,u,null,n.InstrumentedItem.getNonSuggestionInstrumentedItem(u,n.SyntheticQSCodesMaps.KValues),1,i,!1,"tp",()=>n.Host.launchUrlWithEdgeProtocolAsync(r.url,{medium:"MSBLink"}));r.notAResult=!0;let f=t=>{let i=n.prettyPrintUrl(t.fixedUrl,t.queryToFetch,!0);r.url=t.fixedUrl;r.tooltip=t.fixedUrl;r.query=i;r.text=HitHighlightingParser.addMarkers(i);r.narratorText=n.getNarratorText(r,n.Host.getLocString("DirectNavSuggestion"));r.reactKey=u+t.fixedUrl};return f(t),r.updateFromQuery=n=>n.isProtocol?(f(n),!0):!1,n.InstrumentationHelper.instrumentSyntheticSuggestion(i,r),r}getWebSearch(t,i,r,u,f,e){let o=n.contains([13,14],f);return n.getSyntheticSuggestion(t,i,r,u,f,e,o,(n,t)=>this.launchWebSearch(t,n.useRaf,r,f,n.msbVerticalHash))}getExplorerSearch(t,i){let r=n.getSyntheticSuggestion(t,i,"SDFE",{content:"&#xEC50",type:1},2,n.Host.getLocString("SearchInFileExplorer"),!0,(t,i)=>n.Host.launchSearchInFileExplorer(i.queryToFetch));return n.shouldSetThisPcGroupSource(n.GroupType.Documents,t)&&(r.sourceForGroup=1),r}getOutlookWebAccessSearch(t,i){let r=n.AccessTokenManager.getWindowsAccountType()==1;return n.getSyntheticSuggestion(t,i,"OWA",{content:"&#xE715",type:2},r?8:12,n.Host.getLocString("SearchInOutlookWeb"),!0,()=>n.Host.launchUrlWithEdgeProtocolAsync(r?"https://outlook.office.com/owa":"https://outlook.live.com/owa",{medium:"MSBLink"}))}getStoreSearch(t,i){return n.getSyntheticSuggestion(t,i,"STS",{content:"&#xEA96",type:2},3,n.Host.getLocString("SearchForAppsInTheStore"),!0,(t,i)=>n.Host.launchStoreSearchAsync(i.queryToFetch))}getRecourse(t,i){var r;if(!t.queryToFetch||t.taskFrame)return null;switch(n.getEffectiveScope(t)){case n.Scope.Apps:return n.isBingEnabled()&&((r=SearchAppWrapper.CortanaApp.isStoreAppEnabled)!==null&&r!==void 0?r:!0)?this.getStoreSearch(t,i):null;case n.Scope.Documents:return this.getExplorerSearch(t,i);case n.Scope.Emails:return n.ScopeConfig[n.Scope.Emails].showUpsellOnSuggestionsList()?null:this.getOutlookWebAccessSearch(t,i);case n.Scope.Photos:return n.isBingEnabled()?this.getWebSearch(t,i,"SBI",{content:"&#xEB9F",type:2},13,n.Host.getLocString("SearchForWebImages")):null;case n.Scope.Videos:return n.isBingEnabled()?this.getWebSearch(t,i,"SBV",{content:"&#xE714",type:1},14,n.Host.getLocString("SearchForWebVideos")):null;default:return null}}getSyntheticSuggestions(t,i){const h=n.getScopeConfig(t),c=h.webSyntheticEnabled&&h.webSyntheticEnabled(t),u=0,e="SW";var r;c&&(n.shouldQFSuggToBingChat(u,t.originalQuery,"SW")?(r=n.getSyntheticSuggestion(t,i,e,undefined,u,n.getWebSuggestionAnnotation(),!1,(t,i)=>n.Host.launchSearchAsync(i.queryToFetch,this._navigationHelper.getSearchUrl(i.fullPartialQuery,i.queryToFetch,e,n.appendBingChatParams(`/search?q=${n.encodeQueryParameter(i.queryToFetch)}`),u,"WSBQFC"),t===null||t===void 0?void 0:t.useRaf,"WSBQFC")),n.setSearchSuggestionChatIcon(r),n.getGroupType(r)===n.GroupType.ChatWithBing&&(r.primaryMetadata=n.Host.getLocString("CodexChatButtonUpperRight"))):r=this.getWebSearch(t,i,e,n.getSearchSuggestionIcon(),u,n.getWebSuggestionAnnotation(n.msbEnabledForQuery(t))));const l=t.isProtocol&&n.RuntimeConfig.AllowProtocolSyntheticSuggestions?this.getProtocol(t,i):null,o=this.getRecourse(t,i);o&&(o.rankingScore=-Number.MAX_VALUE);const f=[];t.scope==n.Scope.All&&t.isSearchHomeZI&&n.msbHost&&n.msbHost.qfUtils.isDocumentZeroQueryEnabled()&&n.msbHost.features.isQwsEnabled()&&n.isMsbEnterprise()&&!n.msbHost.isGccHighTenant()&&f.push(n.msbHost.qfUtils.getOnRampButtonSuggestion(t,i));this._imageSearchViewModel&&t.isSearchHomeZI&&t.scope==n.Scope.All&&f.push(this._imageSearchViewModel.getSnipSearchSyntheticSuggestion(t,i));this._upsellViewModel&&f.push(this._upsellViewModel.getUpsellSyntheticSuggestion(t,i));let s=[];if(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isWorkScopeApplicable()){s=n.msbHost.verticalManager.getSyntheticSuggestions(t,i);for(const n of s)if(n&&(n.click=()=>this.launchWebSearch(t,n.useRaf,n.type,n.handoffType,n.msbVerticalHash),n.childSuggestions!=undefined))for(const i of n.childSuggestions)i.click=()=>this.launchWebSearch(t,i.useRaf,i.type,i.handoffType,i.msbVerticalHash)}return{protocol:l,searchTheWeb:r,recourse:o,msbVerticals:s,others:f.filter(n=>!!n)}}canHaveDuplicates(t,i){switch(t){case"Web":case"MRU":case"MWS":case"RWQ":case"OSTMA":case"MSBC":case"QS":case"PP":case"IBA":case"LRA":case"ST":case"FL":case"LM":case"IFF":case"CG":case"PT":case"MPP":case"MST":case"MFF":case"MRS":case"MPVD":case"MDOC":case"MFOL":case"MPHO":case"MVID":case"MMUS":case"SSUE":case"SSUC":case"ANA":case"QWQS":return!0;case"FEH":case"TOPP":case"QSCH":case"TS":case"DFLS":case"CUSE":case"SREE":return!1;case"SSEE":return i.scope==n.Scope.Documents||i.scope==n.Scope.Emails||n.RuntimeConfig.QfMode==5;case"SSEC":return i.scope==n.Scope.Emails}throw new Error("New data source "+t+" needs to be explicity classified as needed deduping with other data sources or not");}canHaveDuplicatesWithinDataSource(t,i){switch(t){case"MPP":case"MST":case"MRU":case"ST":case"MSBC":case"MWS":return!0;case"SSEE":case"SSEC":return i.scope==n.Scope.Emails}return n.supportsShortcuts(t,i)}mergeDuplicates(t,i,u){let f=n.isDuplicate(t,i,u);return f?(i.type==="MFIL"||u.type==="MFIL")&&n.config.msbReplaceDupLocalFiles&&u.type==="MFIL"?!0:(f==r.MergeMetadata&&n.enrichMetadataFromDuplicate(t,i,u),i.duplicates=i.duplicates||[],n.contains(i.duplicates,u)||(i.duplicates.push(u),i.needsRefreshAfterDeduping=!0,i.previewPaneNeedsRefreshAfterDeduping=f==r.MergeMetadata),!0):!1}rank(t,r,u,f,e,o,h){var tt,b;const ft=n.isL2(f);ft&&(h=!1);let p=u.Web,it=p?p.rankingSignals:null,ct=p?p.webTopResultRoutingType:1,k=u.MRU,et=null,a=null,ot=null;if(it&&(it.WebSignalsAvailable=!0,et=p.engagementSignals,a=p.suppressedGroups,(n.config.groupsToNeverFullySuppress||[]).length>0&&a&&(a.fullySuppressedGroups||[]).length>0)){let t=[],i=[];a.fullySuppressedGroups.forEach(r=>{n.contains(n.config.groupsToNeverFullySuppress,r)?t.push(r):i.push(r)});t.length>0&&(a=s(a),a.fullySuppressedGroups=i,a.partiallySuppressedGroups.push(...t))}this._previousKeystrokeCache&&(ot=this._previousKeystrokeCache.getPreviousEventWebSignalsData(f.queryToFetch));let lt=k?k.SuggestionEngagementData:null,at=k?k.LookupCompletions:null,vt={cvid:n.Host.getConversationId(),privacyNumber:n.Host.getPrivacyNumber()},v=this.getSyntheticSuggestions(f,o);if(f.scope!=n.Scope.Web&&n.config.enableSearchTheWebMaxSuggestions){let i=[n.GroupType.SearchSuggestions,n.GroupType.Websites];n.limitWebSuggestions(f,t,r,i,["ANAH","ANAR","ANATH"])}if(r=r.slice(),a&&(a.fullySuppressedGroups&&a.fullySuppressedGroups.length>0&&(this.removePromotedFSUPGroups(r,a.fullySuppressedGroups),r=r.filter(t=>!n.contains(a.fullySuppressedGroups,String(this.getGroupTypeForSuppressions(t))))),a.suppressedSuggestions&&a.suppressedSuggestions.length>0&&(r=r.filter(t=>!n.contains(a.suppressedSuggestions,n.getSuggestionKey(t))))),n.config.suppressFileFolders&&f.queryToFetch.length<n.config.maxPrefixLengthForSupp&&f.scope==n.Scope.All){let t=[n.GroupType.Documents,n.GroupType.Folders];r=r.filter(i=>!n.contains(t,n.getGroupType(i)))}t.length==0&&(v.others.length>0&&r.unshift(...v.others),v.protocol&&r.unshift(v.protocol),((tt=v.msbVerticals)===null||tt===void 0?void 0:tt.length)>0&&(v.msbVerticals[0].isQfWorkSuggestionMode=r.length>=1,r.push(...v.msbVerticals)));this.ensureUniqueReactKeys(r);let d=e.length==1&&e[0].childSuggestions&&e[0].childSuggestions.some(n=>n.displayed),w=this.getSuggestionsToRank(d,t,r,v,o);n.config.bypassRankerOnNoNewSuggestions&&r&&r.length&&(f.hasNewSuggestions=!0);let g=[];if(n.config.enableConversationCache&&this._conversationCache&&!n.isL2(f)&&(this._conversationCache.refreshPartialQuery(f.queryToFetch),g=n.config.enableConversationCacheSearchTheWeb?w.filter(n=>this.shouldCacheSuggestion(n,f)&&n.handoffType==0):w.filter(n=>this.shouldCacheSuggestion(n,f)&&n.type!="SW"),g.length>0&&f.queryToFetch.length>0)){let i=!1;t.some(n=>n.type=="SW")&&(i=!0);t=this._conversationCache.retrieveSuggestionsFromCache(!0);for(b in t)t[b].sequenceNumber!=o&&(t[b].sequenceNumber=o,t[b].instItem=n.InstrumentedItem.createInstrumentedItem(o,t[b].type));r=g;w=this.getSuggestionsToRank(d,t,r,v,o);i&&v.searchTheWeb&&t.push(v.searchTheWeb)}let nt=this._ranker.rank(f,w,it,lt,at,et,vt,ot,v);this._previousKeystrokeCache&&!h&&this._previousKeystrokeCache.updateSpellerTriggerData(f.queryToFetch,w);t.length==0&&v.recourse&&r.push(v.recourse);let l=this.determineTopResults(e,r,nt,v,f,o,d);if(n.config.enableWebSynonymScoreTopHit&&((f===null||f===void 0?void 0:f.queryToFetch.toLowerCase())==="skype"||(f===null||f===void 0?void 0:f.queryToFetch.toLowerCase())=="skyp")&&((f===null||f===void 0?void 0:f.scope)==n.Scope.All||(f===null||f===void 0?void 0:f.scope)==n.Scope.Apps)){let n=t.find(n=>Math.abs(n.prefetchConfidenceScore-1e4)<Number.MIN_VALUE);n||(n=t.find(n=>{var t;if((t=n.duplicates)!==null&&t!==void 0)return t.some(n=>Math.abs(n.prefetchConfidenceScore-1e4)<Number.MIN_VALUE)}));n&&(l.length==0?l.push(n):l[0]!==n&&(l[1]=l[0],l[0]=n))}let rt=t.filter(t=>!n.contains(e,t)),y=this.determineSuggestionsToAddToGroups(ft,rt,r,e,l,v,f,d,h);if(!n.RuntimeConfig.FlatListWithoutGroups&&nt.mruSuppressions&&nt.mruSuppressions.backPropDataExists)this.applyMRUSuppressions(nt,e,l,y,f);else if(a&&a.partiallySuppressedGroups&&this.canPartiallySuppressGroups(l,y,f))for(let t of y)if(!i(t,f)){let i=this.getGroupTypeForSuppressions(t);if(this.canBePartiallySuppressed(t,i)&&n.contains(a.partiallySuppressedGroups,String(i))&&!n.contains(e,t)){if(t.sequenceNumber<n.config.minSequenceForPSUP)continue;t.suppressed=!0}}if(n.config.enableQFChatWithBingSuggestions){let i=[],t=[];for(let r of y)if(r&&n.getGroupType(r)===n.GroupType.SearchSuggestions&&r.type!="MB"&&n.shouldQFSuggToBingChat(r.handoffType,r.query,r.type)){let u=n.deepCopy(r);u.staticGroupType=n.GroupType.ChatWithBing;u.primaryMetadata=n.config.enableReBalanceWebChatSuggestion?n.Host.getLocString("CodexChatButtonUpperRightNew"):n.Host.getLocString("CodexChatButtonUpperRight");u.instItem=n.InstrumentedItem.createInstrumentedItem(o,r.type);i.push(u);n.config.enableQFChatdupSuggestion&&(r.id+="_dup",r.icon=n.getSearchSuggestionIcon(),r.handoffType=0,r.click=()=>n.Host.launchSearchAsync(r.query,this._navigationHelper.getSearchUrl(r.query,r.query,"SW",null,0,undefined,undefined,undefined,undefined),r===null||r===void 0?void 0:r.useRaf),r.reactKey+="dup",t.push(r))}else t.push(r);n.InstrumentationHelper.instrumentDataSource(o,"Web",i,null);t=t.concat(i);y=t.slice()}let ut=[];this.removeProtocolIfDuplicate(f,v,l,rt,y,ut);this.setUseRafFlag(l,y,f,ct);let c=this.getGroupOrder(f,y,rt);if(f.staticGroupOrder){let n=[];for(let t of f.staticGroupOrder){let i=c.findIndex(n=>n.type==t);i>=0&&(n.push(c[i]),c.splice(i,1))}n.length>0&&(n.push(...c),c=n)}else if(f.forceGroupOnTop){let i=f.forceGroupOnTop,t=c.findIndex(t=>n.sameGroup(t,i));if(t>=0&&(c.splice(t,1),c.unshift(i)),t=c.findIndex(t=>n.isTopHitChildGroup(t)),t>=0){let n=c[t];c.splice(t,1);c.unshift(n)}}if(n.RuntimeConfig.FlatListWithoutGroups&&(l=l.concat(y.filter(n=>!n.suppressed)),y=[],n.trimList(l,n.RuntimeConfig.MaxSuggestionsWhenFlatList,i=>!n.contains(t,i)&&!i.notAResult),ut.length!=0))throw new Error("Can't remove suggestions from groups when there are no groups");if(n.config.promoteEdgeOverIE&&this.promoteEdgeOverInternetExplorer(y,l),n.config.transitionIEToEdge&&this.transitionInternetExplorerToEdge(l),n.config.enablePartnerPromotions&&this.promotePartnerSuggestions(y,l,f.queryToFetch),n.config.enablePromoteWebSuggestionsGroup&&l.length>0){const t=n.isApp(l[0].type);if(t){let t=c.findIndex(t=>t.type==n.GroupType.SearchSuggestions);if(t!==-1&&t!==0){let n=c.splice(t,1);c.splice(0,0,n[0])}}}if(n.config.enablePromoteWebSuggestionsGroupForAll&&f.scope==n.Scope.All){let t=c.findIndex(t=>t.type==n.GroupType.SearchSuggestions),i=c.findIndex(t=>t.type==n.GroupType.Related);if(i!==-1&&i==0){if(t!==-1&&t!==0){let n=c.splice(t,1);c.splice(1,0,n[0])}}else if(t!==-1&&t!==0){let n=c.splice(t,1);c.splice(0,0,n[0])}}let yt=c.slice(0);const st=l.filter(t=>n.isMsbQFSuggestion(t)).length>0,ht=l.filter(t=>n.isWebSuggestion(t)||t.isAnswer).length>0;if(st?c=this.promoteMsbSuggestions(l,c):ht&&(c=this.promoteMsbSuggestionsAboveWeb(c)),(ht||st)&&y.forEach(t=>{if(n.isMsbQFSuggestion(t)){const i=n.getGroupType(t);this.isMsbGroupTypePromoted(i,yt,c)&&(t.suppressed=!1)}}),n.config.enableConversationCache&&this._conversationCache&&!n.isL2(f)&&g.length>0&&f.queryToFetch.length>0&&(this._conversationCache.setTopResultCount(l.length),this._conversationCache.setSuggestions(w)),n.config.trendingSearchAboveTiles){let t=c.findIndex(t=>t.type==n.GroupType.TopApps||t.type==n.GroupType.AnaheimDataTile),i=c.findIndex(t=>t.type==n.GroupType.TrendingSearchData);if(t!==-1)if(i!==-1){let r=c.splice(i,1);if(c.splice(t,0,r[0]),n.config.anaheimDataListAboveTiles){let i=c.findIndex(t=>t.type==n.GroupType.AnaheimDataList);if(i!==-1){let n=c.splice(i,1);c.splice(t+1,0,n[0])}}}else if(n.config.anaheimDataListAboveTiles){let i=c.findIndex(t=>t.type==n.GroupType.AnaheimDataList);if(i!==-1){let n=c.splice(i,1);c.splice(t,0,n[0])}}}else if(n.config.anaheimDataListAboveTiles){let t=c.findIndex(t=>t.type==n.GroupType.TopApps||t.type==n.GroupType.AnaheimDataTile),i=c.findIndex(t=>t.type==n.GroupType.AnaheimDataList);if(t!==-1&&i!==-1){let n=c.splice(i,1);c.splice(t,0,n[0])}}if(n.config.trendingSearchInWin11LeftPane){const i=c.findIndex(t=>t.type===n.GroupType.MRUHistory),t=c.findIndex(t=>t.type===n.GroupType.TrendingSearchData);i==-1&&t>-1&&(c.splice(t,1),y=y.filter(n=>n.type!=="TS"))}return{topResults:l,suggestionsToAdd:y,suggestionsToRemove:ut,groupOrder:c}}isMsbGroupTypePromoted(t,i,r){let u=-1,f=-1;return t===n.GroupType.Documents?(u=i.findIndex(n=>this.isMsbFileGroupType(n)),f=r.findIndex(n=>this.isMsbFileGroupType(n))):(u=i.findIndex(n=>n.type===t),f=r.findIndex(n=>n.type===t)),f<u}promoteMsbSuggestionsAboveWeb(t){const f=t.filter(t=>t.type==n.GroupType.SearchSuggestions);if(f.length==0)return t;let r=t.filter(n=>this.isMsbGroupTypes(n));if(r.length==0)return t;t=t.filter(n=>!this.isMsbGroupTypes(n));const u=t.findIndex(t=>t.type==n.GroupType.SearchSuggestions);let i=t.slice(0,u);i.push(...r);const e=t.slice(u);return i.push(...e),i}isArithmeticExpression(n){return/^[\+\-]?(\d+(\.\d+)?[\+\-\*\/\^])+(\d+(\.\d+)?)$/.test(n)}promoteMsbSuggestions(t,i){let r=i.filter(n=>this.isMsbGroupTypes(n));const u=r.filter(t=>t.type===n.GroupType.Bookmarks);u.length>0&&(r=r.filter(t=>t.type!==n.GroupType.Bookmarks),r.unshift(...u));const f=t.filter(t=>n.isMsbQFSuggestion(t)&&(t.type==="MPPL"||t.type==="MFIL")).length>0;if(f){const n=r.filter(n=>this.isMsbFileGroupType(n));n.length>0&&(r=r.filter(n=>!this.isMsbFileGroupType(n)),r.unshift(...n))}return r.length>0&&(i=i.filter(n=>!this.isMsbGroupTypes(n)),i.unshift(...r)),i}removePromotedFSUPGroups(t,i){for(let r in n.config.disableFSUPPartnerAppIds){let u=t[t.findIndex(n=>n.deviceItem&&n.deviceItem.id==r)];if(u){let t=this.getGroupTypeForSuppressions(u).toString();n.contains(i,t)&&n.tryRemove(i,t)}}}shouldCacheSuggestion(t,i){let u=this._conversationCache.isSuggestionCached(t,i);if(u)return this._conversationCache.update(t),!1;let r=this._conversationCache.retrieveSuggestionsFromCache(!0);for(let n of r)if(t.query==n.query&&t.handoffType==n.handoffType){if(t.type=="SW"&&n.type!="SW"&&n.handoffType==0)continue;return!1}if(r.length>50)SharedLogHelper.LogError("shouldCacheSuggestion","We should not cache more than 50 suggestions "+i.queryToFetch);else for(let u of r)!n.isDuplicate(i,u,t)&&this._conversationCache.isCached(t)&&SharedLogHelper.LogError("shouldCacheSuggestion","Suggestion found that was not a duplicate of suggestion in cache "+this._conversationCache.createKeyFromSuggestion(t));return!0}transitionInternetExplorerToEdge(t){var r;let i=(r=n.Host.getQuery().originalQuery)===null||r===void 0?void 0:r.toLowerCase();if(i==="ie"||(i===null||i===void 0?void 0:i.startsWith("internet e"))){let i=t.findIndex(t=>t.deviceItem&&n.contains(n.AnaheimAppIds,t.deviceItem.id));if(i>=0){t[i].primaryMetadata=n.Host.getLocString("EdgeToIEUpsell");t[i].classNames.twoLineMax||t[i].classNames.push("twoLineMax");let r="&ciaid=actpermedge&source=windowsSearch";t[i].click=n.config.useCobaltCSS?()=>n.Host.launchUrlWithEdgeProtocolAsync("https://go.microsoft.com/fwlink/?linkid=2181241"+r,{medium:"MSBLink"}):()=>n.Host.launchUrlWithEdgeProtocolAsync("https://go.microsoft.com/fwlink/?linkid=2181242"+r,{medium:"MSBLink"})}}}promoteEdgeOverInternetExplorer(t,i){let r=i.findIndex(t=>t.deviceItem&&t.deviceItem.id==n.InternetExplorerId),u=t.findIndex(t=>t.deviceItem&&n.contains(n.AnaheimAppIds,t.deviceItem.id));r>=0&&u>=0&&(i.unshift(t.splice(u,1)[0]),t.unshift(i.splice(r+1,1)[0]))}promotePartnerSuggestions(n,t,i){for(let r in u)if(u[r].enabled){let e=t.findIndex(n=>n.deviceItem&&n.deviceItem.id==r),f=n.findIndex(n=>n.deviceItem&&n.deviceItem.id==u[r].appToPromote);e>=0&&f>=0&&n[f].query.toLocaleLowerCase().includes(i)&&(t.unshift(n.splice(f,1)[0]),n.unshift(t.splice(e+1,1)[0]))}}applyMRUSuppressions(t,r,u,f,e){if(this.canPartiallySuppressGroups(u,f,e)){const o=3.34728026,s=3.523466,h=3.72204852,c=.5865976,l=1.37432766,a=-1.75450325;let u={};for(let v of f)if(!i(v,e)){let i=n.getGroupType(v);if(this.canBePartiallySuppressed(v,i)){if(!u[i]){let r=t.mruSuppressions.maxGroupCCR?t.mruSuppressions.maxGroupCCR[i]||0:0,f=t.mruSuppressions.maxGroupProbSugClickGivenPref?t.mruSuppressions.maxGroupProbSugClickGivenPref[i]||0:0,e=t.mruSuppressions.mruGroupRatios?t.mruSuppressions.mruGroupRatios[i]||0:0,v=t.mruSuppressions.mruGroupBackpropRatios?t.mruSuppressions.mruGroupBackpropRatios[i]||0:0,y=t.mruSuppressions.mruGroupBackpropWeights?t.mruSuppressions.mruGroupBackpropWeights[i]||0:0,p=o*r+s*f+h*e+c*v+l*y+a,w=1/(1+Math.exp(-p));u[i]=n.trimFeatureStoreValue(w)}v.mruSuppressionScore=u[i];let f=this.getGroupSuppressionCutOff(v);v.mruSuppressionScore<f&&(n.contains(r,v)||(v.suppressed=!0))}}}}getGroupSuppressionCutOff(t){return n.config.msbUseSuppressionsThreshold&&n.isMsbQFSuggestion(t)?n.config.msbSuppressionsThreshold:n.config.lRModelCutOff}isMsbFileGroupType(t){return t.type===n.GroupType.Documents&&t.source===7?!0:!1}isMsbGroupTypes(t){return t.type===n.GroupType.People||t.type===n.GroupType.Bookmarks?!0:this.isMsbFileGroupType(t)?!0:!1}allowedInGroups(n){return n.isAnswer?n.allowedInGroups:!0}getGroupTypeForSuppressions(t){let i=n.getGroupType(t);return i==n.GroupType.LocalPlaces?n.GroupType.SearchSuggestions:i}canBePartiallySuppressed(t,i){return n.getScope(i)!=n.Scope.All}canPartiallySuppressGroups(t,i,r){return t.every(n=>!n.query.toLocaleLowerCase().includes(r.queryToFetch))?!1:n.RuntimeConfig.ScopesAvailable?t.every(t=>n.getGroupType(t)==n.GroupType.SearchSuggestions)&&i.every(t=>n.getGroupType(t)==n.GroupType.SearchSuggestions)?!1:!0:!1}isProtocolDuplicate(t,i,r){return t==r?!1:t.type=="MD"?!0:t.handoffType==1&&n.isDuplicateUrl(i,t.url,r.url)}removeProtocolIfDuplicate(t,i,r,u,f,e){if(i.protocol){let o=n=>!n.suppressed&&this.isProtocolDuplicate(n,t,i.protocol);if(r.some(o)||u.some(o)||f.some(o)){if(n.tryRemove(r,i.protocol)){if(!r.length){let t=n.removeFirstWhere(u,o)||n.removeFirstWhere(f,o);r.push(t)}}else n.tryRemove(f,i.protocol)||n.contains(u,i.protocol)&&(n.config.enableConversationCache||e.push(i.protocol));i.protocol=null}}}getSuggestionsToRank(t,i,r,u){t&&(i=i.filter(t=>!n.isChildSuggestion(t)));u.recourse&&(i=i.filter(n=>n!=u.recourse));let f=i.concat(r);return n.config.enableConversationCache&&this._conversationCache?u.searchTheWeb&&!n.contains(f,u.searchTheWeb)&&f.push(u.searchTheWeb):u.searchTheWeb&&!n.contains(i,u.searchTheWeb)&&f.push(u.searchTheWeb),n.config.topHitMuse&&f.forEach(n=>{var t,i,r,u;return n.tooltip="Rank:"+((t=n.rankingScore)===null||t===void 0?void 0:t.toString())+" launch:"+((i=n.anaheimRankingSignals)===null||i===void 0?void 0:i.visitCount)+" DateV:"+((u=(r=n.anaheimRankingSignals)===null||r===void 0?void 0:r.dateVisited)===null||u===void 0?void 0:u.toString())}),f}determineTopResults(t,r,u,s,h,c,l){var y,p,v;if(l||!h.queryToFetch)return t;if(n.config.enableArithmeticToSWTopHit&&n.RuntimeConfig.QfMode!=5&&(h===null||h===void 0?void 0:h.scope)==n.Scope.All&&!n.isNullOrUndefined(s===null||s===void 0?void 0:s.searchTheWeb)&&this.isArithmeticExpression(h.queryToFetch)){let n=r.find(n=>(n===null||n===void 0?void 0:n.query)===s.searchTheWeb.query&&n.type!="SW");if(t.length==0)return t[0]=n?n:s.searchTheWeb,t;if(!t[0].isAnswer&&t[0].query!=s.searchTheWeb.query)return t[1]=t[0],t[0]=n?n:s.searchTheWeb,i(t[1],h)&&t.splice(0,1),t}if(n.config.stickyTopResultsV2&&t.length>1&&!n.isL2(h))if((n.config.enableBoostWebAnswer||n.config.enableBoostSWAnswer)&&h.scope==n.Scope.All){if(!(t.length==2&&(n.isApp(t[0].type)||n.isSetting(t[0].type)||n.isFileOrFolder(t[0].type))&&(t[1]==s.searchTheWeb||n.isWebSuggestion(t[1])||t[1].type=="MB")))return t}else if(n.config.enablePutASInSecondTopHit&&h.scope==n.Scope.All){if(!(t.length==2&&(t[1]==s.searchTheWeb||n.isWebSuggestion(t[1])||t[1].type=="MB")))return t}else if(n.config.promoteAS2SecondTopWhenTopHitIsFLorFD&&h.scope==n.Scope.All){if(!(t.length==2&&n.isFileOrFolder(t[0].type)&&(t[1]==s.searchTheWeb||n.isWebSuggestion(t[1])||t[1].type=="MB")))return t}else return t;if(h.inorganic&&h.queryToFetch){if(t.length>0)return t;if(((y=s.searchTheWeb)===null||y===void 0?void 0:y.query)===h.queryToFetch)return t.push(s.searchTheWeb),t}let a=u.topResults,w=this._previewPane?this._previewPane.getPreviewedSuggestionToForceTopHit():null;if(w&&this._ranker.allowInTopHit(h,w)){let i=t=>n.isEquivalentForPreviewPanePurposes(h,w,t),u=a.findIndex(i);if(u!=0){let n;u>0?(n=a[u],a.splice(u,1)):n=t.find(i)||r.find(i)||(s.searchTheWeb?[s.searchTheWeb]:[]).find(i);n&&a.unshift(n)}}if(s.protocol&&s.searchTheWeb&&this._ranker.allowInTopHit(h,s.protocol)&&n.tryRemove(a,s.searchTheWeb),s.searchTheWeb){let n=a.indexOf(s.searchTheWeb);n>=0&&a.some(n=>n!=s.searchTheWeb&&i(n,h))&&a.splice(n,1)}a.length==0&&(n.config.stickyTopResultsV2&&n.config.enableBoostWebAnswer&&h.scope==n.Scope.All&&t.length==2&&(n.isApp(t[0].type)||n.isSetting(t[0].type)||n.isFileOrFolder(t[0].type))&&t[1]==s.searchTheWeb?a.push(t[0]):n.config.stickyTopResultsV2&&t.length>0&&h.scope==n.Scope.All&&t.length==2&&(n.config.enablePutASInSecondTopHit||n.config.promoteAS2SecondTopWhenTopHitIsFLorFD)&&(n.isWebSuggestion(r[1])||r[1].type=="MB"||t[1]==s.searchTheWeb)?a.push(t[0]):n.config.stickyTopResultsV2&&t.length>0?a.push(...t):s.protocol&&this._ranker.allowInTopHit(h,s.protocol)?a.push(s.protocol):s.searchTheWeb&&this._ranker.allowInTopHit(h,s.searchTheWeb)?a.push(s.searchTheWeb):s.recourse&&this._ranker.allowInTopHit(h,s.recourse)&&a.push(s.recourse));let d=o(a,n.config.enableThumbnailFocusUI),b=n.getEffectiveScope(h)==n.Scope.Emails?n.config.maxNumberOfEmailsInTopResult:Math.max(n.config.maxNumberOfTopResults,e(a)?d:0,t.length);if(n.config.bypassFallbackOnMSBTopHit==4&&a.length>0&&n.isMsbOnlineSuggestionType(a[0].type)&&(b=2),a.length>b&&(a=a.slice(0,b)),n.config.synthWebNoBestMatch&&a.length==1){let t=[n.GroupType.SearchSuggestions,n.GroupType.Websites],i=r.filter(i=>!n.contains(t,n.getGroupType(i))),u=a.filter(i=>!n.contains(t,n.getGroupType(i)));i.length==0&&u.length==0&&(a=[])}for(let i=t.length-1;i>=0;--i){let u=t[i];if(!n.contains(a,u)){if(n.config.enableConversationCache&&a.some(t=>n.isDuplicate(h,u,t)))continue;u.useRaf&&(u.useRaf=!1);u!=s.searchTheWeb&&r.unshift(u)}}a.length==1&&n.safeExecute(()=>this.applyAppOverride(a,r),"applyDeviceInfoOverride");a.forEach(n=>n.suppressed=!1);let k=n.isL2(h);if(n.config.stickyTopResultsV2&&a.length==1&&t.length==1&&!k){let r=a[0],i=t[0];r==i||f(i)||n.config.msbDisableStickyWeb&&n.isWebSuggestion(i)&&n.isMsbOnlineSuggestionType(r.type)||a.unshift(i)}else if((n.config.enablePutASInSecondTopHit||n.config.promoteAS2SecondTopWhenTopHitIsFLorFD)&&n.config.stickyTopResultsV2&&a.length==1&&t.length>1&&!k){let r=a[0],i=t[0];r==i||f(i)||n.config.msbDisableStickyWeb&&n.isWebSuggestion(i)&&n.isMsbOnlineSuggestionType(r.type)||a.unshift(i)}if(n.config.enableBoostASTopHitForLowClickType&&h.queryToFetch.length==1&&a.length==1&&!n.isWebSuggestion(a[0])&&!n.isApp(a[0].type))for(let t=0;t<r.length;t++)if(n.isWebSuggestion(r[t])||r[t].type=="MB"){a.splice(0,0,r[t]);break}if(n.config.enableBoostASTopHitForFile&&h.queryToFetch.length==1&&a.length==1&&!n.isWebSuggestion(a[0])&&!n.isApp(a[0].type)&&!n.isSetting(a[0].type))for(let t=0;t<r.length;t++)if(n.isWebSuggestion(r[t])||r[t].type=="MB"){a.splice(0,0,r[t]);break}if(n.config.enableBoostWebAnswer&&h.scope==n.Scope.All&&a.length===1&&(n.isApp(a[0].type)||n.isSetting(a[0].type)||n.isFileOrFolder(a[0].type))&&(!n.config.enableBoostWebAnswerScoreLimit||n.config.enableBoostWebAnswerScoreLimit&&a[0].rankingScore<n.config.boostWebAnswerScoreThreshold))for(let t=0;t<r.length;t++)if(n.isWebSuggestion(r[t])||r[t].type=="MB"){a.push(r[t]);break}if(n.config.enableBoostSWAnswer&&h.scope==n.Scope.All&&a.length===1&&(n.isApp(a[0].type)||n.isSetting(a[0].type)||n.isFileOrFolder(a[0].type))&&(!n.config.enableBoostWebAnswerScoreLimit||n.config.enableBoostWebAnswerScoreLimit&&a[0].rankingScore<n.config.boostWebAnswerScoreThreshold)&&a.length===1&&s.searchTheWeb&&(s.protocol&&this._ranker.allowInTopHit(h,s.protocol)||a.push(s.searchTheWeb)),n.config.enableBoostWebAnswer&&h.scope==n.Scope.All&&a.length===1&&(n.isApp(a[0].type)||n.isSetting(a[0].type)||n.isFileOrFolder(a[0].type))&&s.searchTheWeb&&this._ranker.allowInTopHit(h,s.searchTheWeb)&&(!n.config.enableBoostWebAnswerScoreLimit||n.config.enableBoostWebAnswerScoreLimit&&a[0].rankingScore<n.config.boostWebAnswerScoreThreshold)&&a.push(s.searchTheWeb),n.config.promoteAS2SecondTopWhenTopHitIsFLorFD&&h.scope==n.Scope.All&&a.length===1&&n.isFileOrFolder(a[0].type)&&n.config.thresholdForQFToSkipGIQS>0&&h.queryToFetch.length>n.config.thresholdForQFToSkipGIQS){for(let t=0;t<r.length;t++)if(!n.contains(a,r[t])&&(n.isWebSuggestion(r[t])||r[t].type=="MB")){a.push(r[t]);break}a.length===1&&s.searchTheWeb&&!n.contains(a,s.searchTheWeb)&&a.push(s.searchTheWeb)}if(n.config.enablePutASInSecondTopHit&&h.scope==n.Scope.All&&a.length===1&&a[0].type!="MB"){for(let t=0;t<r.length;t++)if(!n.contains(a,r[t])&&(n.isWebSuggestion(r[t])||r[t].type=="MB")){a.push(r[t]);break}a.length===1&&s.searchTheWeb&&!n.contains(a,s.searchTheWeb)&&a.push(s.searchTheWeb)}if(n.config.stickyTopResultsV2&&t.length==1&&n.config.enableSuperStickySWTopHit){let u=a.filter(n=>n.handoffType==0),f=a.filter(n=>n.type=="ANAH"||n.type=="ANAR"),i=r.filter(n=>n.type=="ANAH"||n.type=="ANAR").sort((n,t)=>t.rankingScore-n.rankingScore);f.length==0&&i.length>0?a.push(i[0]):s.searchTheWeb&&u.length==0&&this._ranker.allowInTopHit(h,s.searchTheWeb)&&(n.config.enableSoftSuperStickySWTopHit&&t[0].rankingScore<2||n.config.enableHardSuperStickySWTopHit&&t[0].rankingScore<0||!n.config.enableHardSuperStickySWTopHit&&t[0].rankingScore<1)&&a.push(s.searchTheWeb)}if(n.config.enableMRUHint&&a.length>0&&this._previousKeystrokeCache){let n=this._previousKeystrokeCache.getPreviousTopHit();n&&n.mruHintEnabled&&n.text==a[0].text&&n.type==a[0].type&&(a[0].mruHintEnabled=!0)}if(n.config.enableCISpeller&&a.length==1&&this._previousKeystrokeCache&&(a[0].type=="PP"||a[0].type=="ST")&&this._previousKeystrokeCache.setPreviousTopHit(k?null:a[0]),n.config.enableConversationCache&&a.length==2&&n.isDuplicate(h,a[0],a[1])&&a.splice(1,1),n.config.topHitMuse&&a.forEach(n=>{var t,i,r,u;return n.tooltip="thRank:"+((t=n.rankingScore)===null||t===void 0?void 0:t.toString())+" thlaunch:"+((i=n.anaheimRankingSignals)===null||i===void 0?void 0:i.visitCount)+" thDateV:"+((u=(r=n.anaheimRankingSignals)===null||r===void 0?void 0:r.dateVisited)===null||u===void 0?void 0:u.toString())}),a.length>2&&(n.config.enableSuperStickySWTopHit||n.config.enableSuperBouncySWTopHit))n.tryRemove(a,s.searchTheWeb);else if(n.config.enableSuperBouncySWTopHit){let i=[];for(v in r){let t=r[v].staticGroupType;t||(t=n.getGroupType(r[v]));t&&i.indexOf(t)<0&&i.push(t)}for(v in t){let r=t[v].staticGroupType;r||(r=n.getGroupType(t[v]));r&&i.indexOf(r)<0&&i.push(r)}i.length>1&&i.indexOf(n.GroupType.SearchSuggestions)>=0?n.config.enablePutASInSecondTopHit||n.config.promoteAS2SecondTopWhenTopHitIsFLorFD||n.tryRemove(a,s.searchTheWeb):a.length==0&&i.length==1&&i.indexOf(n.GroupType.SearchSuggestions)>=0&&a.push(s.searchTheWeb)}if(n.config.disableQFPreviewBtnForChatSugg)for(v in a)((p=a[v].icon)===null||p===void 0?void 0:p.className)&&n.searchChatIconClassName()&&(a[v].icon=n.getSearchSuggestionIcon(),a[v].primaryMetadata=n.Host.getLocString("SeeWebResults"),a[v].click=()=>{var t;return n.Host.launchSearchAsync(a[v].query,this._navigationHelper.getSearchUrl(a[v].query,a[v].query,a[v].type,null,0,undefined,undefined,undefined,undefined),(t=a[v])===null||t===void 0?void 0:t.useRaf)});return a}applyAppOverride(n,t){const i=["Microsoft.Office.WINWORD.EXE","{6D809377-6AF0-444B-8957-A3773F02200E}\\Windows NT\\Accessories\\wordpad.exe"];let r=n[0].deviceItem?n[0].deviceItem.id:null;if(r&&r.startsWith(i[1])){let r=t.findIndex(n=>n.deviceItem&&n.deviceItem.id&&n.deviceItem.id.startsWith(i[0]));r>=0&&n.splice(0,1,t[r])}}setUseRafFlag(t,i,r,u){if(n.isCortanaEnabledCache&&u==2)for(let n of t)n.handoffType!=0||n.isAnswer||(n.useRaf=!0)}determineANASuggestionsToRemoveForZeroInput(t,i,r){const u=n.canShowAnaheimDataSH(),f=n.canShowAnaheimDataSHTileE2E(),e=n.canShowAnaheimDataSHListE2E();r.isSearchHomeZI&&u&&r.scope==n.Scope.All&&t.forEach((t,r)=>{n.config.enableAnaheimDataTSTile&&(f?n.config.enableAnaheimWin11ZITopSites||t.type!="TOPL"||i.push(r):t.type=="ANAT"&&i.push(r)),e?t.type=="QSSG"&&i.push(r):(t.type=="ANAH"||t.type=="ANAR")&&i.push(r)})}determineSuggestionsToAddToGroups(t,r,u,f,e,o,s,h,c){let l=u.filter(t=>!n.contains(e,t));n.config.enableConversationCache&&this._conversationCache&&this._conversationCache.isFirstRender()&&!n.isL2(s)&&(l=l.concat(r.filter(t=>!n.contains(e,t))));let a=[];n.RuntimeConfig.FlatListWithoutGroups||l.forEach((t,i)=>{this.allowedInGroups(t)||(n.getScope(n.getGroupType(t))==n.Scope.All?a.push(i):t.suppressed=!0)});this.determineANASuggestionsToRemoveForZeroInput(l,a,s);for(let n=a.length-1;n>=0;--n)l.splice(a[n],1);if(o.searchTheWeb){let t=e.indexOf(o.searchTheWeb);if(t!=-1){let r=n.removeFirstWhere(l,n=>i(n,s));r&&(e[t]=r)}}let v=l.filter(t=>n.contains([n.GroupType.SearchSuggestions,n.GroupType.Websites,n.GroupType.LocalPlaces],n.getGroupType(t))),p=l.filter(n.enforceOriginalOrder);const y=u.find(n=>n.handoffType===21);return n.config.enableAnaheimRelevance==2&&(v=l.filter(t=>n.contains([n.GroupType.Websites,n.GroupType.LocalPlaces],n.getGroupType(t)))),!h&&this.canRenderChildSuggestions(e,c,s)?this.addChildSuggestions(t,e[0],l):(s===null||s===void 0?void 0:s.scope)===n.Scope.Work&&y&&this.addChildSuggestions(t,y,l),s.queryToFetch&&l.sort((n,t)=>t.rankingScore-n.rankingScore),this.insertDefaultSearchTheWeb(s,o,e,r,l,v),l=this.insertSuggestionsToRightPlace(l,p),l=this.insertSuggestionsToRightPlace(l,v),n.config.topHitMuse&&e.forEach(n=>{var t,i,r,u;return n.tooltip="gaRank:"+((t=n.rankingScore)===null||t===void 0?void 0:t.toString())+" galaunch:"+((i=n.anaheimRankingSignals)===null||i===void 0?void 0:i.visitCount)+" gaDateV:"+((u=(r=n.anaheimRankingSignals)===null||r===void 0?void 0:r.dateVisited)===null||u===void 0?void 0:u.toString())}),l}insertDefaultSearchTheWeb(t,r,u,f,e,o){if(r.searchTheWeb&&(t.scope==n.Scope.Web||t.scope==n.Scope.All)){let n=o.findIndex(n=>i(n,t));if(f.some(n=>i(n,t))||u.some(n=>i(n,t))){if(n!=-1){let t=o[n];o.splice(n,1);e.splice(e.indexOf(t),1)}}else n==-1&&(o.unshift(r.searchTheWeb),e.unshift(r.searchTheWeb))}}getGroupOrder(t,i,r){switch(t.scope){case n.Scope.Web:if(!t.queryToFetch)return[{type:n.GroupType.Websites},{type:n.GroupType.SearchSuggestions}];break;case n.Scope.Apps:return[{type:n.GroupType.Apps},{type:n.GroupType.Store}];case n.Scope.Photos:return[{type:n.GroupType.Photos},{type:n.GroupType.SearchSuggestions}];case n.Scope.Videos:return[{type:n.GroupType.Videos},{type:n.GroupType.SearchSuggestions}]}let u=r.concat(i);u.sort((n,t)=>t.rankingScore-n.rankingScore);let s=[],o=[],e=[];for(let t of u)if(t.suppressed)o.push(t);else if(s.push(t),n.config.enableStaticGroupRanking){let r=n.getGroupType(t),i={type:r,source:t.sourceForGroup};e.some(t=>n.sameGroup(t,i))||e.push(i)}o.length!=0&&(u=s.concat(o));let f=[];if(n.config.enableStaticGroupRanking&&u.length>0&&n.getGroupType(u[0])!=n.GroupType.SearchSuggestions){let t=[{type:n.GroupType.Apps},{type:n.GroupType.Settings},{type:n.GroupType.Documents,source:1},];n.config.topHitMuse&&(t=[{type:n.GroupType.Apps},{type:n.GroupType.AnaheimDataTopHit},{type:n.GroupType.Settings},{type:n.GroupType.Documents,source:1}]);for(let i of t)e.some(t=>n.sameGroup(t,i))&&f.push(i);e.some(t=>n.sameGroup(t,{type:n.GroupType.SearchSuggestions}))&&f.push({type:n.GroupType.SearchSuggestions})}for(let i of u){let u=n.getGroupType(i,t===null||t===void 0?void 0:t.scope),r=this.getTypeWithSource(u,i);f.some(t=>n.sameGroup(t,r))||(!n.config.enableStaticGroupRanking||!n.isTopHitChildGroup(r)||i.handoffType===21?f.push(r):f.unshift(r))}return f}getTypeWithSource(t,i){const r=t==n.GroupType.MRUHistory?undefined:i.sourceForGroup;return{type:t,source:r}}addChildSuggestions(t,i,r){i.calculateChildSuggestions&&i.calculateChildSuggestions();i.childSuggestions&&i.childSuggestions.length>0&&Object.keys(n.config.topHitChildGroups).forEach((n,u)=>{const f=parseInt(n),e=this.getMaxChildSuggestions(t,i,f);if(e>0){const n=i.childSuggestions.filter(n=>n.groupType==f).slice(0,e);n.forEach((n,t)=>{n.handoffType===21||(n.rankingScore=1e4-100*u-t),r.push(n)})}})}getMaxChildSuggestions(t,i,r){var u;return n.isMsbVerticalOnlineSuggestionType(i.type)?t?((u=i.childSuggestions)===null||u===void 0?void 0:u.length)||0:n.config.msbVerticalChildSuggestionsInL1||0:n.contains(n.config.suppressedTopHitChildGroups,r)?0:n.config.topHitChildGroups[r]}canRenderChildSuggestions(t,i){if(n.RuntimeConfig.FlatListWithoutGroups||t.length!=1)return!1;let r=t[0];if(n.RuntimeConfig.AlwaysWide){const n=r.previewPaneType===1,t=r.handoffType===21,i=r.type==="MPPL"&&!!r.calculateChildSuggestions;if(!n&&!t&&!i)return!1}if(!i||r.handoffType===21)return!0;if(this._renderedTopResults.topResults.length==1){let t=this._renderedTopResults.topResults[0];return t.hasChildSuggestionsDisplayed&&t.query==r.query&&n.getGroupType(t)==n.getGroupType(r)}return!1}insertSuggestionsToRightPlace(t,i){if(i.length==0)return t;let r=[],u=i[0];for(let f=0;f<t.length;f++){let e=t[f];e==u?r=r.concat(i):n.contains(i,e)||r.push(e)}return r}ensureUniqueReactKeys(n){let t={};if(n)for(let i=n.length-1;i>=0;i--){let r=n[i];if(t[r.reactKey]){let t=n.splice(i,1),r=t[0].mayContainPII?t[0].type:t[0].reactKey;SharedLogHelper.LogError("ensureUniqueReactKeys","Found two suggestions with the same key: "+r)}else t[r.reactKey]=1}}}t.Aggregator=h})(t=n.Ranking||(n.Ranking={}))}(WSB||(WSB={})),function(n){function f(t,i){t(n.getCurrentTime(),n.getInputType(i),i)}function i(n,t){let i=parseInt(n.substr(1),16),r=i>>16&255,u=i>>8&255,f=i&255;return"rgba("+r+","+u+","+f+","+t+")"}function r(n,t){var i=parseInt(n.slice(1),16),r=t<0?0:255,u=t<0?t*-1:t,f=i>>16,e=i>>8&255,o=i&255;return"#"+(16777216+(Math.round((r-f)*u)+f)*65536+(Math.round((r-e)*u)+e)*256+(Math.round((r-o)*u)+o)).toString(16).slice(1)}n.invokeClickHandler=f;n.SinglePaneWidth=344;n.PreviewPaneWidth=440;n.DebugWindowWidth=800;n.CobaltPreviewPaneWidth=410;const e="qfContainer",o="workScopeSubVerticalsContainer";let t,u="aria-selected";class s{constructor(){this._windowsTemporaryMessageShown=!1;this._progressBarVisible=!1;this._previewPaneVisible=!1;this._debugWindowVisible=!1;this._suggestionsContainerHeight=0;this._renderingInProgress=!1;this._narratorLaunchHandlers=[];this._viewData={};this._targetElemCache={};this._shimmerShown=!1;this.scrollTo=(t,i,r)=>{var f;let u=_ge(t.id);const c=(f=this._qfContainer)===null||f===void 0?void 0:f.contains(u);while(r&&c&&(u===null||u===void 0?void 0:u.offsetParent.id)!==e)u=u.parentElement;const s=n.msbDsbHost&&n.isMsbEnterprise()&&t.dsb,l=i&&s?_ge(n.MsbDsb.MAINPAGE_CONTAINER_SCROLL):n.StaticHtmlElements.msbDsbRoot,h=s?l:!n.config.enableWin11SSH&&i?n.StaticHtmlElements.root:r&&(u===null||u===void 0?void 0:u.id)===o?n.StaticHtmlElements.qfContainerScroll:this._qfContainer;this.scrollToElement(u,h,h.offsetHeight)};let r=new MutationObserver(n=>{if(!this._renderingInProgress){let t=[],i;for(let r of n){let n=r.target;i=n.id;t.push(n.getAttribute(u)=="true"?1:0)}(t.length==1&&t[0]==0||t.length==2&&t[0]^t[1])&&this._narratorLaunchHandlers.forEach(n=>n(i))}});r.observe(document,{subtree:!0,attributes:!0,attributeFilter:[u]});n.View.getLocString=(t,...i)=>n.Host.getLocString(t,...i);this.addViewData("TestHooksEnabled",n.TestHookUrlParameters);t=SearchAppWrapper.CortanaApp;this._qfContainer=n.config.useCobaltCSS?n.StaticHtmlElements.qfContainerScroll:n.StaticHtmlElements.qfContainer;this._messageBannerArea=n.StaticHtmlElements.messageBannerBottom;n.Host.bindAppVisible(()=>{let i=t.width,r=t.height;if(i&&r)this.setDimensions(i,r);else{const t=n.Host.getCachedCortanaHeaders();if(t&&t["X-BM-DeviceDimensionsLogical"]){let[n,i]=t["X-BM-DeviceDimensionsLogical"].split("x");this.setDimensions(parseInt(n),i)}else ThresholdUtilities.getCortanaHeaders(t=>{if(t){n.Host.setCortanaHeadersCache(t);let[i,r]=t["X-BM-DeviceDimensionsLogical"].split("x");this.setDimensions(parseInt(i),r)}})}this._isFileExplorerOrControlPanel=n.RuntimeConfig.QfMode==5||n.RuntimeConfig.QfMode==9;n.RuntimeConfig.PreviewPaneAvailable&&(this.initPreviewPane(),n.setVisibility(n.StaticHtmlElements.qfPreviewPane,n.RuntimeConfig.AlwaysWide),!n.RuntimeConfig.AlwaysWide&&n.Host.hasFallbackHappened()&&t.resetToDefaultSize());this.initDebugWindow();this.setConditionalCss("wideByDefault",n.RuntimeConfig.AlwaysWide);this.setConditionalCss("win11",n.config.useCobaltCSS);this.setConditionalCss("handIconHover",n.config.enableHandIconWhenHover);this.setConditionalCss("settingsApp",n.RuntimeConfig.QfMode==7);this.setConditionalCss("fileExplorer",this._isFileExplorerOrControlPanel);this.setConditionalCss("panelCanResize",n.RuntimeConfig.PanelCanResize);this.setConditionalCss("flatListWithoutGroups",n.RuntimeConfig.FlatListWithoutGroups);this.setConditionalCss("searchBoxOnTop",n.RuntimeConfig.SearchBoxOnTop);this.setConditionalCss("noScopes",!n.RuntimeConfig.ScopesAvailable);this.setConditionalCss("twoColumns",n.shouldShowTwoColumns());this.setConditionalCss("enableAnaheimData",!n.config.enableWin11SSH&&(n.isAnaheimDataEnabled(!0)||n.isAnaheimDataEnabled(!1)));this.setConditionalCss("enableAnaheimTopSitesWin11",n.config.enableAnaheimWin11ZITopSites);this.setConditionalCss("trendingSearchInWin11LeftPane",n.config.trendingSearchInWin11LeftPane);this.setConditionalCss("snipSearchEnabled",n.shouldEnableSnipSearch());this.setConditionalCss("edgeUpsell",n.shouldEnableAnaheimResetDefault());this.setConditionalCss("scope-with-background",n.config.scopeWithBackground);this.setConditionalCss("msbDsbWide",n.config.msbDsbWide&&n.RuntimeConfig.AlwaysWide);this.setQueryBasedCss(null);this.setConditionalCss("reclaimSearchboxCampaign",n.config.enableMessageBanner);this.setConditionalCss("wsbOnWebView2",n.config.wsbWebView2);this.setConditionalCss("notificationBannerShown",n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(40979072))});n.Host.bindBootstrapDone(()=>{n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBPage.bindBootstrapDone");let t=_ge("preBootstrapPane");t&&(n.setVisibility(t,!1),t.remove());n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBPage.bindBootstrapDone")});n.Host.bindShown(()=>{if(n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBPage.bindShown"),this.applyAccentColor(),this.setThemeBasedCss(),this.setConditionalCss("snipSearch",t.entryPoint=="WNSSBS"&&n.config.enableSnipSearchV2),n.setVisibility(n.StaticHtmlElements.root,!0),n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBPage.bindShown"),n.config.enableMessageBanner&&t.isUserOnboarded()){let i=t.getSearchAppLaunchCount();i<4&&(n.InstrumentationHelper.logClientInstEvent("ClientInst","ReclaimSearchBoxBannerShown",null,{shownCnt:String(i)}),t.setSearchAppLaunchCount(i+1))}});n.Host.bindAppHidden(()=>{n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBPage.bindAppHidden"),this._openPreviewPaneButtonCache=undefined,n.setVisibility(n.StaticHtmlElements.qfPreviewPane,!1),n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBPage.bindAppHidden")});n.Host.bindQueryChangedOrInitialized(()=>{n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBPage.bindQueryChangedOrInitialized"),this._isFileExplorerOrControlPanel&&this.updateFENarratorSuggestionCount(null),n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBPage.bindQueryChangedOrInitialized")});n.Host.bindSearchBoxClick(()=>{n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("WSBPage.bindSearchBoxClick"),n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("WSBPage.bindSearchBoxClick")});const i=()=>{n.RuntimeConfig.AlwaysWide||(this._previewPaneVisible=!1,n.setVisibility(n.StaticHtmlElements.qfPreviewPane,!1)),(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isWorkUpsellApplicable())&&this.updateWorkUpsellAreaView(undefined),n.config.enableMessageBanner&&this.updateMessageBannerAreaView(null),(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(40979072))&&this.updateNotificationBannerAreaView(null),this.setDebugWindowVisibility(!1)};n.Host.bindDismissed(()=>{this.resetSuggestionsContainerHeight(),i(),n.config.showShimmerOnDismiss&&(this._shimmerShown=!0,n.StaticHtmlElements.shimmerContainer.classList.remove("b_hide"),n.StaticHtmlElements.rootContainer.classList.add("b_hide"))});!n.View.PerformanceWidget||!n.StaticHtmlElements.performanceWidget||(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.hidePerfWidget)||(n.setVisibility(n.StaticHtmlElements.performanceWidget,!0),n.Host.bindShown(()=>{this.renderReactView("performanceWidget",n.View.PerformanceWidget,{keystrokeTimeline:null})}),n.InstrumentationHelper.bindKeystrokeTimelineUpdated(t=>{this.renderReactView("performanceWidget",n.View.PerformanceWidget,{keystrokeTimeline:t})}));n.config.alwaysWideBeforeRS5&&t.addEventListener("openanimationcompleted",()=>{this.ensureWebViewWidthExpanded()});t.addEventListener("resettingtodefaultsize",()=>{i()});sj_be(sj_b,"contextmenu",n=>{let t=n.target;while(t){if(t.classList.contains("allowcontextmenu"))break;t=t.parentElement}t||sj_pd(n)})}setConditionalCss(t,i){this.setConditionalCssOnElement(n.StaticHtmlElements.root,t,i)}setConditionalCssOnElement(n,t,i){i?n.classList.add(t):n.classList.remove(t)}setQueryBasedCss(t,i){this.setConditionalCss("zeroInput19H1",(t===null||t===void 0?void 0:t.isSearchHomeZI)||!!(t===null||t===void 0?void 0:t.isThirdPartyZI));(t===null||t===void 0?void 0:t.scope)==n.Scope.ThirdPartyWeb&&i&&this.setConditionalCss("zeroInput19H1",!1);this.setConditionalCss("twoPanesZI",n.shouldShowStaticSearchHome(t)||n.shouldShowDSBLayout(t));this.setConditionalCss("dsb",n.shouldShowDSBLayout(t));this.setConditionalCss("dsbFullWidth",n.shouldShowDSBFullWidth(t));this.setConditionalCss("transparentMiniserp",n.shouldShowTransparentMiniserp());this.setConditionalCss("allScope",t&&t.scope==n.Scope.All);this.setConditionalCss("chatScope",!!n.isChatScopeEnabled()&&(t===null||t===void 0?void 0:t.scope)==n.Scope.Chat);this.setConditionalCss("searchHomeToggle",!!n.isChatScopeEnabled()&&(t===null||t===void 0?void 0:t.isSearchHomeZI)||n.isThirdPartySearchAllowed()&&n.Host.isThirdPartySearchAppsEnabled());n.dsbManager===null||n.dsbManager===void 0?void 0:n.dsbManager.setDsbPanesVisibility(t)}setThemeBasedCss(){if(n.config.isThemeAware){var t=n.Host.getWindowsTheme();this.setConditionalCss("darkTheme",t==2);this.setConditionalCss("lightTheme",t==1);n.config.showShimmerOnDismiss&&(this.setConditionalCssOnElement(n.StaticHtmlElements.shimmerContainer,"darkTheme",t==2),this.setConditionalCssOnElement(n.StaticHtmlElements.shimmerContainer,"lightTheme",t==1))}else n.config.searchHomeSupported&&(this.setConditionalCss("lightTheme",!0),this.setConditionalCss("lightThemeRS5",!0))}initPreviewPane(){let t=n.RuntimeConfiguration.TextScaleFactor||1,i=n.config.useCobaltCSS?n.CobaltPreviewPaneWidth/t:n.PreviewPaneWidth/t;n.StaticHtmlElements.qfPreviewPane.classList.remove("transitionOn");n.StaticHtmlElements.qfPreviewPane.style.minWidth=i+"px"}initDebugWindow(){this._debugWindow||(this._debugWindow=_ge("qfDebugPane"),this._debugWindow&&(this._debugWindow.style.flexBasis=n.DebugWindowWidth+"px"))}setDimensions(n){if(!this._previewPaneVisible&&!this._debugWindowVisible){this.onPaneWidthSet(n);this._originalPaneWidth=n}}ensureWebViewWidthExpanded(){let i=n.SinglePaneWidth+n.PreviewPaneWidth;n.RuntimeConfig.QfMode==1&&t.width<i&&(t.setPaneWidth(i),this.setDimensions(i,null))}getScrollTop(){return this._qfContainer.scrollTop}scrollToTop(){this._qfContainer.scrollTop=0;_d.body.scrollTop=0}scrollRightPaneToTop(){const t=document.getElementById("localScrollArea"),i=document.getElementById("qfPreviewScrollArea"),r=document.querySelector(".previewDataSection > div > ul");t&&i&&r&&(t.scrollTop!==0||i.scrollTop!==0)&&r.firstElementChild===document.activeElement&&(n.config.useCobaltCSS?t.scrollTop=0:i.scrollTop=0)}scrollToElement(n,t,i){let u=t.scrollTop,r=n===null||n===void 0?void 0:n.offsetTop,f=r+(n===null||n===void 0?void 0:n.offsetHeight);f>u+i?t.scrollTop=f-i:r<u&&(t.scrollTop=r)}getSuggestionsContainerHeight(){return this._suggestionsContainerHeight||this.calculateSuggestionsContainerHeight(),this._suggestionsContainerHeight}getSuggestionsContainerWidth(){return(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)?t.width:_w.innerWidth}resetSuggestionsContainerHeight(){this._suggestionsContainerHeight=0}calculateSuggestionsContainerHeight(){let t=n.StaticHtmlElements.root.clientHeight;t<440&&(t=440);let i=_ge("temporaryMessage");t-=i.offsetHeight;this._suggestionsContainerHeight=t}getPanelWidthFor(t){let i=this._originalPaneWidth;return i+=t&1?n.PreviewPaneWidth:0,i+(t&2?n.DebugWindowWidth:0)}getPanelState(){switch(t.width-this._originalPaneWidth){case 0:return 0;case n.PreviewPaneWidth:return 1;case n.DebugWindowWidth:return 2;case n.PreviewPaneWidth+n.DebugWindowWidth:return 3;default:return 0}}openSidePanel(n){let i=this.getPanelState();if(i==0&&this.setDimensions(t.width,null),!(i&n)){let u=i|n,r=this.getPanelWidthFor(u);t.setPaneWidth(r);this.onPaneWidthSet(r)}}closeSidePanel(i){let r=this.getPanelState();if(r&i){let f=r&~i,u=this.getPanelWidthFor(f);u!=this._originalPaneWidth||n.config.alwaysWideBeforeRS5?t.setPaneWidth(u):t.resetToDefaultSize();this.onPaneWidthSet(u)}}onPaneWidthSet(t){n.safeFireEvent("CortanaPaneWidthSet",t)}getOpenPreviewPaneButton(){if(!n.RuntimeConfig.PreviewPaneAvailable)return null;if(!this._openPreviewPaneButtonCache){let t=n.isRtl(),i=t?"&#xE96F":"&#xE970";this._openPreviewPaneButtonCache={defaultIcon:{content:i,type:2},openedIcon:{content:t?"&#xE72B":"&#xE72A",type:2},clickHandler:this._openPreviewPaneClickHandler}}return this._openPreviewPaneButtonCache}setContextMenuHandler(n){this._contextMenuHandler=n}setSuggestionClickHandler(n){this._suggestionClickHandler=n}setOpenPreviewPaneClickHandler(n){this._openPreviewPaneClickHandler=n}setExpanderClickInstrumentation(n){this._expanderClickInstrumentation=n}updateGroupsView(t,i,r,u){var e,o,s;if((n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.forceRenderingCrashOnSecondConversation)&&n.Host.getPaneCloseCount())throw new Error("Simulated exception");if(n.shouldShowDSBLayout(t.query)){let t=n.Host.getBindDimissTime(),i=n.Host.getBindShownTime();if(t&&i&&(i-t)/1e3>n.DSB_RESET_SECONDS){if(n.config.useCobaltCSS){const n=document===null||document===void 0?void 0:document.getElementById("dsb-moment-container");n&&(n.scrollTop=0)}else n.StaticHtmlElements.dynamicPane.scrollTop=0;n.StaticHtmlElements.dynamicPaneFullWidth&&(n.StaticHtmlElements.dynamicPaneFullWidth.scrollTop=0)}n.StaticHtmlElements.msbDsbRoot&&(n.StaticHtmlElements.msbDsbRoot.scrollTop=0)}i||this.setQueryBasedCss(t.query,t.topResults.length!=0);this.setConditionalCss("noSuggestions",t.topResults.length==0&&t.groups.length==0);let h=t.query&&t.query.isSearchHomeZI;if(h){let n=t.groups.filter(n=>!n.suggestions.every(n=>n.suppressed==!0));t.groups=n}let c=h?null:((e=t.query)===null||e===void 0?void 0:e.scopePrefix)==="work"?null:" - "+n.getWebSuggestionAnnotation(n.msbEnabledForQuery(t.query)),l=n.config.clearMru&&(!t.query||!t.query.queryToFetch)&&t.groups.length>0&&t.groups[0].type!=n.GroupType.QuickSearch;u&&this.updateMessageBannerAreaView(null);let f={groups:t.groups,contextMenuHandler:this._contextMenuHandler,clickHandler:this._suggestionClickHandler,openPreviewPaneButton:this.getOpenPreviewPaneButton(),isSearchHome:h,isWorkScopeZI:(o=t.query)===null||o===void 0?void 0:o.isWorkScopeZI,webSuggestionAnnotation:c,deleteMRUButtonCallback:l?()=>this.deleteMRUButtonCallback():null,notifyIconPending:(t,i,r)=>n.InstrumentationHelper.notifyIconPending(t,i,r),notifyIconReadyOrFailed:(t,i)=>n.InstrumentationHelper.notifyIconReadyOrFailed(t,i),scope:(s=t.query)===null||s===void 0?void 0:s.scope,updateFullyExpandState:r,scrollTo:this.scrollTo,messageBannerModel:u};n.config.enableMRUDSBV2&&n.shouldShowDSBFullWidth(t.query)?this.renderReactView("dsb-fwp-groups-ssh",n.View.WindowsGroups,n.config.reactGroups?n.deepCopy(f,["parent"],["deviceItem"]):f):this.renderReactView("groups",n.View.WindowsGroups,n.config.reactGroups?n.deepCopy(f,["parent"],["deviceItem"]):f)}deleteMRUButtonCallback(){sj_evt.fire("clearMRUButtonClicked");n.Host.refreshCurrentPane()}updateFENarratorSuggestionCount(t){let i="";this._isFileExplorerOrControlPanel&&t&&(i=n.Host.getLocString("SuggestionCountNarrator",`${t}`));this.updateNarratorMessageView(i)}updateTopResultsView(t,i){if(!this._shimmerShown||i||(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.forceLoadingShimmer)||(this._shimmerShown=!1,n.StaticHtmlElements.shimmerContainer.classList.add("b_hide"),n.StaticHtmlElements.rootContainer.classList.remove("b_hide")),i||this.setQueryBasedCss(t.query,t.topResults.length!=0),this.setConditionalCss("noSuggestions",t.topResults.length==0&&t.groups.length==0),this._isFileExplorerOrControlPanel){let n=t.topResults.length;this.updateFENarratorSuggestionCount(n>0?n:null)}let r={suggestions:t.topResults,contextMenuHandler:this._contextMenuHandler,clickHandler:this._suggestionClickHandler,openPreviewPaneButton:this.getOpenPreviewPaneButton(),isSearchHome:t.query&&t.query.isSearchHomeZI,notifyIconPending:(t,i,r)=>n.InstrumentationHelper.notifyIconPending(t,i,r),notifyIconReadyOrFailed:(t,i)=>n.InstrumentationHelper.notifyIconReadyOrFailed(t,i)};this.renderReactView("topResults",n.View.WindowsTopResults,n.config.reactGroups?n.deepCopy(r,["parent"],["deviceItem"]):r)}showTemporaryMessage(t,i,r,u){if(this._windowsTemporaryMessageShown)this.hideTemporaryMessage(),n.safeSetTimeout(()=>this.showTemporaryMessage(t),100,"showTemporaryMessage");else{let f={messageText:t,icon:i!==null&&i!==void 0?i:{content:"&#xE946",type:2},messageClassName:r!==null&&r!==void 0?r:"slideInMessage",clickHandler:()=>{this.hideTemporaryMessage(),n.Host.setFocusInSearchBox(null,"temporaryMessage")},action:u};this.updateTemporaryMessageView(f);this._windowsTemporaryMessageShown=!0}}hideTemporaryMessage(){this._windowsTemporaryMessageShown&&(this.updateTemporaryMessageView(null),this._windowsTemporaryMessageShown=!1)}updateTemporaryMessageView(t){this.renderReactView("temporaryMessage",n.View.WindowsMessage,{dataModel:t})}updateDialogBox(t){t.isVisible?n.Host.setFocusInWebView("updateDialogBox"):n.Host.setFocusInSearchBox(null,"updateDialogBox: hidden");this.renderReactView("dialogBox",n.View.WindowsDialogBox,{dataModel:t})}updateMessageBannerAreaView(t){t?(n.setVisibility(this._messageBannerArea,!0),this.renderReactView("messageBannerBottom",n.View.WSBMessageBanner,{dataModel:t})):n.setVisibility(this._messageBannerArea,!1)}updateNotificationBannerAreaView(t){(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(40979072))&&t?(n.setVisibility(n.StaticHtmlElements.notificationBanner,!0),this.renderReactView("notificationBanner",n.View.NotificationBanner,{dataModel:t})):n.setVisibility(n.StaticHtmlElements.notificationBanner,!1)}updateRewardsFlyout(t){this.renderReactView("rewardsFlyoutContainer",n.View.RewardsFlyout,{dataModel:t})}renderAdvancedOptionsMessages(t){this.renderReactView("temporaryOption",n.View.AdvancedOptions,n.config.reactGroups?n.deepCopy({advancedOptions:t}):{advancedOptions:t})}updateTopHitHeaderView(t){this.renderReactView("topHitHeader",n.View.TopHitHeader,n.config.reactGroups?n.deepCopy({dataModel:t},["parent"]):{dataModel:t})}createFlyout(t){return n.config.enableEducationalFlyout?(this._flyoutController||(this._flyoutController=new n.FlyoutController(this),n.Host.bindQueryChangedOrInitialized(n=>{this._flyoutController.onQueryChange(n)})),this._flyoutController.createFlyout(t)):null}renderFlyoutAreaView(t){t.acknowledgeFlyoutText=n.Host.getLocString("AcknowledgeFlyoutText");t.nextFlyoutText=n.Host.getLocString("NextFlyoutText");t.stepCounterText=n.Host.getLocString("FlyoutStepCounterFormat",(t.currentStep+1).toString(),t.nbSteps.toString());t.dismissFlyoutText=n.Host.getLocString("DismissFlyout");this._flyoutController.setQuery(n.Host.getQuery());n.RuntimeConfig.QfMode===0||n.RuntimeConfig.QfMode===4||n.RuntimeConfig.QfMode===11?n.StaticHtmlElements.flyoutContainer.classList.add("flyoutSinglePane"):n.StaticHtmlElements.flyoutContainer.classList.remove("flyoutSinglePane");this.renderReactView("flyoutContainer",n.View.Flyout,{dataModel:t});this.showFlyoutAreaView();t.overlay&&this.showOverlayAreaView()}renderAADVerificationAreaView(t){n.View.AADVerification&&n.StaticHtmlElements.aadVerificationContainer&&(this.renderReactView("aadVerificationContainer",n.View.AADVerification,{dataModel:t,isEduTenant:!!(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.isEduTenant())}),n.setVisibility(n.StaticHtmlElements.aadVerificationContainer,!0))}showFlyoutAreaView(){n.setVisibility(n.StaticHtmlElements.flyoutContainer,!0);n.StaticHtmlElements.flyoutContainer.style.animation="none";n.StaticHtmlElements.flyoutContainer.offsetHeight;n.StaticHtmlElements.flyoutContainer.style.animation=null}hideFlyoutAreaView(){n.setVisibility(n.StaticHtmlElements.flyoutContainer,!1)}showOverlayAreaView(){n.setVisibility(n.StaticHtmlElements.overlayContainer,!0)}hideOverlayAreaView(){n.setVisibility(n.StaticHtmlElements.overlayContainer,!1)}updateTopBrandingBarView(t){!n.msbHost||(n.msbHost===null||n.msbHost===void 0?void 0:n.msbHost.features.isScopeListBrandingLogoEnabled())||this.renderReactView("msbTopBrandingBar",n.View.MsbBrandingBar,{dataModel:t})}updateWorkUpsellAreaView(t){t?(n.setVisibility(n.StaticHtmlElements.workUpsellBanner,!0),this.renderReactView("workUpsellBanner",n.View.WorkUpsellBanner,{dataModel:t})):n.setVisibility(n.StaticHtmlElements.workUpsellBanner,!1)}removeWorkUpsellAreaView(){var t;(t=n.StaticHtmlElements.workUpsellBanner)===null||t===void 0?void 0:t.remove()}updateScopesHeaderView(t){!this._shimmerShown||!t||(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.forceLoadingShimmer)||(this._shimmerShown=!1,n.StaticHtmlElements.shimmerContainer.classList.add("b_hide"),n.StaticHtmlElements.rootContainer.classList.remove("b_hide"));this.renderReactView("scopesHeader",n.View.ScopesHeader,{dataModel:t})}updateNarratorMessageView(t){t&&n.StaticHtmlElements.narratorMessageContainer.setAttribute("aria-label",t);this.renderReactView("narratorMessageContainer",n.View.NarratorAnnouncement,{message:t})}updatePreviewErrorMessageView(t){this.renderReactView("errorPane",n.View.PreviewErrorMessageContainer,{dataModel:t,icon:{content:"&#xF303",type:2}})}updatePreviewContainerView(t){this.renderReactView("localPane",n.View.WindowsPreviewContainer,{dataModel:t,expanderClickInstrumentation:this._expanderClickInstrumentation,chevronDownIcon:{content:"&#xE70D",type:2}})}updateMsbPreviewContainerView(n){let t=_ge("b_bfb");if(t!=null){const n=_w.BingAtWork;n&&n.clearMsbContainer&&n.clearMsbContainer();t.remove()}let i=_ge("msbPane");n.suggestion?(t=sj_ce("div","b_bfb"),t.classList.add("fbig"),i.appendChild(t),i.classList.add("localPreviewContainer","msbPreviewContainer")):i.classList.remove("localPreviewContainer","msbPreviewContainer")}updateMenuView(t){this.renderReactView("menuContainer",n.View.WindowsMenu,{dataModel:t})}updatePopoverView(t){this.renderReactView("popoverContainer",n.View.Popover,{dataModel:t})}updateSnipSearchMessageView(t){this.renderReactView("messageContainer",n.View.SnipSearchMessage,{dataModel:t})}setProgressIndicatorVisibility(t){this._progressBarVisible!=t&&(this._progressBar||(this._progressBar=_ge("b_progress")),n.setVisibility(this._progressBar,t),this._progressBarVisible=t)}setPreviewPaneVisibility(t){this._previewPaneVisible!=t&&(t||this.closeSidePanel(1),n.setVisibility(n.StaticHtmlElements.qfPreviewPane,t),t&&this.openSidePanel(1),this._previewPaneVisible=t)}toggleDebugWindowVisibility(){return this.setDebugWindowVisibility(!this._debugWindowVisible),this._debugWindowVisible}updateOptionsWindowView(t){this.renderReactView("optionsContainer",n.View.OptionsWindow,{dataModel:t})}updateDynamicSearchView(t,i,r,u,f,e){var o;if(!t&&!u){n.setZeroInputDataSourcesForL1();n.Host.refreshCurrentPane();return}if(n.isDSBFullWidthFlightEnabled()){if(this.renderReactView("dynamic-pane",n.View.DSB.Templates.DynamicSearchBoxTemplateContainer,{moment:t,shouldShowDSBFlipper:r,isPastMoment:u,previousDateInFlipper:f,nextDateInFlipper:e}),i){let r="dsb-fwp-left-content",t=_ge(r);if(t){let n=t.nextElementSibling,r=t.parentElement;i.isMainColumnInLeft===!1?n&&((o=n.getAttribute("class"))===null||o===void 0?void 0:o.includes("dsb-fwp-right"))&&(n.setAttribute("class","dsb-fwp-right switched"),t.removeAttribute("class"),t.setAttribute("class","dsb-fwp-left"),r.removeChild(t),r.removeChild(n),r.appendChild(n),r.appendChild(t)):(t.setAttribute("class","dsb-fwp-left non-switched"),n||(n=t.previousElementSibling,n&&(n.removeAttribute("class"),n.setAttribute("class","dsb-fwp-right"),r.removeChild(t),r.removeChild(n),r.appendChild(t),r.appendChild(n))))}this.renderReactView(r,n.View.DSB.Templates.DSBFullWidthContainer,{moment:i,side:n.View.DSB.Templates.FullWidthContainerSide.Left});this.renderReactView("dsb-fwp-right-content",n.View.DSB.Templates.DSBFullWidthContainer,{moment:i,side:n.View.DSB.Templates.FullWidthContainerSide.Right})}}else this.renderReactView("dynamic-pane",n.View.DSB.Templates.DynamicSearchBoxTemplateContainer,{moment:t,shouldShowDSBFlipper:r,isPastMoment:u,previousDateInFlipper:f,nextDateInFlipper:e});this.setQueryBasedCss(n.Host.getQuery())}setDebugWindowVisibility(t){n.setVisibility(this._debugWindow,t);n.RuntimeConfig.AlwaysWide?this.setConditionalCss("debugWindowOpen",t):t?this.openSidePanel(2):this.closeSidePanel(2);this._debugWindowVisible=t}applyAccentColor(){let u=n.Host.getAccentColor();if(this._lastAccentColor!=u){let e,o="accent-style",f=_ge(o);f||(f=_d.createElement("style"),f.setAttribute("id",o),f.type="text/css",e=!0);let t=":root {";t+=`--accent0: ${u};`;t+=`--accent1: ${i(u,.3)};`;t+=`--accent2: ${i(u,.1)};`;t+=`--accent3: ${i(u,.4)};`;t+=`--accent4: ${i(u,.6)};`;t+=`--accent5: ${i(u,.7)};`;t+=`--accent6: ${i(u,.15)};`;t+=`--accent7: ${r(u,-.35)};`;t+=`--accent8: ${r(u,-.2)};`;t+=`--accent9: ${r(u,-.1)};`;t+=`--accent10: ${i(u,0)};`;t+=`--accent11: ${n.Host.getAccentColor(1)};`;t+=`--accent12: ${n.Host.getAccentColor(-2)};`;t+=`--accent13: ${n.Host.getAccentColor(2)};`;t+=`--accent14: ${n.Host.getAccentColor(-1)};`;t+=`--accent15: ${i(u,.9)};`;t+=`--accent16: ${i(u,.8)};`;t+=`--accent17: ${i(n.Host.getAccentColor(1),.9)};`;t+=`--accent18: ${i(n.Host.getAccentColor(1),.8)};`;t+=`--accent19: ${i(n.Host.getAccentColor(-2),.9)};`;t+=`--accent20: ${i(n.Host.getAccentColor(-2),.8)};`;t+=`--accent21: ${r(n.Host.getAccentColor(1),.1)};`;t+=`--accent22: ${r(n.Host.getAccentColor(-2),.1)};`;t+=`--accent23: ${r(n.Host.getAccentColor(1),.2)};`;t+=`--accent24: ${r(n.Host.getAccentColor(-2),.2)};`;t+="}";f.innerHTML=t;e&&_d.head.appendChild(f);this._lastAccentColor=u}}adjustHeightAsync(){n.safeSetTimeout(()=>n.Host.adjustHeight(),0,"adjustHeightAsync")}bindOnNarratorLaunch(n){this._narratorLaunchHandlers.push(n)}render(t){this._renderingTimer&&sb_ct(this._renderingTimer);this._renderingInProgress=!0;try{n.View.ViewData=this.getViewData();t()}finally{this._renderingTimer=n.safeSetTimeout(()=>{this._renderingTimer=null,this._renderingInProgress=!1},0,"BasePage render")}}renderReactView(t,i,r){n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().beginMark("React Render - "+t);let u=this._targetElemCache[t];u||(this._targetElemCache[t]=u=_ge(t));let f=r;f.adjustHeight||(f.adjustHeight=()=>this.adjustHeightAsync());this.render(()=>_w.ReactDOM.render(React.createElement(i,r),u),t);n!==undefined&&n.config.perfLogging&&n.WSBPerformance&&n.WSBPerformance.getInstance().endMark("React Render - "+t)}addViewData(n,t){this._viewData[n]=t}getViewData(){return this._viewData}}n.Page=s}(WSB||(WSB={})),function(n){const t=54e5,i=20;class r{constructor(){if(this._isReloadSuppressed=!1,this._pendingReload=!1,!navigator.serviceWorker){n.log("Service worker is not available");return}n.Host.hasFallbackHappened()&&(this._isReloadSuppressed=!0,this._lastReloadAfterFallback=n.getCurrentTime());navigator.serviceWorker.ready.then(n=>{this._registration=n});n.Host.bindConversationStart(()=>this.onConversationStart());n.Host.bindAppHidden(()=>this.onAppHidden());sj_be(navigator.serviceWorker,"message",n=>this.onMessage(n))}getServiceWorkerRegistrationAsync(){return this._registration?Promise.resolve(this._registration):navigator.serviceWorker.ready.then(n=>(this._registration=n,n))}onConversationStart(){this._isReloadSuppressed=!0;const t=n.Host.getCachedCortanaHeaders();if(t){const t=n.Host.getCachedCortanaHeaders();(async()=>{await this.postMessageAsync("sah",{headers:Object.assign({},t)}),this.shouldCheckForUpdate()&&await this.syncAsync("cu")})()}else ThresholdUtilities.getCortanaHeaders(async t=>{t?(n.Host.setCortanaHeadersCache(t),await this.postMessageAsync("sah",{headers:Object.assign({},t)})):SharedLogHelper===null||SharedLogHelper===void 0?void 0:SharedLogHelper.LogError("superFreshServiceWorker",undefined,"get Cortana headers failed"),this.shouldCheckForUpdate()&&await this.syncAsync("cu")})}onAppHidden(){var r;(this._isReloadSuppressed=this._lastReloadAfterFallback&&n.getCurrentTime()-this._lastReloadAfterFallback<t,this._isReloadSuppressed)||(!this._pendingReload&&n.Host.getPaneCloseCount()>=((r=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.reloadAfterConversations)!==null&&r!==void 0?r:i)&&(this._pendingReload=!0),this._pendingReload&&this.reloadAsync())}async syncAsync(n){const t=await this.getServiceWorkerRegistrationAsync();t.sync?t.sync.register(n):await this.postMessageAsync("sy",{tag:n})}shouldCheckForUpdate(){return n.isBingEnabled()?(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.disableAppCache)?!1:!0:!1}onUpdateReady(){this._isReloadSuppressed||n.Host.getIsReloadSuppressedBgTask()?this._pendingReload=!0:this.reloadAsync()}reloadAsync(){return n.Host.reloadWebViewAsync()}onGetAppHeaders(t){t&&n.Host.setCortanaHeadersCache(t)}async postMessageAsync(n,...t){(await this.getServiceWorkerRegistrationAsync()).active.postMessage(Object.assign({message:n},...t))}onMessage(n){let t=n.data;switch(t.message){case"ua":this.onUpdateReady();break;case"sahc":this.onGetAppHeaders(t.headers)}}}n.SuperFreshServiceWorker=r}(WSB||(WSB={})),function(n){let t;(function(t){function u(t,i,r,u,o,s,h=1,c){var v,y,p;let b=Date.now();(n.config===null||n.config===void 0?void 0:n.config.perfLogging)&&performance.mark(t+"_start");let w=(new Error).stack,l,a=n=>{const i=n instanceof Error&&(n.message===e||n.message===f);if(!i){n.stack&&(w=n.stack+"\n"+w);n.stack=w;l&&(o===null||o===void 0?void 0:o.unregister(l));switch(h){case 1:SharedLogHelper.LogError(t,s,c||n);break;case 2:SharedLogHelper.LogWarning(t,s,c||n)}u&&u(n)}};try{let u=i();if(u){let i=null;u.cancel?i=()=>u.cancel():!((p=(y=(v=window===null||window===void 0?void 0:window.chrome)===null||v===void 0?void 0:v.webview)===null||y===void 0?void 0:y.hostObjects)===null||p===void 0?void 0:p.cancelPromise)||(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)||(i=()=>window.chrome.webview.hostObjects.cancelPromise(u));o&&i&&(l=o.register(i,!1,t+" cancellation"));let f=i=>{let u=Date.now()-b;n.InstrumentationHelper.instrumentAggregateFunctionPerf(t,u);(n.config===null||n.config===void 0?void 0:n.config.perfLogging)&&performance.mark(t+"_end");l&&o.unregister(l);r&&n.safeExecute(()=>r(i),t+" safeChain() completion");(n.config===null||n.config===void 0?void 0:n.config.perfLogging)&&performance.measure(t,t+"_start",t+"_end")};u.done?u.done(f,a):u.then(f,a)}else a(new Error("No promise returned"))}catch(k){a(k)}}function o(n,t,i,r,f=1,e){return new Promise((o,s)=>u(n,t,o,s,i,r,f,e))}function r(t,i,r,u){i.completed=!0;i.result=r;i.pendingCallbacks.forEach(t=>n.safeExecute(()=>t(r),u));i.pendingCallbacks=null}function s(){i={}}function h(){let n=[];for(let t in i)i[t].completed||n.push(t);n.forEach(n=>delete i[n])}function c(u,f,e,o,s,h,c,l,a=1){return(v,y)=>{let w=e(v),p=i[w];if(p||(p={started:!1,completed:!1,result:null,pendingCallbacks:[]},i[w]=p),p.completed)y(p.result);else if(p.pendingCallbacks.push(y),!p.started){p.started=!0;let e=()=>{t.safeChain(u,()=>f(v),n=>{h&&!h(n)&&delete i[w],r(w,p,o?o(n):n,u)},t=>{n.isCancellation(t)?r(w,p,null,u):l?(l-=1,e()):r(w,p,s,u)},null,c,a)};e()}}}const f="Canceled",e="Promise canceled";t.safeChain=u;t.safePromise=o;let i={};t.clearGlobalCache=s;t.clearPendingItemsFromCache=h;t.safeChainWithGlobalCaching=c})(t=n.Async||(n.Async={}));let i;(function(n){function t(n,t,i){let r={};for(let u of n){let n=t[u];n&&(r[u]=i(n))}return r}function i(n){for(let t in n)if(n[t])return!1;return!0}n.map=t;n.isEmpty=i})(i=n.Map||(n.Map={}))}(WSB||(WSB={})),function(n){const i="show",t=n.config.useCobaltCSS?23:10;class r{constructor(t,i,r){this._page=t;this._showIcons=i;this.adjustHeight=r;this._menuStack=[];this._itemClickHandler=(t,i)=>{i.button==0&&(t.subItems?t.isSelectable&&!t.isExpanded&&(this.showSubMenu(t),t.isSticky=!0):t.click&&(t.click(n.getCurrentTime(),n.getInputType(i)),n.dismissAppWhenRunAsAdmin(t.id)))};this._itemEnterHandler=t=>{t.isSelectable&&!t.isExpanded&&(t.subItems&&(this._hoverTimer&&sb_ct(this._hoverTimer),this._hoverTimer=n.safeSetTimeout(()=>{this._hoverTimer=0;let n=_ge(t.id);t&&!t.isExpanded&&n&&n.matches(":hover")&&this.showSubMenu(t)},500,"menu item mouse enter")),this.stickParent(t))};this._itemLeaveHandler=t=>{t.isExpanded&&!t.isSticky&&n.safeSetTimeout(()=>{let n=_ge(t.id);t&&!t.isSticky&&n&&!n.matches(":hover")&&(t.subItems.some(n=>n==this._selectedItem)&&this.select(null,!1),this.dismissSubMenu(t))},450,"menu item mouse leave")};sj_be(_d.body,"mouseup",t=>{n.StaticHtmlElements.menuContainer.contains(t.target)||this.dismiss()});n.TestHookUrlParameters||sj_be(_w,"blur",()=>this.dismiss());sj_evt.bind("ajax.threshold.pageStart",()=>this.dismiss());n.Host.bindKeyEscape(n=>{this.isMenuVisible()&&(n.handled=!0,this._menuStack.length>0?this.reselectParentItem():this.dismiss(!0))})}showSubMenu(t){if(!t.isExpanded){this._selectedItem&&this.select(null,!1);let i=_ge(t.id),r=i.querySelector(".contextMenu");t.isExpanded=!0;n.setVisibility(r,!0);this.adjustSubMenuPosition(i,r);this._menuStack.push(t);this._page.updateMenuView(this.getDataModel())}}dismissSubMenu(t){if(this._selectedItem&&this.select(null,!1),t){let n=this._menuStack.indexOf(t);if(n<0)return;let i=this._menuStack.slice(n);for(let n=0;n<i.length;++n)this.dismissSubMenu()}else{t=this._menuStack.pop();let i=_ge(t.id),r=i.querySelector(".contextMenu");t.isExpanded=!1;t.isSticky=!1;n.setVisibility(r,!1)}this._page.updateMenuView(this.getDataModel())}showMenu(t,r){if(this._menuItems.length){n.setVisibility(n.StaticHtmlElements.menuContainer,!0);let u=this.getDataModel();this._page.updateMenuView(u);for(let n of this._menuItems)n.getIcon&&n.getIcon(1,t=>{n.icon=t,this._page.updateMenuView(this.getDataModel())});const f="renderContextMenu";n.safeSetTimeout(()=>{this.adjustPosition(t,r,u.menuType!=0);n.StaticHtmlElements.menuContainer.classList.add(i);let e=_qs("#menuContainer > .contextMenu");this._inputType!==2?this.select(this._menuItems.filter(n=>n===null||n===void 0?void 0:n.click)[0],!1):e.focus();e.scrollTop=0;n.Host.setFocusInWebView(f)},0,f)}}innerShowContextMenu(t,i,r,u,f,e){this.dismiss();let o=this.getContextMenuItems(t,u);o&&o.length>0&&(this._menuItems=o,this._onDismiss=f,this._menuType=0,this._inputType=e,i-=n.StaticHtmlElements.root.offsetLeft,r-=n.StaticHtmlElements.root.offsetTop,this.showMenu(i,r))}showDropdownMenu(i,r,u,f,e){if(this.dismiss(),this._parentElement=r,this._inputType=e,i&&i.length>0){this._menuItems=i;this._onDismiss=f;this._menuType=u;let e;if(n.config.scopeWithBackground&&!n.isRtl()&&(r.id==="optionsButton"||r.id==="userProfileButton")){let i=n.StaticHtmlElements.menuContainer;if(!i)return;let r=i.offsetWidth;e=n.StaticHtmlElements.root.offsetWidth-r-t}else e=r.offsetLeft;let o=r.offsetTop+r.offsetHeight+1;n.isRtl()&&(e+=r.offsetWidth);this.showMenu(e,o)}}showContextMenuOnElement(n,t,i,r,u){let f=t.getBoundingClientRect();this._inputType=r;let e=f.left+t.offsetWidth/2,o=f.top+this._page.getScrollTop()+t.offsetHeight/2;this.showContextMenuOnXY(n,e,o,i,this._inputType,u)}showContextMenuOnXY(t,i,r,u,f,e){if(this._parentElement=null,this._inputType=f,e){let n=t.childSuggestions.filter(n=>n.text===e.text);n&&n.length&&(t=n[0])}let o=n.getVerbsAsync("showContextMenu",t,n.config.rawVerbs,!1,e=>n.safeSetTimeout(()=>this.innerShowContextMenu(n.extendVerbs(e,t,this._page),i,r,(i,r,u,f)=>{n.InstrumentationHelper.instrumentItemClickForContextMenu(r,t.instItem,t.sequenceNumber,t.instrumentPingBack,u,f,i)},u,f),0,"showContextMenu handler"),()=>!0);e||o||(this._page.hideTemporaryMessage(),n.Host.setFocusInSearchBox(null,"noContextMenu"))}getSelectableItems(){if(this._menuItems){let n=[];if(this._menuStack.length>0){let t=this._menuStack[this._menuStack.length-1];n=t.subItems}else n=this._menuItems;return n.map(n=>n.groupItems?n.groupItems:[n]).reduce((n,t)=>(n.push(...t),n),[]).filter(n=>n.isSelectable)}return[]}getSelectableItemsByGroup(){return[]}getSelectedItem(){return this._selectedItem}getDataModel(){return{items:this._menuItems,showIcons:this._showIcons,clickHandler:this._itemClickHandler,menuType:this._menuType,enterHandler:this._itemEnterHandler,leaveHandler:this._itemLeaveHandler,expandIcon:this.getExpandIcon(),inputType:this._inputType}}getExpandIcon(){return{content:n.isRtl()?"&#xE76B":"&#xE76C",type:2}}select(n){if(this._selectedItem){let n=_ge(this._selectedItem.id);n&&n.blur();this._selectedItem.selected=!1}if(this._selectedItem=n,this._selectedItem){let n=_ge(this._selectedItem.id);n&&n.focus();this._selectedItem.selected=!0}n&&this.stickParent(n);this._page.updateMenuView(this.getDataModel())}stickParent(n){let t=this.getParent(n);t&&(t.isSticky=!0);let i=this.getSiblings(n);for(let n of i)n.isSticky&&(n.isSticky=!1,this._itemLeaveHandler(n,null))}isItemInMenuOrMenuGroup(n,t){return t.some(t=>t==n||t.groupItems&&t.groupItems.indexOf(n)>=0)}getParent(n){for(let t of this._menuStack)if(this.isItemInMenuOrMenuGroup(n,t.subItems))return t;if(this.isItemInMenuOrMenuGroup(n,this._menuItems))return null;throw new Error(`Item: '${n.id}' was not found`);}getSiblings(n,t=false){let i=this.getParent(n),r=i?i.subItems:this._menuItems;return r.map(n=>n.groupItems?n.groupItems:[n]).reduce((n,t)=>(n.push(...t),n),[]).filter(i=>i.isSelectable&&(t||i!=n))}selectSubItem(n,t){this.showSubMenu(n);this.select(t,!1)}reselectParentItem(){let n=this._menuStack[this._menuStack.length-1];this.dismissSubMenu();this.select(n,!1)}onAfterKeyDown(t,i,r,u){if((r||u)&&!n.isUpOrDownKey(t))return!1;if(t=n.getRtlAdjustedKey(t),t==39||t==13){let n=this._selectedItem;if(n&&n.subItems&&n.subItems[0]){let t=n.subItems.filter(n=>n.isSelectable)[0];if(t)return this.selectSubItem(n,t),!0}}else if(t==37){if(this._menuStack.length>0)return this.reselectParentItem(),!0}else if(n.isUpOrDownKey(t)&&this._selectedItem){let n=this._menuStack.length==0?_qs(".contextMenu"):_ge(this._menuStack[this._menuStack.length-1].id).querySelector(".contextMenu");return n&&this._page.scrollToElement(_ge(this._selectedItem.id),n,n.offsetHeight),!0}return t==13}isMenuVisible(){return!!this._menuItems}dismiss(t){if(this._menuItems&&(this._menuItems=null,this._selectedItem&&(this._selectedItem.selected=!1,this._selectedItem=null),this._page.updateMenuView(this.getDataModel()),n.StaticHtmlElements.menuContainer.classList.remove(i),n.StaticHtmlElements.menuContainer.style.width=null,n.setVisibility(n.StaticHtmlElements.menuContainer,!1),n.RuntimeConfig.PanelCanResize&&(n.StaticHtmlElements.root.style.minHeight="",this.adjustHeight()),this._menuStack=[]),t&&this._parentElement&&this._parentElement.focus(),this._parentElement=null,this._inputType=null,this._onDismiss){let n=this._onDismiss;this._onDismiss=null;n()}}adjustSubMenuPosition(i,r){if(this._menuItems){const f=n.StaticHtmlElements.menuContainer;let a=f.offsetWidth,v=r.offsetHeight,o=r.offsetWidth,y=0,e=window.getComputedStyle(r).paddingTop;e.endsWith("px")&&(e=e.substr(0,e.length-2),y=+e+1);let h=0,p=_qs("#menuContainer .contextMenu").scrollTop,c=n.isRtl(),l=6;for(let n of this._menuStack){let t=_ge(n.id).querySelector(".contextMenu");l=+t.style.zIndex;h+=t.offsetLeft;p+=t.scrollTop;c=t.offsetLeft<0}++l;let u=f.offsetLeft+h+i.offsetLeft,s=f.offsetTop+i.offsetTop-p-y,w=n.StaticHtmlElements.root.offsetWidth-(u+a),b=u,k=o<w,d=o<b;(c||!k)&&d?u-=o:c&&d||!k?u=b>w?t:n.StaticHtmlElements.root.offsetWidth-o-t:u+=a-2;s+v>n.StaticHtmlElements.root.offsetHeight&&(s=Math.max(n.StaticHtmlElements.root.offsetHeight-v,n.StaticHtmlElements.root.offsetTop));u-=f.offsetLeft+h;s-=f.offsetTop;r.style.left=u+"px";r.style.top=s+"px";r.style.zIndex=l.toString()}}adjustPosition(i,r,u){if(this._menuItems){const o=n.StaticHtmlElements.menuContainer;let f=o.offsetWidth,h=o.offsetHeight;f>n.StaticHtmlElements.root.offsetWidth&&(f=n.StaticHtmlElements.root.offsetWidth,o.style.width=f+"px");let e=i,s=r;n.isRtl()?(e-=f,e<0&&(e=u?t:i)):e+f>n.StaticHtmlElements.root.offsetWidth&&(e=u?n.StaticHtmlElements.root.offsetWidth-f-t:Math.max(i-f,n.StaticHtmlElements.root.offsetLeft));!u&&s+h>n.StaticHtmlElements.root.offsetHeight&&(s=Math.max(n.StaticHtmlElements.root.offsetHeight-h,n.StaticHtmlElements.root.offsetTop));o.style.left=e+"px";o.style.top=s+"px";n.RuntimeConfig.PanelCanResize&&(n.StaticHtmlElements.root.style.minHeight=s+h+"px",this.adjustHeight())}}getContextMenuItems(t,i){return t.map((t,r)=>{let u={id:encodeURIComponent(t.verb),text:t.displayName,isSeparator:!t.verb,selected:!1,isDefault:t.isDefault,icon:t.icon,getIcon:t.getIcon,click:undefined,title:undefined,cssClass:undefined,isSelectable:!!t.verb};return u.isSeparator?u.id="Separator"+r:u.click=(r,u)=>{i(t.verb,r,u,null),t.executeSync?(n.safeExecute(()=>t.executeSync(),"verb.executeSync",null,t.verb),this.dismiss()):n.Async.safeChain("verb.executeAsync",()=>t.executeAsync(),()=>this.dismiss(),null,null,t.verb)},u})}}n.MenuFactory=r}(WSB||(WSB={})),function(n){const t="ConnectedAccounts";class i{constructor(){this._accountsCache={};(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.clearSSOCache)&&this.clear();this.init()}setToken(n,t){this.setTokenInfo(t,n);this.writeToLocalStorage()}findAccount(n,t){let i=this._accountsCache[n];return i&&!this.isExpired(i.LastUpdated,t,i.ExpireDateTime)?i:null}clear(){this._accountsCache={};this.writeToLocalStorage()}init(){this._accountsCache={};let i=n.LightweightStorage.getItem(t);i&&(this._accountsCache=n.safeExecute(()=>JSON.parse(i),"parseConnectedAccountString",{}))}writeToLocalStorage(){n.LightweightStorage.setItem(t,JSON.stringify(this._accountsCache))}isExpired(t,i,r){if(i===undefined)return!1;if(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.forceTokenRefresh)return!0;let u=n.getCurrentTime();if(r&&u>r)return!0;let f=Math.floor((u-t)/6e4);return f<0||f>=i}setTokenInfo(t,i){let r=this._accountsCache[t],u=n.getCurrentTime();r={Token:i.Token,LastUpdated:u,ExpireDateTime:i.ExpireDateTime,TenantName:i.TenantName,RoutingHint:i.RoutingHint,UserName:i.UserName,TenantId:i.TenantId,UserObjectId:i.UserObjectId,UserFirstName:i.UserFirstName};this._accountsCache[t]=r}}n.TokenStore=i}(WSB||(WSB={})),function(n){const u="SelectedAuthAccountId",i="consumers",r="organizations",e=60,f="72f988bf-86f1-41af-91ab-2d7cd011db47";class t{constructor(n){this._tokenStore=n;this._pendingCallbacks={};this._availableMsaAccounts=[];this._availableAadAccounts=[];this._accessTokenAvailableHandlers=[];this._verifyAccountRequired=[];this._accountTypeChangedHandlers=[];this._accountsEnumeratedBeforeConnectHandlers=[];this._selectedAccountChangedBeforeConnectHandlers=[];this._selectedAccountChangedHandlers=[];this._reconnectAadReportHandlers=[];SearchAppWrapper.CortanaApp.addEventListener("experiencelaunched",()=>{SearchAppWrapper.CortanaApp.experienceId=="NotebookOffline"&&this._tokenStore.clear()})}static getWindowsAccountType(){return t._windowsAccountType}static internalSetWindowsAccountType(n){t._windowsAccountType=n}static getWindowsIdentity(){return t._windowsIdentity}static internalSetWindowsIdentity(n){t._windowsIdentity=n}static getMsaAccountsCount(){return t._msaAccountsCount}static internalSetMsaAccountsCount(n){t._msaAccountsCount=n}static getAadAccountsCount(){return t._aadAccountsCount}static internalSetAadAccountsCount(n){t._aadAccountsCount=n}authTypeMatchesWindowsAccountType(n){var i=t.getWindowsAccountType();return i==4||(n==0?i==2:i==1)}setWindowsAccountType(i){var r=t.getWindowsAccountType();t.internalSetWindowsAccountType(i);this.authTypeMatchesWindowsAccountType(1)&&n.isCloudSearchEnabledAadCache||(n.isMsftAccountConnected=!1);i!=r&&this.fireAccountTypeChanged()}getAllSyncingAccounts(n,t,i,r,u){let o=SearchAppWrapper.CortanaApp.fileExplorerSuggestionPage.registeredSyncRootInfo,f=[];for(let n in o){let t=o[n];typeof t=="string"&&t.includes("@")&&f.push(t)}f.length==0&&u([]);let e={responses:0,accounts:[]};for(let o of f)this.getAccountByUserName(n,t,o,i,r,n=>{++e.responses,n&&n.Token&&e.accounts.push(n),e.responses==f.length&&u(e.accounts)})}getAllAvailableAccounts(n){return n==0?this.getEnabledMSAAccounts().slice(0):this.getEnabledAADAccounts().slice(0)}getCachedAccountInfo(n){if(!this.authTypeMatchesWindowsAccountType(n))return null;switch(n){case 1:return this._cachedAAD;case 0:return this._cachedMSA;default:return null}}getSelectedAccountInfo(){let i=n.LightweightStorage.getItem(u),t;const r=this.getEnabledAADAccounts().concat(this.getEnabledMSAAccounts());if(r.length>0){if(i&&(t=r.filter(n=>n.accountId==i)[0],t))return this.cacheAccount(t),t;if(!t){const n=this.getEnabledAADAccounts(),i=this.getEnabledMSAAccounts();if(n.length>0){const i=n.findIndex(n=>n.isDefaultAccount==!0);t=i>-1?n[i]:n[0]}else if(i.length>0){const n=i.findIndex(n=>n.isDefaultAccount==!0);t=n>-1?i[n]:i[0]}}t&&this.setSelectedAccount(t,0)}return t}setSelectedAccount(i,r){this.cacheAccount(i);let f=n.LightweightStorage.getItem(u);if(n.LightweightStorage.setItem(u,i.accountId),t.getWindowsAccountType()!=4){let t=this.getAccountType(i);if(f==i.accountId)return;let e=this.isAadAccount(f),o=this.isAadAccount(i.accountId);e&&o&&_w.bfbWsbTel&&bfbWsbTel.logValue("AccountChanged","AadToAad");this.setWindowsAccountType(t);n.config.msbEnableAccountManager&&this.fireSelectedAccountChangedBeforeConnect({prevousAccountId:f,nextAccount:i});this.connectAccounts([i],r);n.LightweightStorage.setItem(u,i.accountId);this.fireSelectedAccountChanged(i);(n.VelocityKeys===null||n.VelocityKeys===void 0?void 0:n.VelocityKeys.isFeatureEnabled(40979072))&&(SearchAppWrapper.CortanaApp.authenticationManager.currentAccount=i);r==3&&n.InstrumentationHelper.logClientInstEvent("ClientInst","AccountChanged",n.SequenceNumberManager===null||n.SequenceNumberManager===void 0?void 0:n.SequenceNumberManager.getSequenceNumber(),{accountType:t===null||t===void 0?void 0:t.toString()})}}reconnectAad(n){const u=this.getSelectedAccountInfo();if((u===null||u===void 0?void 0:u.accountProviderAuthority)!==r){n();return}const e=500,o=40;let i=0;const t={success:!0,retryCount:i,errors:[]},f=()=>{this.getAccount(1,"https://substrate.office.com",!1,!0,(r,u)=>{r?(t.success=!0,t.retryCount=i,this.fireReconnectAadReport(t),n()):(t.errors.push(u||"<EMPTY>"),i>o?(t.success=!1,t.retryCount=i,this.fireReconnectAadReport(t),n()):(i++,sb_st(f,e)))},u)};f()}isMsaAvailable(){return this._availableMsaAccounts.length>0}isAadAvailable(){return this._availableAadAccounts.length>0}getSelectedAccountId(){return n.LightweightStorage.getItem(u)}isAadAccount(n){return this._availableAadAccounts.filter(t=>t.accountId==n).length>0}cacheAccount(t){n.Host.isAccountNotConsented(t)||(t.accountProviderAuthority==i?this._cachedMSA=t:this._cachedAAD=t)}cacheAllAccounts(r){this._availableMsaAccounts=[];this._availableAadAccounts=[];for(let t of r)n.Host.isAccountNotConsented(t)||(t.accountProviderAuthority==i?this._availableMsaAccounts.push(t):this._availableAadAccounts.push(t));t.internalSetMsaAccountsCount(this._availableMsaAccounts.length);t.internalSetAadAccountsCount(this._availableAadAccounts.length)}getEnabledMSAAccounts(){return n.isCloudSearchEnabledMsaCache?this._availableMsaAccounts:[]}getEnabledAADAccounts(){return n.isCloudSearchEnabledAadCache?this._availableAadAccounts:[]}getAccountType(n){const{accountProviderAuthority:t}=n;switch(t){case i:return 2;case r:return 1;default:return 3}}getAccountByUserName(t,i,r,u,f,e){let o,s=i==0?this._availableMsaAccounts:this._availableAadAccounts;if(s.length>0&&(o=s.find(n=>n.accountUserName.toLocaleLowerCase()==r.toLocaleLowerCase())),o){let r=t?n.getSubstrateResourceOrScope(i):n.getBingResourceOrScope(i);this.getAccount(i,r,u,f,e,o)}else e(null)}getAccountByUserNamePromise(n,t,i,r,u){return new Promise(f=>{this.getAccountByUserName(n,t,i,r,u,f)})}getAccount(n,t,i,r,u,f){if(!t)throw new Error("Resource or Scope has to be set");let o=n=>{let t=this._pendingCallbacks[e];this._pendingCallbacks[e]=null;t.forEach(t=>t(n))};if(!this.authTypeMatchesWindowsAccountType(n)){u(null,"AuthTypeMismatch");return}f||(f=this.getCachedAccountInfo(n));let e=t+i+r+(f?f.accountId:"");if(this._pendingCallbacks[e]){this._pendingCallbacks[e].push(u);return}this._pendingCallbacks[e]=[u];this.authenticate(n,t,i,r,o,f)}authenticate(t,i,r,u,o,s){let c=`${t}.${i}${s?"|"+s.accountId:""}`;if(u){const u=r?0:e,s=n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.noAuthCache;let i=s?null:this._tokenStore.findAccount(c,u);if(i){t==1&&(n.isMsftAccountConnected=i.RoutingHint&&i.RoutingHint.indexOf(f)>-1);o(i);return}}let h=n=>o(null,n);if(n.isBrowserOnline()){let r=SearchAppWrapper.CortanaApp.authenticationManager.createAuthenticateRequest();r.accountType="Windows";r.silentMode=u;t==1?r.resource=i:r.scope=i;let e=s&&SearchAppWrapper.CortanaApp.authenticationManager.authenticateSearchWebAccountAsync;const l=e?()=>SearchAppWrapper.CortanaApp.authenticationManager.authenticateSearchWebAccountAsync(r,s):()=>SearchAppWrapper.CortanaApp.authenticationManager.authenticateAsync(r);n.Async.safeChain("authenticateAsyncWAM",l,i=>{if(n.TestHookUrlParameters)if(u){if(n.TestHookUrlParameters.ssoAuthFail){h("MockedError");return}}else if(n.TestHookUrlParameters.uxAuthFail){h("MockedError");return}if(!i){n.log("WAM returned null");h("WamReturnsNull");return}if(i.token){const r=i.properties,u=r.UPN||i.userName,e=r.tid||r.TenantId,s=r.OID;if(!u){n.log("WAM didn't return UPN");h("WamReturnsNoUpn");return}let l;t==0?l=`MSA:${u}`:(n.isMsftAccountConnected=e==f,e&&s&&(l=`OID:${s}@${e}`));const a={Token:i.token,ExpireDateTime:r.exp?parseInt(r.exp)*1e3-3e5:null,TenantName:r.tenant_display_name||"",RoutingHint:l||u,UserName:u,TenantId:e,UserObjectId:s,UserFirstName:r.FirstName||""};t==0&&(a.ExpireDateTime=n.getCurrentTime()+n.HourToMs);this._tokenStore.setToken(a,c);const v=this._tokenStore.findAccount(c);o(v)}else{const t=JSON.stringify({errorCode:i.errorCode,errorMessage:i.errorMessage,status:i.status,accountId:i.accountId,authority:i.authority}),u=JSON.stringify({accountProviderId:r.accountProviderId,clientId:r.clientId,resource:r.resource,scope:r.scope,accountType:r.accountType,silentMode:r.silentMode});n.log(`WAM error: result=${t}, request=${u}; useMultiauth=${!!e}`);h(`WamError: ${t}`)}},n=>h(`AsyncCallError: ${(n===null||n===void 0?void 0:n.message)||JSON.stringify(n)}`))}else h("NotOnline")}bindAccessTokenAvailable(n){this._accessTokenAvailableHandlers.push(n)}bindVerifyAccountRequired(n){this._verifyAccountRequired.push(n)}bindAccountTypesChanged(n){this._accountTypeChangedHandlers.push(n)}bindAccountsEnumeratedBeforeConnect(n){this._accountsEnumeratedBeforeConnectHandlers.push(n)}bindSelectedAccountChangedBeforeConnect(n){this._selectedAccountChangedBeforeConnectHandlers.push(n)}bindSelectedAccountChanged(n){this._selectedAccountChangedHandlers.push(n)}bindReconnectAadReport(n){this._reconnectAadReportHandlers.push(n)}fireAccountTypeChanged(){this._accountTypeChangedHandlers.forEach(n=>n())}fireAccountsEnumeratedBeforeConnect(){this._accountsEnumeratedBeforeConnectHandlers.forEach(n=>n())}fireSelectedAccountChangedBeforeConnect(n){this._selectedAccountChangedBeforeConnectHandlers.forEach(t=>t(n))}fireSelectedAccountChanged(n){this._selectedAccountChangedHandlers.forEach(t=>t(n))}fireReconnectAadReport(n){this._reconnectAadReportHandlers.forEach(t=>t(n))}tryConnect(t,i,r){let f=t==1?n.isSubstrateO365AccountConnected:n.isSubstrateOutlookAccountConnected;if(!f){const u=n.getSubstrateResourceOrScope(t);this.getAccount(t,u,!1,!0,i=>{let f=!!i;t==1?n.isSubstrateO365AccountConnected=f:n.isSubstrateOutlookAccountConnected=f;f?this._accessTokenAvailableHandlers.forEach(i=>n.safeExecute(()=>i(t,u,r),"accessTokenAvailable",null,`${t}`)):this._verifyAccountRequired.forEach(i=>n.safeExecute(()=>i(t,u,r),"accessTokenAvailable",null,`${t}`))},i)}}updateWindowsAccountType(t){let e=!1,f=!1;for(let u of t)switch(u.accountProviderAuthority){case i:e=n.isCloudSearchEnabledMsaCache;break;case r:f=n.isCloudSearchEnabledAadCache}let u=3;if(n.config.userProfileButtonEnabled){let n=this.getSelectedAccountInfo();n&&(u=this.getAccountType(n))}else!f||!n.isMsbEnterprise()||(n.MockUrlParameters===null||n.MockUrlParameters===void 0?void 0:n.MockUrlParameters.isTest)?e&&f?u=4:f?u=1:e&&(u=2):u=1;this.setWindowsAccountType(u)}connectAccounts(t,u){n.isSubstrateO365AccountConnected=!1;n.isSubstrateOutlookAccountConnected=!1;for(let f of t)f.accountProviderAuthority==i&&n.isCloudSearchEnabledMsaCache?this.tryConnect(0,f,u):f.accountProviderAuthority==r&&n.isCloudSearchEnabledAadCache&&this.tryConnect(1,f,u)}accountTypeToAuthType(n){switch(n){case 2:return 0;case 1:return 1;default:throw new Error(`Not a logged in account: ${n}`);}}enumerateAccountAuthority(u){n.Async.safeChain("enumerateAccountAuthorityAsync",()=>SearchAppWrapper.CortanaApp.authenticationManager.enumerateAccountAuthorityAsync(),f=>{var e=t.getWindowsAccountType();if(e==0){let u=3;switch(f.Windows){case i:u=2;break;case r:u=1}if(this.setWindowsAccountType(u),e=t.getWindowsAccountType(),e!=3){let i=this.accountTypeToAuthType(e);this.getAccount(i,n.getBingResourceOrScope(i),!1,!0,n=>{let i=n&&n.UserName?n.UserName:"";t.internalSetWindowsIdentity(i)},undefined)}}n.substrateProvidersEnabled()&&(n.isCloudSearchEnabledAadCache&&e==1?this.tryConnect(1,null,1):n.isCloudSearchEnabledMsaCache&&e==2&&this.tryConnect(0,null,1));u()})}enumerateMultiAccountAuthority(u){if(!SearchAppWrapper.CortanaApp.authenticationManager.getAllSearchWebAccountsAsync){this.enumerateAccountAuthority(u);return}let f;n.Async.safeChain("getAllSearchWebAccountsAsync",()=>(f=n.getCurrentTime(),SearchAppWrapper.CortanaApp.authenticationManager.getAllSearchWebAccountsAsync()),e=>{const c=n.getCurrentTime()-f,y=n.getCurrentTime();this.cacheAllAccounts(e);let o=[],l=this.getSelectedAccountId();if(this._availableMsaAccounts.length>0){let n=this._availableMsaAccounts.findIndex(n=>n.accountId==l),t=n>=0?n:Math.max(this._availableMsaAccounts.findIndex(n=>n.isDefaultAccount),0),i=this._availableMsaAccounts[t];o.push(i)}if(this._availableAadAccounts.length>0){let n=this._availableAadAccounts.findIndex(n=>n.accountId==l),t=n>=0?n:Math.max(this._availableAadAccounts.findIndex(n=>n.isDefaultAccount),0),i=this._availableAadAccounts[t];o.push(i)}if(!n.config.userProfileButtonEnabled)for(let n of o)this.cacheAccount(n);const p=t.getWindowsAccountType();if(this.updateWindowsAccountType(o),n.config.msbEnableAccountManager&&this.fireAccountsEnumeratedBeforeConnect(),t.getWindowsAccountType()!=p){const u=(i,r)=>{this.getAccount(i,n.getBingResourceOrScope(i),!1,!0,n=>{let i=n&&n.UserName?n.UserName:"";t.internalSetWindowsIdentity(i)},r)};for(let t of o)t.accountProviderAuthority==i&&n.isCloudSearchEnabledMsaCache?u(0,t):t.accountProviderAuthority==r&&n.isCloudSearchEnabledAadCache&&u(1,t)}(n.isCloudSearchEnabledAadCache||n.isCloudSearchEnabledMsaCache)&&n.substrateProvidersEnabled()&&this.connectAccounts(o,1);u();const s="WebAccounts";let a=_G.ServerIG;if(!a){SharedLogHelper.LogError("instrumentPerformance "+s,"Could not instrument as server IG not known",new Error("Could not instrument performance "+s));return}const v=n.getCurrentTime()-y;let w={AllSearchWebAccounts:c,AllSearchWebAccountsCallback:v};const b=[w];let h=n.InstrumentationCommon.createPerfPingEvent(a,b,s);Log2.LogEvent(h.EventType,h.Data,n.InstrumentationCommon.QFPERFPING_EVENT_NAME,null,null,h.ImpressionGuid,null,null)})}promptAutheticateDialog(t,i,r,u){const f=f=>{let e=!!f;t==1?n.isSubstrateO365AccountConnected=e:n.isSubstrateOutlookAccountConnected=e;e?(r(),this._accessTokenAvailableHandlers.forEach(r=>n.safeExecute(()=>r(t,i,2),"promptAccessTokenAvailable",null,`${t}`))):(u(),this._verifyAccountRequired.forEach(r=>n.safeExecute(()=>r(t,i,2),"promptAccessTokenAvailable",null,`${t}`)))};this.getAccount(t,i,!1,!1,f,undefined)}}t._windowsAccountType=0;n.AccessTokenManager=t}(WSB||(WSB={})),function(n){const r="cohortProfile",u="WSBFirstOpenedDate",f=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/,i=29;class t{static getSingleton(){return t._singleton||SharedLogHelper.LogError("cohortProfileManager.getSingleton()",null,"CohortProfileManager._singleton should be initialized first!"),t._singleton}static initSingleton(){return t._singleton||(t._singleton=new t),t._singleton}constructor(){this._cohortProfile=[];n.Host.bindShown(()=>{this.deserializeCohortProfile(),this.updateCohortProfileBasedOnWSBOpenedDate(),this.determineWSBNewUser()});n.Host.bindDismissed(()=>{this.serializeCohortProfile()})}serializeCohortProfile(){n.LightweightStorage.setItem(r,JSON.stringify(this._cohortProfile));n.LightweightStorage.setItem(u,JSON.stringify(this._WSBFirstOpenedDate))}deserializeCohortProfile(){let t=n.LightweightStorage.getItem(r);t&&(this._cohortProfile=n.safeExecute(()=>JSON.parse(t,this.reviver),"cohortProfile",null));let i=n.LightweightStorage.getItem(u);i&&(this._WSBFirstOpenedDate=n.safeExecute(()=>JSON.parse(i,this.reviver),"firstOpen",null))}reviver(n,t){return typeof t=="string"&&f.test(t)?new Date(t):t}createCohortProfile(){this._cohortProfile=[];for(let n=0;n<30;n++)this._cohortProfile.push({date:null,count:0});let n=new Date;this._cohortProfile[i].date=this.getCurrentDate(n);this._cohortProfile[i].count=1}recordWSBFirstOpenedDate(){for(let n=0;n<30;n++)this._cohortProfile[n].date&&(!this._WSBFirstOpenedDate||this._cohortProfile[n].date<this._WSBFirstOpenedDate)&&(this._WSBFirstOpenedDate=this._cohortProfile[n].date)}updateCohortProfileBasedOnWSBOpenedDate(){if(this._cohortProfile.length==0)this.createCohortProfile(),this.recordWSBFirstOpenedDate();else{this._WSBFirstOpenedDate||this.recordWSBFirstOpenedDate();let t=this.getWSBLastOpenedDate(),r=new Date,n=this.getCurrentDate(r);if(t.getTime()===n.getTime())this._cohortProfile[i].count+=1;else{let r=this.getDaysBetween(t,n);if(r>30)this.createCohortProfile();else{let t=[];for(let n=0;n<30;n++)t.push({date:this._cohortProfile[n].date,count:this._cohortProfile[n].count});for(let n=r;n<30;n++)this._cohortProfile[n-r]=t[n];for(let t=0,n=30-r;t<r;t++,n++)this._cohortProfile[n].date=null,this._cohortProfile[n].count=0;this._cohortProfile[i].date=n;this._cohortProfile[i].count=1}}}}getCurrentDate(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate())}getDaysBetween(n,t){var i=n.getTime(),r=t.getTime(),u=r-i;return Math.round(u/864e5)}determineWSBNewUser(){this._isWSBNewUser=!1;let n=7,t=0;for(let i=30-n;i<30-t;i++)this._WSBFirstOpenedDate!=null&&this._cohortProfile[i].date!=null&&this._WSBFirstOpenedDate.getTime()===this._cohortProfile[i].date.getTime()&&(this._isWSBNewUser=!0)}isWSBNewUser(){return this._isWSBNewUser}getWSBFirstOpenedDate(){return this._WSBFirstOpenedDate}getWSBLastOpenedDate(){return this._cohortProfile[i].date}getTimesOfWSBOpenedInLastNDays(n){if(n>30)return-1;let t=0;for(let i=30-n;i<30;i++)t+=this._cohortProfile[i].count;return t}resetCohortProfileManager(){t._singleton=null;this._cohortProfile=[];this._WSBFirstOpenedDate=null}resetWSBFirstOpenedDate(){this._WSBFirstOpenedDate=null}}n.CohortProfileManager=t}(WSB||(WSB={})),function(n){var t;(function(t){function i(){n.Host.bindAppHidden(()=>{SearchAppWrapper.CortanaApp.isBingEnabled&&n.isBrowserOnline()&&n.safeExecute(()=>r.start("asgw",["fp.msedge.net/conf/v2/asgw/fpconfig.min.json"],2e3),"AFDFootprint.start",null,null)})}t.init=i;var r=(()=>{function ct(t,u,f,e="",o="",s={},h){try{if(!t||t.trim().length===0||Number(f)!==f||f%1!=0||f<0)return;const v=o.trim().length>0,p=e.trim().length>0;p&&e.trim().length>l&&(e=e.trim().substr(0,l));var c=window.location.protocol=="file:"?"https://":window.location.protocol+"//";if(!JSON||!XMLHttpRequest)return;if(window.XMLHttpRequest){const n=new XMLHttpRequest;if(!("onload"in n)||!("onerror"in n)||!("ontimeout"in n)||!("getAllResponseHeaders"in n))return}else return;const b=y(),k=i(),g=`MonitorID=${t}${v?`&customerId=${o}`:""}&rid=${k}&w3c=${b}&prot=${window.location.protocol}&v=${ft}${p?`&tag=${e}`:""}&DATA=`,w=()=>{const n=lt(fpconfig,c);if(n.length!==0){const i=at(n,c,d,s),t=[];for(let n of fpconfig.r)t.push(c+n+"?"+g);pt(i,a,f,t,null,h)}};if(typeof fpconfig=="undefined"){for(let n in u)u[n]=c+u[n]+"?"+`monitorId=${t}${v?`&customerId=${o}`:""}`;const i=n=>{fpconfig=JSON.parse(n.responseText),w()};r(u,0,n,i)}else w()}catch(v){}}function r(t,i,u,f){if(!(i>=t.length)){u!==n&&u!==rt&&(u=n);const o=()=>{r(t,i+1,u,f)},e=new XMLHttpRequest;e.open(u,t[i],!0);e.onload=()=>{e.readyState===4&&e.status===200?f!=null&&f(e):o()};e.onerror=o;e.timeout=a;e.ontimeout=o;e.send()}}function lt(n,r){const e=[];let l=0;const p=b|t;for(let t of n.e)t.w>0&&t.m&p&&(l+=t.w,e.push({endpoint:t.e,cumWeight:l,weight:t.w,measurementTypes:t.m}));const a=r.toLowerCase()===k?[f,s,c]:[u,o,h],w=[v,nt,v],d=[1,3,2],y=[],g=Math.min(n.n,e.length);for(let n=0;n<g;n++){const t=Math.floor(Math.random()*l);let n=null;for(let i=0;i<e.length;i++)n==null?t<e[i].cumWeight&&(n=e[i],e[i].cumWeight=0):e[i].cumWeight-=n.weight;l-=n.weight;const r=n.endpoint.charAt(0)==="*"?i():"";for(let t=0;t<a.length;t++)n.measurementTypes&a[t]&&y.push({id:n.endpoint,testImage:w[t],measurementType:a[t],guid:r,rank:d[t]})}return y.sort((n,t)=>n.rank-t.rank),y}function at(n,r,u,f={}){const e=[];for(let o of n){const h=o.measurementType,c=o.testImage,l=o.guid;let n=o.id,s=r+(f&&f[n]||n);if(n.indexOf(".")===-1)s+=".clo.footprintdns.com";else if(n.charAt(0)==="*"){const t=n.substring(2);s=r+l+"."+t;n=t==="clo.footprintdns.com"||t==="fp.measure.office.com"||t==="azr.footprintdns.com"?l:t}s+=g;const a=s+u+"?"+i(),v=(h&t)!==h;e.push({url:a,requestID:n,object:u,conn:"cold",measurementType:h,report:v});const y=s+c+"?"+i();e.push({url:y,requestID:n,object:c,conn:"warm",measurementType:h,report:!0})}return e}function vt(n,t,i,r,u,f){const e=[];for(let o=0;o<f.length;o++)if(f[o].report){const c=n[o],h=f[o].measurementType,l=yt(c,h),s={};s.RequestID=f[o].requestID;s.Object=f[o].object;s.Conn=f[o].conn;s.Result=l;s.T=h;t[o]&&(s.Rip=t[o]);i[o]&&(s.Ep=i[o]);r[o]&&(s.Fe=r[o]);u[o]&&(s.Mn=u[o]);e.push(s)}return e}function yt(n,i){if(n<=0)return n;if(i&t&&n>0){const t=tt/(n/it);return Math.round(t)}return Math.round(n)}function i(){function n(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}return n()+n()+n()+n()+n()+n()+n()+n()}function y(){return window.performance&&window.performance.getEntriesByName?!0:!1}function pt(t,i,u,f,e,o){function c(n){t[n].conn==="cold"?(t[n+1].report=!1,l(n+2)):l(n+1)}function k(n){let r;const u=new Image;u.onload=()=>{s[n]=(new Date).getTime()-f,r&&clearTimeout(r),l(n+1)};u.onerror=()=>{r&&clearTimeout(r),c(n)};r=setTimeout(()=>{u.onload=null,u.onerror=null,c(n)},i);let f=(new Date).getTime();u.src=t[n].url}function d(r){try{const u=new XMLHttpRequest;u.open(n,t[r].url,!0);u.onload=()=>{try{if(u.readyState===4)if(u.status===200){s[r]=(new Date).getTime()-f;const n=u.getAllResponseHeaders();if(n){const t=n.split("\r\n");t.forEach(function(n){var t=n.substring(0,n.indexOf(":")).toLowerCase(),i=n.substring(n.indexOf(":")+1);t===et?a[r]=i:t===ot?v[r]=i:t===st?w[r]=i:t===ht&&(b[r]=i)})}l(r+1)}else s[r]=0-u.status,c(r);else c(r)}catch(n){}};u.onerror=()=>{c(r)};u.ontimeout=()=>{c(r)};u.timeout=i;const f=(new Date).getTime();u.send()}catch(u){}}function l(n){try{n<t.length?t[n].measurementType&p?k(n):d(n):(g(),e!=null&&e())}catch(i){}}const s=[],a=[],v=[],w=[],b=[];for(var h=0;h<t.length;h++)s[h]=ut,a[h]=null,v[h]=null,w[h]=null,b[h]=null;const g=()=>{if(f!=null&&f.length!==0){if(y())for(let n=0;n<t.length;n++){const r=t[n].url,i=window.performance.getEntriesByName(r);s[n]>=0&&i&&i[0]&&(s[n]=i[0].duration)}const i=vt(s,a,v,w,b,t),e=JSON.stringify(i),u=[];for(let n=0;n<f.length;n++){const t=f[n]+e;u.push(t)}r(u,0,n,()=>{try{o&&o(i)}catch(n){}})}};setTimeout(()=>{l(0)},u)}const u=1,f=2,e=u|f,o=8,s=16,t=o|s,p=e|t,h=128,c=256,w=h|c,b=e|w,k="http://",l=200,d="trans.gif",g="/apc/",a=5e3,v="trans.gif",nt="100k.gif",tt=822.128,it=1e3,n="GET",rt="POST",ut=-1,ft="20190506",et="x-userhostaddress",ot="x-endpoint",st="x-frontend",ht="x-machinename";return{start:ct}})()})(t=n.AFDFootprintV2||(n.AFDFootprintV2={}))}(WSB||(WSB={})),function(n){class t{constructor(n,t){this.id=n;this._controller=t;this.flyoutMaxHeight=170;this.slackSize=10;this.currentStep=0;this.steps=[];this.dismissIntervalMs=0;this.repeatMax=1}addMessage(n,t=null,i,r,u){let f={message:n,title:t};return i&&(f=Object.assign(Object.assign({},f),this.getPositions(i))),r&&(f.id=r),u&&(f.iconKey=u),this.steps.push(f),this}button(n,t,i,r){return this.buttonMessage=n,this.buttonIcon={content:r,type:2},this.buttonClickHandler=i==1?(n,i)=>{this.hide(),t(n,i)}:(n,i)=>{this.dismiss(),t(n,i)},this}showButton(n){return this.showButtonMessage=n,this}icon(n){return this._icon=n,this}overlay(n){return this._overlay=n,this}hasOverlay(){return this._overlay}isLinkTextButton(n){return this._isLinkText=n,this}getPositions(t,i){var f,e,o,s,h,c,l,a;const it=n.RuntimeConfig.QfMode===0||n.RuntimeConfig.QfMode===4||n.RuntimeConfig.QfMode===11;let v=it?336:400,y=152;const k=(e=(f=n.StaticHtmlElements.root)===null||f===void 0?void 0:f.scrollHeight)!==null&&e!==void 0?e:document.body.scrollHeight,d=(s=(o=n.StaticHtmlElements.root)===null||o===void 0?void 0:o.scrollWidth)!==null&&s!==void 0?s:document.body.scrollWidth,r=t.getBoundingClientRect();if(!i){const n=r.bottom>k-this.flyoutMaxHeight;i=n?"Top":"Bottom"}let g,u,p,nt,w;const tt=r.top+r.height/2,b=(c=(h=n.StaticHtmlElements.root)===null||h===void 0?void 0:h.getBoundingClientRect().top)!==null&&c!==void 0?c:0;switch(i){case"Top":g=k-r.top+this.slackSize;break;case"Bottom":u=r.bottom+this.slackSize-b;break;case"Left":u=Math.max(Math.min(tt-y/2-b,d-y),4);break;default:return null}switch(i){case"Top":case"Bottom":const t=r.left+r.width/2;p=Math.max(Math.min(t-v/2,d-v),this.slackSize);w=Math.max(Math.min(t-p-this.slackSize,v-this.slackSize),this.slackSize);break;case"Left":const i=(a=(l=n.StaticHtmlElements.root)===null||l===void 0?void 0:l.getBoundingClientRect().right)!==null&&a!==void 0?a:0;nt=i-r.left+this.slackSize;w=Math.max(Math.min(tt-u-b-this.slackSize,y-this.slackSize),this.slackSize)}return{position:i,top:u,bottom:g,left:p,right:nt,beakOffset:w}}target(n,t){if(!n)return this;const i=this.getPositions(n,t);return this.position=i.position,this.bottom=i.bottom,this.top=i.top,this.beakOffset=i.beakOffset,this.left=i.left,this.right=i.right,this}setSticky(){return this.sticky=!0,this}isSticky(){return this.sticky}show(){return(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isTest)&&!(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.showFlyoutInTests)||this._controller.showFlyout(this),this}dismissible(n,t){return this.dismissIntervalMs=n,this.dismissMessage=t,this}repeat(n){return this.repeatMax=n,this}dataModel(){if(!this.isValid())return null;const n=this.steps[this.currentStep],{message:t,title:i}=n;return{title:i,message:t,flyoutClass:this.flyoutClass,left:this.stepHasProperty("left")?n.left:this.left,right:this.stepHasProperty("right")?n.right:this.right,top:this.stepHasProperty("top")?n.top:this.top,bottom:this.stepHasProperty("bottom")?n.bottom:this.bottom,beakOffset:this.stepHasProperty("beakOffset")?n.beakOffset:this.beakOffset,nextStep:()=>this.nextStep(),nbSteps:this.steps.length,currentStep:this.currentStep,position:this.stepHasProperty("position")?n.position:this.position,iconKey:this.stepHasProperty("iconKey")?n.iconKey:this._icon,showDismissButton:this.dismissIntervalMs!=null&&this.dismissMessage!=null,buttonClickHandler:(t,i)=>{this.buttonClickHandler(t,i),this._controller.instrumentClientEvent("FlyoutSubmit",{id:this.stepHasProperty("id")?n.id:this.id})},showButtonMessage:this.showButtonMessage,buttonMessage:this.buttonMessage,buttonIcon:this.buttonIcon,dismissMessage:this.dismissMessage,dismissClickHandler:()=>{this.dismiss(),this._controller.instrumentClientEvent("FlyoutDismiss",{id:this.stepHasProperty("id")?n.id:this.id})},id:this.stepHasProperty("id")?n.id:this.id,overlay:this._overlay,isLinkText:this._isLinkText}}setClass(n){return this.flyoutClass=n,this}isValid(){return this.steps.length>0&&(!isNaN(this.left)||!isNaN(this.right))&&(!isNaN(this.top)||!isNaN(this.bottom))||!!(n.TestHookUrlParameters===null||n.TestHookUrlParameters===void 0?void 0:n.TestHookUrlParameters.isTest)}dismiss(){return this._controller.dismissFlyout(this.id),this}shouldBeShown(){let t=this._controller.getLastTimeShown(this.id),i=this._controller.getTimesShown(this.id);return(t==0||t+this.dismissIntervalMs<=n.getCurrentTime())&&i<this.repeatMax}hide(){return this.currentStep=0,this._controller.hideFlyout(this.id),this}nextStep(){this.currentStep=Math.min(this.currentStep+1,this.steps.length-1);this.show()}stepHasProperty(n){return n in this.steps[this.currentStep]}}class i{constructor(n){this._page=n;this.lastShownKey=n=>`flyout-last-shown-${n}`;this.timesShownKey=n=>`flyout-times-shown-${n}`}createFlyout(n){return new t(n,this)}showFlyout(n){const t=this.currentFlyout&&this.currentFlyout.id!=n.id;if(t&&(this.currentFlyout=n),this.currentFlyout=n,this.shouldShow(this.currentFlyout)){const t=n.dataModel();t&&(this._page.renderFlyoutAreaView(t),this.instrumentClientEvent("FlyoutShow",{id:this.currentFlyout.id}))}}hideFlyout(t=null){t&&this.currentFlyout&&t!==this.currentFlyout.id||(this.currentFlyout&&this.currentFlyout.hasOverlay()&&(this._page.hideOverlayAreaView(),n.StaticHtmlElements.root.classList.remove("overlayEnabled")),this.currentFlyout=null,this._page.hideFlyoutAreaView())}dismissFlyout(t){t&&this.currentFlyout&&t!==this.currentFlyout.id||(this.hideFlyout(t),n.LightweightStorage.setItem(this.lastShownKey(t),n.getCurrentTime().toString()),n.LightweightStorage.setItem(this.timesShownKey(t),(this.getTimesShown(t)+1).toString()))}wasDismissed(t){return!!n.LightweightStorage.getItem(this.lastShownKey(t))}shouldShow(n){return n.shouldBeShown()}getLastTimeShown(t){const i=parseInt(n.LightweightStorage.getItem(this.lastShownKey(t)));return i?i:0}getTimesShown(t){const i=parseInt(n.LightweightStorage.getItem(this.timesShownKey(t)));return i?i:0}onQueryChange(n){this.currentFlyout&&!this.currentFlyout.isSticky()&&this.queryOnActivation&&n.fullPartialQuery!=this.queryOnActivation.fullPartialQuery&&this.currentFlyout.hide()}setQuery(n){this.queryOnActivation=n}instrumentClientEvent(t,i={}){n.InstrumentationHelper!=null&&n.InstrumentationHelper.logClientInstEvent("Select",t,n.SequenceNumberManager.getSequenceNumber(),i)}}n.FlyoutController=i}(WSB||(WSB={})),function(n){const r="show",i=10,t=7;class u{constructor(t){this._page=t;n.Host.bindKeyEscape(n=>{this.isPopoverVisible()&&(n.handled=!0,this.dismiss(!0))});n.Host.bindShown(()=>{this.dismiss(!1)});sj_be(n.StaticHtmlElements.popoverContainer,"mouseenter",()=>{this.clearDismissTimer()});sj_be(n.StaticHtmlElements.popoverContainer,"mouseleave",()=>{this.waitForEnterBeforeDismiss()});this.onMouseLeavesParent=this.onMouseLeavesParent.bind(this)}getElementOffsetFromRoot(t){let r=0,i=0;while(t&&t!=n.StaticHtmlElements.root)r+=t.offsetLeft,i+=t.offsetTop-t.scrollTop,t=t.offsetParent;if(n.config.enableAnaheimWin11ZITopSites){let n=this._page.getScrollTop();i-=n}return[r,i]}showPopover(n,t,i,r,u,f,e){if(this._parentElement){if(this._parentElement==i){this.clearDismissTimer();return}this.dismiss(e)}if(this._returnFocusToSearchBox=r,this._finishedOpening=!1,this._parentElement=i,sj_be(this._parentElement,"mouseleave",this.onMouseLeavesParent),n){this._text=n;this._buttons=t;this._className=f||"";let[r,o]=this.getElementOffsetFromRoot(i);r+=i.offsetWidth/2;this.showPopoverAt(r,o,u,e)}}isPopoverVisible(){return!!this._text&&this._finishedOpening}dismiss(t,i){this.clearDismissTimer();this._text&&(this._text=null,this._buttons=[],this._className="",n.StaticHtmlElements.popoverContainer.firstChild.blur(),this._selectedItem&&(this._selectedItem.selected=!1,this._selectedItem=null),this._page.updatePopoverView(this.getDataModel(i)),n.StaticHtmlElements.popoverContainer.classList.remove(r),n.setVisibility(n.StaticHtmlElements.popoverContainer,!1),n.StaticHtmlElements.popoverContainer.style.top=null,n.StaticHtmlElements.popoverContainer.style.width=null,n.StaticHtmlElements.popoverContainer.style.bottom=null,n.StaticHtmlElements.popoverContainer.style.left=null);this._parentElement&&(sj_ue(this._parentElement,"mouseleave",this.onMouseLeavesParent),t&&(this._parentElement.focus(),this._returnFocusToSearchBox&&n.Host.setFocusInSearchBox(null,"popoverDismissed")));this._parentElement=null}getSelectableItems(){return this._buttons||[]}getSelectableItemsByGroup(){return[]}getSelectedItem(){return this._selectedItem}select(n,t,i){if(this._selectedItem){let n=_ge(this._selectedItem.id);n&&n.blur();this._selectedItem.selected=!1}if(this._selectedItem=n,this._selectedItem){let n=_ge(this._selectedItem.id);n&&n.focus();this._selectedItem.selected=!0}this._page.updatePopoverView(this.getDataModel(i))}submit(t){if(t.action){let i=n.getCurrentTime();if(t.instItem){n.InstrumentationHelper.instrumentItemClick(i,t.instItem,t.sequenceNumber,null,2,null);let r=this.getSelectableItems();for(let t of r){let i=t;i.instItem&&n.InstrumentationHelper.instrumentSyntheticInstrumentedItem(i.sequenceNumber,i.instItem.getQsCode(),i.instItem)}}t.action()}}onAfterKeyDown(t){if(t=n.getRtlAdjustedKey(t),t==39||t==37){let n=this.getSelectableItems();if(n.length>0){let r=this.getSelectedItem(),i=n.indexOf(r);i+=t==39?1:-1;i<0?this.select(n[n.length-1],!1):this.select(n[i%n.length],!1)}return!0}return t==13}onItemClick(n,t){t.button==0&&this.submit(n)}onMouseLeavesParent(){this.waitForEnterBeforeDismiss()}waitForEnterBeforeDismiss(){this.clearDismissTimer();this._dismissTimer=n.safeSetTimeout(()=>{this._dismissTimer=null,!this._parentElement||this._parentElement.matches(":hover")||n.StaticHtmlElements.popoverContainer.matches(":hover")||this.dismiss()},100,"waitForDismiss")}clearDismissTimer(){this._dismissTimer&&(sb_ct(this._dismissTimer),this._dismissTimer=null)}getDataModel(n){return{text:this._text,items:this._buttons,clickHandler:(n,t)=>this.onItemClick(n,t),className:this._className,isSideBeak:n}}showPopoverAtSide(r,u){if(this._text){const f=n.StaticHtmlElements.popoverContainer;let e=f.offsetWidth+1,o=n.StaticHtmlElements.root.offsetWidth-2*i;e>o&&(e=o);let s=r,h=u-t;s+=t*2;f.style.width=e+"px";f.style.left=`${s}px`;f.style.top=`${h}px`;let c=_qs(".popover .beak.sidebeak",n.StaticHtmlElements.popoverContainer);c.style.top=`${t*4}px`;this._finishedOpening=!0}}showPopoverAtTop(r,u){if(this._text){const o=n.StaticHtmlElements.popoverContainer;let f=o.offsetWidth+1,s=n.StaticHtmlElements.root.offsetWidth-2*i;f>s&&(f=s);let e=0,h=n.StaticHtmlElements.root.offsetHeight-u;r-=f/2;h+=t;r<i?e=i-r:r+f>n.StaticHtmlElements.root.offsetWidth-i&&(e=n.StaticHtmlElements.root.offsetWidth-i-(r+f));o.style.width=f+"px";o.style.left=`${r+e}px`;o.style.bottom=`${h}px`;e<f/-2+t?e=f/-2+t:e>f/2-t&&(e=f/2-t);let c=_qs(".popover .beak",n.StaticHtmlElements.popoverContainer);c.style.left=`calc(50% - ${e}px`;this._finishedOpening=!0}}showPopoverAt(t,i,u,f){n.setVisibility(n.StaticHtmlElements.popoverContainer,!0);let o=this.getDataModel(f);this._page.updatePopoverView(o);const e="renderPopover";n.safeSetTimeout(()=>{if(f?this.showPopoverAtSide(t,i):this.showPopoverAtTop(t,i),n.StaticHtmlElements.popoverContainer.classList.add(r),u&&this._buttons&&this._buttons.length!=0)this.select(this.getSelectableItems()[0],!1,f);else{let t=n.StaticHtmlElements.popoverContainer.firstElementChild;t.focus()}n.Host.setFocusInWebView(e)},0,e)}}n.PopoverFactory=u}(WSB||(WSB={})),function(n){function e(n,t){return n<<t|n>>>32-t}function t(n,t){let i=(n&65535)+(t&65535),r=(n>>16)+(t>>16)+(i>>16);return r<<16|i&65535}function c(n,t,i){return n&t|~n&i}function l(n,t,i){return n&i|t&~i}function a(n,t,i){return n^t^i}function v(n,t,i){return t^(n|~i)}function i(n,i,r,u,f,o,s){return n=t(n,t(t(c(i,r,u),f),s)),t(e(n,o),i)}function r(n,i,r,u,f,o,s){return n=t(n,t(t(l(i,r,u),f),s)),t(e(n,o),i)}function u(n,i,r,u,f,o,s){return n=t(n,t(t(a(i,r,u),f),s)),t(e(n,o),i)}function f(n,i,r,u,f,o,s){return n=t(n,t(t(v(i,r,u),f),s)),t(e(n,o),i)}function y(n){let t=[],i=n.length*8;t[(n.length>>2)-1]=undefined;for(let n=0;n<t.length;n+=1)t[n]=0;for(let r=0;r<i;r+=8)t[r>>5]|=(n.charCodeAt(r/8)&255)<<r%32;return t[i>>5]|=128<<i%32,t[(i+64>>>9<<4)+14]=i,t}function o(n){let t="",i="";for(let r=0;r<=3;r++){let u=n>>>r*8&255;i="0"+u.toString(16);t=t+i.substr(i.length-2,2)}return t}function s(n){let st,ht,ct,lt,e=1732584193,s=4023233417,h=2562383102,c=271733878;const a=7,v=12,p=17,w=22,b=5,k=9,d=14,g=20,nt=4,tt=11,it=16,rt=23,ut=6,ft=10,et=15,ot=21;n=unescape(encodeURIComponent(n));let l=y(n);for(let n=0;n<l.length;n+=16)st=e,ht=s,ct=h,lt=c,e=i(e,s,h,c,l[n+0],a,3614090360),c=i(c,e,s,h,l[n+1],v,3905402710),h=i(h,c,e,s,l[n+2],p,606105819),s=i(s,h,c,e,l[n+3],w,3250441966),e=i(e,s,h,c,l[n+4],a,4118548399),c=i(c,e,s,h,l[n+5],v,1200080426),h=i(h,c,e,s,l[n+6],p,2821735955),s=i(s,h,c,e,l[n+7],w,4249261313),e=i(e,s,h,c,l[n+8],a,1770035416),c=i(c,e,s,h,l[n+9],v,2336552879),h=i(h,c,e,s,l[n+10],p,4294925233),s=i(s,h,c,e,l[n+11],w,2304563134),e=i(e,s,h,c,l[n+12],a,1804603682),c=i(c,e,s,h,l[n+13],v,4254626195),h=i(h,c,e,s,l[n+14],p,2792965006),s=i(s,h,c,e,l[n+15],w,1236535329),e=r(e,s,h,c,l[n+1],b,4129170786),c=r(c,e,s,h,l[n+6],k,3225465664),h=r(h,c,e,s,l[n+11],d,643717713),s=r(s,h,c,e,l[n+0],g,3921069994),e=r(e,s,h,c,l[n+5],b,3593408605),c=r(c,e,s,h,l[n+10],k,38016083),h=r(h,c,e,s,l[n+15],d,3634488961),s=r(s,h,c,e,l[n+4],g,3889429448),e=r(e,s,h,c,l[n+9],b,568446438),c=r(c,e,s,h,l[n+14],k,3275163606),h=r(h,c,e,s,l[n+3],d,4107603335),s=r(s,h,c,e,l[n+8],g,1163531501),e=r(e,s,h,c,l[n+13],b,2850285829),c=r(c,e,s,h,l[n+2],k,4243563512),h=r(h,c,e,s,l[n+7],d,1735328473),s=r(s,h,c,e,l[n+12],g,2368359562),e=u(e,s,h,c,l[n+5],nt,4294588738),c=u(c,e,s,h,l[n+8],tt,2272392833),h=u(h,c,e,s,l[n+11],it,1839030562),s=u(s,h,c,e,l[n+14],rt,4259657740),e=u(e,s,h,c,l[n+1],nt,2763975236),c=u(c,e,s,h,l[n+4],tt,1272893353),h=u(h,c,e,s,l[n+7],it,4139469664),s=u(s,h,c,e,l[n+10],rt,3200236656),e=u(e,s,h,c,l[n+13],nt,681279174),c=u(c,e,s,h,l[n+0],tt,3936430074),h=u(h,c,e,s,l[n+3],it,3572445317),s=u(s,h,c,e,l[n+6],rt,76029189),e=u(e,s,h,c,l[n+9],nt,3654602809),c=u(c,e,s,h,l[n+12],tt,3873151461),h=u(h,c,e,s,l[n+15],it,530742520),s=u(s,h,c,e,l[n+2],rt,3299628645),e=f(e,s,h,c,l[n+0],ut,4096336452),c=f(c,e,s,h,l[n+7],ft,1126891415),h=f(h,c,e,s,l[n+14],et,2878612391),s=f(s,h,c,e,l[n+5],ot,4237533241),e=f(e,s,h,c,l[n+12],ut,1700485571),c=f(c,e,s,h,l[n+3],ft,2399980690),h=f(h,c,e,s,l[n+10],et,4293915773),s=f(s,h,c,e,l[n+1],ot,2240044497),e=f(e,s,h,c,l[n+8],ut,1873313359),c=f(c,e,s,h,l[n+15],ft,4264355552),h=f(h,c,e,s,l[n+6],et,2734768916),s=f(s,h,c,e,l[n+13],ot,1309151649),e=f(e,s,h,c,l[n+4],ut,4149444226),c=f(c,e,s,h,l[n+11],ft,3174756917),h=f(h,c,e,s,l[n+2],et,718787259),s=f(s,h,c,e,l[n+9],ot,3951481745),e=t(e,st),s=t(s,ht),h=t(h,ct),c=t(c,lt);return(o(e)+o(s)+o(h)+o(c)).toLowerCase()}function p(n){let t=s(n);if(t==null||t.length!==32)return null;for(let n=0;n<32;n++){let i=t[n];if(!(/^\d+$/.test(i)||i>="a"&&i<="f"))return null}t+=0;let i="";for(let n=0;n<11;n++){let r=t[n*3],u=t[n*3+1],f=t[n*3+2],e=((r>="a"?r.charCodeAt(0)-"a".charCodeAt(0)+10:r.charCodeAt(0)-"0".charCodeAt(0))<<8)+((u>="a"?u.charCodeAt(0)-"a".charCodeAt(0)+10:u.charCodeAt(0)-"0".charCodeAt(0))<<4)+(f>="a"?f.charCodeAt(0)-"a".charCodeAt(0)+10:f.charCodeAt(0)-"0".charCodeAt(0));i=w(i,e)}return i}function w(n,t){return n.concat(h[Math.floor(t/64)]).concat(h[t%64])}n.calculateMd5=s;const h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";n.generateKeyFromDomain=p}(WSB||(WSB={})),function(n){class t{constructor(){this.promise=new Promise(n=>this.signal=n)}}n.Flag=t;class i{constructor(){this.flags=[];this.locked=!1}lock(){if(this.locked){const n=new t;return this.flags.push(n),n.promise}return this.locked=!0,Promise.resolve()}release(){if(this.flags.length>0){const n=this.flags.shift();n.signal()}else this.locked=!1}isLocked(){return this.locked}}n.Mutex=i}(WSB||(WSB={}))